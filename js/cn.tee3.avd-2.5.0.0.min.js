/*! cn.tee3.avd-2.5.0.0 2017-06-21 02:11:51 */
function base64encode(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";c<d;){if(e=255&a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2|(192&g)>>6),b+=base64EncodeChars.charAt(63&g)}return b}function base64decode(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";f<g;){do b=base64DecodeChars[255&a.charCodeAt(f++)];while(f<g&&b==-1);if(b==-1)break;do c=base64DecodeChars[255&a.charCodeAt(f++)];while(f<g&&c==-1);if(c==-1)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=base64DecodeChars[d]}while(f<g&&d==-1);if(d==-1)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=base64DecodeChars[e]}while(f<g&&e==-1);if(e==-1)break;h+=String.fromCharCode((3&d)<<6|e)}return h}function utf16to8(a){var b,c,d,e;for(b="",d=a.length,c=0;c<d;c++)e=a.charCodeAt(c),e>=1&&e<=127?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b}function utf8to16(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;c<d;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b}function doit(){var a=document.f;a.output.value=base64encode(utf16to8(a.source.value)),a.decode.value=utf8to16(base64decode(a.output.value))}function trace(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+a)}function maybeFixConfiguration(a){if(a)for(var b=0;b<a.iceServers.length;b++)a.iceServers[b].hasOwnProperty("urls")&&(a.iceServers[b].url=a.iceServers[b].urls,delete a.iceServers[b].urls)}function getPlugin(){var a=document.getElementById(WebRTCPlugin.pluginInfo.pluginId);return a.logSeverity="info",a}function mergeConstraints(a,b){var c=a;for(var d in b){var e=d.substring(0,1).toUpperCase()+d.substring(1);"offerToReceiveAudio"==d||"offerToReceiveVideo"==d?c.mandatory[e]=b[d]:c.optional[e]=b[d]}return c}function SdpSerializer(a){function b(a){if(i[a])if(q=="a=mid:"+a){var b=o[p-1];b&&(i[a].direction=b.split("a=")[1],i[a].attributes.pop(1)),n=!0,i[a]["a=mid:"+a]={line:q,attributes:[]}}else if(n)if(0==q.indexOf("a=crypto:"))i[a].crypto[q.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=q;else if(0==q.indexOf("a=rtpmap:")){var c=q.split("a=rtpmap:")[1].split(" ");i[a].payload[c[0]]=c[1],function b(){q=o[p+1],q&&q.indexOf("a=rtpmap:")==-1&&q.indexOf("m=")==-1&&(q.indexOf("a=ssrc")==-1&&(i[a].payload[c[0]]+="\r\n"+q),q.indexOf("a=ssrc")!=-1&&i[a].ssrc.push(q),p++,b())}()}else i[a]["a=mid:"+a].attributes.push(q);else i[a].attributes.push(q);else if(i[a]={line:q,attributes:[],payload:{},ssrc:[],crypto:{}},q.indexOf("RTP/SAVPF")!=-1)for(var d=q.split("RTP/SAVPF ")[1].split(" "),e=0;e<d.length;e++)i[a].payload[d[e]]=""}function c(a){if(i[a]){for(var b=[],c="",d=0;d<i[a].ssrc.length;d++){var e=i[a].ssrc[d];""==c?c=e:c+="\r\n"+e,e.indexOf("cname:")!=-1&&b.push([]),b.length>0&&b[b.length-1].push(e)}i[a].ssrc=b,i[a].ssrcStr=c}}function d(a){i[a]&&delete i[a];for(var b=0;b<j.length;b++)if(j[b].indexOf("a=group")!=-1){var c=j[b].split("a=group:BUNDLE ")[1].split(" ");j[b]="a=group:BUNDLE";for(var d=0;d<c.length;d++)c[d]!=a&&(j[b]+=" "+c[d])}}function e(a,b){if(i[b]&&i[b].line.indexOf(a)!=-1&&(i[b].payload[a]&&delete i[b].payload[a],i[b].line.indexOf("RTP/SAVPF")!=-1)){for(var c=i[b].line.split("RTP/SAVPF ")[1].split(" "),d=0;d<c.length;d++)c[d]==a&&delete c[d];c=swap(c),i[b].line=i[b].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+c.join(" ")}}function f(a,b,c){if(i[c]&&i[c].line.indexOf(a)!=-1&&i[c].line.indexOf("RTP/SAVPF")!=-1){for(var d=i[c].line.split("RTP/SAVPF ")[1].split(" "),e=[],f=0;f<d.length;f++)d[f]==a&&(e[b]=d[f],delete d[f]);for(var f=0;f<d.length;f++)f<b&&(e[f]=d[f]),f>=b&&(e[f+1]=d[f]);e=swap(e),i[c].line=i[c].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+e.join(" ")}}function g(a,b){if(!i[b])return a;a+=i[b].line+"\r\n";for(var c=0;c<i[b].attributes.length;c++)a+=i[b].attributes[c]+"\r\n";i[b].direction&&(a+="a="+i[b].direction+"\r\n"),a+="a=mid:"+b+"\r\n";for(var c=0;c<i[b]["a=mid:"+b].attributes.length;c++)i[b]["a=mid:"+b].attributes[c]&&(a+=i[b]["a=mid:"+b].attributes[c]+"\r\n");for(var d in i[b].crypto)a+=i[b].crypto[d]+"\r\n";if(i[b].line.indexOf("RTP/SAVPF")!=-1)for(var e=i[b].line.split("RTP/SAVPF ")[1].split(" "),f=0;f<e.length;f++){var g=e[f];g&&(a+="a=rtpmap:"+g+" "+i[b].payload[g]+"\r\n")}for(var h=0;h<i[b].ssrc.length;h++)for(var j=i[b].ssrc[h],k=0;k<j.length;k++)a+=j[k]+"\r\n";return a}function h(a){return{mLine:a,payload:function(a){return i[this.mLine]&&i[this.mLine].payload[a]||log.error(a,"doesn'nt exits."),{payload:a,mLine:this.mLine,newLine:function(a){i[this.mLine].payload[this.payload]+="\r\n"+a},remove:function(){e(this.payload,this.mLine)},order:function(a){f(this.payload,a,this.mLine)}}},remove:function(){d(this.mLine)},isRejected:function(){var a=i[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(a)},crypto:function(a){var b=i[this.mLine].crypto[a];return{mLine:this.mLine,remove:function(){b&&delete i[this.mLine].crypto[a]},newLine:function(a){i[this.mLine].crypto[a.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=a}}},track:function(b){var c=i[a].ssrc[b];return{ssrc:c,set:function(a){i[this.mLine].ssrc[b]=a},mLine:this.mLine,remove:function(){c&&(delete i[a].ssrc[b],i[a].ssrc=swap(i[a].ssrc))}}}}}for(var i={},j=[],k=!1,l=!1,m=!1,n=!1,o=a.split("\r\n"),p=0;p<o.length;p++){var q=o[p];k||0==q.indexOf("m=audio")?(k=!0,b("audio"),q=o[p+1],q&&0==q.indexOf("m=video")&&(n=k=!1)):l||0==q.indexOf("m=video")?(l=!0,b("video"),q=o[p+1],q&&0==q.indexOf("m=application")&&(n=l=!1)):m||0==q.indexOf("m=application")?(m=!0,b("data")):j.push(q)}!function(){c("audio"),c("video"),c("data")}(),this.deserialize=function(){for(var a="",b=0;b<j.length;b++)a+=j[b]+"\r\n";return a=g(a,"audio"),a=g(a,"video"),a=g(a,"data")},this.audio=h("audio"),this.video=h("video"),this.data=h("data"),this._inner=i}function swap(a){for(var b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(a){return"function"==typeof a}function isNumber(a){return"number"==typeof a}function isObject(a){return"object"==typeof a&&null!==a}function isUndefined(a){return void 0===a}function getRandomNum(a,b){var c=b-a,d=Math.random();return a+Math.round(d*c)}function resizeVideo(a,b,c){doResizeVideo(a,b,c,!1)}function resizeRealVideo(a,b,c){doResizeVideo(a,b,c,!0)}function doResizeVideo(a,b,c,d){b||(b=window.innerWidth),c||(c=window.innerHeight),a.addEventListener("loadedmetadata",function(e){var f=this.videoWidth,g=this.videoHeight;positionLarge(a,f,g,b,c,d)})}function positionLarge(a,b,c,d,e,f){var g;g=f?getCameraRealVideoSize(b,c,d,e):getCameraVideoSize(b,c,d,e);var h=g[0],i=g[1],j=getCameraVideoPosition(h,i,d,e),k=j[0],l=j[1];f?positionRealVideo(a,h,i,k,l):positionVideo(a,h,i,k,l)}function getCameraVideoSize(a,b,c,d){var e=a/b,c=Math.max(a,c),d=Math.max(b,d);return c/e<d&&(d=d,c=d*e),d*e<c&&(c=c,d=c/e),[c,d]}function getCameraRealVideoSize(a,b,c,d){var e=a/b,f=Math.max(a,c),g=Math.max(b,d);if(f>=a&&g>=b){var h=c/d;e>h?(c=c,d=c/e):(d=d,c=d*e)}else{var c=f,d=g;c/e>d&&(d=d,c=d*e),d*e>c&&(c=c,d=c/e)}return[c,d]}function getCameraVideoPosition(a,b,c,d){var e=(c-a)/2,f=(d-b)/2;return[e,f]}function positionVideo(a,b,c,d,e){a.setAttribute("width",b),a.setAttribute("height",c)}function positionRealVideo(a,b,c,d,e){a.setAttribute("width",b),a.setAttribute("height",c);var f=a.parentNode;f.style.top=e+"px",f.style.bottom=e+"px",f.style.left=d+"px",f.style.right=d+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(a,b){a.requestFullScreen=a.webkitRequestFullScreen||a.mozRequestFullScreen||a.requestFullScreen,isFullScreen()&&b.target!==a||fullScreenElement()===a?document.cancelFullScreen():b.target===a?a.requestFullScreen():a.requestFullScreen()}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(a){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var b=window.createPopup(),c=b.document.body;c.style.backgroundColor="lime",c.style.border="solid black 1px",c.innerHTML="在鼠标点击窗口以外区域时自动关闭";var d=b.document.createElement("object"),e=Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window;if(e){var f=b.document.createElement("param");f.setAttribute("name","windowless"),f.setAttribute("value",!0),d.appendChild(f),d.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else d.setAttribute("type","application/avd-plugin");d.setAttribute("id","fullScreen"),d.setAttribute("width",winWidth),d.setAttribute("height",winHeight),d.src=a,c.appendChild(d),b.show(0,0,winWidth,winHeight,document.body)}function getBrowserType(){return RTCBrowserType.RTC_BROWSER_CHROME}function PeerStats(){this.ssrc2Loss={},this.ssrc2resolution={},this.ssrc2bitrate={},this.ssrc2AudioLevel={}}function formatAudioLevel(a){return Math.min(Math.max(a,0),1)}function calculatePacketLoss(a,b){return!b||b<=0||!a||a<=0?0:Math.round(a/b*100)}function getStatValue(a,b){if(!keyMap[getBrowserType()][b])throw"The property isn't supported!";var c=keyMap[getBrowserType()][b];return getBrowserType()==RTCBrowserType.RTC_BROWSER_CHROME?a.stat(c):a[c]}function getIP(a){return a.substring(0,a.lastIndexOf(":"))}function getPort(a){return a.substring(a.lastIndexOf(":")+1,a.length)}function getStringFromArray(a){for(var b="",c=0;c<a.length;c++)b+=(0===c?"":", ")+a[c];return b}function ConnectionInfoCollector(a,b){this.peerconnection=a,this.statsInterval=b,this.currentStatsReport=null,this.baselineStatsReport=null,this.statsIntervalId=null,this.jid=1,this.jid2stats={},this.resolution}function AudioLevel(a,b){this.peerconnection=a,this.audioLevelsIntervalMilis=b,this.audioLevelsIntervalId=null,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null}function timeDomainDataToAudioLevel(a){for(var b=0,c=a.length,d=0;d<c;d++)b<a[d]&&(b=a[d]);return parseFloat(((b-127)/128).toFixed(3))}function animateLevel(a,b){var c=0,d=b-a;return c=d>.2?b-.2:d<-.4?b+.4:a,parseFloat(c.toFixed(3))}function LocalStatsCollector(a,b,c){this.stream=a,this.intervalId=null,this.intervalMilis=b,this.audioLevel=0,this.callback=c}function isAndroid(){var a=navigator.userAgent.indexOf("Android")!=-1;return a}function getPreviousResolution(a){if(!Resolutions[a])return null;var b=Resolutions[a].order,c=null,d=null;for(var e in Resolutions){var f=Resolutions[e];(null==c||c.order<f.order&&f.order<b)&&(d=e,c=f)}return d}function getConstraints(a,b){var c={audio:!1,video:!1};return a&&(c.audio={mandatory:{},optional:[]}),b&&(c.video={mandatory:{},optional:[]}),c.audio&&(c.audio.optional.push({googEchoCancellation:!0},{googAutoGainControl:!0},{googNoiseSuppression:!0},{googHighpassFilter:!0},{googNoisesuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0}),a.id&&(c.audio.mandatory.sourceId=a.id)),c.video&&(c.video.optional.push({googNoiseReduction:!1}),b.id&&(c.video.mandatory.sourceId=b.id)),b&&(b.resolution&&setResolutionConstraints(c,b.resolution),b.frameRate&&setFrameRateConstraints(c,b.frameRate)),c}function setResolutionConstraints(a,b){b&&!a.video&&(a.video={mandatory:{},optional:[]}),b&&(a.video.mandatory.minWidth=b.width,a.video.mandatory.minHeight=b.height,currentVideoParameter.videoWidth=b.width,currentVideoParameter.videoHeight=b.height),a.video.mandatory.minWidth&&(a.video.mandatory.maxWidth=a.video.mandatory.minWidth),a.video.mandatory.minHeight&&(a.video.mandatory.maxHeight=a.video.mandatory.minHeight)}function setFrameRateConstraints(a,b){b&&!a.video&&(a.video={mandatory:{},optional:[]}),b&&(a.video.mandatory.minFrameRate=b,a.video.mandatory.maxFrameRate=b,currentVideoParameter.frameRate=b)}function obtainUserMedia(a,b,c,d){"firefox"==webrtcDetectedBrowser?null!=a&&null!=b?getUserMediaWithConstraints(a,!1,function(a){getUserMediaWithConstraints(!1,b,function(b){var d=handleLocalStream({audioStream:a,videoStream:b});c(d)},function(a){d(a)})},function(a){d(a)}):null!=a&&null==b?getUserMediaWithConstraints(a,!1,function(a){var b=handleLocalStream({audioStream:a,videoStream:null});c(b)},function(a){d(a)}):null==a&&null!=b&&getUserMediaWithConstraints(!1,b,function(a){var b=handleLocalStream({audioStream:null,videoStream:a});c(b)},function(a){d(a)}):getUserMediaWithConstraints(a,b,function(a){c(handleLocalStream(a))},function(a){d(a)})}function getUserMediaWithConstraints(a,b,c,d){var e=getConstraints(a,b);try{getUserMedia(e,function(a){c(a)},function(a){var b,c=ModuleBase.use(ModulesEnum.error);b=new c("PermissionDeniedError"==a.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==a.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==a.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),d&&d(b)})}catch(a){var f=ModuleBase.use(ModulesEnum.error),g=new f(ErrorConstant.navigatorUserMediaError_unknown);d&&d(g)}}function handleLocalStream(a){var b,c;if("chrome"==webrtcDetectedBrowser){if(b=new webkitMediaStream,c=new webkitMediaStream,a){for(var d=a.getAudioTracks(),e=0;e<d.length;e++)b.addTrack(d[e]);var f=a.getVideoTracks();for(e=0;e<f.length;e++)c.addTrack(f[e])}}else if("Internet Explorer"==webrtcDetectedBrowser){if(b=null,c=null,a){var d=a.getAudioTracks();if(d.length>0){var g=a.clone();g.removeTrack(d[0]),c=g}else c=a;var f=a.getVideoTracks();if(f.length>0){var g=a.clone();g.removeTrack(f[0]),b=g}else b=a}}else"firefox"==webrtcDetectedBrowser&&(b=a.audioStream,c=a.videoStream);return{audioStream:b,videoStream:c}}function getFakeVideoStream(a){navigator.getUserMedia(fakeVideoConstraints,function(b){a(b)},function(a){})}function getFakeAudioStream(a){navigator.getUserMedia(fakeAudioConstraints,function(b){a(b)},function(a){})}function getAllAudioVideoDevices(a,b){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),!navigator.enumerateDevices)return void b(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.");var c=[],d=[],e=[],f=[],g=[],h=[];navigator.enumerateDevices(function(b){b.forEach(function(a){var b={};for(var i in a)b[i]=a[i];var j;c.forEach(function(a){a.id===b.id&&(j=!0)}),j||("audio"===b.kind&&(b.kind="audioinput"),"video"===b.kind&&(b.kind="videoinput"),b.deviceId||(b.deviceId=b.id),b.id||(b.id=b.deviceId),b.label||(b.label="Please invoke getUserMedia once."),"audioinput"!==b.kind&&"audio"!==b.kind||f.push(b),"audiooutput"===b.kind&&g.push(b),"videoinput"!==b.kind&&"video"!==b.kind||h.push(b),b.kind.indexOf("audio")!==-1&&d.push(b),b.kind.indexOf("video")!==-1&&e.push(b),c.push(b))}),a&&a({allMdiaDevices:c,allVideoDevices:e,allAudioDevices:d,videoInputDevices:h,audioInputDevices:f,audioOutputDevices:g})})}function captureUserMedia(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b)}function saveLog(a,b,c){var d=document.location.protocol,e=d+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password,f="";"undefined"!=typeof returnCitySN&&(f=returnCitySN.cip);var g=(1e3*(new Date).getTime()*1e3,""),h="",i="",j="",k=0;room&&(room.id&&(g=room.id),room.selfUser&&(room.selfUser.name&&(h=room.selfUser.name),room.selfUser.id&&(i=room.selfUser.id))),browserDetect&&browserDetect.detect&&browserDetect.detect.browser&&(browserDetect.detect.browser.name&&(j=browserDetect.detect.browser.name),browserDetect.detect.browser.fullVersion&&(k=browserDetect.detect.browser.fullVersion));var l='js_log host_ip="'+f+'",roomId="'+g+'",userName="'+h+'",userId="'+i+'",browserName="'+j+'",browserVersion="'+k+'",level="'+a+'",msg="'+b+'" ';$.ajax({type:"post",url:e,timeout:5e3,data:l,success:function(a){},error:function(a,b,c){}})}function getFingerPrint(a){var b=null;console.log(a);for(var c=a.split("\r\n"),d=0;d<c.length;d++)if(c[d].indexOf("a=fingerprint")>-1){var e=c[d].split(" ");b=e[1];break}return console.log(b),b}function updateSDPFingerPrint(a,b){var c=preferLineSdp(a,"a=","fingerprint");if(null!=c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];a=a.replace(e,"a=fingerprint:sha-1 "+b)}return a}function updateSDPIceUfrag(a,b){var c=preferLineSdp(a,"a=","ice-ufrag");if(null!=c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];a=a.replace(e,"a=ice-ufrag:"+b)}return a}function updateSDPIcePwd(a,b){var c=preferLineSdp(a,"a=","ice-pwd");if(null!=c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];a=a.replace(e,"a=ice-pwd:"+b)}return a}function updateSDPSetup(a,b){var c=preferLineSdp(a,"a=","setup");if(null!=c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];a=a.replace(e,"a=setup:"+b)}return a}function preferLineSdp(a,b,c){var d=[],e=a.split("\r\n"),f=findLine(e,b,c);if(null!=f&&f.length>0)for(var g=0;g<f.length;g++)d.push(e[f[g]]);return d}function findLine(a,b,c){return findLineInRange(a,0,-1,b,c)}function findLineInRange(a,b,c,d,e){for(var f=[],g=c!==-1?c:a.length,h=b;h<g;++h)0===a[h].indexOf(d)&&(e&&a[h].toLowerCase().indexOf(e.toLowerCase())===-1||f.push(h));return f}function findLine1(a,b,c){return findLineInRange1(a,0,-1,b,c)}function findLineInRange1(a,b,c,d,e){for(var f=c!==-1?c:a.length,g=b;g<f;++g)if(0===a[g].indexOf(d)&&(!e||a[g].toLowerCase().indexOf(e.toLowerCase())!==-1))return g;return null}function preferBitRate(a,b,c){var d=a.split("\r\n"),e=findLine1(d,"m=",c);if(null===e)return trace("Failed to add bandwidth line to sdp, as no m-line found"),a;var f=findLineInRange1(d,e+1,-1,"m=");null===f&&(f=d.length);var g=findLineInRange1(d,e+1,f,"c=");if(null===g)return trace("Failed to add bandwidth line to sdp, as no c-line found"),a;var h=findLineInRange1(d,g+1,f,"b=AS");h&&d.splice(h,1);var i="b=AS:"+b;return d.splice(g+1,0,i),a=d.join("\r\n")}function firefoxRemoveStream(a,b){b&&a.getSenders().forEach(function(c){var d=b.getTracks();d.forEach(function(b){b==c.track&&a.removeTrack(c)})})}function checkSdpContents(a,b){var c=0,d=toSessionJSON(a,{});for(var e in d.contents){var f=d.contents[e];f.description.media==b&&(c+=1)}return c}function checkRemoteMsids(a,b){var c=[],d=toSessionJSON(a,{});for(var e in d.contents){var f=d.contents[e];if(f.description.media==b){var g=f.description.sources;for(var h in g){var i=g[h],j=i.parameters;for(var k in j){var l=j[k];"msid"==l.key&&""!=l.value&&c.push(l.value)}}}}return unique(c).length}function checkLocalMsids(a,b){var c=[],d=toSessionJSON(a,{});for(var e in d.contents){var f=d.contents[e];if(f.description.media==b){var g=f.description.msid;null!=g&&null!=g.msid&&null!=g.trackId&&c.push(g.streamId+" "+g.trackId)}}return unique(c).length}function unique(a){for(var b,c=[],d={},e=0;null!=(b=a[e]);e++)d[b]||(c.push(b),d[b]=!0);return c}function addGroupContents(a,b){if(b<=0)return a;for(var c=toSessionJSON(a,{}),d=c.groups[0],e=d.contents.length,f=0;f<b;f++){var g=e+f,h="sdparta_"+g;d.contents.push(h)}return toSessionSDP(c,{})}function updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(a,b,c,d,e){var f=toSessionJSON(a,{});for(var g in f.contents){var h=f.contents[g];b&&h.transport.fingerprints.length>0&&(h.transport.fingerprints[0].value=b),c&&h.transport.fingerprints.length>0&&(h.transport.fingerprints[0].setup=c),d&&(h.transport.ufrag=d),e&&(h.transport.pwd=e)}return toSessionSDP(f,{})}function updateSDPSenders(a,b,c){var d=toSessionJSON(a,{});for(var e in d.contents){var f=d.contents[e];f.description.media==b&&(f.senders=c)}return toSessionSDP(d,{})}function getSdpSsrc(a,b,c){var d=toSessionJSON(a,{});for(var e in d.contents){var f=d.contents[e];if(f.description.media==b){if("firefox"!=webrtcDetectedBrowser)return getSdpSsrcHandle(f.description);var g=f.description.msid;if(g.streamId==c)return getSdpSsrcByFirefox2ChromeHandle(f.description)}}}function getSdpSsrcHandle(a){var b="",c=a.sourceGroups;for(var d in c){var e=c[d],f=e.semantics,g=e.sources;b+="a=ssrc-group:"+f+" "+g.join(" ")+"\r\n"}var g=a.sources;for(var d in g){var h=g[d],i=h.ssrc,j=h.parameters;for(var k in j){var l=j[k];b+="a=ssrc:"+i+" "+l.key+":"+l.value+"\r\n"}}return b=b.replace(/^\n+|\n+$/g,"")}function getSdpSsrcByFirefox2ChromeHandle(a){var b,c,d=getSdpSsrcHandle(a),e=a.msid;if(d.length){var f=d.split(" "),g=f[0].split(":"),h=f[1].split(":");b=g[1],c=h[1]}var i=d+"\r\n";return i+="a=ssrc:"+b+" msid:"+e.streamId+" "+e.trackId+"\r\n",i+="a=ssrc:"+b+" mslabel:"+e.streamId+"\r\n",i+="a=ssrc:"+b+" label:"+e.trackId}function addSdpSsrc(a,b,c){var d=toSessionJSON(a,{}),e=0,f=0;for(var g in d.contents){var h=d.contents[g];h.description.media==c&&(f+=1)}for(var g in d.contents){var h=d.contents[g];if(h.description.media==c){e+=1;var i=!1;e==f&&(i=!0),h.description=addSdpSsrcByFirefoxHandle(d,h.description,b,c,i)}}return toSessionSDP(d,{})}function addSdpSsrcByFirefoxHandle(a,b,c,d,e){var f=sdpLines(c),g=toSessionSDP(a,{});if(g.indexOf(f[0])>0)return b;if(1==e){var h=b.sources;if(null!=h&&h.length>0){var i=a.groups[0],j=i.contents.length,k="sdparta_"+j;if(i.contents.push(k),"video"==d){var l=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirefox_video,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd),m=toSessionJSON(l,{}),n=m.contents[0];n.name=k,n.description=addSdpSsrcHandle(n.description,c),a.contents.push(n)}else if("audio"==d){remoteSDPFirfox_audio=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(remoteSDPFirfox_audio,room.fingerPrint,room.setup,room.iceUfragForFirefox,room.icePwd);var o=toSessionJSON(remoteSDPFirfox_audio,{}),p=o.contents[0];p.name=k,p.description=addSdpSsrcHandle(p.description,c),a.contents.push(p)}return b}return addSdpSsrcHandle(b,c)}var h=b.sources;return null!=h&&h.length>0?b:addSdpSsrcHandle(b,c)}function addSdpSsrcHandle(a,b){for(var c=sdpLines(b),d=findLinesInFirefox("a=ssrc-group:",c),e=sourceGroups(d||[]),f=findLinesInFirefox("a=ssrc:",c),g=sources(f||[]),h=0;h<e.length;h++)a.sourceGroups.push(e[h]);for(var h=0;h<g.length;h++)a.sources.push(g[h]);return a}function delRemoveSdp(a,b,c){var d,e,f=0,g=toSessionJSON(a,{}),h=g.groups[0].contents,i=h.length;for(var j in g.contents){var k=g.contents[j];k.description.media==c&&(f+=1)}var l=-1;for(var j in g.contents){var k=g.contents[j];if(k.description.media==c){var m=k.description.sources;for(var n in m){var o=m[n],p=o.parameters;for(var q in p){var r=p[q];if("msid"==r.key&&""!=r.value){var s=b.indexOf(r.value);if(s>=0){l=s;break}}}if(l>=0)break}if(f>1){if(l>=0){var t=k.name;arrayUtil.objectNameSplice(g.contents,t),arrayUtil.baseSplice(h,t);var e=t.split("_")[1];break}for(var u=b.split("\r\n"),q=0;q<u.length;q++){var v=u[q]+"\r\n";a=a.replace(v,""),d=a}}}}if(d=toSessionSDP(g,{}),e)for(var q=0;q<i;q++)if(e<q){var w=q-1;d=d.replace("sdparta_"+q,"sdparta_"+w),d=d.replace("sdparta_"+q,"sdparta_"+w)}return d}function getSDPSenders(a){var b=[],c="initiator",d="outgoing",e=toSessionJSON(a,{});for(var f in e.contents){var g=e.contents[f],h=g.name,i=g.senders,j=SENDERS[c][d][i];b[h]=j}return b}function setSDPSenders(a,b){var c="initiator",d="outgoing",e=toSessionJSON(a,{});for(var f in e.contents){var g=e.contents[f],h=g.name,i=g.senders,j=(SENDERS[c][d][i],b[h]);"sendonly"==j?g.senders="responder":"recvonly"==j?g.senders="initiator":"sendrecv"==j?g.senders="both":"inactive"==j&&(g.senders="none")}return toSessionSDP(e,{})}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);!function(a,b){function c(a){var b=oa[a]={};return $.each(a.split(ba),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(qa,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d||"false"!==d&&("null"===d?null:+d+""===d?+d:pa.test(d)?$.parseJSON(d):d)}catch(a){}$.data(a,c,d)}else d=b}return d}function e(a){var b;for(b in a)if(("data"!==b||!$.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function f(){return!1}function g(){return!0}function h(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function i(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function j(a,b,c){if(b=b||0,$.isFunction(b))return $.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return $.grep(a,function(a,d){return a===b===c});if("string"==typeof b){var d=$.grep(a,function(a){return 1===a.nodeType});if(Ka.test(b))return $.filter(b,d,!c);b=$.filter(b,d)}return $.grep(a,function(a,d){return $.inArray(a,b)>=0===c})}function k(a){var b=Na.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function l(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function m(a,b){if(1===b.nodeType&&$.hasData(a)){var c,d,e,f=$._data(a),g=$._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)$.event.add(b,c,h[c][d])}g.data&&(g.data=$.extend({},g.data))}}function n(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),$.support.html5Clone&&a.innerHTML&&!$.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Xa.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text),b.removeAttribute($.expando))}function o(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll("*"):[]}function p(a){Xa.test(a.type)&&(a.defaultChecked=a.checked)}function q(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=rb.length;e--;)if(b=rb[e]+c,b in a)return b;return d}function r(a,b){return a=b||a,"none"===$.css(a,"display")||!$.contains(a.ownerDocument,a)}function s(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)c=a[f],c.style&&(e[f]=$._data(c,"olddisplay"),b?(!e[f]&&"none"===c.style.display&&(c.style.display=""),""===c.style.display&&r(c)&&(e[f]=$._data(c,"olddisplay",w(c.nodeName)))):(d=cb(c,"display"),!e[f]&&"none"!==d&&$._data(c,"olddisplay",d)));for(f=0;f<g;f++)c=a[f],c.style&&(b&&"none"!==c.style.display&&""!==c.style.display||(c.style.display=b?e[f]||"":"none"));return a}function t(a,b,c){var d=kb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function u(a,b,c,d){for(var e=c===(d?"border":"content")?4:"width"===b?1:0,f=0;e<4;e+=2)"margin"===c&&(f+=$.css(a,c+qb[e],!0)),d?("content"===c&&(f-=parseFloat(cb(a,"padding"+qb[e]))||0),"margin"!==c&&(f-=parseFloat(cb(a,"border"+qb[e]+"Width"))||0)):(f+=parseFloat(cb(a,"padding"+qb[e]))||0,"padding"!==c&&(f+=parseFloat(cb(a,"border"+qb[e]+"Width"))||0));return f}function v(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e=!0,f=$.support.boxSizing&&"border-box"===$.css(a,"boxSizing");if(d<=0||null==d){if(d=cb(a,b),(d<0||null==d)&&(d=a.style[b]),lb.test(d))return d;e=f&&($.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+u(a,b,c||(f?"border":"content"),e)+"px"}function w(a){if(nb[a])return nb[a];var b=$("<"+a+">").appendTo(P.body),c=b.css("display");return b.remove(),"none"!==c&&""!==c||(db=P.body.appendChild(db||$.extend(P.createElement("iframe"),{frameBorder:0,width:0,height:0})),eb&&db.createElement||(eb=(db.contentWindow||db.contentDocument).document,eb.write("<!doctype html><html><body>"),eb.close()),b=eb.body.appendChild(eb.createElement(a)),c=cb(b,"display"),P.body.removeChild(db)),nb[a]=c,c}function x(a,b,c,d){var e;if($.isArray(b))$.each(b,function(b,e){c||ub.test(a)?d(a,e):x(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==$.type(b))d(a,b);else for(e in b)x(a+"["+e+"]",b[e],c,d)}function y(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(ba),h=0,i=g.length;if($.isFunction(c))for(;h<i;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function z(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;for(var h,i=a[f],j=0,k=i?i.length:0,l=a===Kb;j<k&&(l||!h);j++)h=i[j](c,d,e),"string"==typeof h&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=z(a,c,d,e,h,g)));return(l||!h)&&!g["*"]&&(h=z(a,c,d,e,"*",g)),h}function A(a,c){var d,e,f=$.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&$.extend(!0,a,e)}function B(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in d&&(c[k[f]]=d[f]);for(;"*"===j[0];)j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g)return g!==j[0]&&j.unshift(g),d[g]}function C(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;if(a.dataFilter&&(b=a.dataFilter(b,a.dataType)),g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if("*"!==e){if("*"!==h&&h!==e){if(c=i[h+" "+e]||i["* "+e],!c)for(d in i)if(f=d.split(" "),f[1]===e&&(c=i[h+" "+f[0]]||i["* "+f[0]])){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}if(c!==!0)if(c&&a.throws)b=c(b);else try{b=c(b)}catch(a){return{state:"parsererror",error:c?a:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function D(){try{return new a.XMLHttpRequest}catch(a){}}function E(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}function F(){return setTimeout(function(){Ub=b},0),Ub=$.now()}function G(a,b){$.each(b,function(b,c){for(var d=($b[b]||[]).concat($b["*"]),e=0,f=d.length;e<f;e++)if(d[e].call(a,b,c))return})}function H(a,b,c){var d,e=0,f=Zb.length,g=$.Deferred().always(function(){delete h.elem}),h=function(){
for(var b=Ub||F(),c=Math.max(0,i.startTime+i.duration-b),d=1-(c/i.duration||0),e=0,f=i.tweens.length;e<f;e++)i.tweens[e].run(d);return g.notifyWith(a,[i,d,c]),d<1&&f?c:(g.resolveWith(a,[i]),!1)},i=g.promise({elem:a,props:$.extend({},b),opts:$.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ub||F(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=$.Tween(a,i.opts,b,c,i.opts.specialEasing[b]||i.opts.easing);return i.tweens.push(e),e},stop:function(b){for(var c=0,d=b?i.tweens.length:0;c<d;c++)i.tweens[c].run(1);return b?g.resolveWith(a,[i,b]):g.rejectWith(a,[i,b]),this}}),j=i.props;for(I(j,i.opts.specialEasing);e<f;e++)if(d=Zb[e].call(i,a,j,i.opts))return d;return G(i,j),$.isFunction(i.opts.start)&&i.opts.start.call(a,i),$.fx.timer($.extend(h,{anim:i,queue:i.opts.queue,elem:a})),i.progress(i.opts.progress).done(i.opts.done,i.opts.complete).fail(i.opts.fail).always(i.opts.always)}function I(a,b){var c,d,e,f,g;for(c in a)if(d=$.camelCase(c),e=b[d],f=a[c],$.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=$.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function J(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],p=a.nodeType&&r(a);c.queue||(j=$._queueHooks(a,"fx"),null==j.unqueued&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,$.queue(a,"fx").length||j.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===$.css(a,"display")&&"none"===$.css(a,"float")&&($.support.inlineBlockNeedsLayout&&"inline"!==w(a.nodeName)?m.zoom=1:m.display="inline-block")),c.overflow&&(m.overflow="hidden",$.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b)if(f=b[d],Wb.exec(f)){if(delete b[d],f===(p?"hide":"show"))continue;o.push(d)}if(g=o.length)for(h=$._data(a,"fxshow")||$._data(a,"fxshow",{}),p?$(a).show():l.done(function(){$(a).hide()}),l.done(function(){var b;$.removeData(a,"fxshow",!0);for(b in n)$.style(a,b,n[b])}),d=0;d<g;d++)e=o[d],i=l.createTween(e,p?h[e]:0),n[e]=h[e]||$.style(a,e),e in h||(h[e]=i.start,p&&(i.end=i.start,i.start="width"===e||"height"===e?1:0))}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function L(a,b){var c,d={height:a},e=0;for(b=b?1:0;e<4;e+=2-b)c=qb[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function M(a){return $.isWindow(a)?a:9===a.nodeType&&(a.defaultView||a.parentWindow)}var N,O,P=a.document,Q=a.location,R=a.navigator,S=a.jQuery,T=a.$,U=Array.prototype.push,V=Array.prototype.slice,W=Array.prototype.indexOf,X=Object.prototype.toString,Y=Object.prototype.hasOwnProperty,Z=String.prototype.trim,$=function(a,b){return new $.fn.init(a,b,N)},_=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,aa=/\S/,ba=/\s+/,ca=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,da=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ea=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fa=/^[\],:{}\s]*$/,ga=/(?:^|:|,)(?:\s*\[)+/g,ha=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ia=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ja=/^-ms-/,ka=/-([\da-z])/gi,la=function(a,b){return(b+"").toUpperCase()},ma=function(){P.addEventListener?(P.removeEventListener("DOMContentLoaded",ma,!1),$.ready()):"complete"===P.readyState&&(P.detachEvent("onreadystatechange",ma),$.ready())},na={};$.fn=$.prototype={constructor:$,init:function(a,c,d){var e,f,g;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:da.exec(a),e&&(e[1]||!c)){if(e[1])return c=c instanceof $?c[0]:c,g=c&&c.nodeType?c.ownerDocument||c:P,a=$.parseHTML(e[1],g,!0),ea.test(e[1])&&$.isPlainObject(c)&&this.attr.call(a,c,!0),$.merge(this,a);if(f=P.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=P,this.selector=a,this}return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return $.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),$.makeArray(a,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return V.call(this)},get:function(a){return null==a?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=$.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,"find"===b?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return $.each(this,a,b)},ready:function(a){return $.ready.promise().done(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(V.apply(this,arguments),"slice",V.call(arguments).join(","))},map:function(a){return this.pushStack($.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:U,sort:[].sort,splice:[].splice},$.fn.init.prototype=$.fn,$.extend=$.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"!=typeof h&&!$.isFunction(h)&&(h={}),j===i&&(h=this,--i);i<j;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&($.isPlainObject(e)||(f=$.isArray(e)))?(f?(f=!1,g=d&&$.isArray(d)?d:[]):g=d&&$.isPlainObject(d)?d:{},h[c]=$.extend(k,g,e)):e!==b&&(h[c]=e));return h},$.extend({noConflict:function(b){return a.$===$&&(a.$=T),b&&a.jQuery===$&&(a.jQuery=S),$},isReady:!1,readyWait:1,holdReady:function(a){a?$.readyWait++:$.ready(!0)},ready:function(a){if(a===!0?!--$.readyWait:!$.isReady){if(!P.body)return setTimeout($.ready,1);$.isReady=!0,a!==!0&&--$.readyWait>0||(O.resolveWith(P,[$]),$.fn.trigger&&$(P).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===$.type(a)},isArray:Array.isArray||function(a){return"array"===$.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):na[X.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==$.type(a)||a.nodeType||$.isWindow(a))return!1;try{if(a.constructor&&!Y.call(a,"constructor")&&!Y.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(a){return!1}var c;for(c in a);return c===b||Y.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return a&&"string"==typeof a?("boolean"==typeof b&&(c=b,b=0),b=b||P,(d=ea.exec(a))?[b.createElement(d[1])]:(d=$.buildFragment([a],b,c?null:[]),$.merge([],(d.cacheable?$.clone(d.fragment):d.fragment).childNodes))):null},parseJSON:function(b){return b&&"string"==typeof b?(b=$.trim(b),a.JSON&&a.JSON.parse?a.JSON.parse(b):fa.test(b.replace(ha,"@").replace(ia,"]").replace(ga,""))?new Function("return "+b)():void $.error("Invalid JSON: "+b)):null},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(a){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&$.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&aa.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(ja,"ms-").replace(ka,la)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||$.isFunction(a);if(d)if(h){for(e in a)if(c.apply(a[e],d)===!1)break}else for(;f<g&&c.apply(a[f++],d)!==!1;);else if(h){for(e in a)if(c.call(a[e],e,a[e])===!1)break}else for(;f<g&&c.call(a[f],f,a[f++])!==!1;);return a},trim:Z&&!Z.call("\ufeff ")?function(a){return null==a?"":Z.call(a)}:function(a){return null==a?"":(a+"").replace(ca,"")},makeArray:function(a,b){var c,d=b||[];return null!=a&&(c=$.type(a),null==a.length||"string"===c||"function"===c||"regexp"===c||$.isWindow(a)?U.call(d,a):$.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(W)return W.call(b,a,c);for(d=b.length,c=c?c<0?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;f<d;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof $||i!==b&&"number"==typeof i&&(i>0&&a[0]&&a[i-1]||0===i||$.isArray(a));if(j)for(;h<i;h++)e=c(a[h],h,d),null!=e&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),null!=e&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),$.isFunction(a)?(e=V.call(arguments,2),f=function(){return a.apply(c,e.concat(V.call(arguments)))},f.guid=a.guid=a.guid||$.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=null==d,k=0,l=a.length;if(d&&"object"==typeof d){for(k in d)$.access(a,c,k,d[k],1,g,e);f=1}else if(e!==b){if(i=h===b&&$.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call($(a),c)}):(c.call(a,e),c=null)),c)for(;k<l;k++)c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h);f=1}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),$.ready.promise=function(b){if(!O)if(O=$.Deferred(),"complete"===P.readyState)setTimeout($.ready,1);else if(P.addEventListener)P.addEventListener("DOMContentLoaded",ma,!1),a.addEventListener("load",$.ready,!1);else{P.attachEvent("onreadystatechange",ma),a.attachEvent("onload",$.ready);var c=!1;try{c=null==a.frameElement&&P.documentElement}catch(a){}c&&c.doScroll&&function a(){if(!$.isReady){try{c.doScroll("left")}catch(b){return setTimeout(a,50)}$.ready()}}()}return O.promise(b)},$.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){na["[object "+b+"]"]=b.toLowerCase()}),N=$(P);var oa={};$.Callbacks=function(a){a="string"==typeof a?oa[a]||c(a):$.extend({},a);var d,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(d=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;j&&i<h;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){d=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):d?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function b(c){$.each(c,function(c,d){var e=$.type(d);"function"!==e||a.unique&&m.has(d)?d&&d.length&&"string"!==e&&b(d):j.push(d)})}(arguments),f?h=j.length:d&&(g=b,l(d))}return this},remove:function(){return j&&$.each(arguments,function(a,b){for(var c;(c=$.inArray(b,j,c))>-1;)j.splice(c,1),f&&(c<=h&&h--,c<=i&&i--)}),this},has:function(a){return $.inArray(a,j)>-1},empty:function(){return j=[],this},disable:function(){return j=k=d=b,this},disabled:function(){return!j},lock:function(){return k=b,d||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],j&&(!e||k)&&(f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},$.extend({Deferred:function(a){var b=[["resolve","done",$.Callbacks("once memory"),"resolved"],["reject","fail",$.Callbacks("once memory"),"rejected"],["notify","progress",$.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return $.Deferred(function(c){$.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]]($.isFunction(g)?function(){var a=g.apply(this,arguments);a&&$.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return null!=a?$.extend(a,d):d}},e={};return d.pipe=d.then,$.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=V.call(arguments),g=f.length,h=1!==g||a&&$.isFunction(a.promise)?g:0,i=1===h?a:$.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?V.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);e<g;e++)f[e]&&$.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),$.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m=P.createElement("div");if(m.setAttribute("className","t"),m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=m.getElementsByTagName("*"),d=m.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5",!c||!c.length)return{};e=P.createElement("select"),f=e.appendChild(P.createElement("option")),g=m.getElementsByTagName("input")[0],b={leadingWhitespace:3===m.firstChild.nodeType,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===g.value,optSelected:f.selected,getSetAttribute:"t"!==m.className,enctype:!!P.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==P.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===P.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete m.test}catch(a){b.deleteExpando=!1}if(!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",l=function(){b.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"),m.detachEvent("onclick",l)),g=P.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue="t"===g.value,g.setAttribute("checked","checked"),g.setAttribute("name","t"),m.appendChild(g),h=P.createDocumentFragment(),h.appendChild(m.lastChild),b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,h.removeChild(g),h.appendChild(m),m.attachEvent)for(j in{submit:!0,change:!0,focusin:!0})i="on"+j,k=i in m,k||(m.setAttribute(i,"return;"),k="function"==typeof m[i]),b[j+"Bubbles"]=k;return $(function(){var c,d,e,f,g="padding:0;margin:0;border:0;display:block;overflow:hidden;",h=P.getElementsByTagName("body")[0];h&&(c=P.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",h.insertBefore(c,h.firstChild),d=P.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",k=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=k&&0===e[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==h.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(d,null)||{width:"4px"}).width,f=P.createElement("div"),f.style.cssText=d.style.cssText=g,f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText=g+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),h.removeChild(c),c=d=e=f=null)}),h.removeChild(m),c=d=e=f=g=h=m=null,b}();var pa=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,qa=/([A-Z])/g;$.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+($.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?$.cache[a[$.expando]]:a[$.expando],!!a&&!e(a)},data:function(a,c,d,e){if($.acceptData(a)){var f,g,h=$.expando,i="string"==typeof c,j=a.nodeType,k=j?$.cache:a,l=j?a[h]:a[h]&&h;if(l&&k[l]&&(e||k[l].data)||!i||d!==b)return l||(j?a[h]=l=$.deletedIds.pop()||$.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=$.noop)),"object"!=typeof c&&"function"!=typeof c||(e?k[l]=$.extend(k[l],c):k[l].data=$.extend(k[l].data,c)),f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[$.camelCase(c)]=d),i?(g=f[c],null==g&&(g=f[$.camelCase(c)])):g=f,g}},removeData:function(a,b,c){if($.acceptData(a)){var d,f,g,h=a.nodeType,i=h?$.cache:a,j=h?a[$.expando]:$.expando;if(i[j]){if(b&&(d=c?i[j]:i[j].data)){$.isArray(b)||(b in d?b=[b]:(b=$.camelCase(b),b=b in d?[b]:b.split(" ")));for(f=0,g=b.length;f<g;f++)delete d[b[f]];if(!(c?e:$.isEmptyObject)(d))return}(c||(delete i[j].data,e(i[j])))&&(h?$.cleanData([a],!0):$.support.deleteExpando||i!=i.window?delete i[j]:i[j]=null)}}},_data:function(a,b,c){return $.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&$.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),$.fn.extend({data:function(a,c){var e,f,g,h,i,j=this[0],k=0,l=null;if(a===b){if(this.length&&(l=$.data(j),1===j.nodeType&&!$._data(j,"parsedAttrs"))){for(g=j.attributes,i=g.length;k<i;k++)h=g[k].name,h.indexOf("data-")||(h=$.camelCase(h.substring(5)),d(j,h,l[h]));$._data(j,"parsedAttrs",!0)}return l}return"object"==typeof a?this.each(function(){$.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",$.access(this,function(c){return c===b?(l=this.triggerHandler("getData"+f,[e[0]]),l===b&&j&&(l=$.data(j,a),l=d(j,a,l)),l===b&&e[1]?this.data(e[0]):l):(e[1]=c,void this.each(function(){var b=$(this);b.triggerHandler("setData"+f,e),$.data(this,a,c),b.triggerHandler("changeData"+f,e)}))},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){$.removeData(this,a)})}}),$.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=$._data(a,b),c&&(!d||$.isArray(c)?d=$._data(a,b,$.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=$.queue(a,b),d=c.length,e=c.shift(),f=$._queueHooks(a,b),g=function(){$.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return $._data(a,c)||$._data(a,c,{empty:$.Callbacks("once memory").add(function(){$.removeData(a,b+"queue",!0),$.removeData(a,c,!0)})})}}),$.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?$.queue(this[0],a):c===b?this:this.each(function(){var b=$.queue(this,a,c);$._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&$.dequeue(this,a)})},dequeue:function(a){return this.each(function(){$.dequeue(this,a)})},delay:function(a,b){return a=$.fx?$.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=$.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=$._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var ra,sa,ta,ua=/[\t\r\n]/g,va=/\r/g,wa=/^(?:button|input)$/i,xa=/^(?:button|input|object|select|textarea)$/i,ya=/^a(?:rea|)$/i,za=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Aa=$.support.getSetAttribute;$.fn.extend({attr:function(a,b){return $.access(this,$.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){$.removeAttr(this,a)})},prop:function(a,b){return $.access(this,$.prop,a,b,arguments.length>1)},removeProp:function(a){return a=$.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(a){}})},addClass:function(a){var b,c,d,e,f,g,h;if($.isFunction(a))return this.each(function(b){$(this).addClass(a.call(this,b,this.className))});if(a&&"string"==typeof a)for(b=a.split(ba),c=0,d=this.length;c<d;c++)if(e=this[c],1===e.nodeType)if(e.className||1!==b.length){for(f=" "+e.className+" ",g=0,h=b.length;g<h;g++)f.indexOf(" "+b[g]+" ")<0&&(f+=b[g]+" ");e.className=$.trim(f)}else e.className=a;return this},removeClass:function(a){var c,d,e,f,g,h,i;if($.isFunction(a))return this.each(function(b){$(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b)for(c=(a||"").split(ba),h=0,i=this.length;h<i;h++)if(e=this[h],1===e.nodeType&&e.className){for(d=(" "+e.className+" ").replace(ua," "),f=0,g=c.length;f<g;f++)for(;d.indexOf(" "+c[f]+" ")>=0;)d=d.replace(" "+c[f]+" "," ");e.className=a?$.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return $.isFunction(a)?this.each(function(c){$(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=$(this),h=b,i=a.split(ba);e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else"undefined"!==c&&"boolean"!==c||(this.className&&$._data(this,"__className__",this.className),this.className=this.className||a===!1?"":$._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;c<d;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ua," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=$.isFunction(a),this.each(function(d){var f,g=$(this);1===this.nodeType&&(f=e?a.call(this,d,g.val()):a,null==f?f="":"number"==typeof f?f+="":$.isArray(f)&&(f=$.map(f,function(a){return null==a?"":a+""})),c=$.valHooks[this.type]||$.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=$.valHooks[f.type]||$.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(va,""):null==d?"":d)}}}),$.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i="select-one"===a.type;if(f<0)return null;for(c=i?f:0,d=i?f+1:h.length;c<d;c++)if(e=h[c],e.selected&&($.support.optDisabled?!e.disabled:null===e.getAttribute("disabled"))&&(!e.parentNode.disabled||!$.nodeName(e.parentNode,"optgroup"))){if(b=$(e).val(),i)return b;g.push(b)}return i&&!g.length&&h.length?$(h[f]).val():g},set:function(a,b){var c=$.makeArray(b);return $(a).find("option").each(function(){this.selected=$.inArray($(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(a&&3!==i&&8!==i&&2!==i)return e&&$.isFunction($.fn[c])?$(a)[c](d):"undefined"==typeof a.getAttribute?$.prop(a,c,d):(h=1!==i||!$.isXMLDoc(a),h&&(c=c.toLowerCase(),g=$.attrHooks[c]||(za.test(c)?sa:ra)),d!==b?null===d?void $.removeAttr(a,c):g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):g&&"get"in g&&h&&null!==(f=g.get(a,c))?f:(f=a.getAttribute(c),null===f?b:f))},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&1===a.nodeType)for(d=b.split(ba);g<d.length;g++)e=d[g],e&&(c=$.propFix[e]||e,f=za.test(e),f||$.attr(a,e,""),a.removeAttribute(Aa?e:c),f&&c in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(wa.test(a.nodeName)&&a.parentNode)$.error("type property can't be changed");else if(!$.support.radioValue&&"radio"===b&&$.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return ra&&$.nodeName(a,"button")?ra.get(a,b):b in a?a.value:null},set:function(a,b,c){return ra&&$.nodeName(a,"button")?ra.set(a,b,c):void(a.value=b)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!$.isXMLDoc(a),g&&(c=$.propFix[c]||c,f=$.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):xa.test(a.nodeName)||ya.test(a.nodeName)&&a.href?0:b}}}}),sa={get:function(a,c){var d,e=$.prop(a,c);return e===!0||"boolean"!=typeof e&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?$.removeAttr(a,c):(d=$.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},Aa||(ta={name:!0,id:!0,coords:!0},ra=$.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(ta[c]?""!==d.value:d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=P.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},$.each(["width","height"],function(a,b){$.attrHooks[b]=$.extend($.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})}),$.attrHooks.contenteditable={get:ra.get,set:function(a,b,c){""===b&&(b="false"),ra.set(a,b,c)}}),$.support.hrefNormalized||$.each(["href","src","width","height"],function(a,c){$.attrHooks[c]=$.extend($.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return null===d?b:d}})}),$.support.style||($.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=b+""}}),$.support.optSelected||($.propHooks.selected=$.extend($.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),$.support.enctype||($.propFix.enctype="encoding"),$.support.checkOn||$.each(["radio","checkbox"],function(){$.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}}),$.each(["radio","checkbox"],function(){$.valHooks[this]=$.extend($.valHooks[this],{set:function(a,b){if($.isArray(b))return a.checked=$.inArray($(a).val(),b)>=0}})});var Ba=/^(?:textarea|input|select)$/i,Ca=/^([^\.]*|)(?:\.(.+)|)$/,Da=/(?:^|\s)hover(\.\S+|)\b/,Ea=/^key/,Fa=/^(?:mouse|contextmenu)|click/,Ga=/^(?:focusinfocus|focusoutblur)$/,Ha=function(a){return $.event.special.hover?a:a.replace(Da,"mouseenter$1 mouseleave$1")};$.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(3!==a.nodeType&&8!==a.nodeType&&c&&d&&(g=$._data(a))){for(d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=$.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return"undefined"==typeof $||a&&$.event.triggered===a.type?b:$.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=$.trim(Ha(c)).split(" "),j=0;j<c.length;j++)k=Ca.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),q=$.event.special[l]||{},l=(f?q.delegateType:q.bindType)||l,q=$.event.special[l]||{},n=$.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&$.expr.match.needsContext.test(f),namespace:m.join(".")},o),p=i[l],p||(p=i[l]=[],p.delegateCount=0,q.setup&&q.setup.call(a,e,m,h)!==!1||(a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h))),q.add&&(q.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?p.splice(p.delegateCount++,0,n):p.push(n),$.event.global[l]=!0;a=null}},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=$.hasData(a)&&$._data(a);if(q&&(m=q.events)){for(b=$.trim(Ha(b||"")).split(" "),f=0;f<b.length;f++)if(g=Ca.exec(b[f])||[],h=i=g[1],j=g[2],h){for(n=$.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=0;l<o.length;l++)p=o[l],(e||i===p.origType)&&(!c||c.guid===p.guid)&&(!j||j.test(p.namespace))&&(!d||d===p.selector||"**"===d&&p.selector)&&(o.splice(l--,1),p.selector&&o.delegateCount--,n.remove&&n.remove.call(a,p));0===o.length&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,q.handle)===!1)&&$.removeEvent(a,h,q.handle),delete m[h])}else for(h in m)$.event.remove(a,h+b[f],c,d,!0);$.isEmptyObject(m)&&(delete q.handle,$.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g,h,i,j,k,l,m,n,o,p,q=c.type||c,r=[];if(Ga.test(q+$.event.triggered))return;if(q.indexOf("!")>=0&&(q=q.slice(0,-1),h=!0),q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),(!e||$.event.customEvent[q])&&!$.event.global[q])return;if(c="object"==typeof c?c[$.expando]?c:new $.Event(q,c):new $.Event(q),c.type=q,c.isTrigger=!0,c.exclusive=h,c.namespace=r.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=q.indexOf(":")<0?"on"+q:"",!e){g=$.cache;for(i in g)g[i].events&&g[i].events[q]&&$.event.trigger(c,d,g[i].handle.elem,!0);return}if(c.result=b,c.target||(c.target=e),d=null!=d?$.makeArray(d):[],d.unshift(c),m=$.event.special[q]||{},m.trigger&&m.trigger.apply(e,d)===!1)return;if(o=[[e,m.bindType||q]],!f&&!m.noBubble&&!$.isWindow(e)){for(p=m.delegateType||q,j=Ga.test(p+q)?e:e.parentNode,k=e;j;j=j.parentNode)o.push([j,p]),k=j;k===(e.ownerDocument||P)&&o.push([k.defaultView||k.parentWindow||a,p])}for(i=0;i<o.length&&!c.isPropagationStopped();i++)j=o[i][0],c.type=o[i][1],n=($._data(j,"events")||{})[c.type]&&$._data(j,"handle"),n&&n.apply(j,d),n=l&&j[l],n&&$.acceptData(j)&&n.apply&&n.apply(j,d)===!1&&c.preventDefault();return c.type=q,!f&&!c.isDefaultPrevented()&&(!m._default||m._default.apply(e.ownerDocument,d)===!1)&&("click"!==q||!$.nodeName(e,"a"))&&$.acceptData(e)&&l&&e[q]&&("focus"!==q&&"blur"!==q||0!==c.target.offsetWidth)&&!$.isWindow(e)&&(k=e[l],k&&(e[l]=null),$.event.triggered=q,e[q](),$.event.triggered=b,k&&(e[l]=k)),c.result}},dispatch:function(c){c=$.event.fix(c||a.event);var d,e,f,g,h,i,j,k,l,m=($._data(this,"events")||{})[c.type]||[],n=m.delegateCount,o=V.call(arguments),p=!c.exclusive&&!c.namespace,q=$.event.special[c.type]||{},r=[];if(o[0]=c,c.delegateTarget=this,!q.preDispatch||q.preDispatch.call(this,c)!==!1){if(n&&(!c.button||"click"!==c.type))for(f=c.target;f!=this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==c.type){for(h={},j=[],d=0;d<n;d++)k=m[d],l=k.selector,h[l]===b&&(h[l]=k.needsContext?$(l,this).index(f)>=0:$.find(l,this,null,[f]).length),h[l]&&j.push(k);j.length&&r.push({elem:f,matches:j})}for(m.length>n&&r.push({elem:this,matches:m.slice(n)}),d=0;d<r.length&&!c.isPropagationStopped();d++)for(i=r[d],c.currentTarget=i.elem,e=0;e<i.matches.length&&!c.isImmediatePropagationStopped();e++)k=i.matches[e],(p||!c.namespace&&!k.namespace||c.namespace_re&&c.namespace_re.test(k.namespace))&&(c.data=k.data,c.handleObj=k,g=(($.event.special[k.origType]||{}).handle||k.handler).apply(i.elem,o),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation())));return q.postDispatch&&q.postDispatch.call(this,c),c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){
var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||P,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[$.expando])return a;var b,c,d=a,e=$.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props;for(a=$.Event(d),b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||P),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,e.filter?e.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){$.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=$.extend(new $.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?$.event.trigger(e,null,b):$.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},$.event.handle=$.event.dispatch,$.removeEvent=P.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},$.Event=function(a,b){return this instanceof $.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&$.extend(this,b),this.timeStamp=a&&a.timeStamp||$.now(),this[$.expando]=!0,void 0):new $.Event(a,b)},$.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f},$.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){$.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;f.selector;return e&&(e===d||$.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),$.support.submitBubbles||($.event.special.submit={setup:function(){return!$.nodeName(this,"form")&&void $.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=$.nodeName(c,"input")||$.nodeName(c,"button")?c.form:b;d&&!$._data(d,"_submit_attached")&&($.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),$._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&$.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return!$.nodeName(this,"form")&&void $.event.remove(this,"._submit")}}),$.support.changeBubbles||($.event.special.change={setup:function(){return Ba.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||($.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),$.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),$.event.simulate("change",this,a,!0)})),!1):void $.event.add(this,"beforeactivate._change",function(a){var b=a.target;Ba.test(b.nodeName)&&!$._data(b,"_change_attached")&&($.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&$.event.simulate("change",this.parentNode,a,!0)}),$._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type)return a.handleObj.handler.apply(this,arguments)},teardown:function(){return $.event.remove(this,"._change"),!Ba.test(this.nodeName)}}),$.support.focusinBubbles||$.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){$.event.simulate(b,a.target,$.event.fix(a),!0)};$.event.special[b]={setup:function(){0===c++&&P.addEventListener(a,d,!0)},teardown:function(){0===--c&&P.removeEventListener(a,d,!0)}}}),$.fn.extend({on:function(a,c,d,e,g){var h,i;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=f;else if(!e)return this;return 1===g&&(h=e,e=function(a){return $().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=$.guid++)),this.each(function(){$.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,$(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}return c!==!1&&"function"!=typeof c||(d=c,c=b),d===!1&&(d=f),this.each(function(){$.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return $(this.context).on(a,this.selector,b,c),this},die:function(a,b){return $(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){$.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return $.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||$.guid++,d=0,e=function(c){var e=($._data(this,"lastToggle"+a.guid)||0)%d;return $._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),$.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){$.fn[b]=function(a,c){return null==c&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Ea.test(b)&&($.event.fixHooks[b]=$.event.keyHooks),Fa.test(b)&&($.event.fixHooks[b]=$.event.mouseHooks)}),function(a,b){function c(a,b,c,d){c=c||[],b=b||F;var e,f,g,h,i=b.nodeType;if(!a||"string"!=typeof a)return c;if(1!==i&&9!==i)return[];if(g=v(b),!g&&!d&&(e=ca.exec(a)))if(h=e[1]){if(9===i){if(f=b.getElementById(h),!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(h))&&w(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return K.apply(c,L.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&ma&&b.getElementsByClassName)return K.apply(c,L.call(b.getElementsByClassName(h),0)),c}return p(a.replace(Z,"$1"),b,c,d,g)}function d(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function e(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function f(a){return N(function(b){return b=+b,N(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function g(a,b,c){if(a===b)return c;for(var d=a.nextSibling;d;){if(d===b)return-1;d=d.nextSibling}return 1}function h(a,b){var d,e,f,g,h,i,j,k=Q[D][a];if(k)return b?0:k.slice(0);for(h=a,i=[],j=t.preFilter;h;){d&&!(e=_.exec(h))||(e&&(h=h.slice(e[0].length)),i.push(f=[])),d=!1,(e=aa.exec(h))&&(f.push(d=new E(e.shift())),h=h.slice(d.length),d.type=e[0].replace(Z," "));for(g in t.filter)(e=ha[g].exec(h))&&(!j[g]||(e=j[g](e,F,!0)))&&(f.push(d=new E(e.shift())),h=h.slice(d.length),d.type=g,d.matches=e);if(!d)break}return b?h.length:h?c.error(a):Q(a,i).slice(0)}function i(a,b,c){var d=b.dir,e=c&&"parentNode"===b.dir,f=I++;return b.first?function(b,c,f){for(;b=b[d];)if(e||1===b.nodeType)return a(b,c,f)}:function(b,c,g){if(g){for(;b=b[d];)if((e||1===b.nodeType)&&a(b,c,g))return b}else for(var h,i=H+" "+f+" ",j=i+r;b=b[d];)if(e||1===b.nodeType){if((h=b[D])===j)return b.sizset;if("string"==typeof h&&0===h.indexOf(i)){if(b.sizset)return b}else{if(b[D]=j,a(b,c,g))return b.sizset=!0,b;b.sizset=!1}}}}function j(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function k(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function l(a,b,c,d,e,f){return d&&!d[D]&&(d=l(d)),e&&!e[D]&&(e=l(e,f)),N(function(f,g,h,i){if(!f||!e){var j,l,m,n=[],p=[],q=g.length,r=f||o(b||"*",h.nodeType?[h]:h,[],f),s=!a||!f&&b?r:k(r,n,a,h,i),t=c?e||(f?a:q||d)?[]:g:s;if(c&&c(s,t,h,i),d)for(m=k(t,p),d(m,[],h,i),j=m.length;j--;)(l=m[j])&&(t[p[j]]=!(s[p[j]]=l));if(f)for(j=a&&t.length;j--;)(l=t[j])&&(f[n[j]]=!(g[n[j]]=l));else t=k(t===g?t.splice(q,t.length):t),e?e(null,g,t,i):K.apply(g,t)}})}function m(a){for(var b,c,d,e=a.length,f=t.relative[a[0].type],g=f||t.relative[" "],h=f?1:0,k=i(function(a){return a===b},g,!0),n=i(function(a){return M.call(b,a)>-1},g,!0),o=[function(a,c,d){return!f&&(d||c!==A)||((b=c).nodeType?k(a,c,d):n(a,c,d))}];h<e;h++)if(c=t.relative[a[h].type])o=[i(j(o),c)];else{if(c=t.filter[a[h].type].apply(null,a[h].matches),c[D]){for(d=++h;d<e&&!t.relative[a[d].type];d++);return l(h>1&&j(o),h>1&&a.slice(0,h-1).join("").replace(Z,"$1"),c,h<d&&m(a.slice(h,d)),d<e&&m(a=a.slice(d)),d<e&&a.join(""))}o.push(c)}return j(o)}function n(a,b){var d=b.length>0,e=a.length>0,f=function(g,h,i,j,l){var m,n,o,p=[],q=0,s="0",u=g&&[],v=null!=l,w=A,x=g||e&&t.find.TAG("*",l&&h.parentNode||h),y=H+=null==w?1:Math.E;for(v&&(A=h!==F&&h,r=f.el);null!=(m=x[s]);s++){if(e&&m){for(n=0;o=a[n];n++)if(o(m,h,i)){j.push(m);break}v&&(H=y,r=++f.el)}d&&((m=!o&&m)&&q--,g&&u.push(m))}if(q+=s,d&&s!==q){for(n=0;o=b[n];n++)o(u,p,h,i);if(g){if(q>0)for(;s--;)!u[s]&&!p[s]&&(p[s]=J.call(j));p=k(p)}K.apply(j,p),v&&!g&&p.length>0&&q+b.length>1&&c.uniqueSort(j)}return v&&(H=y,A=w),u};return f.el=0,d?N(f):f}function o(a,b,d,e){for(var f=0,g=b.length;f<g;f++)c(a,b[f],d,e);return d}function p(a,b,c,d,e){var f,g,i,j,k,l=h(a);l.length;if(!d&&1===l.length){if(g=l[0]=l[0].slice(0),g.length>2&&"ID"===(i=g[0]).type&&9===b.nodeType&&!e&&t.relative[g[1].type]){if(b=t.find.ID(i.matches[0].replace(ga,""),b,e)[0],!b)return c;a=a.slice(g.shift().length)}for(f=ha.POS.test(a)?-1:g.length-1;f>=0&&(i=g[f],!t.relative[j=i.type]);f--)if((k=t.find[j])&&(d=k(i.matches[0].replace(ga,""),da.test(g[0].type)&&b.parentNode||b,e))){if(g.splice(f,1),a=d.length&&g.join(""),!a)return K.apply(c,L.call(d,0)),c;break}}return x(a,l)(d,b,e,c,da.test(a)),c}function q(){}var r,s,t,u,v,w,x,y,z,A,B=!0,C="undefined",D=("sizcache"+Math.random()).replace(".",""),E=String,F=a.document,G=F.documentElement,H=0,I=0,J=[].pop,K=[].push,L=[].slice,M=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},N=function(a,b){return a[D]=null==b||b,a},O=function(){var a={},b=[];return N(function(c,d){return b.push(c)>t.cacheLength&&delete a[b.shift()],a[c]=d},a)},P=O(),Q=O(),R=O(),S="[\\x20\\t\\r\\n\\f]",T="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",U=T.replace("w","w#"),V="([*^$|!~]?=)",W="\\["+S+"*("+T+")"+S+"*(?:"+V+S+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+U+")|)|)"+S+"*\\]",X=":("+T+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+W+")|[^:]|\\\\.)*|.*))\\)|)",Y=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+S+"*((?:-\\d)?\\d*)"+S+"*\\)|)(?=[^-]|$)",Z=new RegExp("^"+S+"+|((?:^|[^\\\\])(?:\\\\.)*)"+S+"+$","g"),_=new RegExp("^"+S+"*,"+S+"*"),aa=new RegExp("^"+S+"*([\\x20\\t\\r\\n\\f>+~])"+S+"*"),ba=new RegExp(X),ca=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,da=/[\x20\t\r\n\f]*[+~]/,ea=/h\d/i,fa=/input|select|textarea|button/i,ga=/\\(?!\\)/g,ha={ID:new RegExp("^#("+T+")"),CLASS:new RegExp("^\\.("+T+")"),NAME:new RegExp("^\\[name=['\"]?("+T+")['\"]?\\]"),TAG:new RegExp("^("+T.replace("w","w*")+")"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+X),POS:new RegExp(Y,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+S+"*(even|odd|(([+-]|)(\\d*)n|)"+S+"*(?:([+-]|)"+S+"*(\\d+)|))"+S+"*\\)|)","i"),needsContext:new RegExp("^"+S+"*[>+~]|"+Y,"i")},ia=function(a){var b=F.createElement("div");try{return a(b)}catch(a){return!1}finally{b=null}},ja=ia(function(a){return a.appendChild(F.createComment("")),!a.getElementsByTagName("*").length}),ka=ia(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==C&&"#"===a.firstChild.getAttribute("href")}),la=ia(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),ma=ia(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!a.getElementsByClassName||!a.getElementsByClassName("e").length)&&(a.lastChild.className="e",2===a.getElementsByClassName("e").length)}),na=ia(function(a){a.id=D+0,a.innerHTML="<a name='"+D+"'></a><div name='"+D+"'></div>",G.insertBefore(a,G.firstChild);var b=F.getElementsByName&&F.getElementsByName(D).length===2+F.getElementsByName(D+0).length;return s=!F.getElementById(D),G.removeChild(a),b});try{L.call(G.childNodes,0)[0].nodeType}catch(a){L=function(a){for(var b,c=[];b=this[a];a++)c.push(b);return c}}c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){return c(b,null,null,[a]).length>0},u=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=u(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=u(b);return c},v=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},w=c.contains=G.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:G.compareDocumentPosition?function(a,b){return b&&!!(16&a.compareDocumentPosition(b))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},c.attr=function(a,b){var c,d=v(a);return d||(b=b.toLowerCase()),(c=t.attrHandle[b])?c(a):d||la?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)},t=c.selectors={cacheLength:50,createPseudo:N,match:ha,attrHandle:ka?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:s?function(a,b,c){if(typeof b.getElementById!==C&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==C&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==C&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:ja?function(a,b){if(typeof b.getElementsByTagName!==C)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c},NAME:na&&function(a,b){if(typeof b.getElementsByName!==C)return b.getElementsByName(name)},CLASS:ma&&function(a,b,c){if(typeof b.getElementsByClassName!==C&&!c)return b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ga,""),a[3]=(a[4]||a[5]||"").replace(ga,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||c.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&c.error(a[0]),a},PSEUDO:function(a){var b,c;return ha.CHILD.test(a[0])?null:(a[3]?a[2]=a[3]:(b=a[4])&&(ba.test(b)&&(c=h(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b),a.slice(0,3))}},filter:{ID:s?function(a){return a=a.replace(ga,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(ga,""),function(b){var c=typeof b.getAttributeNode!==C&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(ga,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=P[D][a];return b||(b=P(a,new RegExp("(^|"+S+")"+a+"("+S+"|$)"))),function(a){return b.test(a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")}},ATTR:function(a,b,d){return function(e,f){var g=c.attr(e,a);return null==g?"!="===b:!b||(g+="","="===b?g===d:"!="===b?g!==d:"^="===b?d&&0===g.indexOf(d):"*="===b?d&&g.indexOf(d)>-1:"$="===b?d&&g.substr(g.length-d.length)===d:"~="===b?(" "+g+" ").indexOf(d)>-1:"|="===b&&(g===d||g.substr(0,d.length+1)===d+"-"))}},CHILD:function(a,b,c,d){return"nth"===a?function(a){var b,e,f=a.parentNode;if(1===c&&0===d)return!0;if(f)for(e=0,b=f.firstChild;b&&(1!==b.nodeType||(e++,a!==b));b=b.nextSibling);return e-=d,e===c||e%c===0&&e/c>=0}:function(b){var c=b;switch(a){case"only":case"first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case"last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b){var d,e=t.pseudos[a]||t.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[D]?e(b):e.length>1?(d=[a,a,"",b],t.setFilters.hasOwnProperty(a.toLowerCase())?N(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=M.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},pseudos:{not:N(function(a){var b=[],c=[],d=x(a.replace(Z,"$1"));return d[D]?N(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:N(function(a){return function(b){return c(a,b).length>0}}),contains:N(function(a){return function(b){return(b.textContent||b.innerText||u(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!t.pseudos.empty(a)},empty:function(a){var b;for(a=a.firstChild;a;){if(a.nodeName>"@"||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},header:function(a){return ea.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:d("radio"),checkbox:d("checkbox"),file:d("file"),password:d("password"),image:d("image"),submit:e("submit"),reset:e("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return fa.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement},first:f(function(a,b,c){return[0]}),last:f(function(a,b,c){return[b-1]}),eq:f(function(a,b,c){return[c<0?c+b:c]}),even:f(function(a,b,c){for(var d=0;d<b;d+=2)a.push(d);return a}),odd:f(function(a,b,c){for(var d=1;d<b;d+=2)a.push(d);return a}),lt:f(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:f(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},y=G.compareDocumentPosition?function(a,b){return a===b?(z=!0,0):(a.compareDocumentPosition&&b.compareDocumentPosition?4&a.compareDocumentPosition(b):a.compareDocumentPosition)?-1:1}:function(a,b){if(a===b)return z=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return g(a,b);if(!h)return-1;if(!i)return 1;for(;j;)e.unshift(j),j=j.parentNode;for(j=i;j;)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return g(e[k],f[k]);return k===c?g(a,f[k],-1):g(e[k],b,1)},[0,0].sort(y),B=!z,c.uniqueSort=function(a){var b,c=1;if(z=B,a.sort(y),z)for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a},c.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},x=c.compile=function(a,b){var c,d=[],e=[],f=R[D][a];if(!f){for(b||(b=h(a)),c=b.length;c--;)f=m(b[c]),f[D]?d.push(f):e.push(f);f=R(a,n(e,d))}return f},F.querySelectorAll&&function(){var a,b=p,d=/'|\\/g,e=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,f=[":focus"],g=[":active",":focus"],i=G.matchesSelector||G.mozMatchesSelector||G.webkitMatchesSelector||G.oMatchesSelector||G.msMatchesSelector;ia(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||f.push("\\["+S+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||f.push(":checked")}),ia(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&f.push("[*^$]="+S+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||f.push(":enabled",":disabled")}),f=new RegExp(f.join("|")),p=function(a,c,e,g,i){if(!(g||i||f&&f.test(a))){var j,k,l=!0,m=D,n=c,o=9===c.nodeType&&a;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){for(j=h(a),(l=c.getAttribute("id"))?m=l.replace(d,"\\$&"):c.setAttribute("id",m),m="[id='"+m+"'] ",k=j.length;k--;)j[k]=m+j[k].join("");n=da.test(a)&&c.parentNode||c,o=j.join(",")}if(o)try{return K.apply(e,L.call(n.querySelectorAll(o),0)),e}catch(a){}finally{l||c.removeAttribute("id")}}return b(a,c,e,g,i)},i&&(ia(function(b){a=i.call(b,"div");try{i.call(b,"[test!='']:sizzle"),g.push("!=",X)}catch(a){}}),g=new RegExp(g.join("|")),c.matchesSelector=function(b,d){if(d=d.replace(e,"='$1']"),!(v(b)||g.test(d)||f&&f.test(d)))try{var h=i.call(b,d);if(h||a||b.document&&11!==b.document.nodeType)return h}catch(a){}return c(d,null,null,[b]).length>0})}(),t.pseudos.nth=t.pseudos.eq,t.filters=q.prototype=t.pseudos,t.setFilters=new q,c.attr=$.attr,$.find=c,$.expr=c.selectors,$.expr[":"]=$.expr.pseudos,$.unique=c.uniqueSort,$.text=c.getText,$.isXMLDoc=c.isXML,$.contains=c.contains}(a);var Ia=/Until$/,Ja=/^(?:parents|prev(?:Until|All))/,Ka=/^.[^:#\[\.,]*$/,La=$.expr.match.needsContext,Ma={children:!0,contents:!0,next:!0,prev:!0};$.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if("string"!=typeof a)return $(a).filter(function(){for(b=0,c=h.length;b<c;b++)if($.contains(h[b],this))return!0});for(g=this.pushStack("","find",a),b=0,c=this.length;b<c;b++)if(d=g.length,$.find(a,this[b],g),b>0)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}return g},has:function(a){var b,c=$(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if($.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(j(this,a,!1),"not",a)},filter:function(a){return this.pushStack(j(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?La.test(a)?$(a,this.context).index(this[0])>=0:$.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=La.test(a)||"string"!=typeof a?$(a,b||this.context):0;d<e;d++)for(c=this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?g.index(c)>-1:$.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return f=f.length>1?$.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?"string"==typeof a?$.inArray(this[0],$(a)):$.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c="string"==typeof a?$(a,b):$.makeArray(a&&a.nodeType?[a]:a),d=$.merge(this.get(),c);return this.pushStack(h(c[0])||h(d[0])?d:$.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),$.fn.andSelf=$.fn.addBack,$.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return $.dir(a,"parentNode")},parentsUntil:function(a,b,c){return $.dir(a,"parentNode",c)},next:function(a){return i(a,"nextSibling")},prev:function(a){return i(a,"previousSibling")},nextAll:function(a){return $.dir(a,"nextSibling")},prevAll:function(a){return $.dir(a,"previousSibling")},nextUntil:function(a,b,c){return $.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return $.dir(a,"previousSibling",c)},siblings:function(a){return $.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return $.sibling(a.firstChild)},contents:function(a){return $.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:$.merge([],a.childNodes)}},function(a,b){$.fn[a]=function(c,d){var e=$.map(this,b,c);return Ia.test(a)||(d=c),d&&"string"==typeof d&&(e=$.filter(d,e)),e=this.length>1&&!Ma[a]?$.unique(e):e,this.length>1&&Ja.test(a)&&(e=e.reverse()),this.pushStack(e,a,V.call(arguments).join(","))}}),$.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?$.find.matchesSelector(b[0],a)?[b[0]]:[]:$.find.matches(a,b)},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!$(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Na="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Oa=/ jQuery\d+="(?:null|\d+)"/g,Pa=/^\s+/,Qa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ra=/<([\w:]+)/,Sa=/<tbody/i,Ta=/<|&#?\w+;/,Ua=/<(?:script|style|link)/i,Va=/<(?:script|object|embed|option|style)/i,Wa=new RegExp("<(?:"+Na+")[\\s/>]","i"),Xa=/^(?:checkbox|radio)$/,Ya=/checked\s*(?:[^=]|=\s*.checked.)/i,Za=/\/(java|ecma)script/i,$a=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,_a={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ab=k(P),bb=ab.appendChild(P.createElement("div"));_a.optgroup=_a.option,_a.tbody=_a.tfoot=_a.colgroup=_a.caption=_a.thead,_a.th=_a.td,$.support.htmlSerialize||(_a._default=[1,"X<div>","</div>"]),$.fn.extend({text:function(a){return $.access(this,function(a){return a===b?$.text(this):this.empty().append((this[0]&&this[0].ownerDocument||P).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if($.isFunction(a))return this.each(function(b){$(this).wrapAll(a.call(this,b))});if(this[0]){var b=$(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return $.isFunction(a)?this.each(function(b){$(this).wrapInner(a.call(this,b))}):this.each(function(){var b=$(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=$.isFunction(a);return this.each(function(c){$(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){$.nodeName(this,"body")||$(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(a,this),"before",this.selector)}},after:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=$.clean(arguments);return this.pushStack($.merge(this,a),"after",this.selector)}},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)a&&!$.filter(a,[c]).length||(!b&&1===c.nodeType&&($.cleanData(c.getElementsByTagName("*")),$.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)for(1===a.nodeType&&$.cleanData(a.getElementsByTagName("*"));a.firstChild;)a.removeChild(a.firstChild);return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return $.clone(this,a,b)})},html:function(a){return $.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Oa,""):b;if("string"==typeof a&&!Ua.test(a)&&($.support.htmlSerialize||!Wa.test(a))&&($.support.leadingWhitespace||!Pa.test(a))&&!_a[(Ra.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Qa,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&($.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(a){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return h(this[0])?this.length?this.pushStack($($.isFunction(a)?a():a),"replaceWith",a):this:$.isFunction(a)?this.each(function(b){var c=$(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=$(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;$(this).remove(),b?$(b).before(a):$(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],m=this.length;if(!$.support.checkClone&&m>1&&"string"==typeof j&&Ya.test(j))return this.each(function(){$(this).domManip(a,c,d)});if($.isFunction(j))return this.each(function(e){var f=$(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){if(e=$.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,1===g.childNodes.length&&(g=f),f)for(c=c&&$.nodeName(f,"tr"),h=e.cacheable||m-1;i<m;i++)d.call(c&&$.nodeName(this[i],"table")?l(this[i],"tbody"):this[i],i===h?g:$.clone(g,!0,!0));g=f=null,k.length&&$.each(k,function(a,b){b.src?$.ajax?$.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):$.error("no ajax"):$.globalEval((b.text||b.textContent||b.innerHTML||"").replace($a,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),$.buildFragment=function(a,c,d){var e,f,g,h=a[0];return c=c||P,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,1===a.length&&"string"==typeof h&&h.length<512&&c===P&&"<"===h.charAt(0)&&!Va.test(h)&&($.support.checkClone||!Ya.test(h))&&($.support.html5Clone||!Wa.test(h))&&(f=!0,e=$.fragments[h],g=e!==b),e||(e=c.createDocumentFragment(),$.clean(a,c,e,d),f&&($.fragments[h]=g&&e)),{fragment:e,cacheable:f}},$.fragments={},$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){$.fn[a]=function(c){var d,e=0,f=[],g=$(c),h=g.length,i=1===this.length&&this[0].parentNode;if((null==i||i&&11===i.nodeType&&1===i.childNodes.length)&&1===h)return g[b](this[0]),this;for(;e<h;e++)d=(e>0?this.clone(!0):this).get(),$(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),$.extend({clone:function(a,b,c){var d,e,f,g;if($.support.html5Clone||$.isXMLDoc(a)||!Wa.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bb.innerHTML=a.outerHTML,bb.removeChild(g=bb.firstChild)),!($.support.noCloneEvent&&$.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||$.isXMLDoc(a)))for(n(a,g),d=o(a),e=o(g),f=0;d[f];++f)e[f]&&n(d[f],e[f]);if(b&&(m(a,g),c))for(d=o(a),e=o(g),f=0;d[f];++f)m(d[f],e[f]);return d=e=null,g},clean:function(a,b,c,d){var e,f,g,h,i,j,l,m,n,o,q,r=b===P&&ab,s=[];for(b&&"undefined"!=typeof b.createDocumentFragment||(b=P),e=0;null!=(g=a[e]);e++)if("number"==typeof g&&(g+=""),g){if("string"==typeof g)if(Ta.test(g)){for(r=r||k(b),l=b.createElement("div"),r.appendChild(l),
g=g.replace(Qa,"<$1></$2>"),h=(Ra.exec(g)||["",""])[1].toLowerCase(),i=_a[h]||_a._default,j=i[0],l.innerHTML=i[1]+g+i[2];j--;)l=l.lastChild;if(!$.support.tbody)for(m=Sa.test(g),n="table"!==h||m?"<table>"!==i[1]||m?[]:l.childNodes:l.firstChild&&l.firstChild.childNodes,f=n.length-1;f>=0;--f)$.nodeName(n[f],"tbody")&&!n[f].childNodes.length&&n[f].parentNode.removeChild(n[f]);!$.support.leadingWhitespace&&Pa.test(g)&&l.insertBefore(b.createTextNode(Pa.exec(g)[0]),l.firstChild),g=l.childNodes,l.parentNode.removeChild(l)}else g=b.createTextNode(g);g.nodeType?s.push(g):$.merge(s,g)}if(l&&(g=l=r=null),!$.support.appendChecked)for(e=0;null!=(g=s[e]);e++)$.nodeName(g,"input")?p(g):"undefined"!=typeof g.getElementsByTagName&&$.grep(g.getElementsByTagName("input"),p);if(c)for(o=function(a){if(!a.type||Za.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)},e=0;null!=(g=s[e]);e++)$.nodeName(g,"script")&&o(g)||(c.appendChild(g),"undefined"!=typeof g.getElementsByTagName&&(q=$.grep($.merge([],g.getElementsByTagName("script")),o),s.splice.apply(s,[e+1,0].concat(q)),e+=q.length));return s},cleanData:function(a,b){for(var c,d,e,f,g=0,h=$.expando,i=$.cache,j=$.support.deleteExpando,k=$.event.special;null!=(e=a[g]);g++)if((b||$.acceptData(e))&&(d=e[h],c=d&&i[d])){if(c.events)for(f in c.events)k[f]?$.event.remove(e,f):$.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,$.deletedIds.push(d))}}}),function(){var a,b;$.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=$.uaMatch(R.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),$.browser=b,$.sub=function(){function a(b,c){return new a.fn.init(b,c)}$.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){return d&&d instanceof $&&!(d instanceof a)&&(d=a(d)),$.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(P);return a}}();var cb,db,eb,fb=/alpha\([^)]*\)/i,gb=/opacity=([^)]*)/,hb=/^(top|right|bottom|left)$/,ib=/^(none|table(?!-c[ea]).+)/,jb=/^margin/,kb=new RegExp("^("+_+")(.*)$","i"),lb=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),mb=new RegExp("^([-+])=("+_+")","i"),nb={},ob={position:"absolute",visibility:"hidden",display:"block"},pb={letterSpacing:0,fontWeight:400},qb=["Top","Right","Bottom","Left"],rb=["Webkit","O","Moz","ms"],sb=$.fn.toggle;$.fn.extend({css:function(a,c){return $.access(this,function(a,c,d){return d!==b?$.style(a,c,d):$.css(a,c)},a,c,arguments.length>1)},show:function(){return s(this,!0)},hide:function(){return s(this)},toggle:function(a,b){var c="boolean"==typeof a;return $.isFunction(a)&&$.isFunction(b)?sb.apply(this,arguments):this.each(function(){(c?a:r(this))?$(this).show():$(this).hide()})}}),$.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=cb(a,"opacity");return""===c?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:$.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=$.camelCase(c),j=a.style;if(c=$.cssProps[i]||($.cssProps[i]=q(j,i)),h=$.cssHooks[c]||$.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=mb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat($.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"===g&&!$.cssNumber[i]&&(d+="px"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(a){}}},css:function(a,c,d,e){var f,g,h,i=$.camelCase(c);return c=$.cssProps[i]||($.cssProps[i]=q(a.style,i)),h=$.cssHooks[c]||$.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=cb(a,c)),"normal"===f&&c in pb&&(f=pb[c]),d||e!==b?(g=parseFloat(f),d||$.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),a.getComputedStyle?cb=function(b,c){var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;return h&&(d=h[c],""===d&&!$.contains(b.ownerDocument,b)&&(d=$.style(b,c)),lb.test(d)&&jb.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d}:P.documentElement.currentStyle&&(cb=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return null==e&&f&&f[b]&&(e=f[b]),lb.test(e)&&!hb.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),""===e?"auto":e}),$.each(["height","width"],function(a,b){$.cssHooks[b]={get:function(a,c,d){if(c)return 0===a.offsetWidth&&ib.test(cb(a,"display"))?$.swap(a,ob,function(){return v(a,b,d)}):v(a,b,d)},set:function(a,c,d){return t(a,c,d?u(a,b,d,$.support.boxSizing&&"border-box"===$.css(a,"boxSizing")):0)}}}),$.support.opacity||($.cssHooks.opacity={get:function(a,b){return gb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=$.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,b>=1&&""===$.trim(f.replace(fb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),d&&!d.filter)||(c.filter=fb.test(f)?f.replace(fb,e):f+" "+e)}}),$(function(){$.support.reliableMarginRight||($.cssHooks.marginRight={get:function(a,b){return $.swap(a,{display:"inline-block"},function(){if(b)return cb(a,"marginRight")})}}),!$.support.pixelPosition&&$.fn.position&&$.each(["top","left"],function(a,b){$.cssHooks[b]={get:function(a,c){if(c){var d=cb(a,b);return lb.test(d)?$(a).position()[b]+"px":d}}}})}),$.expr&&$.expr.filters&&($.expr.filters.hidden=function(a){return 0===a.offsetWidth&&0===a.offsetHeight||!$.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||cb(a,"display"))},$.expr.filters.visible=function(a){return!$.expr.filters.hidden(a)}),$.each({margin:"",padding:"",border:"Width"},function(a,b){$.cssHooks[a+b]={expand:function(c){var d,e="string"==typeof c?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+qb[d]+b]=e[d]||e[d-2]||e[0];return f}},jb.test(a)||($.cssHooks[a+b].set=t)});var tb=/%20/g,ub=/\[\]$/,vb=/\r?\n/g,wb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,xb=/^(?:select|textarea)/i;$.fn.extend({serialize:function(){return $.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?$.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||xb.test(this.nodeName)||wb.test(this.type))}).map(function(a,b){var c=$(this).val();return null==c?null:$.isArray(c)?$.map(c,function(a,c){return{name:b.name,value:a.replace(vb,"\r\n")}}):{name:b.name,value:c.replace(vb,"\r\n")}}).get()}}),$.param=function(a,c){var d,e=[],f=function(a,b){b=$.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=$.ajaxSettings&&$.ajaxSettings.traditional),$.isArray(a)||a.jquery&&!$.isPlainObject(a))$.each(a,function(){f(this.name,this.value)});else for(d in a)x(d,a[d],c,f);return e.join("&").replace(tb,"+")};var yb,zb,Ab=/#.*$/,Bb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cb=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Db=/^(?:GET|HEAD)$/,Eb=/^\/\//,Fb=/\?/,Gb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Hb=/([?&])_=[^&]*/,Ib=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Jb=$.fn.load,Kb={},Lb={},Mb=["*/"]+["*"];try{zb=Q.href}catch(a){zb=P.createElement("a"),zb.href="",zb=zb.href}yb=Ib.exec(zb.toLowerCase())||[],$.fn.load=function(a,c,d){if("string"!=typeof a&&Jb)return Jb.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),$.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(f="POST"),$.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?$("<div>").append(a.replace(Gb,"")).find(e):a)}),this},$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){$.fn[b]=function(a){return this.on(b,a)}}),$.each(["get","post"],function(a,c){$[c]=function(a,d,e,f){return $.isFunction(d)&&(f=f||e,e=d,d=b),$.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),$.extend({getScript:function(a,c){return $.get(a,b,c,"script")},getJSON:function(a,b,c){return $.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?A(a,$.ajaxSettings):(b=a,a=$.ajaxSettings),A(a,b),a},ajaxSettings:{url:zb,isLocal:Cb.test(yb[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Mb},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":$.parseJSON,"text xml":$.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:y(Kb),ajaxTransport:y(Lb),ajax:function(a,c){function d(a,c,d,g){var j,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),h=b,f=g||"",w.readyState=a>0?4:0,d&&(t=B(m,w,d)),a>=200&&a<300||304===a?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&($.lastModified[e]=v),v=w.getResponseHeader("Etag"),v&&($.etag[e]=v)),304===a?(x="notmodified",j=!0):(j=C(m,t),x=j.state,l=j.data,s=j.error,j=!s)):(s=x,x&&!a||(x="error",a<0&&(a=0))),w.status=a,w.statusText=(c||x)+"",j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,k&&o.trigger("ajax"+(j?"Success":"Error"),[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--$.active||$.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=$.ajaxSetup({},c),n=m.context||m,o=n!==m&&(n.nodeType||n instanceof $)?$(n):$.event,p=$.Deferred(),q=$.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,setRequestHeader:function(a,b){if(!u){var c=a.toLowerCase();a=t[c]=t[c]||a,s[a]=b}return this},getAllResponseHeaders:function(){return 2===u?f:null},getResponseHeader:function(a){var c;if(2===u){if(!g)for(g={};c=Bb.exec(f);)g[c[1].toLowerCase()]=c[2];c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return u||(m.mimeType=a),this},abort:function(a){return a=a||v,h&&h.abort(a),d(0,a),this}};if(p.promise(w),w.success=w.done,w.error=w.fail,w.complete=q.add,w.statusCode=function(a){if(a){var b;if(u<2)for(b in a)r[b]=[r[b],a[b]];else b=a[w.status],w.always(b)}return this},m.url=((a||m.url)+"").replace(Ab,"").replace(Eb,yb[1]+"//"),m.dataTypes=$.trim(m.dataType||"*").toLowerCase().split(ba),null==m.crossDomain&&(j=Ib.exec(m.url.toLowerCase())||!1,m.crossDomain=j&&j.join(":")+(j[3]?"":"http:"===j[1]?80:443)!==yb.join(":")+(yb[3]?"":"http:"===yb[1]?80:443)),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=$.param(m.data,m.traditional)),z(Kb,m,c,w),2===u)return w;if(k=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Db.test(m.type),k&&0===$.active++&&$.event.trigger("ajaxStart"),!m.hasContent&&(m.data&&(m.url+=(Fb.test(m.url)?"&":"?")+m.data,delete m.data),e=m.url,m.cache===!1)){var x=$.now(),y=m.url.replace(Hb,"$1_="+x);m.url=y+(y===m.url?(Fb.test(m.url)?"&":"?")+"_="+x:"")}(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(e=e||m.url,$.lastModified[e]&&w.setRequestHeader("If-Modified-Since",$.lastModified[e]),$.etag[e]&&w.setRequestHeader("If-None-Match",$.etag[e])),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Mb+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(!m.beforeSend||m.beforeSend.call(n,w,m)!==!1&&2!==u){v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);if(h=z(Lb,m,c,w)){w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,h.send(s,d)}catch(a){if(!(u<2))throw a;d(-1,a)}}else d(-1,"No Transport");return w}return w.abort()},active:0,lastModified:{},etag:{}});var Nb=[],Ob=/\?/,Pb=/(=)\?(?=&|$)|\?\?/,Qb=$.now();$.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Nb.pop()||$.expando+"_"+Qb++;return this[a]=!0,a}}),$.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&Pb.test(j),m=k&&!l&&"string"==typeof i&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Pb.test(i);if("jsonp"===c.dataTypes[0]||l||m)return f=c.jsonpCallback=$.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(Pb,"$1"+f):m?c.data=i.replace(Pb,"$1"+f):k&&(c.url+=(Ob.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||$.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Nb.push(f)),h&&$.isFunction(g)&&g(h[0]),h=g=b}),"script"}),$.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return $.globalEval(a),a}}}),$.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),$.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=P.head||P.getElementsByTagName("head")[0]||P.documentElement;return{send:function(e,f){c=P.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){(e||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Rb,Sb=!!a.ActiveXObject&&function(){for(var a in Rb)Rb[a](0,1)},Tb=0;$.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&D()||E()}:D,function(a){$.extend($.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}($.ajaxSettings.xhr()),$.support.ajax&&$.ajaxTransport(function(c){if(!c.crossDomain||$.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(a){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=$.noop,Sb&&delete Rb[g]),e)4!==i.readyState&&i.abort();else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(a){j=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(a){e||f(-1,a)}l&&f(h,j,l,k)},c.async?4===i.readyState?setTimeout(d,0):(g=++Tb,Sb&&(Rb||(Rb={},$(a).unload(Sb)),Rb[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var Ub,Vb,Wb=/^(?:toggle|show|hide)$/,Xb=new RegExp("^(?:([-+])=|)("+_+")([a-z%]*)$","i"),Yb=/queueHooks$/,Zb=[J],$b={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=Xb.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){if(c=+f[2],d=f[3]||($.cssNumber[a]?"":"px"),"px"!==d&&h){h=$.css(e.elem,a,!0)||c||1;do i=i||".5",h/=i,$.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&1!==i&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};$.Animation=$.extend(H,{tweener:function(a,b){$.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],$b[c]=$b[c]||[],$b[c].unshift(b)},prefilter:function(a,b){b?Zb.unshift(a):Zb.push(a)}}),$.Tween=K,K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||($.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.options.duration?this.pos=b=$.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}},K.prototype.init.prototype=K.prototype,K.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=$.css(a.elem,a.prop,!1,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){$.fx.step[a.prop]?$.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[$.cssProps[a.prop]]||$.cssHooks[a.prop])?$.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},$.each(["toggle","show","hide"],function(a,b){var c=$.fn[b];$.fn[b]=function(d,e,f){return null==d||"boolean"==typeof d||!a&&$.isFunction(d)&&$.isFunction(e)?c.apply(this,arguments):this.animate(L(b,!0),d,e,f)}}),$.fn.extend({fadeTo:function(a,b,c,d){return this.filter(r).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=$.isEmptyObject(a),f=$.speed(b,c,d),g=function(){var b=H(this,$.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=$.timers,g=$._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Yb.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(null==a||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&$.dequeue(this,a)})}}),$.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){$.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),$.speed=function(a,b,c){var d=a&&"object"==typeof a?$.extend({},a):{complete:c||!c&&b||$.isFunction(a)&&a,duration:a,easing:c&&b||b&&!$.isFunction(b)&&b};return d.duration=$.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in $.fx.speeds?$.fx.speeds[d.duration]:$.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){$.isFunction(d.old)&&d.old.call(this),d.queue&&$.dequeue(this,d.queue)},d},$.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},$.timers=[],$.fx=K.prototype.init,$.fx.tick=function(){for(var a,b=$.timers,c=0;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||$.fx.stop()},$.fx.timer=function(a){a()&&$.timers.push(a)&&!Vb&&(Vb=setInterval($.fx.tick,$.fx.interval))},$.fx.interval=13,$.fx.stop=function(){clearInterval(Vb),Vb=null},$.fx.speeds={slow:600,fast:200,_default:400},$.fx.step={},$.expr&&$.expr.filters&&($.expr.filters.animated=function(a){return $.grep($.timers,function(b){return a===b.elem}).length});var _b=/^(?:body|html)$/i;$.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){$.offset.setOffset(this,a,b)});var c,d,e,f,g,h,i,j={top:0,left:0},k=this[0],l=k&&k.ownerDocument;if(l)return(d=l.body)===k?$.offset.bodyOffset(k):(c=l.documentElement,$.contains(c,k)?("undefined"!=typeof k.getBoundingClientRect&&(j=k.getBoundingClientRect()),e=M(l),f=c.clientTop||d.clientTop||0,g=c.clientLeft||d.clientLeft||0,h=e.pageYOffset||c.scrollTop,i=e.pageXOffset||c.scrollLeft,{top:j.top+h-f,left:j.left+i-g}):j)},$.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return $.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat($.css(a,"marginTop"))||0,c+=parseFloat($.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=$.css(a,"position");"static"===d&&(a.style.position="relative");var e,f,g=$(a),h=g.offset(),i=$.css(a,"top"),j=$.css(a,"left"),k=("absolute"===d||"fixed"===d)&&$.inArray("auto",[i,j])>-1,l={},m={};k?(m=g.position(),e=m.top,f=m.left):(e=parseFloat(i)||0,f=parseFloat(j)||0),$.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(l.top=b.top-h.top+e),null!=b.left&&(l.left=b.left-h.left+f),"using"in b?b.using.call(a,l):g.css(l)}},$.fn.extend({position:function(){if(this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=_b.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat($.css(a,"marginTop"))||0,c.left-=parseFloat($.css(a,"marginLeft"))||0,d.top+=parseFloat($.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat($.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||P.body;a&&!_b.test(a.nodeName)&&"static"===$.css(a,"position");)a=a.offsetParent;return a||P.body})}}),$.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);$.fn[a]=function(e){return $.access(this,function(a,e,f){var g=M(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:void(g?g.scrollTo(d?$(g).scrollLeft():f,d?f:$(g).scrollTop()):a[e]=f)},a,e,arguments.length,null)}}),$.each({Height:"height",Width:"width"},function(a,c){$.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){$.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return $.access(this,function(c,d,e){var f;return $.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?$.css(c,d,e,h):$.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=$,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return $})}(window),function(a,b){"function"==typeof define&&define.amd?define([],b):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=b():(a.dcodeIO=a.dcodeIO||{}).Long=b()}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}a.__isLong__;try{Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(a){}a.isLong=function(a){return(a&&a.__isLong__)===!0};var b={},c={};a.fromInt=function(d,e){var f,g;return e?(d>>>=0,0<=d&&d<256&&(g=c[d])?g:(f=new a(d,(0|d)<0?-1:0,!0),0<=d&&d<256&&(c[d]=f),f)):(d|=0,-128<=d&&d<128&&(g=b[d])?g:(f=new a(d,d<0?-1:0,!1),-128<=d&&d<128&&(b[d]=f),f))},a.fromNumber=function(b,c){return c=!!c,isNaN(b)||!isFinite(b)?a.ZERO:!c&&b<=-g?a.MIN_VALUE:!c&&b+1>=g?a.MAX_VALUE:c&&b>=f?a.MAX_UNSIGNED_VALUE:b<0?a.fromNumber(-b,c).negate():new a(b%e|0,b/e|0,c)},a.fromBits=function(b,c,d){return new a(b,c,d)},a.fromString=function(b,c,d){if(0===b.length)throw Error("number format error: empty string");if("NaN"===b||"Infinity"===b||"+Infinity"===b||"-Infinity"===b)return a.ZERO;if("number"==typeof c&&(d=c,c=!1),d=d||10,d<2||36<d)throw Error("radix out of range: "+d);var e;if((e=b.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+b);if(0===e)return a.fromString(b.substring(1),c,d).negate();for(var f=a.fromNumber(Math.pow(d,8)),g=a.ZERO,h=0;h<b.length;h+=8){var i=Math.min(8,b.length-h),j=parseInt(b.substring(h,h+i),d);if(i<8){var k=a.fromNumber(Math.pow(d,i));g=g.multiply(k).add(a.fromNumber(j))}else g=g.multiply(f),g=g.add(a.fromNumber(j))}return g.unsigned=c,g},a.fromValue=function(b){return b instanceof a?b:"number"==typeof b?a.fromNumber(b):"string"==typeof b?a.fromString(b):new a(b.low,b.high,b.unsigned)};var d=1<<24,e=4294967296,f=0x10000000000000000,g=f/2,h=a.fromInt(d);return a.ZERO=a.fromInt(0),a.UZERO=a.fromInt(0,!0),a.ONE=a.fromInt(1),a.UONE=a.fromInt(1,!0),a.NEG_ONE=a.fromInt(-1),a.MAX_VALUE=a.fromBits(-1,2147483647,!1),a.MAX_UNSIGNED_VALUE=a.fromBits(-1,-1,!0),a.MIN_VALUE=a.fromBits(0,-2147483648,!1),a.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},a.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*e+(this.low>>>0):this.high*e+(this.low>>>0)},a.prototype.toString=function(b){if(b=b||10,b<2||36<b)throw RangeError("radix out of range: "+b);if(this.isZero())return"0";var c;if(this.isNegative()){if(this.equals(a.MIN_VALUE)){var d=a.fromNumber(b),e=this.divide(d);return c=e.multiply(d).subtract(this),e.toString(b)+c.toInt().toString(b)}return"-"+this.negate().toString(b)}var f=a.fromNumber(Math.pow(b,6),this.unsigned);c=this;for(var g="";;){var h=c.divide(f),i=c.subtract(h.multiply(f)).toInt()>>>0,j=i.toString(b);if(c=h,c.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},a.prototype.getHighBits=function(){return this.high},a.prototype.getHighBitsUnsigned=function(){return this.high>>>0},a.prototype.getLowBits=function(){return this.low},a.prototype.getLowBitsUnsigned=function(){return this.low>>>0},a.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(a.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var b=0!=this.high?this.high:this.low,c=31;c>0&&0==(b&1<<c);c--);return 0!=this.high?c+33:c+1},a.prototype.isZero=function(){return 0===this.high&&0===this.low},a.prototype.isNegative=function(){return!this.unsigned&&this.high<0},a.prototype.isPositive=function(){return this.unsigned||this.high>=0},a.prototype.isOdd=function(){return 1===(1&this.low)},a.prototype.isEven=function(){return 0===(1&this.low)},a.prototype.equals=function(b){return a.isLong(b)||(b=a.fromValue(b)),(this.unsigned===b.unsigned||this.high>>>31!==1||b.high>>>31!==1)&&(this.high===b.high&&this.low===b.low)},a.eq=a.prototype.equals,a.prototype.notEquals=function(a){return!this.equals(a)},a.neq=a.prototype.notEquals,a.prototype.lessThan=function(a){return this.compare(a)<0},a.prototype.lt=a.prototype.lessThan,a.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},a.prototype.lte=a.prototype.lessThanOrEqual,a.prototype.greaterThan=function(a){return this.compare(a)>0},a.prototype.gt=a.prototype.greaterThan,a.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},a.prototype.gte=a.prototype.greaterThanOrEqual,a.prototype.compare=function(b){if(a.isLong(b)||(b=a.fromValue(b)),this.equals(b))return 0;var c=this.isNegative(),d=b.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?b.high>>>0>this.high>>>0||b.high===this.high&&b.low>>>0>this.low>>>0?-1:1:this.subtract(b).isNegative()?-1:1},a.prototype.negate=function(){return!this.unsigned&&this.equals(a.MIN_VALUE)?a.MIN_VALUE:this.not().add(a.ONE)},a.prototype.neg=a.prototype.negate,a.prototype.add=function(b){a.isLong(b)||(b=a.fromValue(b));var c=this.high>>>16,d=65535&this.high,e=this.low>>>16,f=65535&this.low,g=b.high>>>16,h=65535&b.high,i=b.low>>>16,j=65535&b.low,k=0,l=0,m=0,n=0;return n+=f+j,m+=n>>>16,n&=65535,m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,k&=65535,a.fromBits(m<<16|n,k<<16|l,this.unsigned)},a.prototype.subtract=function(b){return a.isLong(b)||(b=a.fromValue(b)),this.add(b.negate())},a.prototype.sub=a.prototype.subtract,a.prototype.multiply=function(b){if(this.isZero())return a.ZERO;if(a.isLong(b)||(b=a.fromValue(b)),b.isZero())return a.ZERO;if(this.equals(a.MIN_VALUE))return b.isOdd()?a.MIN_VALUE:a.ZERO;if(b.equals(a.MIN_VALUE))return this.isOdd()?a.MIN_VALUE:a.ZERO;if(this.isNegative())return b.isNegative()?this.negate().multiply(b.negate()):this.negate().multiply(b).negate();if(b.isNegative())return this.multiply(b.negate()).negate();if(this.lessThan(h)&&b.lessThan(h))return a.fromNumber(this.toNumber()*b.toNumber(),this.unsigned);var c=this.high>>>16,d=65535&this.high,e=this.low>>>16,f=65535&this.low,g=b.high>>>16,i=65535&b.high,j=b.low>>>16,k=65535&b.low,l=0,m=0,n=0,o=0;return o+=f*k,n+=o>>>16,o&=65535,n+=e*k,m+=n>>>16,n&=65535,n+=f*j,m+=n>>>16,n&=65535,m+=d*k,l+=m>>>16,m&=65535,m+=e*j,l+=m>>>16,m&=65535,m+=f*i,l+=m>>>16,m&=65535,l+=c*k+d*j+e*i+f*g,l&=65535,a.fromBits(n<<16|o,l<<16|m,this.unsigned)},a.prototype.mul=a.prototype.multiply,a.prototype.divide=function(b){if(a.isLong(b)||(b=a.fromValue(b)),b.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?a.UZERO:a.ZERO;var c,d,e;if(this.equals(a.MIN_VALUE)){if(b.equals(a.ONE)||b.equals(a.NEG_ONE))return a.MIN_VALUE;if(b.equals(a.MIN_VALUE))return a.ONE;var f=this.shiftRight(1);return c=f.divide(b).shiftLeft(1),c.equals(a.ZERO)?b.isNegative()?a.ONE:a.NEG_ONE:(d=this.subtract(b.multiply(c)),e=c.add(d.divide(b)))}if(b.equals(a.MIN_VALUE))return this.unsigned?a.UZERO:a.ZERO;if(this.isNegative())return b.isNegative()?this.negate().divide(b.negate()):this.negate().divide(b).negate();if(b.isNegative())return this.divide(b.negate()).negate();for(e=a.ZERO,d=this;d.greaterThanOrEqual(b);){c=Math.max(1,Math.floor(d.toNumber()/b.toNumber()));for(var g=Math.ceil(Math.log(c)/Math.LN2),h=g<=48?1:Math.pow(2,g-48),i=a.fromNumber(c),j=i.multiply(b);j.isNegative()||j.greaterThan(d);)c-=h,i=a.fromNumber(c,this.unsigned),j=i.multiply(b);i.isZero()&&(i=a.ONE),e=e.add(i),d=d.subtract(j)}return e},a.prototype.div=a.prototype.divide,a.prototype.modulo=function(b){return a.isLong(b)||(b=a.fromValue(b)),this.subtract(this.divide(b).multiply(b))},a.prototype.mod=a.prototype.modulo,a.prototype.not=function(){return a.fromBits(~this.low,~this.high,this.unsigned)},a.prototype.and=function(b){return a.isLong(b)||(b=a.fromValue(b)),a.fromBits(this.low&b.low,this.high&b.high,this.unsigned)},a.prototype.or=function(b){return a.isLong(b)||(b=a.fromValue(b)),a.fromBits(this.low|b.low,this.high|b.high,this.unsigned)},a.prototype.xor=function(b){return a.isLong(b)||(b=a.fromValue(b)),a.fromBits(this.low^b.low,this.high^b.high,this.unsigned)},a.prototype.shiftLeft=function(b){return a.isLong(b)&&(b=b.toInt()),0===(b&=63)?this:b<32?a.fromBits(this.low<<b,this.high<<b|this.low>>>32-b,this.unsigned):a.fromBits(0,this.low<<b-32,this.unsigned)},a.prototype.shl=a.prototype.shiftLeft,a.prototype.shiftRight=function(b){return a.isLong(b)&&(b=b.toInt()),0===(b&=63)?this:b<32?a.fromBits(this.low>>>b|this.high<<32-b,this.high>>b,this.unsigned):a.fromBits(this.high>>b-32,this.high>=0?0:-1,this.unsigned)},a.prototype.shr=a.prototype.shiftRight,a.prototype.shiftRightUnsigned=function(b){if(a.isLong(b)&&(b=b.toInt()),b&=63,0===b)return this;var c=this.high;if(b<32){var d=this.low;return a.fromBits(d>>>b|c<<32-b,c>>>b,this.unsigned)}return 32===b?a.fromBits(c,0,this.unsigned):a.fromBits(c>>>b-32,0,this.unsigned)},a.prototype.shru=a.prototype.shiftRightUnsigned,a.prototype.toSigned=function(){return this.unsigned?new a(this.low,this.high,!1):this},a.prototype.toUnsigned=function(){return this.unsigned?this:new a(this.low,this.high,!0)},a}),function(a,b){"function"==typeof define&&define.amd?define(["long"],b):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var a;try{a=require("long")}catch(a){}return b(a)}():(a.dcodeIO=a.dcodeIO||{}).ByteBuffer=b(a.dcodeIO.Long)}(this,function(a){"use strict";function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){return 0===arguments.length?b.join("")+i.apply(String,a):(a.length+arguments.length>1024&&(b.push(i.apply(String,a)),a.length=0),void Array.prototype.push.apply(a,arguments))}}function d(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],
l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)}function e(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}var f=function(a,b,c){if("undefined"==typeof a&&(a=f.DEFAULT_CAPACITY),"undefined"==typeof b&&(b=f.DEFAULT_ENDIAN),"undefined"==typeof c&&(c=f.DEFAULT_NOASSERT),!c){if(a|=0,a<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?h:new ArrayBuffer(a),this.view=0===a?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian=b,this.noAssert=c};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=a||null;var g=f.prototype;g.__isByteBuffer__;try{Object.defineProperty(g,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(a){}try{var h=new ArrayBuffer(0)}catch(a){var h=""}var i=String.fromCharCode;f.accessor=function(){return Uint8Array},f.allocate=function(a,b,c){return new f(a,b,c)},f.concat=function(a,b,c,d){"boolean"!=typeof b&&"string"==typeof b||(d=c,c=b,b=void 0);for(var e,g=0,h=0,i=a.length;h<i;++h)f.isByteBuffer(a[h])||(a[h]=f.wrap(a[h],b)),e=a[h].limit-a[h].offset,e>0&&(g+=e);if(0===g)return new f(0,c,d);var j,k=new f(g,c,d);for(h=0;h<i;)j=a[h++],e=j.limit-j.offset,e<=0||(k.view.set(j.view.subarray(j.offset,j.limit),k.offset),k.offset+=e);return k.limit=k.offset,k.offset=0,k},f.isByteBuffer=function(a){return(a&&a.__isByteBuffer__)===!0},f.type=function(){return ArrayBuffer},f.wrap=function(a,b,c,d){if("string"!=typeof b&&(d=c,c=b,b=void 0),"string"==typeof a)switch("undefined"==typeof b&&(b="utf8"),b){case"base64":return f.fromBase64(a,c);case"hex":return f.fromHex(a,c);case"binary":return f.fromBinary(a,c);case"utf8":return f.fromUTF8(a,c);case"debug":return f.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var e;if(f.isByteBuffer(a))return e=g.clone.call(a),e.markedOffset=-1,e;if(a instanceof Uint8Array)e=new f(0,c,d),a.length>0&&(e.buffer=a.buffer,e.offset=a.byteOffset,e.limit=a.byteOffset+a.byteLength,e.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)e=new f(0,c,d),a.byteLength>0&&(e.buffer=a,e.offset=0,e.limit=a.byteLength,e.view=a.byteLength>0?new Uint8Array(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");e=new f(a.length,c,d),e.limit=a.length;for(var h=0;h<a.length;++h)e.view[h]=a[h]}return e},g.writeBitSet=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if(!(a instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=b,f=a.length,g=f>>3,h=0;for(b+=this.writeVarint32(f,b);g--;)d=1&!!a[h++]|(1&!!a[h++])<<1|(1&!!a[h++])<<2|(1&!!a[h++])<<3|(1&!!a[h++])<<4|(1&!!a[h++])<<5|(1&!!a[h++])<<6|(1&!!a[h++])<<7,this.writeByte(d,b++);if(h<f){var i=0;for(d=0;h<f;)d|=(1&!!a[h++])<<i++;this.writeByte(d,b++)}return c?(this.offset=b,this):b-e},g.readBitSet=function(a){var b="undefined"==typeof a;b&&(a=this.offset);var c,d=this.readVarint32(a),e=d.value,f=e>>3,g=0,h=[];for(a+=d.length;f--;)c=this.readByte(a++),h[g++]=!!(1&c),h[g++]=!!(2&c),h[g++]=!!(4&c),h[g++]=!!(8&c),h[g++]=!!(16&c),h[g++]=!!(32&c),h[g++]=!!(64&c),h[g++]=!!(128&c);if(g<e){var i=0;for(c=this.readByte(a++);g<e;)h[g++]=!!(c>>i++&1)}return b&&(this.offset=a),h},g.readBytes=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+"+a+") <= "+this.buffer.byteLength)}var d=this.slice(b,b+a);return c&&(this.offset+=a),d},g.writeBytes=g.append,g.writeInt8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeByte=g.writeInt8,g.readInt8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return 128===(128&c)&&(c=-(255-c+1)),b&&(this.offset+=1),c},g.readByte=g.readInt8,g.writeUint8=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeUInt8=g.writeUint8,g.readUint8=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return b&&(this.offset+=1),c},g.readUInt8=g.readUint8,g.writeInt16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeShort=g.writeInt16,g.readInt16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),32768===(32768&c)&&(c=-(65535-c+1)),b&&(this.offset+=2),c},g.readShort=g.readInt16,g.writeUint16=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeUInt16=g.writeUint16,g.readUint16=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),b&&(this.offset+=2),c},g.readUInt16=g.readUint16,g.writeInt32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeInt=g.writeInt32,g.readInt32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),c|=0,b&&(this.offset+=4),c},g.readInt=g.readInt32,g.writeUint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeUInt32=g.writeUint32,g.readUint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),b&&(this.offset+=4),c},g.readUInt32=g.readUint32,a&&(g.writeInt64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeLong=g.writeInt64,g.readInt64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,!1);return c&&(this.offset+=8),f},g.readLong=g.readInt64,g.writeUint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeUInt64=g.writeUint64,g.readUint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,!0);return c&&(this.offset+=8),f},g.readUInt64=g.readUint64),g.writeFloat32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,e(this.view,a,b,this.littleEndian,23,4),c&&(this.offset+=4),this},g.writeFloat=g.writeFloat32,g.readFloat32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,23,4);return b&&(this.offset+=4),c},g.readFloat=g.readFloat32,g.writeFloat64=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,e(this.view,a,b,this.littleEndian,52,8),c&&(this.offset+=8),this},g.writeDouble=g.writeFloat64,g.readFloat64=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,52,8);return b&&(this.offset+=8),c},g.readDouble=g.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},f.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},f.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},g.writeVarint32=function(a,b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=f.calculateVarint32(a);b+=e;var g=this.buffer.byteLength;for(b>g&&this.resize((g*=2)>b?g:b),b-=e,a>>>=0;a>=128;)d=127&a|128,this.view[b++]=d,a>>>=7;return this.view[b++]=a,c?(this.offset=b,this):e},g.writeVarint32ZigZag=function(a,b){return this.writeVarint32(f.zigZagEncode32(a),b)},g.readVarint32=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d=0,e=0;do{if(!this.noAssert&&a>this.limit){var f=Error("Truncated");throw f.truncated=!0,f}c=this.view[a++],d<5&&(e|=(127&c)<<7*d),++d}while(0!==(128&c));return e|=0,b?(this.offset=a,e):{value:e,length:d}},g.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=f.zigZagDecode32(b.value):b=f.zigZagDecode32(b),b},a&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},f.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},g.writeVarint64=function(b,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):b.unsigned!==!1&&(b=b.toSigned());var e=f.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=e;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=e,e){case 10:this.view[c+9]=i>>>7&1;case 9:this.view[c+8]=9!==e?128|i:127&i;case 8:this.view[c+7]=8!==e?h>>>21|128:h>>>21&127;case 7:this.view[c+6]=7!==e?h>>>14|128:h>>>14&127;case 6:this.view[c+5]=6!==e?h>>>7|128:h>>>7&127;case 5:this.view[c+4]=5!==e?128|h:127&h;case 4:this.view[c+3]=4!==e?g>>>21|128:g>>>21&127;case 3:this.view[c+2]=3!==e?g>>>14|128:g>>>14&127;case 2:this.view[c+1]=2!==e?g>>>7|128:g>>>7&127;case 1:this.view[c]=1!==e?128|g:127&g}return d?(this.offset+=e,this):e},g.writeVarint64ZigZag=function(a,b){return this.writeVarint64(f.zigZagEncode64(a),b)},g.readVarint64=function(b){var c="undefined"==typeof b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,b<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view[b++],e=127&h,128&h&&(h=this.view[b++],e|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],e|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<7,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<14,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],f|=(127&h)<<21,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g=127&h,(128&h||this.noAssert&&"undefined"==typeof h)&&(h=this.view[b++],g|=(127&h)<<7,128&h||this.noAssert&&"undefined"==typeof h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},g.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=f.zigZagDecode64(c.value):c=f.zigZagDecode64(c),c}),g.writeCString=function(a,c){var d="undefined"==typeof c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=k.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),this.view[c++]=0,d?(this.offset=c,this):f},g.readCString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return k.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return f=this.view[a++],0===f?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},g.writeIString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.littleEndian?(this.view[c+3]=e>>>24&255,this.view[c+2]=e>>>16&255,this.view[c+1]=e>>>8&255,this.view[c]=255&e):(this.view[c]=e>>>24&255,this.view[c+1]=e>>>16&255,this.view[c+2]=e>>>8&255,this.view[c+3]=255&e),c+=4,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},g.readIString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=a,d=this.readUint32(a),e=this.readUTF8String(d,f.METRICS_BYTES,a+=4);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",g.writeUTF8String=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),d?(this.offset=c,this):c-f},g.writeString=g.writeUTF8String,f.calculateUTF8Chars=function(a){return k.calculateUTF16asUTF8(b(a))[0]},f.calculateUTF8Bytes=function(a){return k.calculateUTF16asUTF8(b(a))[1]},f.calculateString=f.calculateUTF8Bytes,g.readUTF8String=function(a,b,d){"number"==typeof b&&(d=b,b=void 0);var e="undefined"==typeof d;if(e&&(d=this.offset),"undefined"==typeof b&&(b=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=d;if(b===f.METRICS_CHARS){if(g=c(),k.decodeUTF8(function(){return h<a&&d<this.limit?this.view[d++]:null}.bind(this),function(a){++h,k.UTF8toUTF16(a,g)}),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return e?(this.offset=d,g()):{string:g(),length:d-i}}if(b===f.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof d||d%1!==0)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,d<0||d+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+"+a+") <= "+this.buffer.byteLength)}var j=d+a;if(k.decodeUTF8toUTF16(function(){return d<j?this.view[d++]:null}.bind(this),g=c(),this.noAssert),d!==j)throw RangeError("Illegal range: Truncated data, "+d+" == "+j);return e?(this.offset=d,g()):{string:g(),length:d-i}}throw TypeError("Unsupported metrics: "+b)},g.readString=g.readUTF8String,g.writeVString=function(a,c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,g,h=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=f.calculateVarint32(e),c+=g+e;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+e,c+=this.writeVarint32(e,c),k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==h+e+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+e+g));return d?(this.offset=c,this):c-h},g.readVString=function(a){var b="undefined"==typeof a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=a,d=this.readVarint32(a),e=this.readUTF8String(d.value,f.METRICS_BYTES,a+=d.length);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},g.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,this.view.set(a.view.subarray(a.offset,a.limit),c),a.offset+=e,d&&(this.offset+=e),this},g.appendTo=function(a,b){return a.append(this,b),this},g.assert=function(a){return this.noAssert=!a,this},g.capacity=function(){return this.buffer.byteLength},g.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},g.clone=function(a){var b=new f(0,this.littleEndian,this.noAssert);return a?(b.buffer=new ArrayBuffer(this.buffer.byteLength),b.view=new Uint8Array(b.buffer)):(b.buffer=this.buffer,b.view=this.view),b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},g.compact=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=h,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c),e=new Uint8Array(d);return e.set(this.view.subarray(a,b)),this.buffer=d,this.view=e,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},g.copy=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new f(0,this.littleEndian,this.noAssert);var c=b-a,d=new f(c,this.littleEndian,this.noAssert);return d.offset=0,d.limit=c,d.markedOffset>=0&&(d.markedOffset-=a),this.copyTo(d,0,a,b),d},g.copyTo=function(a,b,c,d){var e,g;if(!this.noAssert&&!f.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g="undefined"==typeof b)?a.offset:0|b,c=(e="undefined"==typeof c)?this.offset:0|c,d="undefined"==typeof d?this.limit:0|d,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||d>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=d-c;return 0===h?a:(a.ensureCapacity(b+h),a.view.set(this.view.subarray(c,d),b),e&&(this.offset+=h),g&&(a.offset+=h),this)},g.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},g.fill=function(a,b,c){var d="undefined"==typeof b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),"undefined"==typeof b&&(b=this.offset),"undefined"==typeof c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view[b++]=a;return d&&(this.offset=b),this},g.flip=function(){return this.limit=this.offset,this.offset=0,this},g.mark=function(a){if(a="undefined"==typeof a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,a<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength);
}return this.markedOffset=a,this},g.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},g.LE=function(a){return this.littleEndian="undefined"==typeof a||!!a,this},g.BE=function(a){return this.littleEndian="undefined"!=typeof a&&!a,this},g.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!==0)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,c<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;var g=e-c;if(g>0){var h=new ArrayBuffer(this.buffer.byteLength+g),i=new Uint8Array(h);i.set(this.view.subarray(c,this.buffer.byteLength),e),this.buffer=h,this.view=i,this.offset+=g,this.markedOffset>=0&&(this.markedOffset+=g),this.limit+=g,c+=g}else{new Uint8Array(this.buffer)}return this.view.set(a.view.subarray(a.offset,a.limit),c-e),a.offset=a.limit,d&&(this.offset-=e),this},g.prependTo=function(a,b){return a.prepend(this,b),this},g.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},g.remaining=function(){return this.limit-this.offset},g.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},g.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if(a|=0,a<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a),c=new Uint8Array(b);c.set(this.view),this.buffer=b,this.view=c}return this},g.reverse=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(this.view.subarray(a,b)),this)},g.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},g.slice=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},g.toBuffer=function(a){var b=this.offset,c=this.limit;if(!this.noAssert){if("number"!=typeof b||b%1!==0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!==0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return h;var d=new ArrayBuffer(c-b);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(b,c),0),d},g.toArrayBuffer=g.toBuffer,g.toString=function(a,b,c){if("undefined"==typeof a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var j=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],"undefined"==typeof f&&d(e),null!==(e=a())&&(g=c[e],"undefined"==typeof g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(f=c[e],"undefined"==typeof f){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(g=c[e],"undefined"==typeof g){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(a)},a}();g.toBase64=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity||a>b)throw RangeError("begin, end");var d;return j.encode(function(){return a<b?this.view[a++]:null}.bind(this),d=c()),d()},f.fromBase64=function(a,c){if("string"!=typeof a)throw TypeError("str");var d=new f(a.length/4*3,c),e=0;return j.decode(b(a),function(a){d.view[e++]=a}),d.limit=e,d},f.btoa=function(a){return f.fromBinary(a).toBase64()},f.atob=function(a){return f.fromBase64(a).toBinary()},g.toBinary=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity()||a>b)throw RangeError("begin, end");if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view[a++]),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},f.fromBinary=function(a,b){if("string"!=typeof a)throw TypeError("str");for(var c,d=0,e=a.length,g=new f(e,b);d<e;){if(c=a.charCodeAt(d),c>255)throw RangeError("illegal char code: "+c);g.view[d++]=c}return g.limit=e,g},g.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(c!==-1&&(b=this.view[c],e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16===0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}e+=c===this.offset&&c===this.limit?c===this.markedOffset?"!":"|":c===this.offset?c===this.markedOffset?"[":"<":c===this.limit?c===this.markedOffset?"]":">":c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},f.fromDebug=function(a,b,c){for(var d,e,g=a.length,h=new f((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){switch(d=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(e=parseInt(d+a.charAt(i++),16),!c&&(isNaN(e)||e<0||e>255))throw TypeError("Illegal str: Not a debug encoded string");h.view[j++]=e,k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},g.toHex=function(a,b){if(a="undefined"==typeof a?this.offset:a,b="undefined"==typeof b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view[a++],c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},f.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var d,e=a.length,g=new f(e/2|0,b),h=0,i=0;h<e;h+=2){if(d=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(d)||d<0||d>255))throw TypeError("Illegal str: Contains non-hex characters");g.view[i++]=d}return g.limit=i,g};var k=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0===(128&c))b(c);else if(192===(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224===(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!==(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(a){for(var b,c=0;null!==(b=a());)c+=b<128?1:b<2048?2:b<65536?3:4;return c},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(a){++c,d+=a<128?1:a<2048?2:a<65536?3:4}),[c,d]},a}();return g.toUTF8=function(a,b){if("undefined"==typeof a&&(a=this.offset),"undefined"==typeof b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!==0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!==0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{k.decodeUTF8toUTF16(function(){return a<b?this.view[a++]:null}.bind(this),d=c())}catch(c){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b)}return d()},f.fromUTF8=function(a,c,d){if(!d&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var e=new f(k.calculateUTF16asUTF8(b(a),!0)[1],c,d),g=0;return k.encodeUTF16toUTF8(b(a),function(a){e.view[g++]=a}),e.limit=g,e},f}),function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.log4javascript=a()}(function(){function isUndefined(a){return"undefined"==typeof a}function EventSupport(){}function Log4JavaScript(){}function toStr(a){return a&&a.toString?a.toString():String(a)}function getExceptionMessage(a){return a.message?a.message:a.description?a.description:toStr(a)}function getUrlFileName(a){var b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return a.substr(b+1)}function getExceptionStringRep(a){if(a){var b="Exception: "+getExceptionMessage(a);try{a.lineNumber&&(b+=" on line number "+a.lineNumber),a.fileName&&(b+=" in file "+getUrlFileName(a.fileName))}catch(a){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&a.stack&&(b+=newLine+"Stack trace:"+newLine+a.stack),b}return null}function bool(a){return Boolean(a)}function trim(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(a){var b=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return b.split("\n")}function array_remove(a,b){for(var c=-1,d=0,e=a.length;d<e;d++)if(a[d]===b){c=d;break}return c>=0&&(a.splice(c,1),!0)}function array_contains(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return!0;return!1}function extractBooleanFromParam(a,b){return isUndefined(a)?b:bool(a)}function extractStringFromParam(a,b){return isUndefined(a)?b:String(a)}function extractIntFromParam(a,b){if(isUndefined(a))return b;try{var c=parseInt(a,10);return isNaN(c)?b:c}catch(c){return logLog.warn("Invalid int param "+a,c),b}}function extractFunctionFromParam(a,b){return"function"==typeof a?a:b}function isError(a){return a instanceof Error}function handleError(a,b){logLog.error(a,b),log4javascript.dispatchEvent("error",{message:a,exception:b})}function Timer(a,b){this.name=a,this.level=isUndefined(b)?Level.INFO:b,this.start=new Date}function Logger(a){this.name=a,this.parent=null,this.children=[];var b=[],c=null,d=this.name===rootLoggerName,e=this.name===nullLoggerName,f=null,g=!1;this.addChild=function(a){this.children.push(a),a.parent=this,a.invalidateAppenderCache()};var h=!0;this.getAdditivity=function(){return h},this.setAdditivity=function(a){var b=h!=a;h=a,b&&this.invalidateAppenderCache()},this.addAppender=function(a){e?handleError("Logger.addAppender: you may not add an appender to the null logger"):a instanceof log4javascript.Appender?array_contains(b,a)||(b.push(a),a.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(a)+"') is not a subclass of Appender")},this.removeAppender=function(a){array_remove(b,a),a.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var a=b.length;if(a>0){for(var c=0;c<a;c++)b[c].setRemovedFromLogger(this);b.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===f||g){var a=d||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();f=a.concat(b),g=!1}return f},this.invalidateAppenderCache=function(){g=!0;for(var a=0,b=this.children.length;a<b;a++)this.children[a].invalidateAppenderCache()},this.log=function(a,b){if(enabled&&a.isGreaterOrEqual(this.getEffectiveLevel())){var c,d=b.length-1,e=b[d];b.length>1&&isError(e)&&(c=e,d--);for(var f=[],g=0;g<=d;g++)f[g]=b[g];var h=new LoggingEvent(this,new Date,a,f,c);this.callAppenders(h)}"undefined"!=typeof logAjax&&logAjax.enabled&&a.level>=logAjax.level&&saveLog(a.name,b[0],b[1])},this.callAppenders=function(a){for(var b=this.getEffectiveAppenders(),c=0,d=b.length;c<d;c++)b[c].doAppend(a)},this.setLevel=function(a){d&&null===a?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):a instanceof Level?c=a:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return c},this.getEffectiveLevel=function(){for(var a=this;null!==a;a=a.parent){var b=a.getLevel();if(null!==b)return b}},this.group=function(a,b){if(enabled)for(var c=this.getEffectiveAppenders(),d=0,e=c.length;d<e;d++)c[d].group(a,b)},this.groupEnd=function(){if(enabled)for(var a=this.getEffectiveAppenders(),b=0,c=a.length;b<c;b++)a[b].groupEnd()};var i={};this.time=function(a,b){enabled&&(isUndefined(a)?handleError("Logger.time: a name for the timer must be supplied"):!b||b instanceof Level?i[a]=new Timer(a,b):handleError("Logger.time: level supplied to timer "+a+" is not an instance of log4javascript.Level"))},this.timeEnd=function(a){if(enabled)if(isUndefined(a))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(i[a]){var b=i[a],c=b.getElapsedTime();this.log(b.level,["Timer "+toStr(a)+" completed in "+c+"ms"]),delete i[a]}else logLog.warn("Logger.timeEnd: no timer found with name "+a)},this.assert=function(a){if(enabled&&!a){for(var b=[],c=1,d=arguments.length;c<d;c++)b.push(arguments[c]);b=b.length>0?b:["Assertion Failure"],b.push(newLine),b.push(a),this.log(Level.ERROR,b)}},this.toString=function(){return"Logger["+this.name+"]"}}function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(a){this.combineMessages=extractBooleanFromParam(a,!0),this.customFields=[]}function escapeNewLines(a){return a.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(a,b){this.readable=extractBooleanFromParam(a,!1),this.combineMessages=extractBooleanFromParam(b,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(a,b,c){function d(a,b,c){function f(a){for(var b=splitIntoLines(a),d=1,e=b.length;d<e;d++)b[d]=c+b[d];return b.join(newLine)}var g,h,i,j,k,l,m;if(c||(c=""),null===a)return"null";if("undefined"==typeof a)return"undefined";if("string"==typeof a)return f(a);if("object"==typeof a&&array_contains(e,a)){try{l=toStr(a)}catch(a){l="Error formatting property. Details: "+getExceptionStringRep(a)}return l+" [already expanded]"}if(a instanceof Array&&b>0){for(e.push(a),l="["+newLine,i=b-1,j=c+"  ",k=[],g=0,h=a.length;g<h;g++)try{m=d(a[g],i,j),k.push(j+m)}catch(a){k.push(j+"Error formatting array member. Details: "+getExceptionStringRep(a))}return l+=k.join(","+newLine)+newLine+c+"]"}if("[object Date]"==Object.prototype.toString.call(a))return a.toString();if("object"==typeof a&&b>0){e.push(a),l="{"+newLine,i=b-1,j=c+"  ",k=[];for(g in a)try{m=d(a[g],i,j),k.push(j+g+": "+m)}catch(a){k.push(j+g+": Error formatting property. Details: "+getExceptionStringRep(a))}return l+=k.join(","+newLine)+newLine+c+"}"}return f(toStr(a))}var e=[];return d(a,b,c)}function PatternLayout(a){a?this.pattern=a:this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}function isHttpRequestSuccessful(a){return isUndefined(a.status)||0===a.status||a.status>=200&&a.status<300||1223==a.status}function AjaxAppender(a,b){function c(a){return!A||(handleError("AjaxAppender: configuration option '"+a+"' may not be set after the appender has been initialized"),!1)}function d(){if(l&&enabled){z=!0;var a;if(n)x.length>0?(a=x.shift(),i(f(a),d)):(z=!1,m&&g());else{for(;a=x.shift();)i(f(a));z=!1,m&&g()}}}function e(){var a=!1;if(l&&enabled){for(var b,c=k.getLayout().allowBatching()?o:1,e=[];b=w.shift();)e.push(b),w.length>=c&&(x.push(e),e=[]);e.length>0&&x.push(e),a=x.length>0,n=!1,m=!1,d()}return a}function f(a){for(var b,c=[],d="";b=a.shift();)c.push(k.getLayout().formatWithException(b));return d=1==a.length?c.join(""):k.getLayout().batchHeader+c.join(k.getLayout().batchSeparator)+k.getLayout().batchFooter,u==k.defaults.contentType&&(d=k.getLayout().returnsPostData?d:urlEncode(s)+"="+urlEncode(d),d.length>0&&(d+="&"),d+="layout="+urlEncode(k.getLayout().toString())),d}function g(){window.setTimeout(d,p)}function h(){var a="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(a),l=!1,r&&r(a)}function i(c,d){try{var e=getXmlHttp(h);if(l){e.onreadystatechange=function(){if(4==e.readyState){if(isHttpRequestSuccessful(e))q&&q(e),d&&d(e);else{var b="AjaxAppender.append: XMLHttpRequest request to URL "+a+" returned status code "+e.status;handleError(b),r&&r(b)}e.onreadystatechange=emptyFunction,e=null}},e.open("POST",a,!0),b&&withCredentialsSupported&&(e.withCredentials=!0);try{for(var f,g=0;f=y[g++];)e.setRequestHeader(f.name,f.value);e.setRequestHeader("Content-Type",u)}catch(a){var i="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(i),l=!1,void(r&&r(i))}e.send(c)}}catch(b){var j="AjaxAppender.append: error sending log message to "+a;handleError(j,b),l=!1,r&&r(j+". Details: "+getExceptionStringRep(b))}}function j(){if(A=!0,t){var a=window.onbeforeunload;window.onbeforeunload=function(){a&&a(),e()}}m&&g()}var k=this,l=!0;a||(handleError("AjaxAppender: URL must be specified in constructor"),l=!1);var m=this.defaults.timed,n=this.defaults.waitForResponse,o=this.defaults.batchSize,p=this.defaults.timerInterval,q=this.defaults.requestSuccessCallback,r=this.defaults.failCallback,s=this.defaults.postVarName,t=this.defaults.sendAllOnUnload,u=this.defaults.contentType,v=null,w=[],x=[],y=[],z=!1,A=!1;this.getSessionId=function(){return v},this.setSessionId=function(a){v=extractStringFromParam(a,null),this.layout.setCustomField("sessionid",v)},this.setLayout=function(a){c("layout")&&(this.layout=a,null!==v&&this.setSessionId(v))},this.isTimed=function(){return m},this.setTimed=function(a){c("timed")&&(m=bool(a))},this.getTimerInterval=function(){return p},this.setTimerInterval=function(a){c("timerInterval")&&(p=extractIntFromParam(a,p))},this.isWaitForResponse=function(){return n},this.setWaitForResponse=function(a){c("waitForResponse")&&(n=bool(a))},this.getBatchSize=function(){return o},this.setBatchSize=function(a){c("batchSize")&&(o=extractIntFromParam(a,o))},this.isSendAllOnUnload=function(){return t},this.setSendAllOnUnload=function(a){c("sendAllOnUnload")&&(t=extractBooleanFromParam(a,t))},this.setRequestSuccessCallback=function(a){q=extractFunctionFromParam(a,q)},this.setFailCallback=function(a){r=extractFunctionFromParam(a,r)},this.getPostVarName=function(){return s},this.setPostVarName=function(a){c("postVarName")&&(s=extractStringFromParam(a,s))},this.getHeaders=function(){return y},this.addHeader=function(a,b){"content-type"==a.toLowerCase()?u=b:y.push({name:a,value:b})},this.sendAll=d,this.sendAllRemaining=e,this.append=function(a){if(l){A||j(),w.push(a);var b=this.getLayout().allowBatching()?o:1;if(w.length>=b){for(var c,e=[];c=w.shift();)e.push(c);x.push(e),m||n&&(!n||z)||d()}}}}function setCookie(a,b,c,d){var e;if(d=d?"; path="+d:"",c){var f=new Date;f.setTime(f.getTime()+24*c*60*60*1e3),e="; expires="+f.toGMTString()}else e="";document.cookie=escape(a)+"="+escape(b)+e+d}function getCookie(a){for(var b=escape(a)+"=",c=document.cookie.split(";"),d=0,e=c.length;d<e;d++){for(var f=c[d];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return unescape(f.substring(b.length,f.length))}return null}function getBaseUrl(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;++b)if(a[b].src.indexOf("log4javascript")!=-1){var d=a[b].src.lastIndexOf("/");return d==-1?"":a[b].src.substr(0,d+1)}return null}function isLoaded(a){try{return bool(a.loaded)}catch(a){return!1}}function padWithSpaces(a,b){if(a.length<b){for(var c=[],d=Math.max(0,b-a.length),e=0;e<d;e++)c[e]=" ";a+=c.join("")}return a}function createDefaultLogger(){var a=log4javascript.getLogger(defaultLoggerName),b=new log4javascript.PopUpAppender;return a.addAppender(b),a}Array.prototype.push||(Array.prototype.push=function(){for(var a=0,b=arguments.length;a<b;a++)this[this.length]=arguments[a];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(this.length>0){for(var a=this[0],b=0,c=this.length-1;b<c;b++)this[b]=this[b+1];return this.length=this.length-1,a}}),Array.prototype.splice||(Array.prototype.splice=function(a,b){var c=this.slice(a+b),d=this.slice(a,a+b);this.length=a;for(var e=[],f=0,g=arguments.length;f<g;f++)e[f]=arguments[f];var h=e.length>2?c=e.slice(2).concat(c):c;for(f=0,g=h.length;f<g;f++)this.push(h[f]);return d}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(a){if(a instanceof Array){this.eventTypes=a,this.eventListeners={};for(var b=0,c=this.eventTypes.length;b<c;b++)this.eventListeners[this.eventTypes[b]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(a,b){"function"==typeof b?(array_contains(this.eventTypes,a)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+a+"'"),this.eventListeners[a].push(b)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(a,b){"function"==typeof b?(array_contains(this.eventTypes,a)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+a+"'"),array_remove(this.eventListeners[a],b)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(a,b){if(array_contains(this.eventTypes,a))for(var c=this.eventListeners[a],d=0,e=c.length;d<e;d++)c[d](this,a,b);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+a+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode="undefined"!=typeof window.encodeURIComponent?function(a){return encodeURIComponent(a)}:function(a){return escape(a).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";"undefined"!=typeof obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(a){for(var b=[],c=1,d=arguments.length;c<d;c++)b[c-1]=arguments[c];return this.apply(a,b)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(a){this.quietMode=bool(a)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(a){this.alertAllErrors=a},debug:function(a){this.debugMessages.push(a)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(a,b){},error:function(a,b){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var c="log4javascript error: "+a;b&&(c+=newLine+newLine+"Original error: "+getExceptionStringRep(b)),alert(c)}}};log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(a){enabled=bool(a)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(a){useTimeStampsInMilliseconds=bool(a)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(a){showStackTraces=bool(a)};var Level=function(a,b){this.level=a,this.name=b};Level.prototype={toString:function(){return this.name},equals:function(a){return this.level==a.level},isGreaterOrEqual:function(a){return this.level>=a.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(a){return a.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(a){if("string"!=typeof a&&(a=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(a)+" supplied, returning anonymous logger")),a==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[a]){var b=new Logger(a);loggers[a]=b,loggerNames.push(a);var c,d=a.lastIndexOf(".");if(d>-1){var e=a.substring(0,d);c=log4javascript.getLogger(e)}else c=rootLogger;c.addChild(b)}return loggers[a]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName),nullLogger.setLevel(Level.OFF)),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(a,b,c,d,e){this.logger=a,this.timeStamp=b,this.timeStampInMilliseconds=b.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=c,this.messages=d,this.exception=e};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(a){this.overrideTimeStampsSetting=!0,
this.useTimeStampsInMilliseconds=bool(a)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(a){return this.isTimeStampsInMilliseconds()?a.timeStampInMilliseconds:a.timeStampInSeconds},getDataValues:function(a,b){var c=[[this.loggerKey,a.logger.name],[this.timeStampKey,this.getTimeStampValue(a)],[this.levelKey,a.level.name],[this.urlKey,window.location.href],[this.messageKey,b?a.getCombinedMessages():a.messages]];if(this.isTimeStampsInMilliseconds()||c.push([this.millisecondsKey,a.milliseconds]),a.exception&&c.push([this.exceptionKey,getExceptionStringRep(a.exception)]),this.hasCustomFields())for(var d=0,e=this.customFields.length;d<e;d++){var f=this.customFields[d].value;"function"==typeof f&&(f=f(this,a)),c.push([this.customFields[d].name,f])}return c},setKeys:function(a,b,c,d,e,f,g){this.loggerKey=extractStringFromParam(a,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(b,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(c,this.defaults.levelKey),this.messageKey=extractStringFromParam(d,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(e,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(f,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(g,this.defaults.millisecondsKey)},setCustomField:function(a,b){for(var c=!1,d=0,e=this.customFields.length;d<e;d++)this.customFields[d].name===a&&(this.customFields[d].value=b,c=!0);c||this.customFields.push({name:a,value:b})},hasCustomFields:function(){return this.customFields.length>0},formatWithException:function(a){var b=this.format(a);return a.exception&&this.ignoresThrowable()&&(b+=a.getThrowableStrRep()),b},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(a){enabled&&a.level.level>=this.threshold.level&&this.append(a)},Appender.prototype.append=function(a){},Appender.prototype.setLayout=function(a){a instanceof Layout?this.layout=a:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(a){a instanceof Level?this.threshold=a:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(a){this.loggers.push(a)},Appender.prototype.setRemovedFromLogger=function(a){array_remove(this.loggers,a)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(a){return a.level.name+" - "+a.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(a){return a.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(a){var b=a.messages,c=a.exception;return c?b.concat([c]):b},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(a){return a.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(a){function b(a){return a="string"==typeof a?a:toStr(a),"<log4javascript:message><![CDATA["+e.escapeCdata(a)+"]]></log4javascript:message>"}var c,d,e=this,f='<log4javascript:event logger="'+a.logger.name+'" timestamp="'+this.getTimeStampValue(a)+'"';if(this.isTimeStampsInMilliseconds()||(f+=' milliseconds="'+a.milliseconds+'"'),f+=' level="'+a.level.name+'">'+newLine,this.combineMessages)f+=b(a.getCombinedMessages());else{for(f+="<log4javascript:messages>"+newLine,c=0,d=a.messages.length;c<d;c++)f+=b(a.messages[c])+newLine;f+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(c=0,d=this.customFields.length;c<d;c++)f+='<log4javascript:customfield name="'+this.customFields[c].name+'"><![CDATA['+this.customFields[c].value.toString()+"]]></log4javascript:customfield>"+newLine;return a.exception&&(f+="<log4javascript:exception><![CDATA["+getExceptionStringRep(a.exception)+"]]></log4javascript:exception>"+newLine),f+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(a){function b(a,c,d){var f,g=typeof a;if(a instanceof Date)f=String(a.getTime());else if(d&&a instanceof Array){f="["+e.lineBreak;for(var h=0,i=a.length;h<i;h++){var j=c+e.tab;f+=j+b(a[h],j,!1),h<a.length-1&&(f+=","),f+=e.lineBreak}f+=c+"]"}else f="number"!==g&&"boolean"!==g?'"'+escapeNewLines(toStr(a).replace(/\"/g,'\\"'))+'"':a;return f}var c,d,e=this,f=this.getDataValues(a,this.combineMessages),g="{"+this.lineBreak;for(c=0,d=f.length-1;c<=d;c++)g+=this.tab+'"'+f[c][0]+'"'+this.colon+b(f[c][1],this.tab,!0),c<d&&(g+=","),g+=this.lineBreak;return g+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(a){for(var b=this.getDataValues(a),c=[],d=0,e=b.length;d<e;d++){var f=b[d][1]instanceof Date?String(b[d][1].getTime()):b[d][1];c.push(urlEncode(b[d][0])+"="+urlEncode(f))}return c.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(a){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout;var SimpleDateFormat;!function(){var a=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=0,e=1,f=2,g=3,h=4,i=5,j={G:d,y:g,M:h,w:f,W:f,D:f,d:f,F:f,E:e,a:d,H:f,k:f,K:f,h:f,m:f,s:f,S:f,Z:i},k=864e5,l=7*k,m=1,n=function(a,b,c){var d=new Date(a,b,c,0,0,0);return d.setMilliseconds(0),d};Date.prototype.getDifference=function(a){return this.getTime()-a.getTime()},Date.prototype.isBefore=function(a){return this.getTime()<a.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(a){return this.getUTCTime()-a.getUTCTime()},Date.prototype.getPreviousSunday=function(){var a=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),b=new Date(a.getTime()-this.getDay()*k);return n(b.getFullYear(),b.getMonth(),b.getDate())},Date.prototype.getWeekInYear=function(a){isUndefined(this.minimalDaysInFirstWeek)&&(a=m);var b=this.getPreviousSunday(),c=n(this.getFullYear(),0,1),d=b.isBefore(c)?0:1+Math.floor(b.getTimeSince(c)/l),e=7-c.getDay(),f=d;return e<a&&f--,f},Date.prototype.getWeekInMonth=function(a){isUndefined(this.minimalDaysInFirstWeek)&&(a=m);var b=this.getPreviousSunday(),c=n(this.getFullYear(),this.getMonth(),1),d=b.isBefore(c)?0:1+Math.floor(b.getTimeSince(c)/l),e=7-c.getDay(),f=d;return e>=a&&f++,f},Date.prototype.getDayInYear=function(){var a=n(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(a)/k)},SimpleDateFormat=function(a){this.formatString=a},SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(a){this.minimalDaysInFirstWeek=a},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?m:this.minimalDaysInFirstWeek};var o=function(a,b){for(;a.length<b;)a="0"+a;return a},p=function(a,b,c){return b>=4?a:a.substr(0,Math.max(c,b))},q=function(a,b){var c=""+a;return o(c,b)};SimpleDateFormat.prototype.format=function(k){for(var l,m="",n=this.formatString;l=a.exec(n);){var r=l[1],s=l[2],t=l[3],u=l[4];if(r)m+="''"==r?"'":r.substring(1,r.length-1);else if(t);else if(u)m+=u;else if(s){var v=s.charAt(0),w=s.length,x="";switch(v){case"G":x="AD";break;case"y":x=k.getFullYear();break;case"M":x=k.getMonth();break;case"w":x=k.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":x=k.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":x=k.getDayInYear();break;case"d":x=k.getDate();break;case"F":x=1+Math.floor((k.getDate()-1)/7);break;case"E":x=c[k.getDay()];break;case"a":x=k.getHours()>=12?"PM":"AM";break;case"H":x=k.getHours();break;case"k":x=k.getHours()||24;break;case"K":x=k.getHours()%12;break;case"h":x=k.getHours()%12||12;break;case"m":x=k.getMinutes();break;case"s":x=k.getSeconds();break;case"S":x=k.getMilliseconds();break;case"Z":x=k.getTimezoneOffset()}switch(j[v]){case d:m+=p(x,w,2);break;case e:m+=p(x,w,3);break;case f:m+=q(x,w);break;case g:if(w<=3){var y=""+x;m+=y.substr(2,2)}else m+=q(x,w);break;case h:m+=w>=3?p(b[x],w,w):q(x+1,w);break;case i:var z=x>0,A=z?"-":"+",B=Math.abs(x),C=""+Math.floor(B/60);C=o(C,2);var D=""+B%60;D=o(D,2),m+=A+C+D}}n=n.substr(l.index+l[0].length)}return m}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(a){for(var b,c=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,d="",e=this.pattern;b=c.exec(e);){var f=b[0],g=b[1],h=b[2],i=b[3],j=b[5],k=b[6];if(k)d+=""+k;else{var l="";switch(i){case"a":case"m":var m=0;j&&(m=parseInt(j,10),isNaN(m)&&(handleError("PatternLayout.format: invalid specifier '"+j+"' for conversion character '"+i+"' - should be a number"),m=0));for(var n="a"===i?a.messages[0]:a.messages,o=0,p=n.length;o<p;o++)o>0&&" "!==l.charAt(l.length-1)&&(l+=" "),l+=0===m?n[o]:formatObjectExpansion(n[o],m);break;case"c":var q=a.logger.name;if(j){var r=parseInt(j,10),s=a.logger.name.split(".");l=r>=s.length?q:s.slice(s.length-r).join(".")}else l=q;break;case"d":var t=PatternLayout.ISO8601_DATEFORMAT;j&&(t=j,"ISO8601"==t?t=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==t?t=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==t&&(t=PatternLayout.DATETIME_DATEFORMAT)),l=new SimpleDateFormat(t).format(a.timeStamp);break;case"f":if(this.hasCustomFields()){var u=0;j&&(u=parseInt(j,10),isNaN(u)?handleError("PatternLayout.format: invalid specifier '"+j+"' for conversion character 'f' - should be a number"):0===u?handleError("PatternLayout.format: invalid specifier '"+j+"' for conversion character 'f' - must be greater than zero"):u>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+j+"' for conversion character 'f' - there aren't that many custom fields"):u-=1);var v=this.customFields[u].value;"function"==typeof v&&(v=v(this,a)),l=v}break;case"n":l=newLine;break;case"p":l=a.level.name;break;case"r":l=""+a.timeStamp.getDifference(applicationStartDate);break;case"%":l="%";break;default:l=f}var w;if(h){w=parseInt(h.substr(1),10);var x=l.length;w<x&&(l=l.substring(x-w,x))}if(g)if("-"==g.charAt(0))for(w=parseInt(g.substr(1),10);l.length<w;)l+=" ";else for(w=parseInt(g,10);l.length<w;)l=" "+l;d+=l}e=e.substr(b.index+b[0].length)}return d},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(a){alert(this.getLayout().formatWithException(a))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(a){var b,c=this,d=function(){var b=c.getLayout().formatWithException(a);return"string"==typeof b?[b]:b};if((b=window.console)&&b.log){var e,f=d();e=b.debug&&Level.DEBUG.isGreaterOrEqual(a.level)?"debug":b.info&&Level.INFO.equals(a.level)?"info":b.warn&&Level.WARN.equals(a.level)?"warn":b.error&&a.level.isGreaterOrEqual(Level.ERROR)?"error":"log",b[e].apply?b[e].apply(b,f):b[e](f)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(d())},BrowserConsoleAppender.prototype.group=function(a){window.console&&window.console.group&&window.console.group(a)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(a){for(var b,c=null,d=0,e=xmlHttpFactories.length;d<e;d++){b=xmlHttpFactories[d];try{return c=b(),withCredentialsSupported=b==xhrFactory&&"withCredentials"in c,getXmlHttp=b,c}catch(a){}}a?a():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")};AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender;var ConsoleAppender;if(function(){function a(a,b,c,d,e){this.create(!1,null,a,b,c,d,e,this.defaults.focusPopUp)}function b(a,b,c,d,e,f){this.create(!0,a,b,c,d,e,f,!1)}var c=function(){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t<!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work -->",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;</script>','\t\t<!--[if IE]><script type="text/javascript">isIe = true</script><![endif]-->','\t\t<!--[if lt IE 7]><script type="text/javascript">isIePre7 = true</script><![endif]-->','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t</script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];
},d=[];ConsoleAppender=function(){};var e=1;ConsoleAppender.prototype=new Appender,ConsoleAppender.prototype.create=function(a,b,f,g,h,i,j,k){function l(a,b){this.loggingEvent=a,this.levelName=a.level.name,this.formattedMessage=b}function m(a,b){this.name=a,this.initiallyExpanded=b}function n(){}var o=this,p=!1,q=!1,r=!1,s=!1,t=[],u=!0,v=e++;g=extractBooleanFromParam(g,this.defaults.initiallyMinimized),f=extractBooleanFromParam(f,this.defaults.lazyInit),h=extractBooleanFromParam(h,this.defaults.useDocumentWrite);var w=this.defaults.newestMessageAtTop,x=this.defaults.scrollToLatestMessage;i=i?i:this.defaults.width,j=j?j:this.defaults.height;var y=this.defaults.maxMessages,z=this.defaults.showCommandLine,A=this.defaults.commandLineObjectExpansionDepth,B=this.defaults.showHideButton,C=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var D,E,F,G,H,I=a?"InPageAppender":"PopUpAppender",J=function(a){return!q||(handleError(I+": configuration option '"+a+"' may not be set after the appender has been initialized"),!1)},K=function(){return r&&u&&!s};this.isNewestMessageAtTop=function(){return w},this.setNewestMessageAtTop=function(a){w=bool(a),K()&&G().setNewestAtTop(w)},this.isScrollToLatestMessage=function(){return x},this.setScrollToLatestMessage=function(a){x=bool(a),K()&&G().setScrollToLatest(x)},this.getWidth=function(){return i},this.setWidth=function(a){J("width")&&(i=extractStringFromParam(a,i))},this.getHeight=function(){return j},this.setHeight=function(a){J("height")&&(j=extractStringFromParam(a,j))},this.getMaxMessages=function(){return y},this.setMaxMessages=function(a){y=extractIntFromParam(a,y),K()&&G().setMaxMessages(y)},this.isShowCommandLine=function(){return z},this.setShowCommandLine=function(a){z=bool(a),K()&&G().setShowCommandLine(z)},this.isShowHideButton=function(){return B},this.setShowHideButton=function(a){B=bool(a),K()&&G().setShowHideButton(B)},this.isShowCloseButton=function(){return C},this.setShowCloseButton=function(a){C=bool(a),K()&&G().setShowCloseButton(C)},this.getCommandLineObjectExpansionDepth=function(){return A},this.setCommandLineObjectExpansionDepth=function(a){A=extractIntFromParam(a,A)};var L=g;this.isInitiallyMinimized=function(){return g},this.setInitiallyMinimized=function(a){J("initiallyMinimized")&&(g=bool(a),L=g)},this.isUseDocumentWrite=function(){return h},this.setUseDocumentWrite=function(a){J("useDocumentWrite")&&(h=bool(a))},l.prototype.append=function(){G().log(this.levelName,this.formattedMessage)},m.prototype.append=function(){G().group(this.name,this.initiallyExpanded)},n.prototype.append=function(){G().groupEnd()};var M=function(){F(),p?s&&ba&&E():D(),F()&&N()};this.append=function(a){if(u){var b=o.getLayout().formatWithException(a);t.push(new l(a,b)),M()}},this.group=function(a,b){u&&(t.push(new m(a,b)),M())},this.groupEnd=function(){u&&(t.push(new n),M())};var N=function(){for(;t.length>0;)t.shift().append();k&&G().focus()};this.setAddedToLogger=function(a){this.loggers.push(a),enabled&&!f&&D()},this.clear=function(){K()&&G().clearLog(),t.length=0},this.focus=function(){K()&&G().focus()},this.focusCommandLine=function(){K()&&G().focusCommandLine()},this.focusSearch=function(){K()&&G().focusSearch()};var O=window;this.getCommandWindow=function(){return O},this.setCommandWindow=function(a){O=a},this.executeLastCommand=function(){K()&&G().evalLastCommand()};var P=new PatternLayout("%m");this.getCommandLayout=function(){return P},this.setCommandLayout=function(a){P=a},this.evalCommandAndAppend=function(a){var b={appendResult:!0,isError:!1},c="";try{var d,e;!O.eval&&O.execScript&&O.execScript("null");var f={};for(e=0,len=Q.length;e<len;e++)f[Q[e][0]]=Q[e][1];var g=[],h=function(a){g.push([a,O[a]])};h("appender"),O.appender=o,h("commandReturnValue"),O.commandReturnValue=b,h("commandLineFunctionsHash"),O.commandLineFunctionsHash=f;var i=function(a){h(a),O[a]=function(){return this.commandLineFunctionsHash[a](o,arguments,b)}};for(e=0,len=Q.length;e<len;e++)i(Q[e][0]);for(O===window&&O.execScript?(h("evalExpr"),h("result"),window.evalExpr=a,O.execScript("window.result=eval(window.evalExpr);"),d=window.result):d=O.eval(a),c=isUndefined(d)?d:formatObjectExpansion(d,A),e=0,len=g.length;e<len;e++)O[g[e][0]]=g[e][1]}catch(a){c="Error evaluating command: "+getExceptionStringRep(a),b.isError=!0}if(b.appendResult){var j=">>> "+a;isUndefined(c)||(j+=newLine+c);var k=b.isError?Level.ERROR:Level.INFO,l=new LoggingEvent(null,new Date,k,[j],null),m=this.getLayout();this.setLayout(P),this.append(l),this.setLayout(m)}};var Q=d.concat([]);this.addCommandLineFunction=function(a,b){Q.push([a,b])};var R="log4javascriptCommandHistory";this.storeCommandHistory=function(a){setCookie(R,a.join(","))};var S=function(a){var b=c();a.open();for(var d=0,e=b.length;d<e;d++)a.writeln(b[d]);a.close()};this.setEventTypes(["load","unload"]);var T=function(){var a=G();a.setAppender(o),a.setNewestAtTop(w),a.setScrollToLatest(x),a.setMaxMessages(y),a.setShowCommandLine(z),a.setShowHideButton(B),a.setShowCloseButton(C),a.setMainWindow(window);var b=getCookie(R);b&&(a.commandHistory=b.split(","),a.currentCommandIndex=a.commandHistory.length),o.dispatchEvent("load",{win:a})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),s||(logLog.debug("really doing unload "+this),s=!0,r=!1,q=!1,o.dispatchEvent("unload",{}))};var U=function(a,b,c,d){function e(){try{s&&clearInterval(f),a(G())&&(clearInterval(f),c())}catch(a){clearInterval(f),u=!1,handleError(d,a)}}var f=setInterval(e,b)},V=function(){var a=document.domain!=location.hostname;return h?"":getBaseUrl()+"console_uncompressed.html"+(a?"?log4javascript_domain="+escape(document.domain):"")};if(a){var W=null,X=[];this.addCssProperty=function(a,b){J("cssProperties")&&X.push([a,b])};var Y,Z=!1,$=uniqueId+"_InPageAppender_"+v;this.hide=function(){p&&q&&(K()&&G().$("command").blur(),Y.style.display="none",L=!0)},this.show=function(){p&&(q?(Y.style.display="block",this.setShowCommandLine(z),L=!1):Z||E(!0))},this.isVisible=function(){return!L&&!s},this.close=function(a){s||a&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(Y.parentNode.removeChild(Y),this.unload())},H=function(){function a(){try{g||o.show(),T(),r=!0,N()}catch(a){u=!1,handleError(c,a)}}function b(){try{var b=function(a){return isLoaded(a)};h&&S(G().document),b(G())?a():U(b,100,a,c)}catch(a){u=!1,handleError(c,a)}}var c="InPageAppender.open: unable to create console iframe";L=!1,Y=W.appendChild(document.createElement("div")),Y.style.width=i,Y.style.height=j,Y.style.border="solid gray 1px";for(var d=0,e=X.length;d<e;d++)Y.style[X[d][0]]=X[d][1];var f=h?"":" src='"+V()+"'";Y.innerHTML="<iframe id='"+$+"' name='"+$+"' width='100%' height='100%' frameborder='0'"+f+" scrolling='no'></iframe>",s=!1;var k=function(a){try{return bool(a)&&bool(a.document)}catch(a){return!1}};k(G())?b():U(k,100,b,c),q=!0},E=function(a){if(a||!g){var c=function(){if(b)try{var a=document.getElementById(b);1==a.nodeType&&(W=a),H()}catch(a){handleError("InPageAppender.init: invalid container element '"+b+"' supplied",a)}else W=document.createElement("div"),W.style.position="fixed",W.style.left="0",W.style.right="0",W.style.bottom="0",document.body.appendChild(W),o.addCssProperty("borderWidth","1px 0 0 0"),o.addCssProperty("zIndex",1e6),H()};pageLoaded&&b&&b.appendChild?(W=b,H()):pageLoaded?c():log4javascript.addEventListener("load",c),Z=!0}},D=function(){E(),p=!0},G=function(){var a=window.frames[$];if(a)return a},F=function(){return!(!u||s)&&(q&&!r&&G()&&isLoaded(G())&&(r=!0),r)}}else{var _=o.defaults.useOldPopUp,aa=o.defaults.complainAboutPopUpBlocking,ba=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return _},this.setUseOldPopUp=function(a){J("useOldPopUp")&&(_=bool(a))},this.isComplainAboutPopUpBlocking=function(){return aa},this.setComplainAboutPopUpBlocking=function(a){J("complainAboutPopUpBlocking")&&(aa=bool(a))},this.isFocusPopUp=function(){return k},this.setFocusPopUp=function(a){k=bool(a)},this.isReopenWhenClosed=function(){return ba},this.setReopenWhenClosed=function(a){ba=bool(a)},this.close=function(){logLog.debug("close "+this);try{ca.close(),this.unload()}catch(a){}},this.hide=function(){logLog.debug("hide "+this),K()&&this.close()},this.show=function(){logLog.debug("show "+this),q||H()},this.isVisible=function(){return F()};var ca;H=function(){function a(){G().setCloseIfOpenerCloses(!_||!h),T(),r=!0,N(),U(f,500,g,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}var b="width="+i+",height="+j+",status,resizable",c="";try{var d=window.frameElement;d&&(c="_"+d.tagName+"_"+(d.name||d.id||""))}catch(a){c="_inaccessibleParentFrame"}var e="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+v+c;_&&h||(e=e+"_"+uniqueId);var f=function(a){if(s)return!0;try{return bool(a)&&a.closed}catch(a){}return!1},g=function(){s||o.unload()};try{if(ca=window.open(V(),e,b),s=!1,q=!0,ca&&ca.document)if(h&&_&&isLoaded(ca))ca.mainPageReloaded(),a();else{h&&S(ca.document);var k=function(a){return bool(a)&&isLoaded(a)};isLoaded(ca)?a():U(k,100,a,"PopUpAppender.init: unable to create console window")}else u=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),aa&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(a){handleError("PopUpAppender.init: error creating pop-up",a)}},E=function(){g||H()},D=function(){E(),p=!0},G=function(){return ca},F=function(){if(u&&!isUndefined(ca)&&!s){if(ca.closed||r&&isUndefined(ca.closed))return o.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!r&&isLoaded(ca)&&(r=!0)}return u&&r&&!s}}this.getConsoleWindow=G},ConsoleAppender.addGlobalCommandLineFunction=function(a,b){d.push([a,b])},a.prototype=new ConsoleAppender,a.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},a.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=a,b.prototype=new ConsoleAppender,b.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},b.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=b,log4javascript.InlineAppender=b}(),function(){function a(a){var b=0;for(var c in a)b=Math.max(toStr(c).length,b);var d=[];for(c in a){var e,f="  "+padWithSpaces(toStr(c),b+2);try{e=splitIntoLines(toStr(a[c])).join(padWithSpaces(newLine,b+6))}catch(a){e="[Error obtaining property. Details: "+getExceptionMessage(a)+"]"}d.push(f+e)}return d.join(newLine)}function b(a,c,d,i,j){function k(a){return a.nodeType==e.TEXT_NODE&&/^[ \t\r\n]*$/.test(a.nodeValue)}function l(a){return a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function m(a){for(var b=a.style.cssText.split(";"),c="",d=0,e=b.length;d<e;d++){var f=b[d].split(":"),g=[];/^\s*$/.test(f[0])||g.push(trim(f[0]).toLowerCase()+":"+trim(f[1])),c=g.join(";")}return c}function n(a){if(a.prefix)return a.prefix;if(a.outerHTML){var b=new RegExp("<([^:]+):"+a.tagName+"[^>]*>","i");if(b.test(a.outerHTML))return RegExp.$1.toLowerCase()}return""}c="undefined"==typeof c||!!c,"string"!=typeof d&&(d=""),i=!!i,j=!!j;var o,p,q,r="<",s=">";if(!c||a.nodeType==e.DOCUMENT_FRAGMENT_NODE){for(o="",p=0,q=a.childNodes.length;p<q;p++)o+=b(a.childNodes[p],!0,d+h);return o}switch(a.nodeType){case e.ELEMENT_NODE:var t=a.tagName.toLowerCase();o=i?newLine+d:"",o+=r;var u=n(a),v=!!u;for(v&&(o+=u+":"),o+=t,p=0,q=a.attributes.length;p<q;p++){var w=a.attributes[p];w.specified&&null!==w.nodeValue&&"style"!==w.nodeName.toLowerCase()&&"string"==typeof w.nodeValue&&0!==w.nodeName.indexOf("_moz")&&(o+=" "+w.nodeName.toLowerCase()+'="',o+=l(w.nodeValue),o+='"')}if(a.style.cssText){var x=m(a);""!==x&&(o+=' style="'+m(a)+'"')}if(array_contains(g,t)||v&&!a.hasChildNodes())o+="/"+s;else{o+=s;var y=!(1===a.childNodes.length&&a.childNodes[0].nodeType===e.TEXT_NODE),z=array_contains(f,t);for(p=0,q=a.childNodes.length;p<q;p++)o+=b(a.childNodes[p],!0,d+h,y,z);var A=r+"/"+t+s;o+=y?newLine+d+A:A}return o;case e.TEXT_NODE:if(k(a))o="";else{if(j)o=a.nodeValue;else{var B=splitIntoLines(trim(a.nodeValue)),C=[];for(p=0,q=B.length;p<q;p++)C[p]=trim(B[p]);o=C.join(newLine+d)}i&&(o=newLine+d+o)}return o;case e.CDATA_SECTION_NODE:return"<![CDATA["+a.nodeValue+"]]>"+newLine;case e.DOCUMENT_NODE:for(o="",p=0,q=a.childNodes.length;p<q;p++)o+=b(a.childNodes[p],!0,d);return o;default:return""}}function c(){ConsoleAppender.addGlobalCommandLineFunction("$",function(a,b,c){return document.getElementById(b[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(b,c,d){for(var e=[],f=0,g=c.length;f<g;f++)e[f]=a(c[f]);return e.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(a,c,d){for(var e=[],f=0,g=c.length;f<g;f++)e[f]=b(c[f]);return e.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(a,b,c){var d,e;return 0===b.length||""===b[0]?(d=window,e="Command line set to run in main window"):b[0].window==b[0]?(d=b[0],e="Command line set to run in frame '"+b[0].name+"'"):(d=window.frames[b[0]],d?e="Command line set to run in frame '"+b[0]+"'":(c.isError=!0,e="Frame '"+b[0]+"' does not exist",d=a.getCommandWindow())),a.setCommandWindow(d),e}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(a,b,c){c.appendResult=!1,a.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(a,b,c){var d=[];for(var e in b[0])d.push(e);return d}),ConsoleAppender.addGlobalCommandLineFunction("values",function(a,b,c){var d=[];for(var e in b[0])try{d.push(b[0][e])}catch(a){logLog.warn("values(): Unable to obtain value for key "+e+". Details: "+getExceptionMessage(a))}return d}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(a,b,c){var d=parseInt(b[0],10);return isNaN(d)||d<0?(c.isError=!0,""+b[0]+" is not a valid expansion depth"):(a.setCommandLineObjectExpansionDepth(d),"Object expansion depth set to "+d)})}function d(){c()}var e={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},f=["script","pre"],g=["br","img","hr","param","link","area","input","col","base","meta"],h="  ";d()}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(a){oldOnload&&oldOnload(a),log4javascript.setDocumentReady()}}return log4javascript},this),function(a,b){"function"==typeof define&&define.amd?define(["bytebuffer"],b):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=b(require("bytebuffer"),!0):(a.dcodeIO=a.dcodeIO||{}).ProtoBuf=b(a.dcodeIO.ByteBuffer)}(this,function(a,b){"use strict";var c={};return c.ByteBuffer=a,c.Long=a.Long||null,c.VERSION="5.0.1",c.WIRE_TYPES={},c.WIRE_TYPES.VARINT=0,c.WIRE_TYPES.BITS64=1,c.WIRE_TYPES.LDELIM=2,c.WIRE_TYPES.STARTGROUP=3,c.WIRE_TYPES.ENDGROUP=4,c.WIRE_TYPES.BITS32=5,c.PACKABLE_WIRE_TYPES=[c.WIRE_TYPES.VARINT,c.WIRE_TYPES.BITS64,c.WIRE_TYPES.BITS32],c.TYPES={int32:{name:"int32",wireType:c.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:c.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:c.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:c.WIRE_TYPES.VARINT,defaultValue:c.Long?c.Long.ZERO:void 0},uint64:{name:"uint64",wireType:c.WIRE_TYPES.VARINT,defaultValue:c.Long?c.Long.UZERO:void 0},sint64:{name:"sint64",wireType:c.WIRE_TYPES.VARINT,defaultValue:c.Long?c.Long.ZERO:void 0},bool:{name:"bool",wireType:c.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:c.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:c.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:c.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:c.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:c.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:c.WIRE_TYPES.BITS64,defaultValue:c.Long?c.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:c.WIRE_TYPES.BITS64,defaultValue:c.Long?c.Long.ZERO:void 0},float:{name:"float",wireType:c.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:c.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:c.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:c.WIRE_TYPES.STARTGROUP,defaultValue:null}},c.MAP_KEY_TYPES=[c.TYPES.int32,c.TYPES.sint32,c.TYPES.sfixed32,c.TYPES.uint32,c.TYPES.fixed32,c.TYPES.int64,c.TYPES.sint64,c.TYPES.sfixed64,c.TYPES.uint64,c.TYPES.fixed64,c.TYPES.bool,c.TYPES.string,c.TYPES.bytes],c.ID_MIN=1,c.ID_MAX=536870911,c.convertFieldsToCamelCase=!1,c.populateAccessors=!0,c.populateDefaults=!0,c.Util=function(){var a={};return a.IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),a.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(a){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},a.fetch=function(b,c){if(c&&"function"!=typeof c&&(c=null),a.IS_NODE){var d=require("fs");if(c)d.readFile(b,function(a,b){c(a?null:""+b)});else try{return d.readFileSync(b)}catch(a){return null}}else{var e=a.XHR();if(e.open("GET",b,!!c),e.setRequestHeader("Accept","text/plain"),"function"==typeof e.overrideMimeType&&e.overrideMimeType("text/plain"),!c)return e.send(null),200==e.status||0==e.status&&"string"==typeof e.responseText?e.responseText:null;if(e.onreadystatechange=function(){4==e.readyState&&c(200==e.status||0==e.status&&"string"==typeof e.responseText?e.responseText:null)},4==e.readyState)return;e.send(null)}},a.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},a}(),c.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},c.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;b.DELIM.lastIndex=0;var f=b.DELIM.test(this.source.charAt(e++));if(!f)for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var g=this.source.substring(this.index,this.index=e);return'"'!==g&&"'"!==g||(this._stringOpen=g),g},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c,d={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},e=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!e||null!==d.package)throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),d.package=a;break;case"import":if(!e)throw Error("unexpected 'import'");a=this.tn.peek(),("public"===a||(c="weak"===a))&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c||d.imports.push(a);break;case"syntax":if(!e)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(d.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(d,null),e=!1;break;case"enum":this._parseEnum(d),e=!1;break;case"option":this._parseOption(d);break;case"service":this._parseService(d);break;case"extend":this._parseExtend(d);break;default:throw Error("unexpected '"+a+"'")}}catch(a){throw a.message="Parse error at line "+this.tn.line+": "+a.message,a}return delete d.name,d},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if(b=this.tn.next(),"'"!==b&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c="rpc",d=this.tn.next();if(!b.NAME.test(d))throw Error("illegal rpc service method name: "+d);var e=d,f={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.request_stream=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal rpc service request type: "+d);if(f.request=d,this.tn.skip(")"),d=this.tn.next(),"returns"!==d.toLowerCase())throw Error("illegal rpc service request type delimiter: "+d);if(this.tn.skip("("),d=this.tn.next(),"stream"===d.toLowerCase()&&(f.response_stream=!0,d=this.tn.next()),f.response=d,this.tn.skip(")"),d=this.tn.peek(),"{"===d){for(this.tn.next();"}"!==(d=this.tn.next());){if("option"!==d)throw Error("illegal rpc service token: "+d);this._parseOption(f)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof a[c]&&(a[c]={}),a[c][e]=f},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("service"===f)this._parseService(g);else if("extensions"===f)g.extensions=this._parseExtensionRanges();else if("reserved"===f)this._parseIgnored();else if("extend"===f)this._parseExtend(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if(e="undefined"!=typeof e?e:this.tn.next(),"group"===e){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b,c=!0;"]"!==(b=this.tn.peek());)c||this.tn.skip(","),this._parseOption(a,!0),c=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensionRanges=function(){var b,c,e,f=[];do{for(c=[];;){switch(b=this.tn.next()){case"min":e=a.ID_MIN;break;case"max":e=a.ID_MAX;break;default:e=d(b)}if(c.push(e),2===c.length)break;if("to"!==this.tn.peek()){c.push(e);break}this.tn.next()}f.push(c)}while(this.tn.omit(","));return this.tn.skip(";"),f},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(c,c.Lang),c.Reflect=function(b){function c(c){if("string"==typeof c&&(c=b.TYPES[c]),"undefined"==typeof c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==b.TYPES.bytes?new a(0):c.defaultValue}function d(a,c){if(a&&"number"==typeof a.low&&"number"==typeof a.high&&"boolean"==typeof a.unsigned&&a.low===a.low&&a.high===a.high)return new b.Long(a.low,a.high,"undefined"==typeof c?a.unsigned:c);if("string"==typeof a)return b.Long.fromString(a,c||!1,10);if("number"==typeof a)return b.Long.fromNumber(a,c||!1);throw Error("not convertible to Long")}function e(a,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case b.WIRE_TYPES.VARINT:do d=c.readUint8();while(128===(128&d));break;case b.WIRE_TYPES.BITS64:c.offset+=8;break;case b.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case b.WIRE_TYPES.STARTGROUP:e(g,c);break;case b.WIRE_TYPES.ENDGROUP:if(g===a)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+a+" expected)");case b.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+a+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(b=b.parent,null==b)break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"};try{var j=i.prototype=Object.create(g.prototype)}catch(a){var j=""}j.getChildren=function(a){if(a=a||null,null==a)return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){
var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(g=d.getChild(c[e]),!g||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do b.unshift(c.name),c=c.parent;while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)a=c[d],a instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"!=typeof this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(a,c,d,e){if(this.type=a,this.resolvedType=c,this.isMapKey=d,this.syntax=e,d&&b.MAP_KEY_TYPES.indexOf(a)<0)throw Error("Invalid map key type: "+a.name)},l=k.prototype;k.defaultFieldValue=c,l.verifyValue=function(c){function e(a,b){throw Error("Illegal value for "+f.toString(!0)+" of type "+f.type.name+": "+a+" ("+b+")")}var f=this;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case b.TYPES.uint32:case b.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:if(b.Long)try{return d(c,!1)}catch(a){e(typeof c,a.message)}else e(typeof c,"requires Long.js");case b.TYPES.uint64:case b.TYPES.fixed64:if(b.Long)try{return d(c,!0)}catch(a){e(typeof c,a.message)}else e(typeof c,"requires Long.js");case b.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case b.TYPES.float:case b.TYPES.double:return"number"!=typeof c&&e(typeof c,"not a number"),c;case b.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case b.TYPES.bytes:return a.isByteBuffer(c)?c:a.wrap(c,"base64");case b.TYPES.enum:var g=this.resolvedType.getChildren(b.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!==0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case b.TYPES.group:case b.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof b.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case b.TYPES.int32:return d<0?a.calculateVarint64(d):a.calculateVarint32(d);case b.TYPES.uint32:return a.calculateVarint32(d);case b.TYPES.sint32:return a.calculateVarint32(a.zigZagEncode32(d));case b.TYPES.fixed32:case b.TYPES.sfixed32:case b.TYPES.float:return 4;case b.TYPES.int64:case b.TYPES.uint64:return a.calculateVarint64(d);case b.TYPES.sint64:return a.calculateVarint64(a.zigZagEncode64(d));case b.TYPES.fixed64:case b.TYPES.sfixed64:return 8;case b.TYPES.bool:return 1;case b.TYPES.enum:return a.calculateVarint32(d);case b.TYPES.double:return 8;case b.TYPES.string:return e=a.calculateUTF8Bytes(d),a.calculateVarint32(e)+e;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return a.calculateVarint32(d.remaining())+d.remaining();case b.TYPES.message:return e=this.resolvedType.calculate(d),a.calculateVarint32(e)+e;case b.TYPES.group:return e=this.resolvedType.calculate(d),e+a.calculateVarint32(c<<3|b.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case b.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case b.TYPES.uint32:e.writeVarint32(d);break;case b.TYPES.sint32:e.writeVarint32ZigZag(d);break;case b.TYPES.fixed32:e.writeUint32(d);break;case b.TYPES.sfixed32:e.writeInt32(d);break;case b.TYPES.int64:case b.TYPES.uint64:e.writeVarint64(d);break;case b.TYPES.sint64:e.writeVarint64ZigZag(d);break;case b.TYPES.fixed64:e.writeUint64(d);break;case b.TYPES.sfixed64:e.writeInt64(d);break;case b.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case b.TYPES.enum:e.writeVarint32(d);break;case b.TYPES.float:e.writeFloat32(d);break;case b.TYPES.double:e.writeFloat64(d);break;case b.TYPES.string:e.writeVString(d);break;case b.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case b.TYPES.message:var g=(new a).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case b.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|b.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(a,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case b.TYPES.int32:return 0|a.readVarint32();case b.TYPES.uint32:return a.readVarint32()>>>0;case b.TYPES.sint32:return 0|a.readVarint32ZigZag();case b.TYPES.fixed32:return a.readUint32()>>>0;case b.TYPES.sfixed32:return 0|a.readInt32();case b.TYPES.int64:return a.readVarint64();case b.TYPES.uint64:return a.readVarint64().toUnsigned();case b.TYPES.sint64:return a.readVarint64ZigZag();case b.TYPES.fixed64:return a.readUint64();case b.TYPES.sfixed64:return a.readInt64();case b.TYPES.bool:return!!a.readVarint32();case b.TYPES.enum:return a.readVarint32();case b.TYPES.float:return a.readFloat();case b.TYPES.double:return a.readDouble();case b.TYPES.string:return a.readVString();case b.TYPES.bytes:if(f=a.readVarint32(),a.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+a.remaining());return e=a.clone(),e.limit=e.offset+f,a.offset+=f,e;case b.TYPES.message:return f=a.readVarint32(),this.resolvedType.decode(a,f);case b.TYPES.group:return this.resolvedType.decode(a,-1,d)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return this.verifyValue(parseInt(c));case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return this.verifyValue(c);case b.TYPES.bool:return"true"===c;case b.TYPES.string:return this.verifyValue(c);case b.TYPES.bytes:return a.fromBinary(c)}},l.valueToString=function(a){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===b.TYPES.bytes?a.toString("binary"):a.toString()},f.Element=k;var m=function(a,b,c,d,e,f){i.call(this,a,b,c,d,f),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!e,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var n=m.prototype=Object.create(i.prototype)}catch(a){var n=""}n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(b,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof b.Reflect.Enum){var h=b.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(a.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(b.Long.isLong(c))return f?c.toString():b.Long.fromValue(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof b.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(b.Reflect.Message.Field),f=c.getChildren(b.Reflect.Message.OneOf),g=function(d,h){b.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new b.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof b.Map||a.isByteBuffer(d)||d instanceof ArrayBuffer||b.Long&&d instanceof b.Long)for(i=0,j=arguments.length;i<j;++i)"undefined"!=typeof(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}};try{var h=g.prototype=Object.create(b.Builder.Message.prototype)}catch(a){var h=""}h.add=function(a,d,e){var f=c._fieldsByName[a];if(!e){if(!f)throw Error(this+"#"+a+" is undefined");if(!(f instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+a+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[a]&&(this[a]=[]),this[a].push(d),this},h.$add=h.add,h.set=function(a,d,e){if(a&&"object"==typeof a){e=d;for(var f in a)a.hasOwnProperty(f)&&"undefined"!=typeof(d=a[f])&&this.$set(f,d,e);return this}var g=c._fieldsByName[a];if(e)this[a]=d;else{if(!g)throw Error(this+"#"+a+" is not a field: undefined");if(!(g instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===a&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(a,d){if(d)return this[a];var e=c._fieldsByName[a];if(!(e&&e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: undefined");if(!(e instanceof b.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof b.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(b,d){"boolean"==typeof b&&(d=b,b=void 0);var e=!1;b||(b=new a,e=!0);var f=b.littleEndian;try{return c.encode(this,b.LE(),d),(e?b.flip():b).LE(f)}catch(a){throw b.LE(f),a}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(b,d){var e=!1;b||(b=new a,e=!0);var f=(new a).LE();return c.encode(this,f,d).flip(),b.writeVarint32(f.remaining()),b.append(f),e?b.flip():b},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(b,d,e){"string"==typeof d&&(e=d,d=-1),"string"==typeof b&&(b=a.wrap(b,e?e:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b);var f=b.littleEndian;try{var g=c.decode(b.LE());return b.LE(f),g}catch(a){throw b.LE(f),a}},g.decodeDelimited=function(b,d){if("string"==typeof b&&(b=a.wrap(b,d?d:"base64")),b=a.isByteBuffer(b)?b:a.wrap(b),b.remaining()<1)return null;var e=b.offset,f=b.readVarint32();if(b.remaining()<f)return b.offset=e,null;try{var g=c.decode(b.slice(b.offset,b.offset+f).LE());return b.offset+=f,g}catch(a){throw b.offset+=f,a}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(b,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if(e=this.children[f],e instanceof s||e instanceof m||e instanceof w){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof v))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(a,c,d){c="number"==typeof c?c:-1;for(var f,g,h,i,j=a.offset,k=new this.clazz;a.offset<j+c||c===-1&&a.remaining()>0;){if(f=a.readVarint32(),g=7&f,h=f>>>3,g===b.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,a));else if(i.map){var l=i.decode(g,a);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,a),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case b.WIRE_TYPES.VARINT:a.readVarint32();break;case b.WIRE_TYPES.BITS32:a.offset+=4;break;case b.WIRE_TYPES.BITS64:a.offset+=8;break;case b.WIRE_TYPES.LDELIM:var n=a.readVarint32();a.offset+=n;break;case b.WIRE_TYPES.STARTGROUP:for(;e(h,a););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}b.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(a,c,d,e,f,h,i,j,k,l){g.call(this,a,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=b.Util.toCamelCase(this.name))};try{var p=o.prototype=Object.create(g.prototype)}catch(a){var p=""}p.build=function(){this.element=new k(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new k(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(a,c){function d(a,b){throw Error("Illegal value for "+e.toString(!0)+" of type "+e.type.name+": "+a+" ("+b+")")}c=c||!1;var e=this;if(null===a)return this.required&&d(typeof a,"required"),"proto3"===this.syntax&&this.type!==b.TYPES.message&&d(typeof a,"proto3 field without field presence cannot be null"),null;var f;if(this.repeated&&!c){Array.isArray(a)||(a=[a]);var g=[];for(f=0;f<a.length;f++)g.push(this.element.verifyValue(a[f]));return g}return this.map&&!c?a instanceof b.Map?a:(a instanceof Object||d(typeof a,"expected ProtoBuf.Map or raw object for map field"),new b.Map(this,a)):(!this.repeated&&Array.isArray(a)&&d(typeof a,"no array expected"),this.element.verifyValue(a))},p.hasWirePresence=function(a,c){if("proto3"!==this.syntax)return null!==a;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case b.TYPES.int32:case b.TYPES.sint32:case b.TYPES.sfixed32:case b.TYPES.uint32:case b.TYPES.fixed32:return 0!==a;case b.TYPES.int64:case b.TYPES.sint64:case b.TYPES.sfixed64:case b.TYPES.uint64:case b.TYPES.fixed64:return 0!==a.low||0!==a.high;case b.TYPES.bool:return a;case b.TYPES.float:case b.TYPES.double:return 0!==a;case b.TYPES.string:return a.length>0;case b.TYPES.bytes:return a.remaining()>0;case b.TYPES.enum:return 0!==a;case b.TYPES.message:return null!==a;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=a.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+a+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=a.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=a.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+a.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=a.calculateVarint32(this.id<<3|b.WIRE_TYPES.LDELIM),e+=a.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=a.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+a+")")}return e},p.decode=function(a,c,d){var e,f,g=!this.map&&a==this.type.wireType||!d&&this.repeated&&this.options.packed&&a==b.WIRE_TYPES.LDELIM||this.map&&a==b.WIRE_TYPES.LDELIM;if(!g)throw Error("Illegal wire type for field "+this.toString(!0)+": "+a+" ("+this.type.wireType+" expected)");if(a==b.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&b.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var h=[];c.offset<f;)h.push(this.decode(this.type.wireType,c,!0));return h}if(this.map){var i=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var j=c.clone();for(j.limit=j.offset+f,c.offset+=f;j.remaining()>0;){var l=j.readVarint32();a=7&l;var m=l>>>3;if(1===m)i=this.keyElement.decode(j,a,m);else{if(2!==m)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(j,a,m)}}return[i,e]}return this.element.decode(c,a,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};try{q.prototype=Object.create(o.prototype)}catch(a){q.prototype=null}f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null};try{var t=s.prototype=Object.create(i.prototype)}catch(a){var t=s.prototype=null}t&&(t.build=function(a){if(this.object&&!a)return this.object;for(var c=new b.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c}),f.Enum=s;var u=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};try{u.prototype=Object.create(g.prototype)}catch(a){u.prototype=null}f.Enum.Value=u;var v=function(a,b,c,d){g.call(this,a,b,c),this.field=d};try{v.prototype=Object.create(g.prototype)}catch(a){v.prototype=null}f.Extension=v;var w=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null};try{var x=w.prototype=Object.create(i.prototype)}catch(a){var x=null}x&&(x.build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(b,c){for(var d=function(a){b.Builder.Service.call(this),this.rpcImpl=a||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(b.Builder.Service.prototype),f=c.getChildren(b.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(b){e[b.name]=function(d,e){try{try{d=b.resolvedRequestType.clazz.decode(a.wrap(d))}catch(a){if(!(a instanceof TypeError))throw a}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof b.resolvedRequestType.clazz||(d=new b.resolvedRequestType.clazz(d)),this.rpcImpl(b.fqn(),d,function(a,d){if(a)return void e(a);null===d&&(d="");try{d=b.resolvedResponseType.clazz.decode(d)}catch(a){}return d&&d instanceof b.resolvedResponseType.clazz?void e(null,d):void e(Error("Illegal response type received in service method "+c.name+"#"+b.name))})}catch(a){setTimeout(e.bind(this,a),0)}},d[b.name]=function(a,c,e){new d(a)[b.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[b.name],"$options",{value:b.buildOpt()}),Object.defineProperty(e[b.name],"$options",{value:d[b.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(b,this)}),f.Service=w;var y=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}};try{var z=y.prototype=Object.create(g.prototype)}catch(a){var z=null}z&&(z.buildOpt=j.buildOpt),f.Service.Method=y;var A=function(a,b,c,d,e,f,g,h){y.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};try{A.prototype=Object.create(y.prototype)}catch(a){A.prototype=null}return f.Service.RPCMethod=A,f}(c),c.Builder=function(a,b,c){function d(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,d(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var e=function(a){this.ns=new c.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},f=e.prototype;return e.isMessage=function(a){return"string"==typeof a.name&&("undefined"==typeof a.values&&"undefined"==typeof a.rpc)},e.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&"undefined"!=typeof a.id},e.isEnum=function(a){return"string"==typeof a.name&&!("undefined"==typeof a.values||!Array.isArray(a.values)||0===a.values.length)},e.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},e.isExtend=function(a){return"string"==typeof a.ref},f.reset=function(){return this.ptr=this.ns,this},f.define=function(a){if("string"!=typeof a||!b.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new c.Namespace(this,this.ptr,a)),this.ptr=b},this),this},f.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var d=[b];d.length>0;){if(b=d.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;b.length>0;){var f=b.shift();if(e.isMessage(f)){var g=new c.Message(this,this.ptr,f.name,f.options,f.isGroup,f.syntax),h={};f.oneofs&&Object.keys(f.oneofs).forEach(function(a){g.addChild(h[a]=new c.Message.OneOf(this,g,a))},this),f.fields&&f.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new c.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,f.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(f.enums&&f.enums.forEach(function(a){i.push(a)}),f.messages&&f.messages.forEach(function(a){i.push(a)}),f.services&&f.services.forEach(function(a){i.push(a)}),f.extensions&&("number"==typeof f.extensions[0]?g.extensions=[f.extensions]:g.extensions=f.extensions),this.ptr.addChild(g),i.length>0){d.push(b),b=i,i=null,this.ptr=g,g=null;continue}i=null}else if(e.isEnum(f))g=new c.Enum(this,this.ptr,f.name,f.options,f.syntax),f.values.forEach(function(a){g.addChild(new c.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(e.isService(f))g=new c.Service(this,this.ptr,f.name,f.options),Object.keys(f.rpc).forEach(function(a){var b=f.rpc[a];g.addChild(new c.Service.RPCMethod(this,g,a,b.request,b.response,!!b.request_stream,!!b.response_stream,b.options))},this),this.ptr.addChild(g);else{if(!e.isExtend(f))throw Error("not a valid definition: "+JSON.stringify(f));if(g=this.ptr.resolve(f.ref,!0))f.fields.forEach(function(b){if(null!==g.getChild(0|b.id))throw Error("duplicate extended field id in "+g.name+": "+b.id);if(g.extensions){var d=!1;if(g.extensions.forEach(function(a){b.id>=a[0]&&b.id<=a[1]&&(d=!0)}),!d)throw Error("illegal extended field id in "+g.name+": "+b.id+" (not within valid ranges)")}var e=b.name;this.options.convertFieldsToCamelCase&&(e=a.Util.toCamelCase(e));var f=new c.Message.ExtensionField(this,g,b.rule,b.type,this.ptr.fqn()+"."+e,b.id,b.options),h=new c.Extension(this,this.ptr,b.name,f);f.extension=h,this.ptr.addChild(h),g.addChild(f)},this);else if(!/\.?google\.protobuf\./.test(f.ref))throw Error("extended message "+f.ref+" is not defined")}f=null,g=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},f.import=function(b,c){var e="/";if("string"==typeof c){if(a.Util.IS_NODE&&(c=require("path").resolve(c)),this.files[c]===!0)return this.reset();this.files[c]=!0}else if("object"==typeof c){var f=c.root;a.Util.IS_NODE&&(f=require("path").resolve(f)),(f.indexOf("\\")>=0||c.file.indexOf("\\")>=0)&&(e="\\");var g=f+e+c.file;if(this.files[g]===!0)return this.reset();this.files[g]=!0}if(b.imports&&b.imports.length>0){var h,i=!1;"object"==typeof c?(this.importRoot=c.root,i=!0,h=this.importRoot,c=c.file,(h.indexOf("\\")>=0||c.indexOf("\\")>=0)&&(e="\\")):"string"==typeof c?this.importRoot?h=this.importRoot:c.indexOf("/")>=0?(h=c.replace(/\/[^\/]*$/,""),""===h&&(h="/")):c.indexOf("\\")>=0?(h=c.replace(/\\[^\\]*$/,""),e="\\"):h=".":h=null;for(var j=0;j<b.imports.length;j++)if("string"==typeof b.imports[j]){if(!h)throw Error("cannot determine import root");var k=b.imports[j];if("google/protobuf/descriptor.proto"===k)continue;if(k=h+e+k,this.files[k]===!0)continue;/\.proto$/i.test(k)&&!a.DotProto&&(k=k.replace(/\.proto$/,".json"));var l=a.Util.fetch(k);if(null===l)throw Error("failed to import '"+k+"' in '"+c+"': file not found");/\.json$/i.test(k)?this.import(JSON.parse(l+""),k):this.import(a.DotProto.Parser.parse(l),k)}else c?/\.(\w+)$/.test(c)?this.import(b.imports[j],c.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+j+"."+c})):this.import(b.imports[j],c+"_import"+j):this.import(b.imports[j]);i&&(this.importRoot=null)}b.package&&this.define(b.package),b.syntax&&d(b);var m=this.ptr;return b.options&&Object.keys(b.options).forEach(function(a){m.options[a]=b.options[a]}),b.messages&&(this.create(b.messages),this.ptr=m),b.enums&&(this.create(b.enums),this.ptr=m),b.services&&(this.create(b.services),this.ptr=m),b.extends&&this.create(b.extends),this.reset()},f.resolveAll=function(){var d;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof c.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof c.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=a.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(d=(this.ptr instanceof c.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!d)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=d,d instanceof c.Enum){if(this.ptr.type=a.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==d.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(d instanceof c.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);
this.ptr.type=d.isGroup?a.TYPES.group:a.TYPES.message}}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=a.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof a.Reflect.Service.Method){if(!(this.ptr instanceof a.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(d=this.ptr.parent.resolve(this.ptr.requestName,!0),!(d&&d instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=d,d=this.ptr.parent.resolve(this.ptr.responseName,!0),!(d&&d instanceof a.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=d}else if(!(this.ptr instanceof a.Reflect.Message.OneOf||this.ptr instanceof a.Reflect.Extension||this.ptr instanceof a.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},f.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},f.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},f.toString=function(){return"Builder"},e.Message=function(){},e.Enum=function(){},e.Service=function(){},e}(c,c.Lang,c.Reflect),c.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,!0,a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,!1,a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e.delete=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));return b in this.map},d}(c,c.Reflect),c.loadProto=function(a,b,d){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(d=b,b=void 0),c.loadJson(c.DotProto.Parser.parse(a),b,d)},c.protoFromString=c.loadProto,c.loadProtoFile=function(a,b,d){if(b&&"object"==typeof b?(d=b,b=null):b&&"function"==typeof b||(b=null),b)return c.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(e){if(null===e)return void b(Error("Failed to fetch file"));try{b(null,c.loadProto(e,d,a))}catch(a){b(a)}});var e=c.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===e?null:c.loadProto(e,d,a)},c.protoFromFile=c.loadProtoFile,c.newBuilder=function(a){return a=a||{},"undefined"==typeof a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=c.convertFieldsToCamelCase),"undefined"==typeof a.populateAccessors&&(a.populateAccessors=c.populateAccessors),new c.Builder(a)},c.loadJson=function(a,b,d){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(d=b,b=null),b&&"object"==typeof b||(b=c.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b.import(a,d),b.resolveAll(),b},c.loadJsonFile=function(a,b,d){if(b&&"object"==typeof b?(d=b,b=null):b&&"function"==typeof b||(b=null),b)return c.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(e){if(null===e)return void b(Error("Failed to fetch file"));try{b(null,c.loadJson(JSON.parse(e),d,a))}catch(a){b(a)}});var e=c.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===e?null:c.loadJson(JSON.parse(e),d,a)},c});var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,drawImage=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;window.performance=window.performance||{},window.performance.now=window.performance.now||function(){var a=Date.now();return function(){return Date.now()-a}}(),window.URL=window.URL||window.webkitURL;var WebRTCPlugin=WebRTCPlugin||{};if(WebRTCPlugin.pluginInfo={prefix:"object_",plugName:"avd-plugin",classId:"CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53",pluginId:"plugin0",type:"application/avd-plugin",portalLink:"http://3tee.cn/dl.htm",downloadLink:null,companyName:null},"undefined"!=typeof IEPluginDownloadLink?WebRTCPlugin.pluginInfo.downloadLink=IEPluginDownloadLink:navigator.platform.match(/^Mac/i)?WebRTCPlugin.pluginInfo.downloadLink="http://3tee.cn/download/avd-plugin-safari.exe":navigator.platform.match(/^Win/i)&&(WebRTCPlugin.pluginInfo.downloadLink="http://3tee.cn/download/avd-plugin-ie.exe"),"undefined"!=typeof pluginCompanyName?WebRTCPlugin.pluginInfo.companyName=pluginCompanyName:WebRTCPlugin.pluginInfo.companyName="3Tee",WebRTCPlugin.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"本产品要求您安装一个插件,使在这个浏览器中支持WebRTC功能。",NOT_SUPPORTED:"您的浏览器不支持WebRTC.",BUTTON:"现在安装"},REFRESH:{REQUIRE_REFRESH:"插件已安装，请刷新页面。",BUTTON:"刷新页面"}},WebRTCPlugin.PLUGIN_STATES={NONE:0,READY:4},WebRTCPlugin.isPluginInstalled=null,WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.NONE,WebRTCPlugin.callWhenPluginReady=function(a,b){if("complete"===document.readyState&&WebRTCPlugin.pluginState===WebRTCPlugin.PLUGIN_STATES.READY)a();else{console.log("readyState = "+document.readyState+", delaying "+b+"...");var c=setInterval(function(){"complete"===document.readyState&&WebRTCPlugin.pluginState===WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(c),a())},100)}},WebRTCPlugin.renderNotificationBar=function(a,b,c,d,e){var f="pluginNotificationBar",g=document.getElementById(f);if(g)return!1;var h=window,i=document.createElement("iframe");i.id="pluginNotificationBar",i.name="pluginNotificationBar",i.style.position="fixed",i.style.top="-41px",i.style.left=0,i.style.right=0,i.style.width="100%",i.style.height="40px",i.style.backgroundColor="#ffffe1",i.style.border="none",i.style.borderBottom="1px solid #888888",i.style.zIndex="9999999","string"==typeof i.style.webkitTransition?i.style.webkitTransition="all .5s ease-out":"string"==typeof i.style.transition&&(i.style.transition="all .5s ease-out"),document.body.appendChild(i);var j=i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument;if(j.document.open(),j.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+a+"</span>"),b&&c){j.document.write('<button id="okay">'+b+'</button><button id="cancel">取消</button>'),j.document.close();var k;attachEventListener(j.document.getElementById("okay"),"click",function(a){window.open(c,d?"_blank":"_top"),a.preventDefault();try{a.cancelBubble=!0}catch(a){}k=setInterval(function(){WebRTCPlugin.pluginState==WebRTCPlugin.PLUGIN_STATES.NONE&&installPlugin(),WebRTCPlugin.pluginState==WebRTCPlugin.PLUGIN_STATES.READY&&(i.parentNode.removeChild(i),clearInterval(k))},5e3)}),attachEventListener(j.document.getElementById("cancel"),"click",function(a){k&&clearInterval(k),h.document.body.removeChild(i)})}else j.document.close();setTimeout(function(){"string"==typeof i.style.webkitTransform?i.style.webkitTransform="translateY(40px)":"string"==typeof i.style.transform?i.style.transform="translateY(40px)":i.style.top="0px"},300)},drawImage=function(a,b,c,d,e,f){a.drawImage(b,c,d,e,f)},attachEventListener=function(a,b,c,d){a.addEventListener(b,c,d)},navigator.mozGetUserMedia){console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);var RTCPeerConnection=function(a,b){return maybeFixConfiguration(a),new mozRTCPeerConnection(a,b)};RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn"))if(webrtcDetectedVersion<27){var f=a.split("?");1!==f.length&&0!==f[1].indexOf("transport=udp")||(d={url:f[0],credential:c,username:b})}else d={url:a,credential:c,username:b};return d},createIceServers=function(a,b,c){var d=[];for(i=0;i<a.length;i++){var e=createIceServer(a[i],b,c);null!==e&&d.push(e)}return d},attachMediaStream=function(a,b){return a.srcObject=b,a},reattachMediaStream=function(a,b){console.log("Reattaching media stream"),a.mozSrcObject=b.mozSrcObject,a.play()}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedVersion=null!==result?parseInt(result[2],10):999,createIceServer=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},createIceServers=function(a,b,c){var d=[];if(webrtcDetectedVersion>=34)d={urls:a,credential:c,username:b};else for(i=0;i<a.length;i++){var e=createIceServer(a[i],b,c);null!==e&&d.push(e)}return d};var RTCPeerConnection=function(a,b){return webrtcDetectedVersion<34&&maybeFixConfiguration(a),new webkitRTCPeerConnection(a,b)};getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(a,b){return"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?b?a.src=URL.createObjectURL(b):a.src&&"undefined"!=typeof URL.revokeObjectURL&&(URL.revokeObjectURL(a.src),a.src=""):console.log("Error attaching stream to element."),a},reattachMediaStream=function(a,b){a.src=b.src}}else{var console=console||{log:function(a){}},createIceServer=function(a,b,c){var d=a.split(":");return 0===d[0].indexOf("stun")?{url:a}:0===d[0].indexOf("turn")?{url:a,credential:c,username:b}:null},extractPluginObj=function(a){return a.isWebRtcPlugin?a:a.pluginObj},attachEventListener=function(a,b,c,d){var e=extractPluginObj(a);e?e.bindEventListener(b,c,d):"undefined"!=typeof a.addEventListener?a.addEventListener(b,c,d):"undefined"!=typeof a.addEvent&&a.addEventListener("on"+b,c,d)},installPlugin=function(){if(!document.getElementById(WebRTCPlugin.pluginInfo.pluginId)){console.log("installPlugin() called");var a=!!(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window),b=!!navigator.userAgent.indexOf("Safari"),c=document.createElement("object");if(a?(c.setAttribute("classid",WebRTCPlugin.pluginInfo.classId),a=!0):c.setAttribute("type",WebRTCPlugin.pluginInfo.type),c.setAttribute("id",WebRTCPlugin.pluginInfo.pluginId),document.body.appendChild(c),c.setAttribute("width","0"),c.setAttribute("height","0"),c.isWebRtcPlugin||"undefined"!=typeof navigator.plugins&&(navigator.plugins["avd-plugin"]||navigator.plugins["avd-plugin for Safari"]))console.log("Plugin version: "+c.versionName),WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.READY,a?(console.log("This appears to be Internet Explorer"),webrtcDetectedBrowser="Internet Explorer"):b&&(console.log("This appears to be Safari"),webrtcDetectedBrowser="Safari");else{console.log("Browser does not appear to be WebRTC-capable"),WebRTCPlugin.pluginState=WebRTCPlugin.PLUGIN_STATES.NONE;var d=document.getElementById(WebRTCPlugin.pluginInfo.pluginId);d.parentNode.removeChild(d),pluginNeededButNotInstalled()}console.log("end of installPlugin()")}};pluginNeededButNotInstalled=function(){console.log("plugin Needed But Not Installed");var a=WebRTCPlugin.pluginInfo.downloadLink;if(a){var b;b=WebRTCPlugin.pluginInfo.portalLink?'本产品要求您安装一个插件 <a href="'+WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a> ,使在这个浏览器中支持WebRTC功能。":WebRTCPlugin.TEXT.PLUGIN.REQUIRE_INSTALLATION,WebRTCPlugin.renderNotificationBar(b,WebRTCPlugin.TEXT.PLUGIN.BUTTON,a)}else WebRTCPlugin.renderNotificationBar(WebRTCPlugin.TEXT.PLUGIN.NOT_SUPPORTED)},document.body?installPlugin():(attachEventListener(window,"load",function(){console.log("onload"),installPlugin()}),attachEventListener(document,"readystatechange",function(){console.log("onreadystatechange:"+document.readyState),"complete"==document.readyState&&installPlugin()})),getUserMedia=navigator.getUserMedia=function(a,b,c){WebRTCPlugin.callWhenPluginReady(function(){getPlugin().getUserMedia(a,b,c)},"getUserMedia")},attachMediaStream=function(a,b){if(console.log("Attaching media stream"),!a)return null;if(a.isWebRtcPlugin)return a.src=b,a;if("video"===a.nodeName.toLowerCase()){if(!a.pluginObj&&b){var c=document.createElement("object"),d=Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window;if(d){var e=document.createElement("param");e.setAttribute("name","windowless"),e.setAttribute("value",!0),c.appendChild(e),c.setAttribute("classid",WebRTCPlugin.pluginInfo.classId)}else c.setAttribute("type",WebRTCPlugin.pluginInfo.type);a.pluginObj=c,c.setAttribute("id",WebRTCPlugin.pluginInfo.prefix+a.id);var f=a.getAttribute("width"),g=a.getAttribute("height"),h=a.getBoundingClientRect();if(f||(f=h.right-h.left),g||(g=h.bottom-h.top),"getComputedStyle"in window){var i=window.getComputedStyle(a,null);f||"auto"==i.width||"0px"==i.width||(f=i.width),g||"auto"==i.height||"0px"==i.height||(g=i.height)}f?c.setAttribute("width",f):c.setAttribute("autowidth",!0),g?c.setAttribute("height",g):c.setAttribute("autoheight",!0),document.body.appendChild(c),a.parentNode&&(a.parentNode.replaceChild(c,a),document.body.appendChild(a),a.style.visibility="hidden")}else!a.pluginObj||null!=b&&""!=b||(a.style.visibility="",a.pluginObj.parentNode.replaceChild(a,a.pluginObj),a.pluginObj=null);return a.pluginObj&&(a.pluginObj.bindEventListener("play",function(b){a.pluginObj&&(a.pluginObj.getAttribute("autowidth")&&b.videoWidth&&a.pluginObj.setAttribute("width",b.videoWidth),a.pluginObj.getAttribute("autoheight")&&b.videoHeight&&a.pluginObj.setAttribute("height",b.videoHeight))}),a.pluginObj.src=b),a.pluginObj}return"audio"===a.nodeName.toLowerCase()?a:void 0},drawImage=function(a,b,c,d,e,f){var g=extractPluginObj(b);if(g&&g.isWebRtcPlugin&&g.videoWidth>0&&g.videoHeight>0)if("undefined"!=typeof g.getScreenShot){var h=g.getScreenShot();if(h){var i=new Image;i.onload=function(){a.drawImage(i,0,0,e,f)},i.src="data:image/png;base64,"+h}}else{var j=a.createImageData(g.videoWidth,g.videoHeight);j&&(g.fillImageData(j),a.putImageData(j,c,d))}},MediaStreamTrack={},MediaStreamTrack.getSources=function(a){WebRTCPlugin.callWhenPluginReady(function(){getPlugin().getSources(a)},"getSources")},RTCPeerConnection=function(a,b){var c=getPlugin().createPeerConnection(a,b),d=this;c.onIceCandidate=function(a){d.onicecandidate(a)},c.onaddstream=function(a){d.onaddstream(a)},c.onremovestream=function(a){d.onremovestream(a)},c.ondatachannel=function(a){d.ondatachannel(a)},c.oniceconnectionstatechange=function(){var a=c.iceConnectionState;d.iceConnectionState=a;var b={},e={};b.target=e,b.target.iceConnectionState=a,d.oniceconnectionstatechange(b)},c.onsignalingstatechange=function(){var a=c.signalingState;d.signalingState=a,d.remoteDescription=c.remoteDescription;var b={},e={};b.target=e,b.target.signalingState=a,d.onsignalingstatechange(b)},d.addStream=function(a){c.addStream(a)},d.removeStream=function(a){c.removeStream(a)},d.createOffer=function(a,b,d){var e={optional:[],mandatory:{}};d=mergeConstraints(e,d),c.createOffer(a,b,d)},d.createAnswer=function(a,b,d){var e={optional:[],mandatory:{}};d=mergeConstraints(e,d),c.createAnswer(a,b,d)},d.setLocalDescription=function(a,b,d){c.setLocalDescription(a,b,d)},d.setRemoteDescription=function(a,b,d){c.setRemoteDescription(a,b,d)},d.addIceCandidate=function(a,b,d){c.addIceCandidate(a,b,d)},d.close=function(){c.close()},d.onsignalingstatechange=function(a){return a},d.getStats=function(a,b){c.getStats(a,b)}},RTCIceCandidate=function(a){return getPlugin().createIceCandidate(a)},RTCSessionDescription=function(a){return getPlugin().createSessionDescription(a)}}SdpSerializer.SerializeASBandwidth=function(a,b){return b=b||{},a=a.replace(/b=AS([^\r\n]+\r\n)/g,""),a=a.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(b.audio||50)+"\r\n"),a=a.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(b.video||256)+"\r\n"),a=a.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(b.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(a,b){return b=b||{},a=a.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+(b.minptime||10)),a=a.replace("a=maxptime:60","a=maxptime:"+(b.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(a,b){return a=a.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(b||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(a){return a.replace(/a=candidate:.*udp.*\r\n/g,"")},!function(a,b){"use strict";a(function(){function a(a,b,c,e){return d(a).then(b,c,e)}function c(a,b){this.then=a,this.inspect=b}function d(a){return g(function(b){b(a)})}function e(b){return a(b,j)}function f(){function a(a,f,g){b.resolve=b.resolver.resolve=function(b){return e?d(b):(e=!0,a(b),c)},b.reject=b.resolver.reject=function(a){return e?d(j(a)):(e=!0,f(a),c)},b.notify=b.resolver.notify=function(a){return g(a),a}}var b,c,e;return b={promise:L,resolve:L,reject:L,notify:L,resolver:{resolve:L,reject:L,notify:L}},b.promise=c=g(a),b}function g(a){function b(a,b,c){return g(function(d,e,f){n?n.push(function(g){g.then(a,b,c).then(d,e,f)}):y(function(){m.then(a,b,c).then(d,e,f)})})}function d(){return m?m.inspect():x()}function e(a){n&&(m=h(a),l(n,m),n=L)}function f(a){e(j(a))}function i(a){n&&l(n,k(a))}var m,n=[];try{a(e,f,i)}catch(a){f(a)}return new c(b,d)}function h(a){return a instanceof c?a:a===Object(a)&&"then"in a?g(function(b,c,d){y(function(){try{var e=a.then;"function"==typeof e?E(e,a,b,c,d):b(i(a))}catch(a){c(a)}})}):i(a)}function i(a){var b=new c(function(c){try{return"function"==typeof c?h(c(a)):b}catch(a){return j(a)}},function(){return v(a)});return b}function j(a){var b=new c(function(c,d){try{return"function"==typeof d?h(d(a)):b}catch(a){return j(a)}},function(){return w(a)});return b}function k(a){var b=new c(function(c,d,e){try{return"function"==typeof e?k(e(a)):b}catch(a){return k(a)}});return b}function l(a,b){y(function(){for(var c,d=0;c=a[d++];)c(b)})}function m(a){return a&&"function"==typeof a.then}function n(b,c,d,e,f){return a(b,function(b){function h(d,e,f){function g(a){n(a)}function h(a){m(a)}var i,j,k,l,m,n,o,p;if(o=b.length>>>0,i=Math.max(0,Math.min(c,o)),k=[],j=o-i+1,l=[],i)for(n=function(a){l.push(a),--j||(m=n=B,e(l))},m=function(a){k.push(a),--i||(m=n=B,d(k))},p=0;o>p;++p)p in b&&a(b[p],h,g,f);else d(k)}return g(h).then(d,e,f)})}function o(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return n(a,1,e,c,d)}function p(a,b,c,d){return t(a,B).then(b,c,d)}function q(){return t(arguments,B)}function r(a){return t(a,v,w)}function s(a,b){return t(a,b)}function t(b,c,d){return a(b,function(b){function e(e,f,g){var h,i,j,k,l;if(j=i=b.length>>>0,h=[],!j)return void e(h);for(k=function(b,i){a(b,c,d).then(function(a){h[i]=a,--j||e(h)},f,g)},l=0;i>l;l++)l in b?k(b[l],l):--j}return g(e)})}function u(b,c){var d=E(D,arguments,1);return a(b,function(b){var e;return e=b.length,d[0]=function(b,d,f){return a(b,function(b){return a(d,function(a){return c(b,a,f,e)})})},C.apply(b,d)})}function v(a){return{state:"fulfilled",value:a}}function w(a){return{state:"rejected",reason:a}}function x(){return{state:"pending"}}function y(a){1===G.push(a)&&z()}function z(){F(A)}function A(){for(var a,b=0;a=G[b++];)a();G=[]}function B(a){return a}a.defer=f,a.resolve=d,a.reject=e,a.join=q,a.all=p,a.map=s,a.reduce=u,a.settle=r,a.any=o,a.some=n,a.isPromise=m,a.promise=g,c.prototype={otherwise:function(a){return this.then(L,a)},ensure:function(a){function b(){return d(a())}return this.then(b,b).yield2(this)},yield2:function(a){return this.then(function(){return a})},spread:function(a){return this.then(function(b){return p(b,function(b){return a.apply(L,b)})})},always:function(a,b){return this.then(a,a,b)}};var C,D,E,F,G,H,I,J,K,L;return G=[],H=b.setTimeout,F="function"==typeof setImmediate?setImmediate.bind(b):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(a){H(a,0)},I=Function.prototype,J=I.call,E=I.bind?J.bind(J):function(a,b){return a.apply(b,D.call(arguments,2))},K=[],D=K.slice,C=K.reduce||function(a){var b,c,d,e,f;if(f=0,b=Object(this),e=b.length>>>0,c=arguments,c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;e>f;++f)f in b&&(d=a(d,b[f],f,b));return d},a})}("function"==typeof define&&define.amd?define:function(a){window.when=a()},this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(a){if(!isNumber(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},EventEmitter.prototype.emit=function(a){var b,c,d,e,f,g;if(this._events||(this._events={}),"error"===a&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],isUndefined(c))return!1;if(isFunction(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,e=new Array(d-1),f=1;f<d;f++)e[f-1]=arguments[f];c.apply(this,e)}else if(isObject(c)){for(d=arguments.length,e=new Array(d-1),f=1;f<d;f++)e[f-1]=arguments[f];for(g=c.slice(),d=g.length,f=0;f<d;f++)g[f].apply(this,e)}return!0},EventEmitter.prototype.addListener=function(a,b){var c;if(!isFunction(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,isFunction(b.listener)?b.listener:b),this._events[a]?isObject(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,isObject(this._events[a])&&!this._events[a].warned){var c;c=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!isFunction(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},EventEmitter.prototype.removeListener=function(a,b){var c,d,e,f;if(!isFunction(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],e=c.length,d=-1,c===b||isFunction(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(isObject(c)){for(f=e;f-- >0;)if(c[f]===b||c[f].listener&&c[f].listener===b){d=f;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},EventEmitter.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],isFunction(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},EventEmitter.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},EventEmitter.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?isFunction(a._events[b])?1:a._events[b].length:0};var define,require,esl;!function(a){function b(a,b){function d(a){0===a.indexOf(".")&&e.push(a)}var e=[];if("string"==typeof a?d(a):G(a,function(a){d(a)}),e.length>0)throw new Error("[REQUIRE_FATAL]Relative ID is not allowed in global require: "+e.join(", "));var f=R.waitSeconds;return f&&a instanceof Array&&(I&&clearTimeout(I),I=setTimeout(c,1e3*f)),Q(a,b)}function c(){function a(g,h){if(!f[g]&&!l(g,O)){f[g]=1,l(g,N)||d[g]||(d[g]=1,b.push(g));var i=J[g];i?h&&(d[g]||(d[g]=1,b.push(g)),G(i.depMs,function(b){a(b.absId,b.hard)})):e[g]||(e[g]=1,c.push(g))}}var b=[],c=[],d={},e={},f={};for(var g in K)a(g,1);if(b.length||c.length)throw new Error("[MODULE_TIMEOUT]Hang( "+(b.join(", ")||"none")+" ) Miss( "+(c.join(", ")||"none")+" )")}function d(a){G(S,function(b){g(a,b.deps,b.factory)}),S.length=0,h(a)}function e(a,b,c){if(null==c&&(null==b?(c=a,a=null):(c=b,b=null,a instanceof Array&&(b=a,a=null))),null!=c){var d=window.opera;if(!a&&document.attachEvent&&(!d||"[object Opera]"!==d.toString())){var e=D();a=e&&e.getAttribute("data-require-id")}a?g(a,b,c):S[0]={deps:b,factory:c}}}function f(){var a=R.config[this.id];return a&&"object"==typeof a?a:{}}function g(a,b,c){J[a]||(J[a]={id:a,depsDec:b,deps:b||["require","exports","module"],factoryDeps:[],factory:c,exports:{},config:f,state:L,require:y(a),depMs:[],depMkv:{},depRs:[],depPMs:[]})}function h(a){var b=J[a];if(b&&!l(a,M)){var c=b.deps,d=b.factory,e=0;"function"==typeof d&&(e=Math.min(d.length,c.length),!b.depsDec&&d.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,"").replace(/require\(\s*(['"'])([^'"]+)\1\s*\)/g,function(a,b,d){c.push(d)}));var f=[];G(c,function(c,d){var g,h,i=B(c),j=z(i.mod,a);j&&!P[j]?(i.res&&(h={id:c,mod:j,res:i.res},K[j]=1,b.depPMs.push(j),b.depRs.push(h)),g=b.depMkv[j],g||(g={id:i.mod,absId:j,hard:e>d},b.depMs.push(g),b.depMkv[j]=g,f.push(j))):g={absId:j},e>d&&b.factoryDeps.push(h||g)}),b.state=M,k(a),r(f)}}function i(){for(var a in K)j(a),m(a)}function j(a){function b(a){if(!l(a,M))return!1;if(l(a,N)||c[a])return!0;c[a]=1;var d=J[a],e=!0;return G(d.depMs,function(a){return e=b(a.absId)}),e&&G(d.depRs,function(a){return e=!(!a.absId||!l(a.absId,O))}),e&&(d.state=N),e}var c={};b(a)}function k(b){function c(){if(!d&&e.state===N){d=1;var c=1,f=[];if(G(e.factoryDeps,function(a){var b=a.absId;return P[b]||(m(b),l(b,O))?void f.push(b):(c=0,!1)}),c){try{var g=n(f,{require:e.require,exports:e.exports,module:e}),h=e.factory,i="function"==typeof h?h.apply(a,g):h;null!=i&&(e.exports=i),e.invokeFactory=null,delete K[b]}catch(a){if(d=0,/^\[MODULE_MISS\]"([^"]+)/.test(a.message)){var j=e.depMkv[RegExp.$1];return void(j&&(j.hard=1))}throw a}p(b)}}}var d,e=J[b];e.invokeFactory=c,G(e.depPMs,function(a){o(a,function(){G(e.depRs,function(c){c.absId||c.mod!==a||(c.absId=z(c.id,b),r([c.absId],i))})})})}function l(a,b){return J[a]&&J[a].state>=b}function m(a){var b=J[a];b&&b.invokeFactory&&b.invokeFactory()}function n(a,b){var c=[];return G(a,function(a,d){c[d]=b[a]||q(a)}),c}function o(a,b){if(l(a,O))return void b();var c=T[a];c||(c=T[a]=[]),c.push(b)}function p(a){var b=T[a]||[],c=J[a];c.state=O;for(var d=b.length;d--;)b[d]();b.length=0,delete T[a]}function q(a){return l(a,O)?J[a].exports:null}function r(b,c,d,e){function f(){if(!g){var d=1;G(b,function(a){return P[a]?void 0:d=!!l(a,O)}),d&&(g=1,"function"==typeof c&&c.apply(a,n(b,P)))}}if("string"==typeof b){if(m(b),!l(b,O))throw new Error('[MODULE_MISS]"'+b+'" is not exists!');return q(b)}e=e||{};var g=0;b instanceof Array&&(f(),g||(G(b,function(a){P[a]||l(a,O)||(o(a,f),e[a]||(a.indexOf("!")>0?t:s)(a,d),h(a))}),i()))}function s(a){function b(){var b=c.readyState;if("undefined"==typeof b||/^(loaded|complete)$/.test(b)){c.onload=c.onreadystatechange=null,c=null,d(a);for(var e in K)h(e);i()}}if(!U[a]&&!J[a]){U[a]=1;var c=document.createElement("script");c.setAttribute("data-require-id",a),c.src=x(a+".js"),c.async=!0,c.readyState?c.onreadystatechange=b:c.onload=b,E(c)}}function t(a,b){function c(b){h.exports=b||!0,p(a)}function e(d){var e=b?J[b].require:Q;d.load(g.res,e,c,f.call({id:a}))}if(!J[a]){var g=B(a),h={id:a,state:M};J[a]=h,c.fromText=function(a,b){K[a]=1,new Function(b)(),d(a)},e(q(g.mod))}}function u(a,b){var c=C(a,1,b);return c.sort(H),c}function v(){R.baseUrl=R.baseUrl.replace(/\/$/,"")+"/",V=u(R.paths),X=u(R.map,1),G(X,function(a){a.v=u(a.v)}),W=[],G(R.packages,function(a){var b=a;"string"==typeof a&&(b={name:a.split("/")[0],location:a,main:"main"}),b.location=b.location||b.name,b.main=(b.main||"main").replace(/\.js$/i,""),b.reg=F(b.name),W.push(b)}),W.sort(H),Y=u(R.urlArgs,1),Z=u(R.noRequests),G(Z,function(a){var b=a.v,c={};a.v=c,b instanceof Array||(b=[b]),G(b,function(a){c[a]=1})})}function w(a,b,c){G(b,function(b){return b.reg.test(a)?(c(b.v,b.k,b),!1):void 0})}function x(a){var b=/(\.[a-z0-9]+)$/i,c=/(\?[^#]*)$/,d="",e=a,f="";c.test(a)&&(f=RegExp.$1,a=a.replace(c,"")),b.test(a)&&(d=RegExp.$1,e=a.replace(b,""));var g,h=e;return w(e,V,function(a,b){h=h.replace(b,a),g=1}),g||w(e,W,function(a,b,c){h=h.replace(c.name,c.location)}),/^([a-z]{2,10}:\/)?\//i.test(h)||(h=R.baseUrl+h),h+=d+f,w(e,Y,function(a){h+=(h.indexOf("?")>0?"&":"?")+a}),h}function y(a){function b(b,d){if("string"==typeof b)return c[b]||(c[b]=r(z(b,a))),c[b];if(b instanceof Array){var e=[],f=[],g=[];G(b,function(b,c){var d=B(b),h=z(d.mod,a);f.push(h),K[h]=1,d.res?(e.push(h),g[c]=null):g[c]=h});var h={};G(f,function(a){var b;w(a,Z,function(a){b=a}),b&&(b["*"]?h[a]=1:G(f,function(c){return b[c]?(h[a]=1,!1):void 0}))}),r(f,function(){G(g,function(c,d){null==c&&(g[d]=z(b[d],a))}),r(g,d,a)},a,h)}}var c={};return b.toUrl=function(b){return x(z(b,a))},b}function z(a,b){if(!a)return"";b=b||"";var c=B(a);if(!c)return a;var d=c.res,e=A(c.mod,b);if(G(W,function(a){var b=a.name;return b===e?(e=b+"/"+a.main,!1):void 0}),w(b,X,function(a){w(e,a,function(a,b){e=e.replace(b,a)})}),d){var f=q(e);d=f.normalize?f.normalize(d,function(a){return z(a,b)}):z(d,b),e+="!"+d}return e}function A(a,b){if(0===a.indexOf(".")){var c=b.split("/"),d=a.split("/"),e=c.length-1,f=d.length,g=0,h=0;a:for(var i=0;f>i;i++)switch(d[i]){case"..":if(!(e>g))break a;g++,h++;break;case".":h++;break;default:break a}return c.length=e-g,d=d.slice(h),c.concat(d).join("/")}return a}function B(a){var b=a.split("!");return b[0]?{mod:b[0],res:b[1]}:null}function C(a,b,c){var d=[];for(var e in a)if(a.hasOwnProperty(e)){var f={k:e,v:a[e]};d.push(f),b&&(f.reg="*"===e&&c?/^/:F(e))}return d}function D(){if($)return $;if(_&&"interactive"===_.readyState)return _;for(var a=document.getElementsByTagName("script"),b=a.length;b--;){
var c=a[b];if("interactive"===c.readyState)return _=c,c}}function E(a){$=a,ba?aa.insertBefore(a,ba):aa.appendChild(a),$=null}function F(a){return new RegExp("^"+a+"(/|$)")}function G(a,b){if(a instanceof Array)for(var c=0,d=a.length;d>c&&b(a[c],c)!==!1;c++);}function H(a,b){var c=a.k||a.name,d=b.k||b.name;return"*"===d?-1:"*"===c?1:d.length-c.length}var I,J={},K={},L=1,M=2,N=3,O=4,P={require:b,exports:1,module:1},Q=y(),R={baseUrl:"./",paths:{},config:{},map:{},packages:[],waitSeconds:0,noRequests:{},urlArgs:{}};b.version="1.8.8",b.loader="esl",b.toUrl=Q.toUrl;var S=[];e.amd={};var T={},U={};b.config=function(a){if(a){for(var b in R){var c=a[b],d=R[b];if(c)if("urlArgs"===b&&"string"==typeof c)R.urlArgs["*"]=c;else if(d instanceof Array)d.push.apply(d,c);else if("object"==typeof d)for(var e in c)d[e]=c[e];else R[b]=c}v()}},v();var V,W,X,Y,Z,$,_,aa=document.getElementsByTagName("head")[0],ba=document.getElementsByTagName("base")[0];ba&&(aa=ba.parentNode),define||(define=e,require||(require=b),esl=b)}(this),define("zrender/core/guid",[],function(){var a=2311;return function(){return a++}}),define("zrender/core/env",[],function(){function a(a){var b={},c={},d=a.match(/Firefox\/([\d.]+)/),e=a.match(/MSIE\s([\d.]+)/)||a.match(/Trident\/.+?rv:(([\d.]+))/),f=a.match(/Edge\/([\d.]+)/),g=/micromessenger/i.test(a);return d&&(c.firefox=!0,c.version=d[1]),e&&(c.ie=!0,c.version=e[1]),f&&(c.edge=!0,c.version=f[1]),g&&(c.weChat=!0),{browser:c,os:b,node:!1,canvasSupported:!!document.createElement("canvas").getContext,touchEventsSupported:"ontouchstart"in window&&!c.ie&&!c.edge,pointerEventsSupported:"onpointerdown"in window&&(c.edge||c.ie&&c.version>=11)}}var b={};return b="undefined"==typeof navigator?{browser:{},os:{},node:!0,canvasSupported:!0}:a(navigator.userAgent)}),define("zrender/core/util",["require"],function(a){function b(a){if(null==a||"object"!=typeof a)return a;var c=a,d=G.call(a);if("[object Array]"===d){c=[];for(var e=0,f=a.length;e<f;e++)c[e]=b(a[e])}else if(F[d])c=a.constructor.from(a);else if(!E[d]&&!y(a)){c={};for(var g in a)a.hasOwnProperty(g)&&(c[g]=b(a[g]))}return c}function c(a,d,e){if(!w(d)||!w(a))return e?b(d):a;for(var f in d)if(d.hasOwnProperty(f)){var g=a[f],h=d[f];!w(h)||!w(g)||t(h)||t(g)||y(h)||y(g)||x(h)||x(g)?!e&&f in a||(a[f]=b(d[f],!0)):c(g,h,e)}return a}function d(a,b){for(var d=a[0],e=1,f=a.length;e<f;e++)d=c(d,a[e],b);return d}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function f(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(c?null!=b[d]:null==a[d])&&(a[d]=b[d]);return a}function g(){return document.createElement("canvas")}function h(){return D||(D=N.createCanvas().getContext("2d")),D}function i(a,b){if(a){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c}return-1}function j(a,b){function c(){}var d=a.prototype;c.prototype=b.prototype,a.prototype=new c;for(var e in d)a.prototype[e]=d[e];a.prototype.constructor=a,a.superClass=b}function k(a,b,c){a="prototype"in a?a.prototype:a,b="prototype"in b?b.prototype:b,f(a,b,c)}function l(a){if(a)return"string"!=typeof a&&"number"==typeof a.length}function m(a,b,c){if(a&&b)if(a.forEach&&a.forEach===I)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,e=a.length;d<e;d++)b.call(c,a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)}function n(a,b,c){if(a&&b){if(a.map&&a.map===L)return a.map(b,c);for(var d=[],e=0,f=a.length;e<f;e++)d.push(b.call(c,a[e],e,a));return d}}function o(a,b,c,d){if(a&&b){if(a.reduce&&a.reduce===M)return a.reduce(b,c,d);for(var e=0,f=a.length;e<f;e++)c=b.call(d,c,a[e],e,a);return c}}function p(a,b,c){if(a&&b){if(a.filter&&a.filter===J)return a.filter(b,c);for(var d=[],e=0,f=a.length;e<f;e++)b.call(c,a[e],e,a)&&d.push(a[e]);return d}}function q(a,b,c){if(a&&b)for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d,a))return a[d]}function r(a,b){var c=K.call(arguments,2);return function(){return a.apply(b,c.concat(K.call(arguments)))}}function s(a){var b=K.call(arguments,1);return function(){return a.apply(this,b.concat(K.call(arguments)))}}function t(a){return"[object Array]"===G.call(a)}function u(a){return"function"==typeof a}function v(a){return"[object String]"===G.call(a)}function w(a){var b=typeof a;return"function"===b||!!a&&"object"==b}function x(a){return!!E[G.call(a)]}function y(a){return"object"==typeof a&&"number"==typeof a.nodeType&&"object"==typeof a.ownerDocument}function z(a){return a!==a}function A(a){for(var b=0,c=arguments.length;b<c;b++)if(null!=arguments[b])return arguments[b]}function B(){return Function.call.apply(K,arguments)}function C(a,b){if(!a)throw new Error(b)}var D,E={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},F={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},G=Object.prototype.toString,H=Array.prototype,I=H.forEach,J=H.filter,K=H.slice,L=H.map,M=H.reduce,N={inherits:j,mixin:k,clone:b,merge:c,mergeAll:d,extend:e,defaults:f,getContext:h,createCanvas:g,indexOf:i,slice:B,find:q,isArrayLike:l,each:m,map:n,reduce:o,filter:p,bind:r,curry:s,isArray:t,isString:v,isObject:w,isFunction:u,isBuildInObject:x,isDom:y,eqNaN:z,retrieve:A,assert:C,noop:function(){}};return N}),define("zrender/mixin/Draggable",["require"],function(a){function b(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}return b.prototype={constructor:b,_dragStart:function(a){var b=a.target;b&&b.draggable&&(this._draggingTarget=b,b.dragging=!0,this._x=a.offsetX,this._y=a.offsetY,this.dispatchToElement(b,"dragstart",a.event))},_drag:function(a){var b=this._draggingTarget;if(b){var c=a.offsetX,d=a.offsetY,e=c-this._x,f=d-this._y;this._x=c,this._y=d,b.drift(e,f,a),this.dispatchToElement(b,"drag",a.event);var g=this.findHover(c,d,b),h=this._dropTarget;this._dropTarget=g,b!==g&&(h&&g!==h&&this.dispatchToElement(h,"dragleave",a.event),g&&g!==h&&this.dispatchToElement(g,"dragenter",a.event))}},_dragEnd:function(a){var b=this._draggingTarget;b&&(b.dragging=!1),this.dispatchToElement(b,"dragend",a.event),this._dropTarget&&this.dispatchToElement(this._dropTarget,"drop",a.event),this._draggingTarget=null,this._dropTarget=null}},b}),define("zrender/mixin/Eventful",["require"],function(a){var b=Array.prototype.slice,c=function(){this._$handlers={}};return c.prototype={constructor:c,one:function(a,b,c){var d=this._$handlers;if(!b||!a)return this;d[a]||(d[a]=[]);for(var e=0;e<d[a].length;e++)if(d[a][e].h===b)return this;return d[a].push({h:b,one:!0,ctx:c||this}),this},on:function(a,b,c){var d=this._$handlers;if(!b||!a)return this;d[a]||(d[a]=[]);for(var e=0;e<d[a].length;e++)if(d[a][e].h===b)return this;return d[a].push({h:b,one:!1,ctx:c||this}),this},isSilent:function(a){var b=this._$handlers;return b[a]&&b[a].length},off:function(a,b){var c=this._$handlers;if(!a)return this._$handlers={},this;if(b){if(c[a]){for(var d=[],e=0,f=c[a].length;e<f;e++)c[a][e].h!=b&&d.push(c[a][e]);c[a]=d}c[a]&&0===c[a].length&&delete c[a]}else delete c[a];return this},trigger:function(a){if(this._$handlers[a]){var c=arguments,d=c.length;d>3&&(c=b.call(c,1));for(var e=this._$handlers[a],f=e.length,g=0;g<f;){switch(d){case 1:e[g].h.call(e[g].ctx);break;case 2:e[g].h.call(e[g].ctx,c[1]);break;case 3:e[g].h.call(e[g].ctx,c[1],c[2]);break;default:e[g].h.apply(e[g].ctx,c)}e[g].one?(e.splice(g,1),f--):g++}}return this},triggerWithContext:function(a){if(this._$handlers[a]){var c=arguments,d=c.length;d>4&&(c=b.call(c,1,c.length-1));for(var e=c[c.length-1],f=this._$handlers[a],g=f.length,h=0;h<g;){switch(d){case 1:f[h].h.call(e);break;case 2:f[h].h.call(e,c[1]);break;case 3:f[h].h.call(e,c[1],c[2]);break;default:f[h].h.apply(e,c)}f[h].one?(f.splice(h,1),g--):h++}}return this}},c}),define("zrender/Handler",["require","./core/util","./mixin/Draggable","./mixin/Eventful"],function(a){function b(a,b,c){return{type:a,event:c,target:b,cancelBubble:!1,offsetX:c.zrX,offsetY:c.zrY,gestureEvent:c.gestureEvent,pinchX:c.pinchX,pinchY:c.pinchY,pinchScale:c.pinchScale,wheelDelta:c.zrDelta,zrByTouch:c.zrByTouch}}function c(){}function d(a,b,c){if(a[a.rectHover?"rectContain":"contain"](b,c)){for(var d=a;d;){if(d.silent||d.clipPath&&!d.clipPath.contain(b,c))return!1;d=d.parent}return!0}return!1}var e=a("./core/util"),f=a("./mixin/Draggable"),g=a("./mixin/Eventful");c.prototype.dispose=function(){};var h=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],i=function(a,b,d,i){g.call(this),this.storage=a,this.painter=b,this.painterRoot=i,d=d||new c,this.proxy=d,d.handler=this,this._hovered,this._lastTouchMoment,this._lastX,this._lastY,f.call(this),e.each(h,function(a){d.on&&d.on(a,this[a],this)},this)};return i.prototype={constructor:i,mousemove:function(a){var b=a.zrX,c=a.zrY,d=this.findHover(b,c,null),e=this._hovered,f=this.proxy;this._hovered=d,f.setCursor&&f.setCursor(d?d.cursor:"default"),e&&d!==e&&e.__zr&&this.dispatchToElement(e,"mouseout",a),this.dispatchToElement(d,"mousemove",a),d&&d!==e&&this.dispatchToElement(d,"mouseover",a)},mouseout:function(a){this.dispatchToElement(this._hovered,"mouseout",a);var b,c=a.toElement||a.relatedTarget;do c=c&&c.parentNode;while(c&&9!=c.nodeType&&!(b=c===this.painterRoot));!b&&this.trigger("globalout",{event:a})},resize:function(a){this._hovered=null},dispatch:function(a,b){var c=this[a];c&&c.call(this,b)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(a){var b=this.proxy;b.setCursor&&b.setCursor(a)},dispatchToElement:function(a,c,d){for(var e="on"+c,f=b(c,a,d),g=a;g&&(g[e]&&(f.cancelBubble=g[e].call(g,f)),g.trigger(c,f),g=g.parent,!f.cancelBubble););f.cancelBubble||(this.trigger(c,f),this.painter&&this.painter.eachOtherLayer(function(a){"function"==typeof a[e]&&a[e].call(a,f),a.trigger&&a.trigger(c,f)}))},findHover:function(a,b,c){for(var e=this.storage.getDisplayList(),f=e.length-1;f>=0;f--)if(!e[f].silent&&e[f]!==c&&!e[f].ignore&&d(e[f],a,b))return e[f]}},e.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(a){i.prototype[a]=function(b){var c=this.findHover(b.zrX,b.zrY,null);if("mousedown"===a)this._downel=c,this._upel=c;else if("mosueup"===a)this._upel=c;else if("click"===a&&this._downel!==this._upel)return;this.dispatchToElement(c,a,b)}}),e.mixin(i,g),e.mixin(i,f),i}),define("zrender/core/matrix",[],function(){var a="undefined"==typeof Float32Array?Array:Float32Array,b={create:function(){var c=new a(6);return b.identity(c),c},identity:function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},copy:function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},mul:function(a,b,c){var d=b[0]*c[0]+b[2]*c[1],e=b[1]*c[0]+b[3]*c[1],f=b[0]*c[2]+b[2]*c[3],g=b[1]*c[2]+b[3]*c[3],h=b[0]*c[4]+b[2]*c[5]+b[4],i=b[1]*c[4]+b[3]*c[5]+b[5];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a},translate:function(a,b,c){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4]+c[0],a[5]=b[5]+c[1],a},rotate:function(a,b,c){var d=b[0],e=b[2],f=b[4],g=b[1],h=b[3],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+g*j,a[1]=-d*j+g*k,a[2]=e*k+h*j,a[3]=-e*j+k*h,a[4]=k*f+j*i,a[5]=k*i-j*f,a},scale:function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d,a[1]=b[1]*e,a[2]=b[2]*d,a[3]=b[3]*e,a[4]=b[4]*d,a[5]=b[5]*e,a},invert:function(a,b){var c=b[0],d=b[2],e=b[4],f=b[1],g=b[3],h=b[5],i=c*g-f*d;return i?(i=1/i,a[0]=g*i,a[1]=-f*i,a[2]=-d*i,a[3]=c*i,a[4]=(d*h-g*e)*i,a[5]=(f*e-c*h)*i,a):null}};return b}),define("zrender/core/vector",[],function(){var a="undefined"==typeof Float32Array?Array:Float32Array,b={create:function(b,c){var d=new a(2);return null==b&&(b=0),null==c&&(c=0),d[0]=b,d[1]=c,d},copy:function(a,b){return a[0]=b[0],a[1]=b[1],a},clone:function(b){var c=new a(2);return c[0]=b[0],c[1]=b[1],c},set:function(a,b,c){return a[0]=b,a[1]=c,a},add:function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},scaleAndAdd:function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},sub:function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},len:function(a){return Math.sqrt(this.lenSquare(a))},lenSquare:function(a){return a[0]*a[0]+a[1]*a[1]},mul:function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},div:function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},scale:function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},normalize:function(a,c){var d=b.len(c);return 0===d?(a[0]=0,a[1]=0):(a[0]=c[0]/d,a[1]=c[1]/d),a},distance:function(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]))},distanceSquare:function(a,b){return(a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])},negate:function(a,b){return a[0]=-b[0],a[1]=-b[1],a},lerp:function(a,b,c,d){return a[0]=b[0]+d*(c[0]-b[0]),a[1]=b[1]+d*(c[1]-b[1]),a},applyTransform:function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},min:function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},max:function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a}};return b.length=b.len,b.lengthSquare=b.lenSquare,b.dist=b.distance,b.distSquare=b.distanceSquare,b}),define("zrender/mixin/Transformable",["require","../core/matrix","../core/vector"],function(a){function b(a){return a>f||a<-f}var c=a("../core/matrix"),d=a("../core/vector"),e=c.identity,f=5e-5,g=function(a){a=a||{},a.position||(this.position=[0,0]),null==a.rotation&&(this.rotation=0),a.scale||(this.scale=[1,1]),this.origin=this.origin||null},h=g.prototype;h.transform=null,h.needLocalTransform=function(){return b(this.rotation)||b(this.position[0])||b(this.position[1])||b(this.scale[0]-1)||b(this.scale[1]-1)},h.updateTransform=function(){var a=this.parent,b=a&&a.transform,d=this.needLocalTransform(),f=this.transform;return d||b?(f=f||c.create(),d?this.getLocalTransform(f):e(f),b&&(d?c.mul(f,a.transform,f):c.copy(f,a.transform)),this.transform=f,this.invTransform=this.invTransform||c.create(),void c.invert(this.invTransform,f)):void(f&&e(f))},h.getLocalTransform=function(a){a=a||[],e(a);var b=this.origin,d=this.scale,f=this.rotation,g=this.position;return b&&(a[4]-=b[0],a[5]-=b[1]),c.scale(a,a,d),f&&c.rotate(a,a,f),b&&(a[4]+=b[0],a[5]+=b[1]),a[4]+=g[0],a[5]+=g[1],a},h.setTransform=function(a){var b=this.transform,c=a.dpr||1;b?a.setTransform(c*b[0],c*b[1],c*b[2],c*b[3],c*b[4],c*b[5]):a.setTransform(c,0,0,c,0,0)},h.restoreTransform=function(a){var b=(this.transform,a.dpr||1);a.setTransform(b,0,0,b,0,0)};var i=[];return h.decomposeTransform=function(){if(this.transform){var a=this.parent,d=this.transform;a&&a.transform&&(c.mul(i,a.invTransform,d),d=i);var e=d[0]*d[0]+d[1]*d[1],f=d[2]*d[2]+d[3]*d[3],g=this.position,h=this.scale;b(e-1)&&(e=Math.sqrt(e)),b(f-1)&&(f=Math.sqrt(f)),d[0]<0&&(e=-e),d[3]<0&&(f=-f),g[0]=d[4],g[1]=d[5],h[0]=e,h[1]=f,this.rotation=Math.atan2(-d[1]/f,d[0]/e)}},h.getGlobalScale=function(){var a=this.transform;if(!a)return[1,1];var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]),c=Math.sqrt(a[2]*a[2]+a[3]*a[3]);return a[0]<0&&(b=-b),a[3]<0&&(c=-c),[b,c]},h.transformCoordToLocal=function(a,b){var c=[a,b],e=this.invTransform;return e&&d.applyTransform(c,c,e),c},h.transformCoordToGlobal=function(a,b){var c=[a,b],e=this.transform;return e&&d.applyTransform(c,c,e),c},g}),define("zrender/animation/easing",[],function(){var a={linear:function(a){return a},quadraticIn:function(a){return a*a},quadraticOut:function(a){return a*(2-a)},quadraticInOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)},cubicIn:function(a){return a*a*a},cubicOut:function(a){return--a*a*a+1},cubicInOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},quarticIn:function(a){return a*a*a*a},quarticOut:function(a){return 1- --a*a*a*a},quarticInOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},quinticIn:function(a){return a*a*a*a*a},quinticOut:function(a){return--a*a*a*a*a+1},quinticInOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},sinusoidalIn:function(a){return 1-Math.cos(a*Math.PI/2)},sinusoidalOut:function(a){return Math.sin(a*Math.PI/2)},sinusoidalInOut:function(a){return.5*(1-Math.cos(Math.PI*a))},exponentialIn:function(a){return 0===a?0:Math.pow(1024,a-1)},exponentialOut:function(a){return 1===a?1:1-Math.pow(2,-10*a)},exponentialInOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)},circularIn:function(a){return 1-Math.sqrt(1-a*a)},circularOut:function(a){return Math.sqrt(1- --a*a)},circularInOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},elasticIn:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)))},elasticOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*(2*Math.PI)/d)+1)},elasticInOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)):c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)*.5+1)},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},backInOut:function(a){var b=2.5949095;return(a*=2)<1?.5*(a*a*((b+1)*a-b)):.5*((a-=2)*a*((b+1)*a+b)+2)},bounceIn:function(b){return 1-a.bounceOut(1-b)},bounceOut:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bounceInOut:function(b){return b<.5?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5}};return a}),define("zrender/animation/Clip",["require","./easing"],function(a){function b(a){this._target=a.target,this._life=a.life||1e3,this._delay=a.delay||0,this._initialized=!1,this.loop=null!=a.loop&&a.loop,this.gap=a.gap||0,this.easing=a.easing||"Linear",this.onframe=a.onframe,this.ondestroy=a.ondestroy,this.onrestart=a.onrestart}var c=a("./easing");return b.prototype={constructor:b,step:function(a){this._initialized||(this._startTime=a+this._delay,this._initialized=!0);var b=(a-this._startTime)/this._life;if(!(b<0)){b=Math.min(b,1);var d=this.easing,e="string"==typeof d?c[d]:d,f="function"==typeof e?e(b):b;return this.fire("frame",f),1==b?this.loop?(this.restart(a),"restart"):(this._needsRemove=!0,"destroy"):null}},restart:function(a){var b=(a-this._startTime)%this._life;this._startTime=a-b+this.gap,this._needsRemove=!1},fire:function(a,b){a="on"+a,this[a]&&this[a](this._target,b)}},b}),define("zrender/tool/color",["require"],function(a){function b(a){return a=Math.round(a),a<0?0:a>255?255:a}function c(a){return a=Math.round(a),a<0?0:a>360?360:a}function d(a){return a<0?0:a>1?1:a}function e(a){return b(a.length&&"%"===a.charAt(a.length-1)?parseFloat(a)/100*255:parseInt(a,10))}function f(a){return d(a.length&&"%"===a.charAt(a.length-1)?parseFloat(a)/100:parseFloat(a))}function g(a,b,c){return c<0?c+=1:c>1&&(c-=1),6*c<1?a+(b-a)*c*6:2*c<1?b:3*c<2?a+(b-a)*(2/3-c)*6:a}function h(a,b,c){return a+(b-a)*c}function i(a){if(a){a+="";var b=a.replace(/ /g,"").toLowerCase();if(b in s)return s[b].slice();if("#"!==b.charAt(0)){var c=b.indexOf("("),d=b.indexOf(")");if(c!==-1&&d+1===b.length){var g=b.substr(0,c),h=b.substr(c+1,d-(c+1)).split(","),i=1;switch(g){case"rgba":if(4!==h.length)return;i=f(h.pop());case"rgb":if(3!==h.length)return;return[e(h[0]),e(h[1]),e(h[2]),i];case"hsla":if(4!==h.length)return;return h[3]=f(h[3]),j(h);case"hsl":if(3!==h.length)return;return j(h);default:return}}}else{if(4===b.length){var k=parseInt(b.substr(1),16);if(!(k>=0&&k<=4095))return;return[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]}if(7===b.length){var k=parseInt(b.substr(1),16);if(!(k>=0&&k<=16777215))return;return[(16711680&k)>>16,(65280&k)>>8,255&k,1]}}}}function j(a){var c=(parseFloat(a[0])%360+360)%360/360,d=f(a[1]),e=f(a[2]),h=e<=.5?e*(d+1):e+d-e*d,i=2*e-h,j=[b(255*g(i,h,c+1/3)),b(255*g(i,h,c)),b(255*g(i,h,c-1/3))];return 4===a.length&&(j[3]=a[3]),j}function k(a){if(a){var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=Math.min(d,e,f),h=Math.max(d,e,f),i=h-g,j=(h+g)/2;if(0===i)b=0,c=0;else{c=j<.5?i/(h+g):i/(2-h-g);var k=((h-d)/6+i/2)/i,l=((h-e)/6+i/2)/i,m=((h-f)/6+i/2)/i;d===h?b=m-l:e===h?b=1/3+k-m:f===h&&(b=2/3+l-k),b<0&&(b+=1),b>1&&(b-=1)}var n=[360*b,c,j];return null!=a[3]&&n.push(a[3]),n}}function l(a,b){var c=i(a);if(c){for(var d=0;d<3;d++)b<0?c[d]=c[d]*(1-b)|0:c[d]=(255-c[d])*b+c[d]|0;return r(c,4===c.length?"rgba":"rgb")}}function m(a,b){var c=i(a);if(c)return((1<<24)+(c[0]<<16)+(c[1]<<8)+ +c[2]).toString(16).slice(1)}function n(a,c,d){if(c&&c.length&&a>=0&&a<=1){d=d||[0,0,0,0];var e=a*(c.length-1),f=Math.floor(e),g=Math.ceil(e),i=c[f],j=c[g],k=e-f;return d[0]=b(h(i[0],j[0],k)),d[1]=b(h(i[1],j[1],k)),d[2]=b(h(i[2],j[2],k)),d[3]=b(h(i[3],j[3],k)),d}}function o(a,c,e){if(c&&c.length&&a>=0&&a<=1){var f=a*(c.length-1),g=Math.floor(f),j=Math.ceil(f),k=i(c[g]),l=i(c[j]),m=f-g,n=r([b(h(k[0],l[0],m)),b(h(k[1],l[1],m)),b(h(k[2],l[2],m)),d(h(k[3],l[3],m))],"rgba");return e?{color:n,leftIndex:g,rightIndex:j,value:f}:n}}function p(a,b,d,e){if(a=i(a))return a=k(a),null!=b&&(a[0]=c(b)),null!=d&&(a[1]=f(d)),null!=e&&(a[2]=f(e)),r(j(a),"rgba")}function q(a,b){if(a=i(a),a&&null!=b)return a[3]=d(b),r(a,"rgba")}function r(a,b){var c=a[0]+","+a[1]+","+a[2];return"rgba"!==b&&"hsva"!==b&&"hsla"!==b||(c+=","+a[3]),b+"("+c+")"}var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return{parse:i,lift:l,toHex:m,fastMapToColor:n,mapToColor:o,modifyHSL:p,modifyAlpha:q,stringify:r}}),define("zrender/animation/Animator",["require","./Clip","../tool/color","../core/util"],function(a){function b(a,b){return a[b]}function c(a,b,c){a[b]=c}function d(a,b,c){return(b-a)*c+a}function e(a,b,c){return c>.5?b:a}function f(a,b,c,e,f){var g=a.length;if(1==f)for(var h=0;h<g;h++)e[h]=d(a[h],b[h],c);else for(var i=a[0].length,h=0;h<g;h++)for(var j=0;j<i;j++)e[h][j]=d(a[h][j],b[h][j],c)}function g(a,b,c){var d=a.length,e=b.length;if(d!==e){var f=d>e;if(f)a.length=e;else for(var g=d;g<e;g++)a.push(1===c?b[g]:r.call(b[g]))}for(var h=a[0]&&a[0].length,g=0;g<a.length;g++)if(1===c)isNaN(a[g])&&(a[g]=b[g]);else for(var i=0;i<h;i++)isNaN(a[g][i])&&(a[g][i]=b[g][i])}function h(a,b,c){if(a===b)return!0;var d=a.length;if(d!==b.length)return!1;if(1===c){for(var e=0;e<d;e++)if(a[e]!==b[e])return!1}else for(var f=a[0].length,e=0;e<d;e++)for(var g=0;g<f;g++)if(a[e][g]!==b[e][g])return!1;return!0}function i(a,b,c,d,e,f,g,h,i){var k=a.length;if(1==i)for(var l=0;l<k;l++)h[l]=j(a[l],b[l],c[l],d[l],e,f,g);else for(var m=a[0].length,l=0;l<k;l++)for(var n=0;n<m;n++)h[l][n]=j(a[l][n],b[l][n],c[l][n],d[l][n],e,f,g)}function j(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}function k(a){if(q(a)){var b=a.length;if(q(a[0])){for(var c=[],d=0;d<b;d++)c.push(r.call(a[d]));return c}return r.call(a)}return a}function l(a){return a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.floor(a[2]),"rgba("+a.join(",")+")"}function m(a,b,c,k,m){var p=a._getter,r=a._setter,s="spline"===b,t=k.length;if(t){var u,v=k[0].value,w=q(v),x=!1,y=!1,z=w&&q(v[0])?2:1;k.sort(function(a,b){return a.time-b.time}),u=k[t-1].time;for(var A=[],B=[],C=k[0].value,D=!0,E=0;E<t;E++){A.push(k[E].time/u);var F=k[E].value;if(w&&h(F,C,z)||!w&&F===C||(D=!1),C=F,"string"==typeof F){var G=o.parse(F);G?(F=G,x=!0):y=!0}B.push(F)}if(!D){for(var H=B[t-1],E=0;E<t-1;E++)w?g(B[E],H,z):!isNaN(B[E])||isNaN(H)||y||x||(B[E]=H);w&&g(p(a._target,m),H,z);var I,J,K,L,M,N,O=0,P=0;if(x)var Q=[0,0,0,0];var R=function(a,b){var c;if(b<0)c=0;else if(b<P){for(I=Math.min(O+1,t-1),c=I;c>=0&&!(A[c]<=b);c--);c=Math.min(c,t-2)}else{for(c=O;c<t&&!(A[c]>b);c++);c=Math.min(c-1,t-2)}O=c,P=b;var g=A[c+1]-A[c];if(0!==g)if(J=(b-A[c])/g,s)if(L=B[c],K=B[0===c?c:c-1],M=B[c>t-2?t-1:c+1],N=B[c>t-3?t-1:c+2],w)i(K,L,M,N,J,J*J,J*J*J,p(a,m),z);else{var h;if(x)h=i(K,L,M,N,J,J*J,J*J*J,Q,1),h=l(Q);else{if(y)return e(L,M,J);h=j(K,L,M,N,J,J*J,J*J*J)}r(a,m,h)}else if(w)f(B[c],B[c+1],J,p(a,m),z);else{var h;if(x)f(B[c],B[c+1],J,Q,1),h=l(Q);else{if(y)return e(B[c],B[c+1],J);h=d(B[c],B[c+1],J)}r(a,m,h)}},S=new n({target:a._target,life:u,loop:a._loop,delay:a._delay,onframe:R,ondestroy:c});return b&&"spline"!==b&&(S.easing=b),S}}}var n=a("./Clip"),o=a("../tool/color"),p=a("../core/util"),q=p.isArrayLike,r=Array.prototype.slice,s=function(a,d,e,f){this._tracks={},this._target=a,this._loop=d||!1,this._getter=e||b,this._setter=f||c,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};return s.prototype={when:function(a,b){var c=this._tracks;for(var d in b)if(b.hasOwnProperty(d)){if(!c[d]){c[d]=[];var e=this._getter(this._target,d);if(null==e)continue;0!==a&&c[d].push({time:0,value:k(e)})}c[d].push({time:a,value:b[d]})}return this},during:function(a){return this._onframeList.push(a),this},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var a=this._doneList,b=a.length,c=0;c<b;c++)a[c].call(this)},start:function(a){var b,c=this,d=0,e=function(){d--,d||c._doneCallback()};for(var f in this._tracks)if(this._tracks.hasOwnProperty(f)){var g=m(this,a,e,this._tracks[f],f);g&&(this._clipList.push(g),d++,this.animation&&this.animation.addClip(g),b=g)}if(b){var h=b.onframe;b.onframe=function(a,b){h(a,b);for(var d=0;d<c._onframeList.length;d++)c._onframeList[d](a,b)}}return d||this._doneCallback(),this},stop:function(a){for(var b=this._clipList,c=this.animation,d=0;d<b.length;d++){var e=b[d];a&&e.onframe(this._target,1),c&&c.removeClip(e)}b.length=0},delay:function(a){return this._delay=a,this},done:function(a){return a&&this._doneList.push(a),this},getClips:function(){return this._clipList}},s}),define("zrender/config",[],function(){var a=1;"undefined"!=typeof window&&(a=Math.max(window.devicePixelRatio||1,1));var b={debugMode:0,devicePixelRatio:a};return b}),define("zrender/core/log",["require","../config"],function(a){var b=a("../config");return function(){if(0!==b.debugMode)if(1==b.debugMode)for(var a in arguments)throw new Error(arguments[a]);else if(b.debugMode>1)for(var a in arguments)console.log(arguments[a])}}),define("zrender/mixin/Animatable",["require","../animation/Animator","../core/util","../core/log"],function(a){var b=a("../animation/Animator"),c=a("../core/util"),d=c.isString,e=c.isFunction,f=c.isObject,g=a("../core/log"),h=function(){this.animators=[]};return h.prototype={constructor:h,animate:function(a,d){var e,f=!1,h=this,i=this.__zr;if(a){var j=a.split("."),k=h;f="shape"===j[0];for(var l=0,m=j.length;l<m;l++)k&&(k=k[j[l]]);k&&(e=k)}else e=h;if(!e)return void g('Property "'+a+'" is not existed in element '+h.id);var n=h.animators,o=new b(e,d);return o.during(function(a){h.dirty(f)}).done(function(){n.splice(c.indexOf(n,o),1)}),n.push(o),i&&i.animation.addAnimator(o),o},stopAnimation:function(a){for(var b=this.animators,c=b.length,d=0;d<c;d++)b[d].stop(a);return b.length=0,this},animateTo:function(a,b,c,f,g){function h(){j--,j||g&&g()}d(c)?(g=f,f=c,c=0):e(f)?(g=f,f="linear",c=0):e(c)?(g=c,c=0):e(b)?(g=b,b=500):b||(b=500),this.stopAnimation(),this._animateToShallow("",this,a,b,c,f,g);var i=this.animators.slice(),j=i.length;j||g&&g();for(var k=0;k<i.length;k++)i[k].done(h).start(f)},_animateToShallow:function(a,b,d,e,g){var h={},i=0;for(var j in d)if(d.hasOwnProperty(j))if(null!=b[j])f(d[j])&&!c.isArrayLike(d[j])?this._animateToShallow(a?a+"."+j:j,b[j],d[j],e,g):(h[j]=d[j],i++);else if(null!=d[j])if(a){var k={};k[a]={},k[a][j]=d[j],this.attr(k)}else this.attr(j,d[j]);return i>0&&this.animate(a,!1).when(null==e?500:e,h).delay(g||0),this}},h}),define("zrender/Element",["require","./core/guid","./mixin/Eventful","./mixin/Transformable","./mixin/Animatable","./core/util"],function(a){var b=a("./core/guid"),c=a("./mixin/Eventful"),d=a("./mixin/Transformable"),e=a("./mixin/Animatable"),f=a("./core/util"),g=function(a){d.call(this,a),c.call(this,a),e.call(this,a),this.id=a.id||b()};return g.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,drift:function(a,b){switch(this.draggable){case"horizontal":b=0;
break;case"vertical":a=0}var c=this.transform;c||(c=this.transform=[1,0,0,1,0,0]),c[4]+=a,c[5]+=b,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(a,b){},attrKV:function(a,b){if("position"===a||"scale"===a||"origin"===a){if(b){var c=this[a];c||(c=this[a]=[]),c[0]=b[0],c[1]=b[1]}}else this[a]=b},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(a,b){if("string"==typeof a)this.attrKV(a,b);else if(f.isObject(a))for(var c in a)a.hasOwnProperty(c)&&this.attrKV(c,a[c]);return this.dirty(!1),this},setClipPath:function(a){var b=this.__zr;b&&a.addSelfToZr(b),this.clipPath&&this.clipPath!==a&&this.removeClipPath(),this.clipPath=a,a.__zr=b,a.__clipTarget=this,this.dirty(!1)},removeClipPath:function(){var a=this.clipPath;a&&(a.__zr&&a.removeSelfFromZr(a.__zr),a.__zr=null,a.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(a){this.__zr=a;var b=this.animators;if(b)for(var c=0;c<b.length;c++)a.animation.addAnimator(b[c]);this.clipPath&&this.clipPath.addSelfToZr(a)},removeSelfFromZr:function(a){this.__zr=null;var b=this.animators;if(b)for(var c=0;c<b.length;c++)a.animation.removeAnimator(b[c]);this.clipPath&&this.clipPath.removeSelfFromZr(a)}},f.mixin(g,e),f.mixin(g,d),f.mixin(g,c),g}),define("zrender/core/BoundingRect",["require","./vector","./matrix"],function(a){function b(a,b,c,d){c<0&&(a+=c,c=-c),d<0&&(b+=d,d=-d),this.x=a,this.y=b,this.width=c,this.height=d}var c=a("./vector"),d=a("./matrix"),e=c.applyTransform,f=Math.min,g=Math.max;return b.prototype={constructor:b,union:function(a){var b=f(a.x,this.x),c=f(a.y,this.y);this.width=g(a.x+a.width,this.x+this.width)-b,this.height=g(a.y+a.height,this.y+this.height)-c,this.x=b,this.y=c},applyTransform:function(){var a=[],b=[],c=[],d=[];return function(h){if(h){a[0]=c[0]=this.x,a[1]=d[1]=this.y,b[0]=d[0]=this.x+this.width,b[1]=c[1]=this.y+this.height,e(a,a,h),e(b,b,h),e(c,c,h),e(d,d,h),this.x=f(a[0],b[0],c[0],d[0]),this.y=f(a[1],b[1],c[1],d[1]);var i=g(a[0],b[0],c[0],d[0]),j=g(a[1],b[1],c[1],d[1]);this.width=i-this.x,this.height=j-this.y}}}(),calculateTransform:function(a){var b=this,c=a.width/b.width,e=a.height/b.height,f=d.create();return d.translate(f,f,[-b.x,-b.y]),d.scale(f,f,[c,e]),d.translate(f,f,[a.x,a.y]),f},intersect:function(a){if(!a)return!1;a instanceof b||(a=b.create(a));var c=this,d=c.x,e=c.x+c.width,f=c.y,g=c.y+c.height,h=a.x,i=a.x+a.width,j=a.y,k=a.y+a.height;return!(e<h||i<d||g<j||k<f)},contain:function(a,b){var c=this;return a>=c.x&&a<=c.x+c.width&&b>=c.y&&b<=c.y+c.height},clone:function(){return new b(this.x,this.y,this.width,this.height)},copy:function(a){this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},b.create=function(a){return new b(a.x,a.y,a.width,a.height)},b}),define("zrender/container/Group",["require","../core/util","../Element","../core/BoundingRect"],function(a){var b=a("../core/util"),c=a("../Element"),d=a("../core/BoundingRect"),e=function(a){a=a||{},c.call(this,a);for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this._children=[],this.__storage=null,this.__dirty=!0};return e.prototype={constructor:e,isGroup:!0,type:"group",silent:!1,children:function(){return this._children.slice()},childAt:function(a){return this._children[a]},childOfName:function(a){for(var b=this._children,c=0;c<b.length;c++)if(b[c].name===a)return b[c]},childCount:function(){return this._children.length},add:function(a){return a&&a!==this&&a.parent!==this&&(this._children.push(a),this._doAdd(a)),this},addBefore:function(a,b){if(a&&a!==this&&a.parent!==this&&b&&b.parent===this){var c=this._children,d=c.indexOf(b);d>=0&&(c.splice(d,0,a),this._doAdd(a))}return this},_doAdd:function(a){a.parent&&a.parent.remove(a),a.parent=this;var b=this.__storage,c=this.__zr;b&&b!==a.__storage&&(b.addToMap(a),a instanceof e&&a.addChildrenToStorage(b)),c&&c.refresh()},remove:function(a){var c=this.__zr,d=this.__storage,f=this._children,g=b.indexOf(f,a);return g<0?this:(f.splice(g,1),a.parent=null,d&&(d.delFromMap(a.id),a instanceof e&&a.delChildrenFromStorage(d)),c&&c.refresh(),this)},removeAll:function(){var a,b,c=this._children,d=this.__storage;for(b=0;b<c.length;b++)a=c[b],d&&(d.delFromMap(a.id),a instanceof e&&a.delChildrenFromStorage(d)),a.parent=null;return c.length=0,this},eachChild:function(a,b){for(var c=this._children,d=0;d<c.length;d++){var e=c[d];a.call(b,e,d)}return this},traverse:function(a,b){for(var c=0;c<this._children.length;c++){var d=this._children[c];a.call(b,d),"group"===d.type&&d.traverse(a,b)}return this},addChildrenToStorage:function(a){for(var b=0;b<this._children.length;b++){var c=this._children[b];a.addToMap(c),c instanceof e&&c.addChildrenToStorage(a)}},delChildrenFromStorage:function(a){for(var b=0;b<this._children.length;b++){var c=this._children[b];a.delFromMap(c.id),c instanceof e&&c.delChildrenFromStorage(a)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(a){for(var b=null,c=new d(0,0,0,0),e=a||this._children,f=[],g=0;g<e.length;g++){var h=e[g];if(!h.ignore&&!h.invisible){var i=h.getBoundingRect(),j=h.getLocalTransform(f);j?(c.copy(i),c.applyTransform(j),b=b||c.clone(),b.union(c)):(b=b||i.clone(),b.union(i))}}return b||c}},b.inherits(e,c),e}),define("zrender/core/timsort",[],function(){function a(a){for(var b=0;a>=i;)b|=1&a,a>>=1;return a+b}function b(a,b,d,e){var f=b+1;if(f===d)return 1;if(e(a[f++],a[b])<0){for(;f<d&&e(a[f],a[f-1])<0;)f++;c(a,b,f)}else for(;f<d&&e(a[f],a[f-1])>=0;)f++;return f-b}function c(a,b,c){for(c--;b<c;){var d=a[b];a[b++]=a[c],a[c--]=d}}function d(a,b,c,d,e){for(d===b&&d++;d<c;d++){for(var f,g=a[d],h=b,i=d;h<i;)f=h+i>>>1,e(g,a[f])<0?i=f:h=f+1;var j=d-h;switch(j){case 3:a[h+3]=a[h+2];case 2:a[h+2]=a[h+1];case 1:a[h+1]=a[h];break;default:for(;j>0;)a[h+j]=a[h+j-1],j--}a[h]=g}}function e(a,b,c,d,e,f){var g=0,h=0,i=1;if(f(a,b[c+e])>0){for(h=d-e;i<h&&f(a,b[c+e+i])>0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}else{for(h=e+1;i<h&&f(a,b[c+e-i])<=0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h);var j=g;g=e-i,i=e-j}for(g++;g<i;){var k=g+(i-g>>>1);f(a,b[c+k])>0?g=k+1:i=k}return i}function f(a,b,c,d,e,f){var g=0,h=0,i=1;if(f(a,b[c+e])<0){for(h=e+1;i<h&&f(a,b[c+e-i])<0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h);var j=g;g=e-i,i=e-j}else{for(h=d-e;i<h&&f(a,b[c+e+i])>=0;)g=i,i=(i<<1)+1,i<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}for(g++;g<i;){var k=g+(i-g>>>1);f(a,b[c+k])<0?i=k:g=k+1}return i}function g(a,b){function c(a,b){m[s]=a,n[s]=b,s+=1}function d(){for(;s>1;){var a=s-2;if(a>=1&&n[a-1]<=n[a]+n[a+1]||a>=2&&n[a-2]<=n[a]+n[a-1])n[a-1]<n[a+1]&&a--;else if(n[a]>n[a+1])break;h(a)}}function g(){for(;s>1;){var a=s-2;a>0&&n[a-1]<n[a+1]&&a--,h(a)}}function h(c){var d=m[c],g=n[c],h=m[c+1],j=n[c+1];n[c]=g+j,c===s-3&&(m[c+1]=m[c+2],n[c+1]=n[c+2]),s--;var k=f(a[h],a,d,g,0,b);d+=k,g-=k,0!==g&&(j=e(a[d+g-1],a,h,j,j-1,b),0!==j&&(g<=j?i(d,g,h,j):l(d,g,h,j)))}function i(c,d,g,h){var i=0;for(i=0;i<d;i++)t[i]=a[c+i];var k=0,l=g,m=c;if(a[m++]=a[l++],0!==--h){if(1===d){for(i=0;i<h;i++)a[m+i]=a[l+i];return void(a[m+h]=t[k])}for(var n,p,q,r=o;;){n=0,p=0,q=!1;do if(b(a[l],t[k])<0){if(a[m++]=a[l++],p++,n=0,0===--h){q=!0;break}}else if(a[m++]=t[k++],n++,p=0,1===--d){q=!0;break}while((n|p)<r);if(q)break;do{if(n=f(a[l],t,k,d,0,b),0!==n){for(i=0;i<n;i++)a[m+i]=t[k+i];if(m+=n,k+=n,d-=n,d<=1){q=!0;break}}if(a[m++]=a[l++],0===--h){q=!0;break}if(p=e(t[k],a,l,h,0,b),0!==p){for(i=0;i<p;i++)a[m+i]=a[l+i];if(m+=p,l+=p,h-=p,0===h){q=!0;break}}if(a[m++]=t[k++],1===--d){q=!0;break}r--}while(n>=j||p>=j);if(q)break;r<0&&(r=0),r+=2}if(o=r,o<1&&(o=1),1===d){for(i=0;i<h;i++)a[m+i]=a[l+i];a[m+h]=t[k]}else{if(0===d)throw new Error;for(i=0;i<d;i++)a[m+i]=t[k+i]}}else for(i=0;i<d;i++)a[m+i]=t[k+i]}function l(c,d,g,h){var i=0;for(i=0;i<h;i++)t[i]=a[g+i];var k=c+d-1,l=h-1,m=g+h-1,n=0,p=0;if(a[m--]=a[k--],0!==--d){if(1===h){for(m-=d,k-=d,p=m+1,n=k+1,i=d-1;i>=0;i--)a[p+i]=a[n+i];return void(a[m]=t[l])}for(var q=o;;){var r=0,s=0,u=!1;do if(b(t[l],a[k])<0){if(a[m--]=a[k--],r++,s=0,0===--d){u=!0;break}}else if(a[m--]=t[l--],s++,r=0,1===--h){u=!0;break}while((r|s)<q);if(u)break;do{if(r=d-f(t[l],a,c,d,d-1,b),0!==r){for(m-=r,k-=r,d-=r,p=m+1,n=k+1,i=r-1;i>=0;i--)a[p+i]=a[n+i];if(0===d){u=!0;break}}if(a[m--]=t[l--],1===--h){u=!0;break}if(s=h-e(a[k],t,0,h,h-1,b),0!==s){for(m-=s,l-=s,h-=s,p=m+1,n=l+1,i=0;i<s;i++)a[p+i]=t[n+i];if(h<=1){u=!0;break}}if(a[m--]=a[k--],0===--d){u=!0;break}q--}while(r>=j||s>=j);if(u)break;q<0&&(q=0),q+=2}if(o=q,o<1&&(o=1),1===h){for(m-=d,k-=d,p=m+1,n=k+1,i=d-1;i>=0;i--)a[p+i]=a[n+i];a[m]=t[l]}else{if(0===h)throw new Error;for(n=m-(h-1),i=0;i<h;i++)a[n+i]=t[i]}}else for(n=m-(h-1),i=0;i<h;i++)a[n+i]=t[i]}var m,n,o=j,p=0,q=k,r=0,s=0;p=a.length,p<2*k&&(q=p>>>1);var t=[];r=p<120?5:p<1542?10:p<119151?19:40,m=[],n=[],this.mergeRuns=d,this.forceMergeRuns=g,this.pushRun=c}function h(c,e,f,h){f||(f=0),h||(h=c.length);var j=h-f;if(!(j<2)){var k=0;if(j<i)return k=b(c,f,h,e),void d(c,f,h,f+k,e);var l=new g(c,e),m=a(j);do{if(k=b(c,f,h,e),k<m){var n=j;n>m&&(n=m),d(c,f,f+n,f+k,e),k=n}l.pushRun(f,k),l.mergeRuns(),j-=k,f+=k}while(0!==j);l.forceMergeRuns()}}var i=32,j=7,k=256;return h}),define("zrender/Storage",["require","./core/util","./core/env","./container/Group","./core/timsort"],function(a){function b(a,b){return a.zlevel===b.zlevel?a.z===b.z?a.z2-b.z2:a.z-b.z:a.zlevel-b.zlevel}var c=a("./core/util"),d=a("./core/env"),e=a("./container/Group"),f=a("./core/timsort"),g=function(){this._elements={},this._roots=[],this._displayList=[],this._displayListLen=0};return g.prototype={constructor:g,traverse:function(a,b){for(var c=0;c<this._roots.length;c++)this._roots[c].traverse(a,b)},getDisplayList:function(a,b){return b=b||!1,a&&this.updateDisplayList(b),this._displayList},updateDisplayList:function(a){this._displayListLen=0;for(var c=this._roots,e=this._displayList,g=0,h=c.length;g<h;g++)this._updateAndAddDisplayable(c[g],null,a);e.length=this._displayListLen,d.canvasSupported&&f(e,b)},_updateAndAddDisplayable:function(a,b,c){if(!a.ignore||c){a.beforeUpdate(),a.__dirty&&a.update(),a.afterUpdate();var d=a.clipPath;if(d){b=b?b.slice():[];for(var e=d,f=a;e;)e.parent=f,e.updateTransform(),b.push(e),f=e,e=e.clipPath}if(a.isGroup){for(var g=a._children,h=0;h<g.length;h++){var i=g[h];a.__dirty&&(i.__dirty=!0),this._updateAndAddDisplayable(i,b,c)}a.__dirty=!1}else a.__clipPaths=b,this._displayList[this._displayListLen++]=a}},addRoot:function(a){this._elements[a.id]||(a instanceof e&&a.addChildrenToStorage(this),this.addToMap(a),this._roots.push(a))},delRoot:function(a){if(null==a){for(var b=0;b<this._roots.length;b++){var d=this._roots[b];d instanceof e&&d.delChildrenFromStorage(this)}return this._elements={},this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(a instanceof Array)for(var b=0,f=a.length;b<f;b++)this.delRoot(a[b]);else{var g;g="string"==typeof a?this._elements[a]:a;var h=c.indexOf(this._roots,g);h>=0&&(this.delFromMap(g.id),this._roots.splice(h,1),g instanceof e&&g.delChildrenFromStorage(this))}},addToMap:function(a){return a instanceof e&&(a.__storage=this),a.dirty(!1),this._elements[a.id]=a,this},get:function(a){return this._elements[a]},delFromMap:function(a){var b=this._elements,c=b[a];return c&&(delete b[a],c instanceof e&&(c.__storage=null)),this},dispose:function(){this._elements=this._renderList=this._roots=null},displayableSortFunc:b},g}),define("zrender/core/event",["require","../mixin/Eventful","./env"],function(a){function b(a){return a.getBoundingClientRect?a.getBoundingClientRect():{left:0,top:0}}function c(a,b,c,e){return c=c||{},e||!i.canvasSupported?d(a,b,c):i.browser.firefox&&null!=b.layerX&&b.layerX!==b.offsetX?(c.zrX=b.layerX,c.zrY=b.layerY):null!=b.offsetX?(c.zrX=b.offsetX,c.zrY=b.offsetY):d(a,b,c),c}function d(a,c,d){var e=b(a);d.zrX=c.clientX-e.left,d.zrY=c.clientY-e.top}function e(a,b,d){if(b=b||window.event,null!=b.zrX)return b;var e=b.type,f=e&&e.indexOf("touch")>=0;if(f){var g="touchend"!=e?b.targetTouches[0]:b.changedTouches[0];g&&c(a,g,b,d)}else c(a,b,b,d),b.zrDelta=b.wheelDelta?b.wheelDelta/120:-(b.detail||0)/3;return b}function f(a,b,c){j?a.addEventListener(b,c):a.attachEvent("on"+b,c)}function g(a,b,c){j?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}var h=a("../mixin/Eventful"),i=a("./env"),j="undefined"!=typeof window&&!!window.addEventListener,k=j?function(a){a.preventDefault(),a.stopPropagation(),a.cancelBubble=!0}:function(a){a.returnValue=!1,a.cancelBubble=!0};return{clientToLocal:c,normalizeEvent:e,addEventListener:f,removeEventListener:g,stop:k,Dispatcher:h}}),define("zrender/animation/requestAnimationFrame",["require"],function(a){return"undefined"!=typeof window&&(window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(a){setTimeout(a,16)}}),define("zrender/animation/Animation",["require","../core/util","../core/event","./requestAnimationFrame","./Animator"],function(a){var b=a("../core/util"),c=a("../core/event").Dispatcher,d=a("./requestAnimationFrame"),e=a("./Animator"),f=function(a){a=a||{},this.stage=a.stage||{},this.onframe=a.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,c.call(this)};return f.prototype={constructor:f,addClip:function(a){this._clips.push(a)},addAnimator:function(a){a.animation=this;for(var b=a.getClips(),c=0;c<b.length;c++)this.addClip(b[c])},removeClip:function(a){var c=b.indexOf(this._clips,a);c>=0&&this._clips.splice(c,1)},removeAnimator:function(a){for(var b=a.getClips(),c=0;c<b.length;c++)this.removeClip(b[c]);a.animation=null},_update:function(){for(var a=(new Date).getTime()-this._pausedTime,b=a-this._time,c=this._clips,d=c.length,e=[],f=[],g=0;g<d;g++){var h=c[g],i=h.step(a);i&&(e.push(i),f.push(h))}for(var g=0;g<d;)c[g]._needsRemove?(c[g]=c[d-1],c.pop(),d--):g++;d=e.length;for(var g=0;g<d;g++)f[g].fire(e[g]);this._time=a,this.onframe(b),this.trigger("frame",b),this.stage.update&&this.stage.update()},_startLoop:function(){function a(){b._running&&(d(a),!b._paused&&b._update())}var b=this;this._running=!0,d(a)},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},animate:function(a,b){b=b||{};var c=new e(a,b.loop,b.getter,b.setter);return this.addAnimator(c),c}},b.mixin(f,c),f}),define("zrender/core/GestureMgr",["require","./event"],function(a){function b(a){var b=a[1][0]-a[0][0],c=a[1][1]-a[0][1];return Math.sqrt(b*b+c*c)}function c(a){return[(a[0][0]+a[1][0])/2,(a[0][1]+a[1][1])/2]}var d=a("./event"),e=function(){this._track=[]};e.prototype={constructor:e,recognize:function(a,b,c){return this._doTrack(a,b,c),this._recognize(a)},clear:function(){return this._track.length=0,this},_doTrack:function(a,b,c){var e=a.touches;if(e){for(var f={points:[],touches:[],target:b,event:a},g=0,h=e.length;g<h;g++){var i=e[g],j=d.clientToLocal(c,i,{});f.points.push([j.zrX,j.zrY]),f.touches.push(i)}this._track.push(f)}},_recognize:function(a){for(var b in f)if(f.hasOwnProperty(b)){var c=f[b](this._track,a);if(c)return c}}};var f={pinch:function(a,d){var e=a.length;if(e){var f=(a[e-1]||{}).points,g=(a[e-2]||{}).points||f;if(g&&g.length>1&&f&&f.length>1){var h=b(f)/b(g);!isFinite(h)&&(h=1),d.pinchScale=h;var i=c(f);return d.pinchX=i[0],d.pinchY=i[1],{type:"pinch",target:a[0].target,event:d}}}}};return e}),define("zrender/dom/HandlerProxy",["require","../core/event","../core/util","../mixin/Eventful","../core/env","../core/GestureMgr"],function(a){function b(a){return"mousewheel"===a&&k.browser.firefox?"DOMMouseScroll":a}function c(a,b,c){var d=a._gestureMgr;"start"===c&&d.clear();var e=d.recognize(b,a.handler.findHover(b.zrX,b.zrY,null),a.dom);if("end"===c&&d.clear(),e){var f=e.type;b.gestureEvent=f,a.handler.dispatchToElement(e.target,f,e.event)}}function d(a){a._touching=!0,clearTimeout(a._touchTimer),a._touchTimer=setTimeout(function(){a._touching=!1},700)}function e(a){var b=a.pointerType;return"pen"===b||"touch"===b}function f(a){function b(a,b){return function(){if(!b._touching)return a.apply(b,arguments)}}i.each(r,function(b){a._handlers[b]=i.bind(u[b],a)}),i.each(t,function(b){a._handlers[b]=i.bind(u[b],a)}),i.each(q,function(c){a._handlers[c]=b(u[c],a)})}function g(a){function c(c,d){i.each(c,function(c){m(a,b(c),d._handlers[c])},d)}j.call(this),this.dom=a,this._touching=!1,this._touchTimer,this._gestureMgr=new l,this._handlers={},f(this),k.pointerEventsSupported?c(t,this):(k.touchEventsSupported&&c(r,this),c(q,this))}var h=a("../core/event"),i=a("../core/util"),j=a("../mixin/Eventful"),k=a("../core/env"),l=a("../core/GestureMgr"),m=h.addEventListener,n=h.removeEventListener,o=h.normalizeEvent,p=300,q=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],r=["touchstart","touchend","touchmove"],s={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},t=i.map(q,function(a){var b=a.replace("mouse","pointer");return s[b]?b:a}),u={mousemove:function(a){a=o(this.dom,a),this.trigger("mousemove",a)},mouseout:function(a){a=o(this.dom,a);var b=a.toElement||a.relatedTarget;if(b!=this.dom)for(;b&&9!=b.nodeType;){if(b===this.dom)return;b=b.parentNode}this.trigger("mouseout",a)},touchstart:function(a){a=o(this.dom,a),a.zrByTouch=!0,this._lastTouchMoment=new Date,c(this,a,"start"),u.mousemove.call(this,a),u.mousedown.call(this,a),d(this)},touchmove:function(a){a=o(this.dom,a),a.zrByTouch=!0,c(this,a,"change"),u.mousemove.call(this,a),d(this)},touchend:function(a){a=o(this.dom,a),a.zrByTouch=!0,c(this,a,"end"),u.mouseup.call(this,a),+new Date-this._lastTouchMoment<p&&u.click.call(this,a),d(this)},pointerdown:function(a){u.mousedown.call(this,a)},pointermove:function(a){e(a)||u.mousemove.call(this,a)},pointerup:function(a){u.mouseup.call(this,a)},pointerout:function(a){e(a)||u.mouseout.call(this,a)}};i.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(a){u[a]=function(b){b=o(this.dom,b),this.trigger(a,b)}});var v=g.prototype;return v.dispose=function(){for(var a=q.concat(r),c=0;c<a.length;c++){var d=a[c];n(this.dom,b(d),this._handlers[d])}},v.setCursor=function(a){this.dom.style.cursor=a||"default"},i.mixin(g,j),g}),define("zrender/graphic/Style",["require"],function(a){function b(a,b,c){var d=b.x,e=b.x2,f=b.y,g=b.y2;b.global||(d=d*c.width+c.x,e=e*c.width+c.x,f=f*c.height+c.y,g=g*c.height+c.y);var h=a.createLinearGradient(d,f,e,g);return h}function c(a,b,c){var d=c.width,e=c.height,f=Math.min(d,e),g=b.x,h=b.y,i=b.r;b.global||(g=g*d+c.x,h=h*e+c.y,i*=f);var j=a.createRadialGradient(g,h,0,g,h,i);return j}var d=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],e=function(a){this.extendFrom(a)};e.prototype={constructor:e,fill:"#000000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,textFill:"#000",textStroke:null,textPosition:"inside",textOffset:null,textBaseline:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textTransform:!1,textRotation:0,blend:null,bind:function(a,b,c){for(var e=this,f=c&&c.style,g=!f,h=0;h<d.length;h++){var i=d[h],j=i[0];(g||e[j]!==f[j])&&(a[j]=e[j]||i[1])}if((g||e.fill!==f.fill)&&(a.fillStyle=e.fill),(g||e.stroke!==f.stroke)&&(a.strokeStyle=e.stroke),(g||e.opacity!==f.opacity)&&(a.globalAlpha=null==e.opacity?1:e.opacity),(g||e.blend!==f.blend)&&(a.globalCompositeOperation=e.blend||"source-over"),this.hasStroke()){var k=e.lineWidth;a.lineWidth=k/(this.strokeNoScale&&b&&b.getLineScale?b.getLineScale():1)}},hasFill:function(){var a=this.fill;return null!=a&&"none"!==a},hasStroke:function(){var a=this.stroke;return null!=a&&"none"!==a&&this.lineWidth>0},extendFrom:function(a,b){if(a){var c=this;for(var d in a)!a.hasOwnProperty(d)||!b&&c.hasOwnProperty(d)||(c[d]=a[d])}},set:function(a,b){"string"==typeof a?this[a]=b:this.extendFrom(a,!0)},clone:function(){var a=new this.constructor;return a.extendFrom(this,!0),a},getGradient:function(a,d,e){for(var f="radial"===d.type?c:b,g=f(a,d,e),h=d.colorStops,i=0;i<h.length;i++)g.addColorStop(h[i].offset,h[i].color);return g}};for(var f=e.prototype,g=0;g<d.length;g++){var h=d[g];h[0]in f||(f[h[0]]=h[1])}return e.getGradient=f.getGradient,e}),define("zrender/graphic/Pattern",["require"],function(a){var b=function(a,b){this.image=a,this.repeat=b,this.type="pattern"};return b.prototype.getCanvasPattern=function(a){return this._canvasPattern||(this._canvasPattern=a.createPattern(this.image,this.repeat))},b}),define("zrender/Layer",["require","./core/util","./config","./graphic/Style","./graphic/Pattern"],function(a){function b(){return!1}function c(a,b,c,d){var e=document.createElement(b),f=c.getWidth(),g=c.getHeight(),h=e.style;return h.position="absolute",h.left=0,h.top=0,h.width=f+"px",h.height=g+"px",e.width=f*d,e.height=g*d,e.setAttribute("data-zr-dom-id",a),e}var d=a("./core/util"),e=a("./config"),f=a("./graphic/Style"),g=a("./graphic/Pattern"),h=function(a,f,g){var h;g=g||e.devicePixelRatio,"string"==typeof a?h=c(a,"canvas",f,g):d.isObject(a)&&(h=a,a=h.id),this.id=a,this.dom=h;var i=h.style;i&&(h.onselectstart=b,i["-webkit-user-select"]="none",i["user-select"]="none",i["-webkit-touch-callout"]="none",i["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",i.padding=0,i.margin=0,i["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=f,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=g};return h.prototype={constructor:h,elCount:0,__dirty:!0,initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},createBackBuffer:function(){var a=this.dpr;this.domBack=c("back-"+this.id,"canvas",this.painter,a),this.ctxBack=this.domBack.getContext("2d"),1!=a&&this.ctxBack.scale(a,a)},resize:function(a,b){var c=this.dpr,d=this.dom,e=d.style,f=this.domBack;e.width=a+"px",e.height=b+"px",d.width=a*c,d.height=b*c,f&&(f.width=a*c,f.height=b*c,1!=c&&this.ctxBack.scale(c,c))},clear:function(a){var b=this.dom,c=this.ctx,d=b.width,e=b.height,h=this.clearColor,i=this.motionBlur&&!a,j=this.lastFrameAlpha,k=this.dpr;if(i&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(b,0,0,d/k,e/k)),c.clearRect(0,0,d,e),h){var l;h.colorStops?(l=h.__canvasGradient||f.getGradient(c,h,{x:0,y:0,width:d,height:e}),h.__canvasGradient=l):h.image&&(l=g.prototype.getCanvasPattern.call(h,c)),c.save(),c.fillStyle=l||h,c.fillRect(0,0,d,e),c.restore()}if(i){var m=this.domBack;c.save(),c.globalAlpha=j,c.drawImage(m,0,0,d,e),c.restore()}}},h}),define("zrender/contain/text",["require","../core/util","../core/BoundingRect"],function(a){function b(a,b){var c=a+":"+b;if(g[c])return g[c];for(var d=(a+"").split("\n"),e=0,f=0,j=d.length;f<j;f++)e=Math.max(m.measureText(d[f],b).width,e);return h>i&&(h=0,g={}),h++,g[c]=e,e}function c(a,c,d,e){var f=((a||"")+"").split("\n").length,g=b(a,c),h=b("国",c),i=f*h,j=new k(0,0,g,i);switch(j.lineHeight=h,e){case"bottom":case"alphabetic":j.y-=h;break;case"middle":j.y-=h/2}switch(d){case"end":case"right":j.x-=j.width;break;case"center":j.x-=j.width/2}return j}function d(a,b,c,d){var e=b.x,f=b.y,g=b.height,h=b.width,i=c.height,j=g/2-i/2,k="left";switch(a){case"left":e-=d,f+=j,k="right";break;case"right":e+=d+h,f+=j,k="left";break;case"top":e+=h/2,f-=d+i,k="center";break;case"bottom":e+=h/2,f+=g+d,k="center";break;case"inside":e+=h/2,f+=j,k="center";break;case"insideLeft":e+=d,f+=j,k="left";break;case"insideRight":e+=h-d,f+=j,k="right";break;case"insideTop":e+=h/2,f+=d,k="center";break;case"insideBottom":e+=h/2,f+=g-i-d,k="center";break;case"insideTopLeft":e+=d,f+=d,k="left";break;case"insideTopRight":e+=h-d,f+=d,k="right";break;case"insideBottomLeft":e+=d,f+=g-i-d;break;case"insideBottomRight":e+=h-d,f+=g-i-d,k="right"}return{x:e,y:f,textAlign:k,textBaseline:"top"}}function e(a,c,d,e,g){if(!c)return"";g=g||{},e=l(e,"...");for(var h=l(g.maxIterations,2),i=l(g.minChar,0),j=b("国",d),k=b("a",d),m=l(g.placeholder,""),n=c=Math.max(0,c-1),o=0;o<i&&n>=k;o++)n-=k;var p=b(e);p>n&&(e="",p=0),n=c-p;for(var q=(a+"").split("\n"),o=0,r=q.length;o<r;o++){var s=q[o],t=b(s,d);if(!(t<=c)){for(var u=0;;u++){if(t<=n||u>=h){s+=e;break}var v=0===u?f(s,n,k,j):t>0?Math.floor(s.length*n/t):0;s=s.substr(0,v),t=b(s,d)}""===s&&(s=m),q[o]=s}}return q.join("\n")}function f(a,b,c,d){for(var e=0,f=0,g=a.length;f<g&&e<b;f++){var h=a.charCodeAt(f);e+=0<=h&&h<=127?c:d}return f}var g={},h=0,i=5e3,j=a("../core/util"),k=a("../core/BoundingRect"),l=j.retrieve,m={getWidth:b,getBoundingRect:c,adjustTextPositionOnRect:d,truncateText:e,measureText:function(a,b){var c=j.getContext();return c.font=b||"12px sans-serif",c.measureText(a)}};return m}),define("zrender/graphic/mixin/RectText",["require","../../contain/text","../../core/BoundingRect"],function(a){function b(a,b){return"string"==typeof a?a.lastIndexOf("%")>=0?parseFloat(a)/100*b:parseFloat(a):a}var c=a("../../contain/text"),d=a("../../core/BoundingRect"),e=new d,f=function(){};return f.prototype={constructor:f,drawRectText:function(a,d,f){var g=this.style,h=g.text;if(null!=h&&(h+=""),h){a.save();var i,j,k=g.textPosition,l=g.textOffset,m=g.textDistance,n=g.textAlign,o=g.textFont||g.font,p=g.textBaseline,q=g.textVerticalAlign;f=f||c.getBoundingRect(h,o,n,p);var r=this.transform;if(g.textTransform?this.setTransform(a):r&&(e.copy(d),e.applyTransform(r),d=e),k instanceof Array){if(i=d.x+b(k[0],d.width),j=d.y+b(k[1],d.height),n=n||"left",p=p||"top",q){switch(q){case"middle":j-=f.height/2-f.lineHeight/2;break;case"bottom":j-=f.height-f.lineHeight/2;break;default:j+=f.lineHeight/2}p="middle"}}else{var s=c.adjustTextPositionOnRect(k,d,f,m);i=s.x,j=s.y,n=n||s.textAlign,p=p||s.textBaseline}l&&(i+=l[0],j+=l[1]),a.textAlign=n||"left",a.textBaseline=p||"alphabetic";var t=g.textFill,u=g.textStroke;t&&(a.fillStyle=t),u&&(a.strokeStyle=u),a.font=o||"12px sans-serif",a.shadowBlur=g.textShadowBlur,a.shadowColor=g.textShadowColor||"transparent",a.shadowOffsetX=g.textShadowOffsetX,a.shadowOffsetY=g.textShadowOffsetY;var v=h.split("\n");g.textRotation&&(r&&a.translate(r[4],r[5]),a.rotate(g.textRotation),r&&a.translate(-r[4],-r[5]));for(var w=0;w<v.length;w++)t&&a.fillText(v[w],i,j),u&&a.strokeText(v[w],i,j),j+=f.lineHeight;a.restore()}}},f}),define("zrender/graphic/Displayable",["require","../core/util","./Style","../Element","./mixin/RectText"],function(a){function b(a){a=a||{},e.call(this,a);for(var b in a)a.hasOwnProperty(b)&&"style"!==b&&(this[b]=a[b]);this.style=new d(a.style),this._rect=null,this.__clipPaths=[]}var c=a("../core/util"),d=a("./Style"),e=a("../Element"),f=a("./mixin/RectText");return b.prototype={constructor:b,type:"displayable",__dirty:!0,invisible:!1,z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:-1,beforeBrush:function(a){},afterBrush:function(a){},brush:function(a,b){},getBoundingRect:function(){},contain:function(a,b){return this.rectContain(a,b)},traverse:function(a,b){a.call(b,this)},rectContain:function(a,b){var c=this.transformCoordToLocal(a,b),d=this.getBoundingRect();return d.contain(c[0],c[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(a){return this.animate("style",a)},attrKV:function(a,b){"style"!==a?e.prototype.attrKV.call(this,a,b):this.style.set(b)},setStyle:function(a,b){return this.style.set(a,b),this.dirty(!1),this},useStyle:function(a){return this.style=new d(a),this.dirty(!1),this}},c.inherits(b,e),c.mixin(b,f),b}),define("zrender/core/LRU",["require"],function(a){var b=function(){this.head=null,this.tail=null,this._len=0},c=b.prototype;c.insert=function(a){var b=new d(a);return this.insertEntry(b),b},c.insertEntry=function(a){this.head?(this.tail.next=a,a.prev=this.tail,this.tail=a):this.head=this.tail=a,this._len++},c.remove=function(a){var b=a.prev,c=a.next;b?b.next=c:this.head=c,c?c.prev=b:this.tail=b,a.next=a.prev=null,this._len--},c.len=function(){return this._len};var d=function(a){this.value=a,this.next,this.prev},e=function(a){this._list=new b,this._map={},this._maxSize=a||10},f=e.prototype;return f.put=function(a,b){var c=this._list,d=this._map;if(null==d[a]){var e=c.len();if(e>=this._maxSize&&e>0){var f=c.head;c.remove(f),delete d[f.key]}var g=c.insert(b);g.key=a,d[a]=g}},f.get=function(a){var b=this._map[a],c=this._list;if(null!=b)return b!==c.tail&&(c.remove(b),c.insertEntry(b)),b.value},f.clear=function(){this._list.clear(),this._map={}},e}),define("zrender/graphic/Image",["require","./Displayable","../core/BoundingRect","../core/util","../core/LRU"],function(a){function b(a){c.call(this,a)}var c=a("./Displayable"),d=a("../core/BoundingRect"),e=a("../core/util"),f=a("../core/LRU"),g=new f(50);return b.prototype={constructor:b,type:"image",brush:function(a,b){var c,d=this.style,e=d.image;if(d.bind(a,this,b),c="string"==typeof e?this._image:e,!c&&e){var f=g.get(e);if(!f)return c=new Image,c.onload=function(){c.onload=null;for(var a=0;a<f.pending.length;a++)f.pending[a].dirty()},f={image:c,pending:[this]},c.src=e,g.put(e,f),void(this._image=c);if(c=f.image,this._image=c,!c.width||!c.height)return void f.pending.push(this)}if(c){var h=d.x||0,i=d.y||0;if(!c.width||!c.height)return;var j=d.width,k=d.height,l=c.width/c.height;if(null==j&&null!=k?j=k*l:null==k&&null!=j?k=j/l:null==j&&null==k&&(j=c.width,k=c.height),this.setTransform(a),d.sWidth&&d.sHeight){var m=d.sx||0,n=d.sy||0;a.drawImage(c,m,n,d.sWidth,d.sHeight,h,i,j,k)}else if(d.sx&&d.sy){var m=d.sx,n=d.sy,o=j-m,p=k-n;a.drawImage(c,m,n,o,p,h,i,j,k)}else a.drawImage(c,h,i,j,k);this.restoreTransform(a),null!=d.text&&this.drawRectText(a,this.getBoundingRect())}},getBoundingRect:function(){var a=this.style;return this._rect||(this._rect=new d(a.x||0,a.y||0,a.width||0,a.height||0)),this._rect}},e.inherits(b,c),b}),define("zrender/Painter",["require","./config","./core/util","./core/log","./core/BoundingRect","./core/timsort","./Layer","./animation/requestAnimationFrame","./graphic/Image"],function(a){function b(a){return parseInt(a,10)}function c(a){return!!a&&(!!a.isBuildin||"function"==typeof a.resize&&"function"==typeof a.refresh)}function d(a){a.__unusedCount++}function e(a){1==a.__unusedCount&&a.clear()}function f(a,b,c){return r.copy(a.getBoundingRect()),a.transform&&r.applyTransform(a.transform),s.width=b,s.height=c,!r.intersect(s)}function g(a,b){if(a==b)return!1;if(!a||!b||a.length!==b.length)return!0;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!0}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.path;d.setTransform(b),e.beginPath(b),d.buildPath(e,d.shape),b.clip(),d.restoreTransform(b)}}function i(a,b){var c=document.createElement("div");return c.style.cssText=["position:relative","overflow:hidden","width:"+a+"px","height:"+b+"px","padding:0","margin:0","border-width:0"].join(";")+";",c}var j=a("./config"),k=a("./core/util"),l=a("./core/log"),m=a("./core/BoundingRect"),n=a("./core/timsort"),o=a("./Layer"),p=a("./animation/requestAnimationFrame"),q=5,r=new m(0,0,0,0),s=new m(0,0,0,0),t=function(a,b,c){var d=!a.nodeName||"CANVAS"===a.nodeName.toUpperCase();this._opts=c=k.extend({},c||{}),this.dpr=c.devicePixelRatio||j.devicePixelRatio,this._singleCanvas=d,this.root=a;var e=a.style;e&&(e["-webkit-tap-highlight-color"]="transparent",e["-webkit-user-select"]=e["user-select"]=e["-webkit-touch-callout"]="none",a.innerHTML=""),this.storage=b;var f=this._zlevelList=[],g=this._layers={};if(this._layerConfig={},d){var h=a.width,l=a.height;
this._width=h,this._height=l;var m=new o(a,this,1);m.initContext(),g[0]=m,f.push(0),this._domRoot=a}else{this._width=this._getSize(0),this._height=this._getSize(1);var n=this._domRoot=i(this._width,this._height);a.appendChild(n)}this.pathToImage=this._createPathToImage(),this._progressiveLayers=[],this._hoverlayer,this._hoverElements=[]};return t.prototype={constructor:t,isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},refresh:function(a){var b=this.storage.getDisplayList(!0),c=this._zlevelList;this._paintList(b,a);for(var d=0;d<c.length;d++){var e=c[d],f=this._layers[e];!f.isBuildin&&f.refresh&&f.refresh()}return this.refreshHover(),this._progressiveLayers.length&&this._startProgessive(),this},addHover:function(a,b){if(!a.__hoverMir){var c=new a.constructor({style:a.style,shape:a.shape});c.__from=a,a.__hoverMir=c,c.setStyle(b),this._hoverElements.push(c)}},removeHover:function(a){var b=a.__hoverMir,c=this._hoverElements,d=k.indexOf(c,b);d>=0&&c.splice(d,1),a.__hoverMir=null},clearHover:function(a){for(var b=this._hoverElements,c=0;c<b.length;c++){var d=b[c].__from;d&&(d.__hoverMir=null)}b.length=0},refreshHover:function(){var a=this._hoverElements,b=a.length,c=this._hoverlayer;if(c&&c.clear(),b){n(a,this.storage.displayableSortFunc),c||(c=this._hoverlayer=this.getLayer(1e5));var d={};c.ctx.save();for(var e=0;e<b;){var f=a[e],g=f.__from;g&&g.__zr?(e++,g.invisible||(f.transform=g.transform,f.invTransform=g.invTransform,f.__clipPaths=g.__clipPaths,this._doPaintEl(f,c,!0,d))):(a.splice(e,1),g.__hoverMir=null,b--)}c.ctx.restore()}},_startProgessive:function(){function a(){c===b._progressiveToken&&b.storage&&(b._doPaintList(b.storage.getDisplayList()),b._furtherProgressive?(b._progress++,p(a)):b._progressiveToken=-1)}var b=this;if(b._furtherProgressive){var c=b._progressiveToken=+new Date;b._progress++,p(a)}},_clearProgressive:function(){this._progressiveToken=-1,this._progress=0,k.each(this._progressiveLayers,function(a){a.__dirty&&a.clear()})},_paintList:function(a,b){null==b&&(b=!1),this._updateLayerStatus(a),this._clearProgressive(),this.eachBuildinLayer(d),this._doPaintList(a,b),this.eachBuildinLayer(e)},_doPaintList:function(a,b){function c(a){var b=f.dpr||1;f.save(),f.globalAlpha=1,f.shadowBlur=0,d.__dirty=!0,f.setTransform(1,0,0,1,0,0),f.drawImage(a.dom,0,0,m*b,n*b),f.restore()}for(var d,e,f,g,h,i,j=0,m=this._width,n=this._height,o=this._progress,p=0,r=a.length;p<r;p++){var s=a[p],t=this._singleCanvas?0:s.zlevel,u=s.__frame;if(u<0&&h&&(c(h),h=null),e!==t&&(f&&f.restore(),g={},e=t,d=this.getLayer(e),d.isBuildin||l("ZLevel "+e+" has been used by unkown layer "+d.id),f=d.ctx,f.save(),d.__unusedCount=0,(d.__dirty||b)&&d.clear()),d.__dirty||b){if(u>=0){if(!h){if(h=this._progressiveLayers[Math.min(j++,q-1)],h.ctx.save(),h.renderScope={},h&&h.__progress>h.__maxProgress){p=h.__nextIdxNotProg-1;continue}i=h.__progress,h.__dirty||(o=i),h.__progress=o+1}u===o&&this._doPaintEl(s,h,!0,h.renderScope)}else this._doPaintEl(s,d,b,g);s.__dirty=!1}}h&&c(h),f&&f.restore(),this._furtherProgressive=!1,k.each(this._progressiveLayers,function(a){a.__maxProgress>=a.__progress&&(this._furtherProgressive=!0)},this)},_doPaintEl:function(a,b,c,d){var e=b.ctx,i=a.transform;if((b.__dirty||c)&&!a.invisible&&0!==a.style.opacity&&(!i||i[0]||i[3])&&(!a.culling||!f(a,this._width,this._height))){var j=a.__clipPaths;(d.prevClipLayer!==b||g(j,d.prevElClipPaths))&&(d.prevElClipPaths&&(d.prevClipLayer.ctx.restore(),d.prevClipLayer=d.prevElClipPaths=null,d.prevEl=null),j&&(e.save(),h(j,e),d.prevClipLayer=b,d.prevElClipPaths=j)),a.beforeBrush&&a.beforeBrush(e),a.brush(e,d.prevEl||null),d.prevEl=a,a.afterBrush&&a.afterBrush(e)}},getLayer:function(a){if(this._singleCanvas)return this._layers[0];var b=this._layers[a];return b||(b=new o("zr_"+a,this,this.dpr),b.isBuildin=!0,this._layerConfig[a]&&k.merge(b,this._layerConfig[a],!0),this.insertLayer(a,b),b.initContext()),b},insertLayer:function(a,b){var d=this._layers,e=this._zlevelList,f=e.length,g=null,h=-1,i=this._domRoot;if(d[a])return void l("ZLevel "+a+" has been used already");if(!c(b))return void l("Layer of zlevel "+a+" is not valid");if(f>0&&a>e[0]){for(h=0;h<f-1&&!(e[h]<a&&e[h+1]>a);h++);g=d[e[h]]}if(e.splice(h+1,0,a),g){var j=g.dom;j.nextSibling?i.insertBefore(b.dom,j.nextSibling):i.appendChild(b.dom)}else i.firstChild?i.insertBefore(b.dom,i.firstChild):i.appendChild(b.dom);d[a]=b},eachLayer:function(a,b){var c,d,e=this._zlevelList;for(d=0;d<e.length;d++)c=e[d],a.call(b,this._layers[c],c)},eachBuildinLayer:function(a,b){var c,d,e,f=this._zlevelList;for(e=0;e<f.length;e++)d=f[e],c=this._layers[d],c.isBuildin&&a.call(b,c,d)},eachOtherLayer:function(a,b){var c,d,e,f=this._zlevelList;for(e=0;e<f.length;e++)d=f[e],c=this._layers[d],c.isBuildin||a.call(b,c,d)},getLayers:function(){return this._layers},_updateLayerStatus:function(a){var b=this._layers,c=this._progressiveLayers,d={},e={};this.eachBuildinLayer(function(a,b){d[b]=a.elCount,a.elCount=0,a.__dirty=!1}),k.each(c,function(a,b){e[b]=a.elCount,a.elCount=0,a.__dirty=!1});for(var f,g,h=0,i=0,j=0,l=a.length;j<l;j++){var m=a[j],n=this._singleCanvas?0:m.zlevel,p=b[n],r=m.progressive;if(p&&(p.elCount++,p.__dirty=p.__dirty||m.__dirty),r>=0){g!==r&&(g=r,i++);var s=m.__frame=i-1;if(!f){var t=Math.min(h,q-1);f=c[t],f||(f=c[t]=new o("progressive",this,this.dpr),f.initContext()),f.__maxProgress=0}f.__dirty=f.__dirty||m.__dirty,f.elCount++,f.__maxProgress=Math.max(f.__maxProgress,s),f.__maxProgress>=f.__progress&&(p.__dirty=!0)}else m.__frame=-1,f&&(f.__nextIdxNotProg=j,h++,f=null)}f&&(h++,f.__nextIdxNotProg=j),this.eachBuildinLayer(function(a,b){d[b]!==a.elCount&&(a.__dirty=!0)}),c.length=Math.min(h,q),k.each(c,function(a,b){e[b]!==a.elCount&&(m.__dirty=!0),a.__dirty&&(a.__progress=0)})},clear:function(){return this.eachBuildinLayer(this._clearLayer),this},_clearLayer:function(a){a.clear()},configLayer:function(a,b){if(b){var c=this._layerConfig;c[a]?k.merge(c[a],b,!0):c[a]=b;var d=this._layers[a];d&&k.merge(d,c[a],!0)}},delLayer:function(a){var b=this._layers,c=this._zlevelList,d=b[a];d&&(d.dom.parentNode.removeChild(d.dom),delete b[a],c.splice(k.indexOf(c,a),1))},resize:function(a,b){var c=this._domRoot;c.style.display="none";var d=this._opts;if(null!=a&&(d.width=a),null!=b&&(d.height=b),a=this._getSize(0),b=this._getSize(1),c.style.display="",this._width!=a||b!=this._height){c.style.width=a+"px",c.style.height=b+"px";for(var e in this._layers)this._layers.hasOwnProperty(e)&&this._layers[e].resize(a,b);k.each(this._progressiveLayers,function(c){c.resize(a,b)}),this.refresh(!0)}return this._width=a,this._height=b,this},clearLayer:function(a){var b=this._layers[a];b&&b.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(a){if(a=a||{},this._singleCanvas)return this._layers[0].dom;var b=new o("image",this,a.pixelRatio||this.dpr);b.initContext(),b.clearColor=a.backgroundColor,b.clear();for(var c=this.storage.getDisplayList(!0),d={},e=0;e<c.length;e++){var f=c[e];this._doPaintEl(f,b,!0,d)}return b.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(a){var c=this._opts,d=["width","height"][a],e=["clientWidth","clientHeight"][a],f=["paddingLeft","paddingTop"][a],g=["paddingRight","paddingBottom"][a];if(null!=c[d]&&"auto"!==c[d])return parseFloat(c[d]);var h=this.root,i=document.defaultView.getComputedStyle(h);return(h[e]||b(i[d])||b(h.style[d]))-(b(i[f])||0)-(b(i[g])||0)|0},_pathToImage:function(b,c,d,e,f){var g=document.createElement("canvas"),h=g.getContext("2d");g.width=d*f,g.height=e*f,h.clearRect(0,0,d*f,e*f);var i={position:c.position,rotation:c.rotation,scale:c.scale};c.position=[0,0,0],c.rotation=0,c.scale=[1,1],c&&c.brush(h);var j=a("./graphic/Image"),k=new j({id:b,style:{x:0,y:0,image:g}});return null!=i.position&&(k.position=c.position=i.position),null!=i.rotation&&(k.rotation=c.rotation=i.rotation),null!=i.scale&&(k.scale=c.scale=i.scale),k},_createPathToImage:function(){var a=this;return function(b,c,d,e){return a._pathToImage(b,c,d,e,a.dpr)}}},t}),define("zrender/zrender",["require","./core/guid","./core/env","./core/util","./Handler","./Storage","./animation/Animation","./dom/HandlerProxy","./Painter"],function(a){function b(a){delete l[a]}var c=a("./core/guid"),d=a("./core/env"),e=a("./core/util"),f=a("./Handler"),g=a("./Storage"),h=a("./animation/Animation"),i=a("./dom/HandlerProxy"),j=!d.canvasSupported,k={canvas:a("./Painter")},l={},m={};m.version="3.3.0",m.init=function(a,b){var d=new n(c(),a,b);return l[d.id]=d,d},m.dispose=function(a){if(a)a.dispose();else{for(var b in l)l.hasOwnProperty(b)&&l[b].dispose();l={}}return m},m.getInstance=function(a){return l[a]},m.registerPainter=function(a,b){k[a]=b};var n=function(a,b,c){c=c||{},this.dom=b,this.id=a;var l=this,m=new g,n=c.renderer;if(j){if(!k.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");n="vml"}else n&&k[n]||(n="canvas");var o=new k[n](b,m,c);this.storage=m,this.painter=o;var p=d.node?null:new i(o.getViewportRoot());this.handler=new f(m,o,p,o.root),this.animation=new h({stage:{update:e.bind(this.flush,this)}}),this.animation.start(),this._needsRefresh;var q=m.delFromMap,r=m.addToMap;m.delFromMap=function(a){var b=m.get(a);q.call(m,a),b&&b.removeSelfFromZr(l)},m.addToMap=function(a){r.call(m,a),a.addSelfToZr(l)}};return n.prototype={constructor:n,getId:function(){return this.id},add:function(a){this.storage.addRoot(a),this._needsRefresh=!0},remove:function(a){this.storage.delRoot(a),this._needsRefresh=!0},configLayer:function(a,b){this.painter.configLayer(a,b),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){this._needsRefresh&&this.refreshImmediately(),this._needsRefreshHover&&this.refreshHoverImmediately()},addHover:function(a,b){this.painter.addHover&&(this.painter.addHover(a,b),this.refreshHover())},removeHover:function(a){this.painter.removeHover&&(this.painter.removeHover(a),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(a){a=a||{},this.painter.resize(a.width,a.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(a,b,d){var e=c();return this.painter.pathToImage(e,a,b,d)},setCursorStyle:function(a){this.handler.setCursorStyle(a)},on:function(a,b,c){this.handler.on(a,b,c)},off:function(a,b){this.handler.off(a,b)},trigger:function(a,b){this.handler.trigger(a,b)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,b(this.id)}},m}),define("zrender",["zrender/zrender"],function(a){return a}),define("zrender/graphic/Text",["require","./Displayable","../core/util","../contain/text"],function(a){var b=a("./Displayable"),c=a("../core/util"),d=a("../contain/text"),e=function(a){b.call(this,a)};return e.prototype={constructor:e,type:"text",brush:function(a,b){var c=this.style,e=c.x||0,f=c.y||0,g=c.text;if(null!=g&&(g+=""),c.bind(a,this,b),g){this.setTransform(a);var h,i=c.textAlign,j=c.textFont||c.font;if(c.textVerticalAlign){var k=d.getBoundingRect(g,j,c.textAlign,"top");switch(h="middle",c.textVerticalAlign){case"middle":f-=k.height/2-k.lineHeight/2;break;case"bottom":f-=k.height-k.lineHeight/2;break;default:f+=k.lineHeight/2}}else h=c.textBaseline;a.font=j||"12px sans-serif",a.textAlign=i||"left",a.textAlign!==i&&(a.textAlign="left"),a.textBaseline=h||"alphabetic",a.textBaseline!==h&&(a.textBaseline="alphabetic");for(var l=d.measureText("国",a.font).width,m=g.split("\n"),n=0;n<m.length;n++)c.hasFill()&&a.fillText(m[n],e,f),c.hasStroke()&&a.strokeText(m[n],e,f),f+=l;this.restoreTransform(a)}},getBoundingRect:function(){if(!this._rect){var a=this.style,b=a.textVerticalAlign,c=d.getBoundingRect(a.text+"",a.textFont||a.font,a.textAlign,b?"top":a.textBaseline);switch(b){case"middle":c.y-=c.height/2;break;case"bottom":c.y-=c.height}c.x+=a.x||0,c.y+=a.y||0,this._rect=c}return this._rect}},c.inherits(e,b),e}),define("zrender/graphic/helper/smoothSpline",["require","../../core/vector"],function(a){function b(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}var c=a("../../core/vector");return function(a,d){for(var e=a.length,f=[],g=0,h=1;h<e;h++)g+=c.distance(a[h-1],a[h]);var i=g/2;i=i<e?e:i;for(var h=0;h<i;h++){var j,k,l,m=h/(i-1)*(d?e:e-1),n=Math.floor(m),o=m-n,p=a[n%e];d?(j=a[(n-1+e)%e],k=a[(n+1)%e],l=a[(n+2)%e]):(j=a[0===n?n:n-1],k=a[n>e-2?e-1:n+1],l=a[n>e-3?e-1:n+2]);var q=o*o,r=o*q;f.push([b(j[0],p[0],k[0],l[0],o,q,r),b(j[1],p[1],k[1],l[1],o,q,r)])}return f}}),define("zrender/graphic/helper/smoothBezier",["require","../../core/vector"],function(a){var b=a("../../core/vector"),c=b.min,d=b.max,e=b.scale,f=b.distance,g=b.add;return function(a,h,i,j){var k,l,m,n,o=[],p=[],q=[],r=[];if(j){m=[1/0,1/0],n=[-(1/0),-(1/0)];for(var s=0,t=a.length;s<t;s++)c(m,m,a[s]),d(n,n,a[s]);c(m,m,j[0]),d(n,n,j[1])}for(var s=0,t=a.length;s<t;s++){var u=a[s];if(i)k=a[s?s-1:t-1],l=a[(s+1)%t];else{if(0===s||s===t-1){o.push(b.clone(a[s]));continue}k=a[s-1],l=a[s+1]}b.sub(p,l,k),e(p,p,h);var v=f(u,k),w=f(u,l),x=v+w;0!==x&&(v/=x,w/=x),e(q,p,-v),e(r,p,w);var y=g([],u,q),z=g([],u,r);j&&(d(y,y,m),c(y,y,n),d(z,z,m),c(z,z,n)),o.push(y),o.push(z)}return i&&o.push(o.shift()),o}}),define("zrender/graphic/helper/poly",["require","./smoothSpline","./smoothBezier"],function(a){var b=a("./smoothSpline"),c=a("./smoothBezier");return{buildPath:function(a,d,e){var f=d.points,g=d.smooth;if(f&&f.length>=2){if(g&&"spline"!==g){var h=c(f,g,e,d.smoothConstraint);a.moveTo(f[0][0],f[0][1]);for(var i=f.length,j=0;j<(e?i:i-1);j++){var k=h[2*j],l=h[2*j+1],m=f[(j+1)%i];a.bezierCurveTo(k[0],k[1],l[0],l[1],m[0],m[1])}}else{"spline"===g&&(f=b(f,e)),a.moveTo(f[0][0],f[0][1]);for(var j=1,n=f.length;j<n;j++)a.lineTo(f[j][0],f[j][1])}e&&a.closePath()}}}}),define("zrender/core/curve",["require","./vector"],function(a){function b(a){return a>-u&&a<u}function c(a){return a>u||a<-u}function d(a,b,c,d,e){var f=1-e;return f*f*(f*a+3*e*b)+e*e*(e*d+3*f*c)}function e(a,b,c,d,e){var f=1-e;return 3*(((b-a)*f+2*(c-b)*e)*f+(d-c)*e*e)}function f(a,c,d,e,f,g){var h=e+3*(c-d)-a,i=3*(d-2*c+a),j=3*(c-a),k=a-f,l=i*i-3*h*j,m=i*j-9*h*k,n=j*j-3*i*k,o=0;if(b(l)&&b(m))if(b(i))g[0]=0;else{var p=-j/i;p>=0&&p<=1&&(g[o++]=p)}else{var q=m*m-4*l*n;if(b(q)){var r=m/l,p=-i/h+r,u=-r/2;p>=0&&p<=1&&(g[o++]=p),u>=0&&u<=1&&(g[o++]=u)}else if(q>0){var v=t(q),y=l*i+1.5*h*(-m+v),z=l*i+1.5*h*(-m-v);y=y<0?-s(-y,x):s(y,x),z=z<0?-s(-z,x):s(z,x);var p=(-i-(y+z))/(3*h);p>=0&&p<=1&&(g[o++]=p)}else{var A=(2*l*i-3*h*m)/(2*t(l*l*l)),B=Math.acos(A)/3,C=t(l),D=Math.cos(B),p=(-i-2*C*D)/(3*h),u=(-i+C*(D+w*Math.sin(B)))/(3*h),E=(-i+C*(D-w*Math.sin(B)))/(3*h);p>=0&&p<=1&&(g[o++]=p),u>=0&&u<=1&&(g[o++]=u),E>=0&&E<=1&&(g[o++]=E)}}return o}function g(a,d,e,f,g){var h=6*e-12*d+6*a,i=9*d+3*f-3*a-9*e,j=3*d-3*a,k=0;if(b(i)){if(c(h)){var l=-j/h;l>=0&&l<=1&&(g[k++]=l)}}else{var m=h*h-4*i*j;if(b(m))g[0]=-h/(2*i);else if(m>0){var n=t(m),l=(-h+n)/(2*i),o=(-h-n)/(2*i);l>=0&&l<=1&&(g[k++]=l),o>=0&&o<=1&&(g[k++]=o)}}return k}function h(a,b,c,d,e,f){var g=(b-a)*e+a,h=(c-b)*e+b,i=(d-c)*e+c,j=(h-g)*e+g,k=(i-h)*e+h,l=(k-j)*e+j;f[0]=a,f[1]=g,f[2]=j,f[3]=l,f[4]=l,f[5]=k,f[6]=i,f[7]=d}function i(a,b,c,e,f,g,h,i,j,k,l){var m,n,o,p,q,s=.005,u=1/0;y[0]=j,y[1]=k;for(var w=0;w<1;w+=.05)z[0]=d(a,c,f,h,w),z[1]=d(b,e,g,i,w),p=r(y,z),p<u&&(m=w,u=p);u=1/0;for(var x=0;x<32&&!(s<v);x++)n=m-s,o=m+s,z[0]=d(a,c,f,h,n),z[1]=d(b,e,g,i,n),p=r(z,y),n>=0&&p<u?(m=n,u=p):(A[0]=d(a,c,f,h,o),A[1]=d(b,e,g,i,o),q=r(A,y),o<=1&&q<u?(m=o,u=q):s*=.5);return l&&(l[0]=d(a,c,f,h,m),l[1]=d(b,e,g,i,m)),t(u)}function j(a,b,c,d){var e=1-d;return e*(e*a+2*d*b)+d*d*c}function k(a,b,c,d){return 2*((1-d)*(b-a)+d*(c-b))}function l(a,d,e,f,g){var h=a-2*d+e,i=2*(d-a),j=a-f,k=0;if(b(h)){if(c(i)){var l=-j/i;l>=0&&l<=1&&(g[k++]=l)}}else{var m=i*i-4*h*j;if(b(m)){var l=-i/(2*h);l>=0&&l<=1&&(g[k++]=l)}else if(m>0){var n=t(m),l=(-i+n)/(2*h),o=(-i-n)/(2*h);l>=0&&l<=1&&(g[k++]=l),o>=0&&o<=1&&(g[k++]=o)}}return k}function m(a,b,c){var d=a+c-2*b;return 0===d?.5:(a-b)/d}function n(a,b,c,d,e){var f=(b-a)*d+a,g=(c-b)*d+b,h=(g-f)*d+f;e[0]=a,e[1]=f,e[2]=h,e[3]=h,e[4]=g,e[5]=c}function o(a,b,c,d,e,f,g,h,i){var k,l=.005,m=1/0;y[0]=g,y[1]=h;for(var n=0;n<1;n+=.05){z[0]=j(a,c,e,n),z[1]=j(b,d,f,n);var o=r(y,z);o<m&&(k=n,m=o)}m=1/0;for(var p=0;p<32&&!(l<v);p++){var q=k-l,s=k+l;z[0]=j(a,c,e,q),z[1]=j(b,d,f,q);var o=r(z,y);if(q>=0&&o<m)k=q,m=o;else{A[0]=j(a,c,e,s),A[1]=j(b,d,f,s);var u=r(A,y);s<=1&&u<m?(k=s,m=u):l*=.5}}return i&&(i[0]=j(a,c,e,k),i[1]=j(b,d,f,k)),t(m)}var p=a("./vector"),q=p.create,r=p.distSquare,s=Math.pow,t=Math.sqrt,u=1e-8,v=1e-4,w=t(3),x=1/3,y=q(),z=q(),A=q();return{cubicAt:d,cubicDerivativeAt:e,cubicRootAt:f,cubicExtrema:g,cubicSubdivide:h,cubicProjectPoint:i,quadraticAt:j,quadraticDerivativeAt:k,quadraticRootAt:l,quadraticExtremum:m,quadraticSubdivide:n,quadraticProjectPoint:o}}),define("zrender/core/bbox",["require","./vector","./curve"],function(a){var b=a("./vector"),c=a("./curve"),d={},e=Math.min,f=Math.max,g=Math.sin,h=Math.cos,i=b.create(),j=b.create(),k=b.create(),l=2*Math.PI;d.fromPoints=function(a,b,c){if(0!==a.length){var d,g=a[0],h=g[0],i=g[0],j=g[1],k=g[1];for(d=1;d<a.length;d++)g=a[d],h=e(h,g[0]),i=f(i,g[0]),j=e(j,g[1]),k=f(k,g[1]);b[0]=h,b[1]=j,c[0]=i,c[1]=k}},d.fromLine=function(a,b,c,d,g,h){g[0]=e(a,c),g[1]=e(b,d),h[0]=f(a,c),h[1]=f(b,d)};var m=[],n=[];return d.fromCubic=function(a,b,d,g,h,i,j,k,l,o){var p,q=c.cubicExtrema,r=c.cubicAt,s=q(a,d,h,j,m);for(l[0]=1/0,l[1]=1/0,o[0]=-(1/0),o[1]=-(1/0),p=0;p<s;p++){var t=r(a,d,h,j,m[p]);l[0]=e(t,l[0]),o[0]=f(t,o[0])}for(s=q(b,g,i,k,n),p=0;p<s;p++){var u=r(b,g,i,k,n[p]);l[1]=e(u,l[1]),o[1]=f(u,o[1])}l[0]=e(a,l[0]),o[0]=f(a,o[0]),l[0]=e(j,l[0]),o[0]=f(j,o[0]),l[1]=e(b,l[1]),o[1]=f(b,o[1]),l[1]=e(k,l[1]),o[1]=f(k,o[1])},d.fromQuadratic=function(a,b,d,g,h,i,j,k){var l=c.quadraticExtremum,m=c.quadraticAt,n=f(e(l(a,d,h),1),0),o=f(e(l(b,g,i),1),0),p=m(a,d,h,n),q=m(b,g,i,o);j[0]=e(a,h,p),j[1]=e(b,i,q),k[0]=f(a,h,p),k[1]=f(b,i,q)},d.fromArc=function(a,c,d,e,f,m,n,o,p){var q=b.min,r=b.max,s=Math.abs(f-m);if(s%l<1e-4&&s>1e-4)return o[0]=a-d,o[1]=c-e,p[0]=a+d,void(p[1]=c+e);if(i[0]=h(f)*d+a,i[1]=g(f)*e+c,j[0]=h(m)*d+a,j[1]=g(m)*e+c,q(o,i,j),r(p,i,j),f%=l,f<0&&(f+=l),m%=l,m<0&&(m+=l),f>m&&!n?m+=l:f<m&&n&&(f+=l),n){var t=m;m=f,f=t}for(var u=0;u<m;u+=Math.PI/2)u>f&&(k[0]=h(u)*d+a,k[1]=g(u)*e+c,q(o,k,o),r(p,k,p))},d}),define("zrender/core/PathProxy",["require","./curve","./vector","./bbox","./BoundingRect","../config"],function(a){var b=a("./curve"),c=a("./vector"),d=a("./bbox"),e=a("./BoundingRect"),f=a("../config").devicePixelRatio,g={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},h=[],i=[],j=[],k=[],l=Math.min,m=Math.max,n=Math.cos,o=Math.sin,p=Math.sqrt,q=Math.abs,r="undefined"!=typeof Float32Array,s=function(){this.data=[],this._len=0,this._ctx=null,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._ux=0,this._uy=0};return s.prototype={constructor:s,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(a,b){this._ux=q(1/f/a)||0,this._uy=q(1/f/b)||0},getContext:function(){return this._ctx},beginPath:function(a){return this._ctx=a,a&&a.beginPath(),a&&(this.dpr=a.dpr),this._len=0,this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(a,b){return this.addData(g.M,a,b),this._ctx&&this._ctx.moveTo(a,b),this._x0=a,this._y0=b,this._xi=a,this._yi=b,this},lineTo:function(a,b){var c=q(a-this._xi)>this._ux||q(b-this._yi)>this._uy||this._len<5;return this.addData(g.L,a,b),this._ctx&&c&&(this._needsDash()?this._dashedLineTo(a,b):this._ctx.lineTo(a,b)),c&&(this._xi=a,this._yi=b),this},bezierCurveTo:function(a,b,c,d,e,f){return this.addData(g.C,a,b,c,d,e,f),this._ctx&&(this._needsDash()?this._dashedBezierTo(a,b,c,d,e,f):this._ctx.bezierCurveTo(a,b,c,d,e,f)),this._xi=e,this._yi=f,this},quadraticCurveTo:function(a,b,c,d){return this.addData(g.Q,a,b,c,d),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(a,b,c,d):this._ctx.quadraticCurveTo(a,b,c,d)),this._xi=c,this._yi=d,this},arc:function(a,b,c,d,e,f){return this.addData(g.A,a,b,c,c,d,e-d,0,f?0:1),this._ctx&&this._ctx.arc(a,b,c,d,e,f),this._xi=n(e)*c+a,this._yi=o(e)*c+a,this},arcTo:function(a,b,c,d,e){return this._ctx&&this._ctx.arcTo(a,b,c,d,e),this},rect:function(a,b,c,d){return this._ctx&&this._ctx.rect(a,b,c,d),this.addData(g.R,a,b,c,d),this},closePath:function(){this.addData(g.Z);var a=this._ctx,b=this._x0,c=this._y0;return a&&(this._needsDash()&&this._dashedLineTo(b,c),a.closePath()),this._xi=b,this._yi=c,this},fill:function(a){a&&a.fill(),this.toStatic()},stroke:function(a){a&&a.stroke(),this.toStatic()},setLineDash:function(a){if(a instanceof Array){this._lineDash=a,this._dashIdx=0;for(var b=0,c=0;c<a.length;c++)b+=a[c];this._dashSum=b}return this},setLineDashOffset:function(a){return this._dashOffset=a,this},len:function(){return this._len},setData:function(a){var b=a.length;this.data&&this.data.length==b||!r||(this.data=new Float32Array(b));for(var c=0;c<b;c++)this.data[c]=a[c];this._len=b},appendPath:function(a){a instanceof Array||(a=[a]);for(var b=a.length,c=0,d=this._len,e=0;e<b;e++)c+=a[e].len();r&&this.data instanceof Float32Array&&(this.data=new Float32Array(d+c));for(var e=0;e<b;e++)for(var f=a[e].data,g=0;g<f.length;g++)this.data[d++]=f[g];this._len=d},addData:function(a){var b=this.data;this._len+arguments.length>b.length&&(this._expandData(),b=this.data);for(var c=0;c<arguments.length;c++)b[this._len++]=arguments[c];this._prevCmd=a},_expandData:function(){if(!(this.data instanceof Array)){for(var a=[],b=0;b<this._len;b++)a[b]=this.data[b];this.data=a}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(a,b){var c,d,e=this._dashSum,f=this._dashOffset,g=this._lineDash,h=this._ctx,i=this._xi,j=this._yi,k=a-i,n=b-j,o=p(k*k+n*n),q=i,r=j,s=g.length;for(k/=o,n/=o,f<0&&(f=e+f),f%=e,q-=f*k,r-=f*n;k>0&&q<=a||k<0&&q>=a||0==k&&(n>0&&r<=b||n<0&&r>=b);)d=this._dashIdx,c=g[d],q+=k*c,r+=n*c,this._dashIdx=(d+1)%s,k>0&&q<i||k<0&&q>i||n>0&&r<j||n<0&&r>j||h[d%2?"moveTo":"lineTo"](k>=0?l(q,a):m(q,a),n>=0?l(r,b):m(r,b));k=q-a,n=r-b,this._dashOffset=-p(k*k+n*n)},_dashedBezierTo:function(a,c,d,e,f,g){var h,i,j,k,l,m=this._dashSum,n=this._dashOffset,o=this._lineDash,q=this._ctx,r=this._xi,s=this._yi,t=b.cubicAt,u=0,v=this._dashIdx,w=o.length,x=0;for(n<0&&(n=m+n),n%=m,h=0;h<1;h+=.1)i=t(r,a,d,f,h+.1)-t(r,a,d,f,h),j=t(s,c,e,g,h+.1)-t(s,c,e,g,h),u+=p(i*i+j*j);for(;v<w&&(x+=o[v],!(x>n));v++);for(h=(x-n)/u;h<=1;)k=t(r,a,d,f,h),l=t(s,c,e,g,h),v%2?q.moveTo(k,l):q.lineTo(k,l),h+=o[v]/u,v=(v+1)%w;v%2!==0&&q.lineTo(f,g),i=f-k,j=g-l,this._dashOffset=-p(i*i+j*j)},_dashedQuadraticTo:function(a,b,c,d){var e=c,f=d;c=(c+2*a)/3,d=(d+2*b)/3,a=(this._xi+2*a)/3,b=(this._yi+2*b)/3,this._dashedBezierTo(a,b,c,d,e,f)},toStatic:function(){var a=this.data;a instanceof Array&&(a.length=this._len,r&&(this.data=new Float32Array(a)))},getBoundingRect:function(){h[0]=h[1]=j[0]=j[1]=Number.MAX_VALUE,i[0]=i[1]=k[0]=k[1]=-Number.MAX_VALUE;for(var a=this.data,b=0,f=0,l=0,m=0,p=0;p<a.length;){var q=a[p++];switch(1==p&&(b=a[p],f=a[p+1],l=b,m=f),q){case g.M:l=a[p++],m=a[p++],b=l,f=m,j[0]=l,j[1]=m,k[0]=l,k[1]=m;break;case g.L:d.fromLine(b,f,a[p],a[p+1],j,k),b=a[p++],f=a[p++];break;case g.C:d.fromCubic(b,f,a[p++],a[p++],a[p++],a[p++],a[p],a[p+1],j,k),b=a[p++],f=a[p++];break;case g.Q:d.fromQuadratic(b,f,a[p++],a[p++],a[p],a[p+1],j,k),b=a[p++],f=a[p++];break;case g.A:var r=a[p++],s=a[p++],t=a[p++],u=a[p++],v=a[p++],w=a[p++]+v,x=(a[p++],1-a[p++]);1==p&&(l=n(v)*t+r,m=o(v)*u+s),d.fromArc(r,s,t,u,v,w,x,j,k),b=n(w)*t+r,f=o(w)*u+s;break;case g.R:l=b=a[p++],m=f=a[p++];var y=a[p++],z=a[p++];d.fromLine(l,m,l+y,m+z,j,k);break;case g.Z:b=l,f=m}c.min(h,h,j),c.max(i,i,k)}return 0===p&&(h[0]=h[1]=i[0]=i[1]=0),new e(h[0],h[1],i[0]-h[0],i[1]-h[1])},rebuildPath:function(a){for(var b,c,d,e,f,h,i=this.data,j=this._ux,k=this._uy,l=this._len,m=0;m<l;){var p=i[m++];switch(1==m&&(d=i[m],e=i[m+1],b=d,c=e),p){case g.M:b=d=i[m++],c=e=i[m++],a.moveTo(d,e);break;case g.L:f=i[m++],h=i[m++],(q(f-d)>j||q(h-e)>k||m===l-1)&&(a.lineTo(f,h),d=f,e=h);break;case g.C:a.bezierCurveTo(i[m++],i[m++],i[m++],i[m++],i[m++],i[m++]),d=i[m-2],e=i[m-1];break;case g.Q:a.quadraticCurveTo(i[m++],i[m++],i[m++],i[m++]),d=i[m-2],e=i[m-1];break;case g.A:var r=i[m++],s=i[m++],t=i[m++],u=i[m++],v=i[m++],w=i[m++],x=i[m++],y=i[m++],z=t>u?t:u,A=t>u?1:t/u,B=t>u?u/t:1,C=Math.abs(t-u)>.001,D=v+w;C?(a.translate(r,s),a.rotate(x),a.scale(A,B),a.arc(0,0,z,v,D,1-y),a.scale(1/A,1/B),a.rotate(-x),a.translate(-r,-s)):a.arc(r,s,z,v,D,1-y),1==m&&(b=n(v)*t+r,c=o(v)*u+s),d=n(D)*t+r,e=o(D)*u+s;break;case g.R:b=d=i[m],c=e=i[m+1],a.rect(i[m++],i[m++],i[m++],i[m++]);break;case g.Z:a.closePath(),d=b,e=c}}}},s.CMD=g,s}),define("zrender/contain/line",[],function(){return{containStroke:function(a,b,c,d,e,f,g){if(0===e)return!1;var h=e,i=0,j=a;if(g>b+h&&g>d+h||g<b-h&&g<d-h||f>a+h&&f>c+h||f<a-h&&f<c-h)return!1;if(a===c)return Math.abs(f-a)<=h/2;i=(b-d)/(a-c),j=(a*d-c*b)/(a-c);var k=i*f-g+j,l=k*k/(i*i+1);return l<=h/2*h/2}}}),define("zrender/contain/cubic",["require","../core/curve"],function(a){var b=a("../core/curve");return{containStroke:function(a,c,d,e,f,g,h,i,j,k,l){if(0===j)return!1;var m=j;if(l>c+m&&l>e+m&&l>g+m&&l>i+m||l<c-m&&l<e-m&&l<g-m&&l<i-m||k>a+m&&k>d+m&&k>f+m&&k>h+m||k<a-m&&k<d-m&&k<f-m&&k<h-m)return!1;var n=b.cubicProjectPoint(a,c,d,e,f,g,h,i,k,l,null);return n<=m/2}}}),define("zrender/contain/quadratic",["require","../core/curve"],function(a){var b=a("../core/curve");return{containStroke:function(a,c,d,e,f,g,h,i,j){if(0===h)return!1;var k=h;if(j>c+k&&j>e+k&&j>g+k||j<c-k&&j<e-k&&j<g-k||i>a+k&&i>d+k&&i>f+k||i<a-k&&i<d-k&&i<f-k)return!1;var l=b.quadraticProjectPoint(a,c,d,e,f,g,i,j,null);return l<=k/2}}}),define("zrender/contain/util",["require"],function(a){var b=2*Math.PI;return{normalizeRadian:function(a){return a%=b,a<0&&(a+=b),a}}}),define("zrender/contain/arc",["require","./util"],function(a){var b=a("./util").normalizeRadian,c=2*Math.PI;return{containStroke:function(a,d,e,f,g,h,i,j,k){if(0===i)return!1;var l=i;j-=a,k-=d;var m=Math.sqrt(j*j+k*k);if(m-l>e||m+l<e)return!1;if(Math.abs(f-g)%c<1e-4)return!0;if(h){var n=f;f=b(g),g=b(n)}else f=b(f),g=b(g);f>g&&(g+=c);var o=Math.atan2(k,j);return o<0&&(o+=c),o>=f&&o<=g||o+c>=f&&o+c<=g}}}),define("zrender/contain/windingLine",[],function(){return function(a,b,c,d,e,f){if(f>b&&f>d||f<b&&f<d)return 0;if(d===b)return 0;var g=d<b?1:-1,h=(f-b)/(d-b);1!==h&&0!==h||(g=d<b?.5:-.5);var i=h*(c-a)+a;return i>e?g:0}}),define("zrender/contain/path",["require","../core/PathProxy","./line","./cubic","./quadratic","./arc","./util","../core/curve","./windingLine"],function(a){function b(a,b){return Math.abs(a-b)<r}function c(){var a=t[0];t[0]=t[1],t[1]=a}function d(a,b,d,e,f,g,h,i,j,k){if(k>b&&k>e&&k>g&&k>i||k<b&&k<e&&k<g&&k<i)return 0;var l=n.cubicRootAt(b,e,g,i,k,s);if(0===l)return 0;for(var m,o,p=0,q=-1,r=0;r<l;r++){var u=s[r],v=0===u||1===u?.5:1,w=n.cubicAt(a,d,f,h,u);w<j||(q<0&&(q=n.cubicExtrema(b,e,g,i,t),t[1]<t[0]&&q>1&&c(),m=n.cubicAt(b,e,g,i,t[0]),q>1&&(o=n.cubicAt(b,e,g,i,t[1]))),p+=2==q?u<t[0]?m<b?v:-v:u<t[1]?o<m?v:-v:i<o?v:-v:u<t[0]?m<b?v:-v:i<m?v:-v)}return p}function e(a,b,c,d,e,f,g,h){if(h>b&&h>d&&h>f||h<b&&h<d&&h<f)return 0;var i=n.quadraticRootAt(b,d,f,h,s);if(0===i)return 0;var j=n.quadraticExtremum(b,d,f);if(j>=0&&j<=1){for(var k=0,l=n.quadraticAt(b,d,f,j),m=0;m<i;m++){var o=0===s[m]||1===s[m]?.5:1,p=n.quadraticAt(a,c,e,s[m]);p<g||(k+=s[m]<j?l<b?o:-o:f<l?o:-o)}return k}var o=0===s[0]||1===s[0]?.5:1,p=n.quadraticAt(a,c,e,s[0]);return p<g?0:f<b?o:-o}function f(a,b,c,d,e,f,g,h){if(h-=b,h>c||h<-c)return 0;var i=Math.sqrt(c*c-h*h);s[0]=-i,s[1]=i;var j=Math.abs(d-e);if(j<1e-4)return 0;if(j%q<1e-4){d=0,e=q;var k=f?1:-1;return g>=s[0]+a&&g<=s[1]+a?k:0}if(f){var i=d;d=m(e),e=m(i)}else d=m(d),e=m(e);d>e&&(e+=q);for(var l=0,n=0;n<2;n++){var o=s[n];if(o+a>g){var p=Math.atan2(h,o),k=f?1:-1;p<0&&(p=q+p),(p>=d&&p<=e||p+q>=d&&p+q<=e)&&(p>Math.PI/2&&p<1.5*Math.PI&&(k=-k),l+=k)}}return l}function g(a,c,g,i,m){for(var n=0,q=0,r=0,s=0,t=0,u=0;u<a.length;){var v=a[u++];switch(v===h.M&&u>1&&(g||(n+=o(q,r,s,t,i,m))),1==u&&(q=a[u],r=a[u+1],s=q,t=r),v){case h.M:s=a[u++],t=a[u++],q=s,r=t;break;case h.L:if(g){if(p(q,r,a[u],a[u+1],c,i,m))return!0}else n+=o(q,r,a[u],a[u+1],i,m)||0;q=a[u++],r=a[u++];break;case h.C:if(g){if(j.containStroke(q,r,a[u++],a[u++],a[u++],a[u++],a[u],a[u+1],c,i,m))return!0}else n+=d(q,r,a[u++],a[u++],a[u++],a[u++],a[u],a[u+1],i,m)||0;q=a[u++],r=a[u++];break;case h.Q:if(g){if(k.containStroke(q,r,a[u++],a[u++],a[u],a[u+1],c,i,m))return!0}else n+=e(q,r,a[u++],a[u++],a[u],a[u+1],i,m)||0;q=a[u++],r=a[u++];break;case h.A:var w=a[u++],x=a[u++],y=a[u++],z=a[u++],A=a[u++],B=a[u++],C=(a[u++],1-a[u++]),D=Math.cos(A)*y+w,E=Math.sin(A)*z+x;u>1?n+=o(q,r,D,E,i,m):(s=D,t=E);var F=(i-w)*z/y+w;if(g){if(l.containStroke(w,x,z,A,A+B,C,c,F,m))return!0}else n+=f(w,x,z,A,A+B,C,F,m);q=Math.cos(A+B)*y+w,r=Math.sin(A+B)*z+x;break;case h.R:s=q=a[u++],t=r=a[u++];var G=a[u++],H=a[u++],D=s+G,E=t+H;if(g){if(p(s,t,D,t,c,i,m)||p(D,t,D,E,c,i,m)||p(D,E,s,E,c,i,m)||p(s,E,s,t,c,i,m))return!0}else n+=o(D,t,D,E,i,m),n+=o(s,E,s,t,i,m);break;case h.Z:if(g){if(p(q,r,s,t,c,i,m))return!0}else n+=o(q,r,s,t,i,m);q=s,r=t}}return g||b(r,t)||(n+=o(q,r,s,t,i,m)||0),0!==n}var h=a("../core/PathProxy").CMD,i=a("./line"),j=a("./cubic"),k=a("./quadratic"),l=a("./arc"),m=a("./util").normalizeRadian,n=a("../core/curve"),o=a("./windingLine"),p=i.containStroke,q=2*Math.PI,r=1e-4,s=[-1,-1,-1],t=[-1,-1];return{contain:function(a,b,c){return g(a,0,!1,b,c)},containStroke:function(a,b,c,d){return g(a,b,!0,c,d)}}}),define("zrender/graphic/Path",["require","./Displayable","../core/util","../core/PathProxy","../contain/path","./Pattern"],function(a){function b(a){c.call(this,a),this.path=new e}var c=a("./Displayable"),d=a("../core/util"),e=a("../core/PathProxy"),f=a("../contain/path"),g=a("./Pattern"),h=g.prototype.getCanvasPattern,i=Math.abs;return b.prototype={constructor:b,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(a,b){var c=this.style,d=this.path,e=c.hasStroke(),f=c.hasFill(),g=c.fill,i=c.stroke,j=f&&!!g.colorStops,k=e&&!!i.colorStops,l=f&&!!g.image,m=e&&!!i.image;if(c.bind(a,this,b),this.setTransform(a),this.__dirty){var n=this.getBoundingRect();j&&(this._fillGradient=c.getGradient(a,g,n)),k&&(this._strokeGradient=c.getGradient(a,i,n))}j?a.fillStyle=this._fillGradient:l&&(a.fillStyle=h.call(g,a)),k?a.strokeStyle=this._strokeGradient:m&&(a.strokeStyle=h.call(i,a));var o=c.lineDash,p=c.lineDashOffset,q=!!a.setLineDash,r=this.getGlobalScale();d.setScale(r[0],r[1]),this.__dirtyPath||o&&!q&&e?(d=this.path.beginPath(a),o&&!q&&(d.setLineDash(o),d.setLineDashOffset(p)),this.buildPath(d,this.shape,!1),this.__dirtyPath=!1):(a.beginPath(),this.path.rebuildPath(a)),f&&d.fill(a),o&&q&&(a.setLineDash(o),a.lineDashOffset=p),e&&d.stroke(a),o&&q&&a.setLineDash([]),this.restoreTransform(a),null!=c.text&&this.drawRectText(a,this.getBoundingRect())},buildPath:function(a,b,c){},getBoundingRect:function(){var a=this._rect,b=this.style,c=!a;if(c){var d=this.path;this.__dirtyPath&&(d.beginPath(),this.buildPath(d,this.shape,!1)),a=d.getBoundingRect()}if(this._rect=a,b.hasStroke()){var e=this._rectWithStroke||(this._rectWithStroke=a.clone());if(this.__dirty||c){e.copy(a);var f=b.lineWidth,g=b.strokeNoScale?this.getLineScale():1;b.hasFill()||(f=Math.max(f,this.strokeContainThreshold||4)),g>1e-10&&(e.width+=f/g,
e.height+=f/g,e.x-=f/g/2,e.y-=f/g/2)}return e}return a},contain:function(a,b){var c=this.transformCoordToLocal(a,b),d=this.getBoundingRect(),e=this.style;if(a=c[0],b=c[1],d.contain(a,b)){var g=this.path.data;if(e.hasStroke()){var h=e.lineWidth,i=e.strokeNoScale?this.getLineScale():1;if(i>1e-10&&(e.hasFill()||(h=Math.max(h,this.strokeContainThreshold)),f.containStroke(g,h/i,a,b)))return!0}if(e.hasFill())return f.contain(g,a,b)}return!1},dirty:function(a){null==a&&(a=!0),a&&(this.__dirtyPath=a,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(a){return this.animate("shape",a)},attrKV:function(a,b){"shape"===a?(this.setShape(b),this.__dirtyPath=!0,this._rect=null):c.prototype.attrKV.call(this,a,b)},setShape:function(a,b){var c=this.shape;if(c){if(d.isObject(a))for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);else c[a]=b;this.dirty(!0)}return this},getLineScale:function(){var a=this.transform;return a&&i(a[0]-1)>1e-10&&i(a[3]-1)>1e-10?Math.sqrt(i(a[0]*a[3]-a[2]*a[1])):1}},b.extend=function(a){var c=function(c){b.call(this,c),a.style&&this.style.extendFrom(a.style,!1);var d=a.shape;if(d){this.shape=this.shape||{};var e=this.shape;for(var f in d)!e.hasOwnProperty(f)&&d.hasOwnProperty(f)&&(e[f]=d[f])}a.init&&a.init.call(this,c)};d.inherits(c,b);for(var e in a)"style"!==e&&"shape"!==e&&(c.prototype[e]=a[e]);return c},d.inherits(b,c),b}),define("zrender/graphic/shape/Arrowline",["require","../helper/poly","../Path"],function(a){var b=a("../helper/poly");return a("../Path").extend({type:"arrowline",shape:{x1:0,y1:0,x2:0,y2:0,percent:1,arrowlength:10,arrowtype:1,points:[]},style:{stroke:"#000",fill:null},buildPath:function(a,c){var d=c.x1,e=c.y1,f=c.x2,g=c.y2,h=c.percent,i=c.arrowlength;if(0!==h)if(a.moveTo(d,e),h<1&&(f=d*(1-h)+f*h,g=e*(1-h)+g*h),a.lineTo(f,g),1==c.arrowtype);else{var j=[],k=Math.sqrt((f-d)*(f-d)+(g-e)*(g-e)),l=-(g-e)/k,m=(f-d)/k,n=i*(Math.cos(5*Math.PI/6)*m-Math.sin(5*Math.PI/6)*l),o=i*(Math.cos(5*Math.PI/6)*l+Math.sin(5*Math.PI/6)*m),h=1-i*(Math.cos(Math.PI/6)-.5)/k,p=d*(1-h)+f*h,q=e*(1-h)+g*h,r=i*(Math.cos(7*Math.PI/6)*m-Math.sin(7*Math.PI/6)*l),s=i*(Math.cos(7*Math.PI/6)*l+Math.sin(7*Math.PI/6)*m);h=1-h;var t=d*(1-h)+f*h,u=e*(1-h)+g*h;3==c.arrowtype?(j.push([f,g]),j.push([f+n,g-o]),j.push([p,q]),j.push([f+r,g-s]),j.push([f,g])):2==c.arrowtype?(j.push([d,e]),j.push([d-n,e+o]),j.push([t,u]),j.push([d-r,e+s]),j.push([d,e])):4==c.arrowtype&&(j.push([f,g]),j.push([f+n,g-o]),j.push([p,q]),j.push([f+r,g-s]),j.push([f,g]),j.push([d,e]),j.push([d-n,e+o]),j.push([t,u]),j.push([d-r,e+s]),j.push([d,e])),c.points=j,b.buildPath(a,c,!0)}},pointAt:function(a){var b=this.shape;return[b.x1*(1-a)+b.x2*a,b.y1*(1-a)+b.y2*a]}})}),define("zrender/graphic/shape/Rose",["require","../Path"],function(a){var b=Math.sin,c=Math.cos,d=Math.PI/180;return a("../Path").extend({type:"rose",shape:{cx:0,cy:0,r:[],k:0,n:1},style:{stroke:"#000",fill:null},buildPath:function(a,e){var f,g,h,i=e.r,j=e.k,k=e.n,l=e.cx,m=e.cy;a.moveTo(l,m);for(var n=0,o=i.length;n<o;n++){h=i[n];for(var p=0;p<=360*k;p++)f=h*b(j/k*p%360*d)*c(p*d)+l,g=h*b(j/k*p%360*d)*b(p*d)+m,a.lineTo(f,g)}}})}),define("zrender/graphic/shape/Trochoid",["require","../Path"],function(a){var b=Math.cos,c=Math.sin;return a("../Path").extend({type:"trochoid",shape:{cx:0,cy:0,r:0,r0:0,d:0,location:"out"},style:{stroke:"#000",fill:null},buildPath:function(a,d){var e,f,g,h,i=d.r,j=d.r0,k=d.d,l=d.cx,m=d.cy,n="out"==d.location?1:-1;if(!(d.location&&i<=j)){var o,p=0,q=1;e=(i+n*j)*b(0)-n*k*b(0)+l,f=(i+n*j)*c(0)-k*c(0)+m,a.moveTo(e,f);do p++;while(j*p%(i+n*j)!==0);do o=Math.PI/180*q,g=(i+n*j)*b(o)-n*k*b((i/j+n)*o)+l,h=(i+n*j)*c(o)-k*c((i/j+n)*o)+m,a.lineTo(g,h),q++;while(q<=j*p/(i+n*j)*360)}}})}),define("zrender/graphic/shape/Circle",["require","../Path"],function(a){return a("../Path").extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(a,b,c){c&&a.moveTo(b.cx+b.r,b.cy),a.arc(b.cx,b.cy,b.r,0,2*Math.PI,!0)}})}),define("zrender/graphic/shape/Sector",["require","../../core/env","../Path"],function(a){var b=a("../../core/env"),c=a("../Path"),d=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]];return c.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:b.browser.ie&&b.browser.version>=11?function(){var a,b=this.__clipPaths,e=this.style;if(b)for(var f=0;f<b.length;f++){var g=b[f]&&b[f].shape;if(g&&g.startAngle===g.endAngle){for(var h=0;h<d.length;h++)d[h][2]=e[d[h][0]],e[d[h][0]]=d[h][1];a=!0;break}}if(c.prototype.brush.apply(this,arguments),a)for(var h=0;h<d.length;h++)e[d[h][0]]=d[h][2]}:c.prototype.brush,buildPath:function(a,b){var c=b.cx,d=b.cy,e=Math.max(b.r0||0,0),f=Math.max(b.r,0),g=b.startAngle,h=b.endAngle,i=b.clockwise,j=Math.cos(g),k=Math.sin(g);a.moveTo(j*e+c,k*e+d),a.lineTo(j*f+c,k*f+d),a.arc(c,d,f,g,h,!i),a.lineTo(Math.cos(h)*e+c,Math.sin(h)*e+d),0!==e&&a.arc(c,d,e,h,g,i),a.closePath()}})}),define("zrender/graphic/shape/Ring",["require","../Path"],function(a){return a("../Path").extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(a,b){var c=b.cx,d=b.cy,e=2*Math.PI;a.moveTo(c+b.r,d),a.arc(c,d,b.r,0,e,!1),a.moveTo(c+b.r0,d),a.arc(c,d,b.r0,0,e,!0)}})}),define("zrender/graphic/shape/Ellipse",["require","../Path"],function(a){return a("../Path").extend({type:"ellipse",shape:{cx:0,cy:0,rx:0,ry:0},buildPath:function(a,b){var c=.5522848,d=b.cx,e=b.cy,f=b.rx,g=b.ry,h=f*c,i=g*c;a.moveTo(d-f,e),a.bezierCurveTo(d-f,e-i,d-h,e-g,d,e-g),a.bezierCurveTo(d+h,e-g,d+f,e-i,d+f,e),a.bezierCurveTo(d+f,e+i,d+h,e+g,d,e+g),a.bezierCurveTo(d-h,e+g,d-f,e+i,d-f,e),a.closePath()}})}),define("zrender/graphic/helper/roundRect",["require"],function(a){return{buildPath:function(a,b){var c,d,e,f,g=b.x,h=b.y,i=b.width,j=b.height,k=b.r;i<0&&(g+=i,i=-i),j<0&&(h+=j,j=-j),"number"==typeof k?c=d=e=f=k:k instanceof Array?1===k.length?c=d=e=f=k[0]:2===k.length?(c=e=k[0],d=f=k[1]):3===k.length?(c=k[0],d=f=k[1],e=k[2]):(c=k[0],d=k[1],e=k[2],f=k[3]):c=d=e=f=0;var l;c+d>i&&(l=c+d,c*=i/l,d*=i/l),e+f>i&&(l=e+f,e*=i/l,f*=i/l),d+e>j&&(l=d+e,d*=j/l,e*=j/l),c+f>j&&(l=c+f,c*=j/l,f*=j/l),a.moveTo(g+c,h),a.lineTo(g+i-d,h),0!==d&&a.quadraticCurveTo(g+i,h,g+i,h+d),a.lineTo(g+i,h+j-e),0!==e&&a.quadraticCurveTo(g+i,h+j,g+i-e,h+j),a.lineTo(g+f,h+j),0!==f&&a.quadraticCurveTo(g,h+j,g,h+j-f),a.lineTo(g,h+c),0!==c&&a.quadraticCurveTo(g,h,g+c,h)}}}),define("zrender/graphic/shape/Rect",["require","../helper/roundRect","../Path"],function(a){var b=a("../helper/roundRect");return a("../Path").extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(a,c){var d=c.x,e=c.y,f=c.width,g=c.height;c.r?b.buildPath(a,c):a.rect(d,e,f,g),a.closePath()}})}),define("zrender/graphic/shape/Heart",["require","../Path"],function(a){return a("../Path").extend({type:"heart",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(a,b){var c=b.cx,d=b.cy,e=b.width,f=b.height;a.moveTo(c,d),a.bezierCurveTo(c+e/2,d-2*f/3,c+2*e,d+f/3,c,d+f),a.bezierCurveTo(c-2*e,d+f/3,c-e/2,d-2*f/3,c,d)}})}),define("zrender/graphic/shape/Droplet",["require","../Path"],function(a){return a("../Path").extend({type:"droplet",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(a,b){var c=b.cx,d=b.cy,e=b.width,f=b.height;a.moveTo(c,d+e),a.bezierCurveTo(c+e,d+e,c+3*e/2,d-e/3,c,d-f),a.bezierCurveTo(c-3*e/2,d-e/3,c-e,d+e,c,d+e),a.closePath()}})}),define("zrender/graphic/shape/Line",["require","../Path"],function(a){return a("../Path").extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(a,b){var c=b.x1,d=b.y1,e=b.x2,f=b.y2,g=b.percent;0!==g&&(a.moveTo(c,d),g<1&&(e=c*(1-g)+e*g,f=d*(1-g)+f*g),a.lineTo(e,f))},pointAt:function(a){var b=this.shape;return[b.x1*(1-a)+b.x2*a,b.y1*(1-a)+b.y2*a]}})}),define("zrender/graphic/shape/Star",["require","../Path"],function(a){var b=Math.PI,c=Math.cos,d=Math.sin;return a("../Path").extend({type:"star",shape:{cx:0,cy:0,n:3,r0:null,r:0},buildPath:function(a,e){var f=e.n;if(f&&!(f<2)){var g=e.cx,h=e.cy,i=e.r,j=e.r0;null==j&&(j=f>4?i*c(2*b/f)/c(b/f):i/3);var k=b/f,l=-b/2,m=g+i*c(l),n=h+i*d(l);l+=k,a.moveTo(m,n);for(var o,p=0,q=2*f-1;p<q;p++)o=p%2===0?j:i,a.lineTo(g+o*c(l),h+o*d(l)),l+=k;a.closePath()}}})}),define("zrender/graphic/shape/Isogon",["require","../Path"],function(a){var b=Math.PI,c=Math.sin,d=Math.cos;return a("../Path").extend({type:"isogon",shape:{x:0,y:0,r:0,n:0},buildPath:function(a,e){var f=e.n;if(f&&!(f<2)){var g=e.x,h=e.y,i=e.r,j=2*b/f,k=-b/2;a.moveTo(g+i*d(k),h+i*c(k));for(var l=0,m=f-1;l<m;l++)k+=j,a.lineTo(g+i*d(k),h+i*c(k));a.closePath()}}})}),define("zrender/graphic/shape/BezierCurve",["require","../../core/curve","../../core/vector","../Path"],function(a){function b(a,b,c){var d=a.cpx2,e=a.cpy2;return null===d||null===e?[(c?j:h)(a.x1,a.cpx1,a.cpx2,a.x2,b),(c?j:h)(a.y1,a.cpy1,a.cpy2,a.y2,b)]:[(c?i:g)(a.x1,a.cpx1,a.x2,b),(c?i:g)(a.y1,a.cpy1,a.y2,b)]}var c=a("../../core/curve"),d=a("../../core/vector"),e=c.quadraticSubdivide,f=c.cubicSubdivide,g=c.quadraticAt,h=c.cubicAt,i=c.quadraticDerivativeAt,j=c.cubicDerivativeAt,k=[];return a("../Path").extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(a,b){var c=b.x1,d=b.y1,g=b.x2,h=b.y2,i=b.cpx1,j=b.cpy1,l=b.cpx2,m=b.cpy2,n=b.percent;0!==n&&(a.moveTo(c,d),null==l||null==m?(n<1&&(e(c,i,g,n,k),i=k[1],g=k[2],e(d,j,h,n,k),j=k[1],h=k[2]),a.quadraticCurveTo(i,j,g,h)):(n<1&&(f(c,i,l,g,n,k),i=k[1],l=k[2],g=k[3],f(d,j,m,h,n,k),j=k[1],m=k[2],h=k[3]),a.bezierCurveTo(i,j,l,m,g,h)))},pointAt:function(a){return b(this.shape,a,!1)},tangentAt:function(a){var c=b(this.shape,a,!0);return d.normalize(c,c)}})}),define("zrender/graphic/shape/Polyline",["require","../helper/poly","../Path"],function(a){var b=a("../helper/poly");return a("../Path").extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(a,c){b.buildPath(a,c,!1)}})}),define("zrender/graphic/shape/Polygon",["require","../helper/poly","../Path"],function(a){var b=a("../helper/poly");return a("../Path").extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(a,c){b.buildPath(a,c,!0)}})}),define("zrender/graphic/Gradient",["require"],function(a){var b=function(a){this.colorStops=a||[]};return b.prototype={constructor:b,addColorStop:function(a,b){this.colorStops.push({offset:a,color:b})}},b}),define("zrender/vml/core",["require","exports","module","../core/env"],function(a,b,c){if(!a("../core/env").canvasSupported){var d,e="urn:schemas-microsoft-com:vml",f=window,g=f.document,h=!1;try{!g.namespaces.zrvml&&g.namespaces.add("zrvml",e),d=function(a){return g.createElement("<zrvml:"+a+' class="zrvml">')}}catch(a){d=function(a){return g.createElement("<"+a+' xmlns="'+e+'" class="zrvml">')}}var i=function(){if(!h){h=!0;var a=g.styleSheets;a.length<31?g.createStyleSheet().addRule(".zrvml","behavior:url(#default#VML)"):a[0].addRule(".zrvml","behavior:url(#default#VML)")}};c.exports={doc:g,initVML:i,createNode:d}}}),define("zrender/vml/graphic",["require","../core/env","../core/vector","../core/BoundingRect","../core/PathProxy","../tool/color","../contain/text","../graphic/mixin/RectText","../graphic/Displayable","../graphic/Image","../graphic/Text","../graphic/Path","../graphic/Gradient","./core"],function(a){if(!a("../core/env").canvasSupported){var b=a("../core/vector"),c=a("../core/BoundingRect"),d=a("../core/PathProxy").CMD,e=a("../tool/color"),f=a("../contain/text"),g=a("../graphic/mixin/RectText"),h=a("../graphic/Displayable"),i=a("../graphic/Image"),j=a("../graphic/Text"),k=a("../graphic/Path"),l=a("../graphic/Gradient"),m=a("./core"),n=Math.round,o=Math.sqrt,p=Math.abs,q=Math.cos,r=Math.sin,s=Math.max,t=b.applyTransform,u=",",v="progid:DXImageTransform.Microsoft",w=21600,x=w/2,y=1e5,z=1e3,A=function(a){a.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px;",a.coordsize=w+","+w,a.coordorigin="0,0"},B=function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")},C=function(a,b,c){return"rgb("+[a,b,c].join(",")+")"},D=function(a,b){b&&a&&b.parentNode!==a&&a.appendChild(b)},E=function(a,b){b&&a&&b.parentNode===a&&a.removeChild(b)},F=function(a,b,c){return(parseFloat(a)||0)*y+(parseFloat(b)||0)*z+c},G=function(a,b){return"string"==typeof a?a.lastIndexOf("%")>=0?parseFloat(a)/100*b:parseFloat(a):a},H=function(a,b,c){var d=e.parse(b);c=+c,isNaN(c)&&(c=1),d&&(a.color=C(d[0],d[1],d[2]),a.opacity=c*d[3])},I=function(a){var b=e.parse(a);return[C(b[0],b[1],b[2]),b[3]]},J=function(a,b,c){var d=b.fill;if(null!=d)if(d instanceof l){var e,f=0,g=[0,0],h=0,i=1,j=c.getBoundingRect(),k=j.width,m=j.height;if("linear"===d.type){e="gradient";var n=c.transform,o=[d.x*k,d.y*m],p=[d.x2*k,d.y2*m];n&&(t(o,o,n),t(p,p,n));var q=p[0]-o[0],r=p[1]-o[1];f=180*Math.atan2(q,r)/Math.PI,f<0&&(f+=360),f<1e-6&&(f=0)}else{e="gradientradial";var o=[d.x*k,d.y*m],n=c.transform,u=c.scale,v=k,x=m;g=[(o[0]-j.x)/v,(o[1]-j.y)/x],n&&t(o,o,n),v/=u[0]*w,x/=u[1]*w;var y=s(v,x);h=0/y,i=2*d.r/y-h}var z=d.colorStops.slice();z.sort(function(a,b){return a.offset-b.offset});for(var A=z.length,B=[],C=[],D=0;D<A;D++){var E=z[D],F=I(E.color);C.push(E.offset*i+h+" "+F[0]),0!==D&&D!==A-1||B.push(F)}if(A>=2){var G=B[0][0],J=B[1][0],K=B[0][1]*b.opacity,L=B[1][1]*b.opacity;a.type=e,a.method="none",a.focus="100%",a.angle=f,a.color=G,a.color2=J,a.colors=C.join(","),a.opacity=L,a.opacity2=K}"radial"===e&&(a.focusposition=g.join(","))}else H(a,d,b.opacity)},K=function(a,b){null!=b.lineDash&&(a.dashstyle=b.lineDash.join(" ")),null==b.stroke||b.stroke instanceof l||H(a,b.stroke,b.opacity)},L=function(a,b,c,d){var e="fill"==b,f=a.getElementsByTagName(b)[0];null!=c[b]&&"none"!==c[b]&&(e||!e&&c.lineWidth)?(a[e?"filled":"stroked"]="true",c[b]instanceof l&&E(a,f),f||(f=m.createNode(b)),e?J(f,c,d):K(f,c),D(a,f)):(a[e?"filled":"stroked"]="false",E(a,f))},M=[[],[],[]],N=function(a,b){var c,e,f,g,h,i,j=d.M,k=d.C,l=d.L,m=d.A,p=d.Q,s=[];for(g=0;g<a.length;){switch(f=a[g++],e="",c=0,f){case j:e=" m ",c=1,h=a[g++],i=a[g++],M[0][0]=h,M[0][1]=i;break;case l:e=" l ",c=1,h=a[g++],i=a[g++],M[0][0]=h,M[0][1]=i;break;case p:case k:e=" c ",c=3;var v,y,z=a[g++],A=a[g++],B=a[g++],C=a[g++];f===p?(v=B,y=C,B=(B+2*z)/3,C=(C+2*A)/3,z=(h+2*z)/3,A=(i+2*A)/3):(v=a[g++],y=a[g++]),M[0][0]=z,M[0][1]=A,M[1][0]=B,M[1][1]=C,M[2][0]=v,M[2][1]=y,h=v,i=y;break;case m:var D=0,E=0,F=1,G=1,H=0;b&&(D=b[4],E=b[5],F=o(b[0]*b[0]+b[1]*b[1]),G=o(b[2]*b[2]+b[3]*b[3]),H=Math.atan2(-b[1]/G,b[0]/F));var I=a[g++],J=a[g++],K=a[g++],L=a[g++],N=a[g++]+H,O=a[g++]+N+H;g++;var P=a[g++],Q=I+q(N)*K,R=J+r(N)*L,z=I+q(O)*K,A=J+r(O)*L,S=P?" wa ":" at ";Math.abs(Q-z)<1e-4&&(Math.abs(O-N)>.01?P&&(Q+=270/w):Math.abs(R-J)<1e-4?P&&Q<I||!P&&Q>I?A-=270/w:A+=270/w:P&&R<J||!P&&R>J?z+=270/w:z-=270/w),s.push(S,n(((I-K)*F+D)*w-x),u,n(((J-L)*G+E)*w-x),u,n(((I+K)*F+D)*w-x),u,n(((J+L)*G+E)*w-x),u,n((Q*F+D)*w-x),u,n((R*G+E)*w-x),u,n((z*F+D)*w-x),u,n((A*G+E)*w-x)),h=z,i=A;break;case d.R:var T=M[0],U=M[1];T[0]=a[g++],T[1]=a[g++],U[0]=T[0]+a[g++],U[1]=T[1]+a[g++],b&&(t(T,T,b),t(U,U,b)),T[0]=n(T[0]*w-x),U[0]=n(U[0]*w-x),T[1]=n(T[1]*w-x),U[1]=n(U[1]*w-x),s.push(" m ",T[0],u,T[1]," l ",U[0],u,T[1]," l ",U[0],u,U[1]," l ",T[0],u,U[1]);break;case d.Z:s.push(" x ")}if(c>0){s.push(e);for(var V=0;V<c;V++){var W=M[V];b&&t(W,W,b),s.push(n(W[0]*w-x),u,n(W[1]*w-x),V<c-1?u:"")}}}return s.join("")};k.prototype.brushVML=function(a){var b=this.style,c=this._vmlEl;c||(c=m.createNode("shape"),A(c),this._vmlEl=c),L(c,"fill",b,this),L(c,"stroke",b,this);var d=this.transform,e=null!=d,f=c.getElementsByTagName("stroke")[0];if(f){var g=b.lineWidth;if(e&&!b.strokeNoScale){var h=d[0]*d[3]-d[1]*d[2];g*=o(p(h))}f.weight=g+"px"}var i=this.path;this.__dirtyPath&&(i.beginPath(),this.buildPath(i,this.shape),i.toStatic(),this.__dirtyPath=!1),c.path=N(i.data,this.transform),c.style.zIndex=F(this.zlevel,this.z,this.z2),D(a,c),null!=b.text?this.drawRectText(a,this.getBoundingRect()):this.removeRectText(a)},k.prototype.onRemove=function(a){E(a,this._vmlEl),this.removeRectText(a)},k.prototype.onAdd=function(a){D(a,this._vmlEl),this.appendRectText(a)};var O=function(a){return"object"==typeof a&&a.tagName&&"IMG"===a.tagName.toUpperCase()};i.prototype.brushVML=function(a){var b,c,d=this.style,e=d.image;if(O(e)){var f=e.src;if(f===this._imageSrc)b=this._imageWidth,c=this._imageHeight;else{var g=e.runtimeStyle,h=g.width,i=g.height;g.width="auto",g.height="auto",b=e.width,c=e.height,g.width=h,g.height=i,this._imageSrc=f,this._imageWidth=b,this._imageHeight=c}e=f}else e===this._imageSrc&&(b=this._imageWidth,c=this._imageHeight);if(e){var j=d.x||0,k=d.y||0,l=d.width,p=d.height,q=d.sWidth,r=d.sHeight,w=d.sx||0,x=d.sy||0,y=q&&r,z=this._vmlEl;z||(z=m.doc.createElement("div"),A(z),this._vmlEl=z);var B,C=z.style,E=!1,G=1,H=1;if(this.transform&&(B=this.transform,G=o(B[0]*B[0]+B[1]*B[1]),H=o(B[2]*B[2]+B[3]*B[3]),E=B[1]||B[2]),E){var I=[j,k],J=[j+l,k],K=[j,k+p],L=[j+l,k+p];t(I,I,B),t(J,J,B),t(K,K,B),t(L,L,B);var M=s(I[0],J[0],K[0],L[0]),N=s(I[1],J[1],K[1],L[1]),P=[];P.push("M11=",B[0]/G,u,"M12=",B[2]/H,u,"M21=",B[1]/G,u,"M22=",B[3]/H,u,"Dx=",n(j*G+B[4]),u,"Dy=",n(k*H+B[5])),C.padding="0 "+n(M)+"px "+n(N)+"px 0",C.filter=v+".Matrix("+P.join("")+", SizingMethod=clip)"}else B&&(j=j*G+B[4],k=k*H+B[5]),C.filter="",C.left=n(j)+"px",C.top=n(k)+"px";var Q=this._imageEl,R=this._cropEl;Q||(Q=m.doc.createElement("div"),this._imageEl=Q);var S=Q.style;if(y){if(b&&c)S.width=n(G*b*l/q)+"px",S.height=n(H*c*p/r)+"px";else{var T=new Image,U=this;T.onload=function(){T.onload=null,b=T.width,c=T.height,S.width=n(G*b*l/q)+"px",S.height=n(H*c*p/r)+"px",U._imageWidth=b,U._imageHeight=c,U._imageSrc=e},T.src=e}R||(R=m.doc.createElement("div"),R.style.overflow="hidden",this._cropEl=R);var V=R.style;V.width=n((l+w*l/q)*G),V.height=n((p+x*p/r)*H),V.filter=v+".Matrix(Dx="+-w*l/q*G+",Dy="+-x*p/r*H+")",R.parentNode||z.appendChild(R),Q.parentNode!=R&&R.appendChild(Q)}else S.width=n(G*l)+"px",S.height=n(H*p)+"px",z.appendChild(Q),R&&R.parentNode&&(z.removeChild(R),this._cropEl=null);var W="",X=d.opacity;X<1&&(W+=".Alpha(opacity="+n(100*X)+") "),W+=v+".AlphaImageLoader(src="+e+", SizingMethod=scale)",S.filter=W,z.style.zIndex=F(this.zlevel,this.z,this.z2),D(a,z),null!=d.text&&this.drawRectText(a,this.getBoundingRect())}},i.prototype.onRemove=function(a){E(a,this._vmlEl),this._vmlEl=null,this._cropEl=null,this._imageEl=null,this.removeRectText(a)},i.prototype.onAdd=function(a){D(a,this._vmlEl),this.appendRectText(a)};var P,Q="normal",R={},S=0,T=100,U=document.createElement("div"),V=function(a){var b=R[a];if(!b){S>T&&(S=0,R={});var c,d=U.style;try{d.font=a,c=d.fontFamily.split(",")[0]}catch(a){}b={style:d.fontStyle||Q,variant:d.fontVariant||Q,weight:d.fontWeight||Q,size:0|parseFloat(d.fontSize||12),family:c||"Microsoft YaHei"},R[a]=b,S++}return b};f.measureText=function(a,b){var c=m.doc;P||(P=c.createElement("div"),P.style.cssText="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;",m.doc.body.appendChild(P));try{P.style.font=b}catch(a){}return P.innerHTML="",P.appendChild(c.createTextNode(a)),{width:P.offsetWidth}};for(var W=new c,X=function(a,b,c,d){var e=this.style,g=e.text;if(null!=g&&(g+=""),g){var h,i,j=e.textAlign,k=V(e.textFont),l=k.style+" "+k.variant+" "+k.weight+" "+k.size+'px "'+k.family+'"',o=e.textBaseline,p=e.textVerticalAlign;c=c||f.getBoundingRect(g,l,j,o);var q=this.transform;if(q&&!d&&(W.copy(b),W.applyTransform(q),b=W),d)h=b.x,i=b.y;else{var r=e.textPosition,s=e.textDistance;if(r instanceof Array)h=b.x+G(r[0],b.width),i=b.y+G(r[1],b.height),j=j||"left",o=o||"top";else{var v=f.adjustTextPositionOnRect(r,b,c,s);h=v.x,i=v.y,j=j||v.textAlign,o=o||v.textBaseline}}if(p){switch(p){case"middle":i-=c.height/2;break;case"bottom":i-=c.height}o="top"}var w=k.size;switch(o){case"hanging":case"top":i+=w/1.75;break;case"middle":break;default:i-=w/2.25}switch(j){case"left":break;case"center":h-=c.width/2;break;case"right":h-=c.width}var x,y,z,C=m.createNode,E=this._textVmlEl;E?(z=E.firstChild,x=z.nextSibling,y=x.nextSibling):(E=C("line"),x=C("path"),y=C("textpath"),z=C("skew"),y.style["v-text-align"]="left",A(E),x.textpathok=!0,y.on=!0,E.from="0 0",E.to="1000 0.05",D(E,z),D(E,x),D(E,y),this._textVmlEl=E);var H=[h,i],I=E.style;q&&d?(t(H,H,q),z.on=!0,z.matrix=q[0].toFixed(3)+u+q[2].toFixed(3)+u+q[1].toFixed(3)+u+q[3].toFixed(3)+",0,0",z.offset=(n(H[0])||0)+","+(n(H[1])||0),z.origin="0 0",I.left="0px",I.top="0px"):(z.on=!1,I.left=n(h)+"px",I.top=n(i)+"px"),y.string=B(g);try{y.style.font=l}catch(a){}L(E,"fill",{fill:d?e.fill:e.textFill,opacity:e.opacity},this),L(E,"stroke",{stroke:d?e.stroke:e.textStroke,opacity:e.opacity,lineDash:e.lineDash},this),E.style.zIndex=F(this.zlevel,this.z,this.z2),D(a,E)}},Y=function(a){E(a,this._textVmlEl),this._textVmlEl=null},Z=function(a){D(a,this._textVmlEl)},$=[g,h,i,k,j],_=0;_<$.length;_++){var aa=$[_].prototype;aa.drawRectText=X,aa.removeRectText=Y,aa.appendRectText=Z}j.prototype.brushVML=function(a){var b=this.style;null!=b.text?this.drawRectText(a,{x:b.x||0,y:b.y||0,width:0,height:0},this.getBoundingRect(),!0):this.removeRectText(a)},j.prototype.onRemove=function(a){this.removeRectText(a)},j.prototype.onAdd=function(a){this.appendRectText(a)}}}),define("zrender/vml/Painter",["require","../core/log","./core"],function(a){function b(a){return parseInt(a,10)}function c(a,b){f.initVML(),this.root=a,this.storage=b;var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="display:inline-block;overflow:hidden;position:relative;width:300px;height:150px;",d.style.cssText="position:absolute;left:0;top:0;",a.appendChild(c),this._vmlRoot=d,this._vmlViewport=c,this.resize();var e=b.delFromMap,g=b.addToMap;b.delFromMap=function(a){var c=b.get(a);e.call(b,a),c&&c.onRemove&&c.onRemove(d)},b.addToMap=function(a){a.onAdd&&a.onAdd(d),g.call(b,a)},this._firstPaint=!0}function d(a){return function(){e('In IE8.0 VML mode painter not support method "'+a+'"')}}var e=a("../core/log"),f=a("./core");c.prototype={constructor:c,getViewportRoot:function(){return this._vmlViewport},refresh:function(){var a=this.storage.getDisplayList(!0,!0);this._paintList(a)},_paintList:function(a){for(var b=this._vmlRoot,c=0;c<a.length;c++){var d=a[c];d.invisible||d.ignore?(d.__alreadyNotVisible||d.onRemove(b),d.__alreadyNotVisible=!0):(d.__alreadyNotVisible&&d.onAdd(b),d.__alreadyNotVisible=!1,d.__dirty&&(d.beforeBrush&&d.beforeBrush(),(d.brushVML||d.brush).call(d,b),d.afterBrush&&d.afterBrush())),d.__dirty=!1}this._firstPaint&&(this._vmlViewport.appendChild(b),this._firstPaint=!1)},resize:function(a,b){var a=null==a?this._getWidth():a,b=null==b?this._getHeight():b;if(this._width!=a||this._height!=b){this._width=a,this._height=b;var c=this._vmlViewport.style;c.width=a+"px",c.height=b+"px"}},dispose:function(){this.root.innerHTML="",this._vmlRoot=this._vmlViewport=this.storage=null},getWidth:function(){return this._width},getHeight:function(){return this._height},clear:function(){this._vmlViewport&&this.root.removeChild(this._vmlViewport)},_getWidth:function(){var a=this.root,c=a.currentStyle;return(a.clientWidth||b(c.width))-b(c.paddingLeft)-b(c.paddingRight)|0},_getHeight:function(){var a=this.root,c=a.currentStyle;return(a.clientHeight||b(c.height))-b(c.paddingTop)-b(c.paddingBottom)|0}};for(var g=["getLayer","insertLayer","eachLayer","eachBuildinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],h=0;h<g.length;h++){var i=g[h];c.prototype[i]=d(i)}return c}),define("zrender/vml/vml",["require","./graphic","../zrender","./Painter"],function(a){a("./graphic"),a("../zrender").registerPainter("vml",a("./Painter"))});var ErrorConstant={check_webrtc_supported:{code:2e3,message:"此浏览器不支持WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"此浏览器不支持MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"屏幕共享插件找不到"},screen_sharing_response_is_null:{code:2004,message:"没有屏幕共享"},not_join_room:{code:2005,message:"还未加会"},navigatorUserMediaError_permissionDenied:{code:2010,message:"打开设备权限不足，原因是非https访问或主动拒绝了设备请求"},navigatorUserMediaError_constraintNotSatisfied:{code:2011,message:"设备打开失败，因为传入的参数格式不对"},navigatorUserMediaError_trackStartError:{code:2012,message:"设备打开失败，因为传入的参数格式不对(chrome39以下)"},navigatorUserMediaError_unknown:{code:2015,message:"设备打开失败未知错误"},cameraId_does_not_exist:{code:2017,message:"摄像头ID不存在"},closeVideo_before_operation_warnings:{code:2018,message:"请关闭摄像头以后再进行此操作"},websock_create_error:{code:2020,message:"Websocket创建失败"},websock_catch_exception:{code:2021,message:"Websocket操作失败"},join_room_timeout:{code:1014,message:"加会超时"},oemname_notfound:{code:1017,message:"OEM名称没找到"},avdEngine_init_failed:{code:1018,message:"sdk引擎初始化失败"},userId_required:{code:1300,message:"userId是必须项，不能为空"},mulLanding_error:{code:1301,message:"同一个userId不能多次登录"},roomId_required:{code:1302,message:"roomId是必须项，不能为空"},params_require:{code:1303,message:"params是必须项，不能为空"},ft_no_authorization:{code:1305,message:"模块无授权."}},FTConstant={datachannel:{name:"透明通道",value:"ft_datachannel"},chat:{name:"聊天",value:"ft_chat"},audio:{name:"语音",value:"ft_audio"},video:{name:"普通视频",value:"ft_video"},video_hd:{name:"高清视频",value:"ft_video_hd"},screen:{name:"屏幕共享",value:"ft_screen"},annotation:{name:"注释白板",value:"ft_annotation"},p2p:{name:"P2P房间",value:"ft_p2p"},record_audio:{name:"录制音频",value:"ft_record_audio"},record_video:{name:"录制视频",value:"ft_record_video"},livebroadcast:{name:"旁路直播",value:"ft_livebroadcast"},platform_android:{name:"Android系统",value:"ft_platform_android"},platform_ios:{name:"ios系统",value:"ft_platform_ios"},platform_win:{name:"windows桌面系统",value:"ft_platform_win"},platform_mac:{name:"mac ox桌面系统",value:"ft_platform_mac"},platform_linux:{name:"linux桌面系统",value:"ft_platform_linux"},platform_web:{name:"web js系统",value:"ft_platform_web"}},ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},EngineCallback={room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error"},VideoCodingType={VP8:0,VP9:1,H264:2},Resolution={1080:{width:1920,height:1080,order:14},720:{width:1280,height:720,order:13},960:{width:960,height:720,order:12},642:{width:640,height:1024,order:11},641:{width:640,height:960,order:10},640:{width:640,height:480,order:9},639:{width:640,height:360,order:8},508:{width:508,height:360,order:7},481:{width:480,height:854,order:6},480:{width:480,height:800,order:5},321:{width:320,height:480,order:4},320:{width:320,height:240,order:3},180:{width:320,height:180,order:2},160:{width:160,height:120,order:1}},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",public_data:"public.data",private_data:"private.data",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result"},RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={line:1,ellipse:2,rect:3,polyline:4,arrowline:5,undo:6,redo:7,clear:8,eraser:9,right:10,wrong:11},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},arrayUtil={intersection:function(a,b){for(var c=new Object,d=0,e=a.length;d<e;d++)c[a[d]]=a[d];for(var d=0,e=b.length;d<e;d++)c[b[d]]=b[d];var f=new Array,d=0;for(var g in c)f[d++]=c[g];return f},chaji:function(a,b){for(var c=new Object,d=0,e=a.length;d<e;d++)c[a[d]]=1;for(var d=0,e=b.length;d<e;d++)c[b[d]]=c[b[d]]?2:1;var f=new Array,d=0;for(var g in c)1==c[g]&&(f[d++]=g);return f},chajiObject:function(a,b){for(var c=new Object,d=0,e=a.length;d<e;d++)c[a[d].nodeId]=1;for(var d=0,e=b.length;d<e;d++)c[b[d].nodeId]=c[b[d].nodeId]?2:1;var f=new Array,d=0;for(var g in c)1==c[g]&&(f[d++]=g);return f},inANotInB:function(a,b){for(var c=new Object,d=0,e=a.length;d<e;d++)c[a[d]]=1;for(var d=0,e=b.length;d<e;d++)c.hasOwnProperty(b[d])&&(c[b[d]]=void 0);var f=new Array,d=0;for(var g in c)c[g]&&(f[d++]=g);return f},baseSplice:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];if(e==b){c=d;break}}c>-1&&a.splice(c,1)},objectSplice:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];if(e.id==b){c=d;break}}c>-1&&a.splice(c,1)}},typeConversionUtil={String2ArrayBuffer:function(a){for(var a=btoa(unescape(encodeURIComponent(a))),b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b},ArrayBuffer2String:function(a){var b=String.fromCharCode.apply(null,new Uint8Array(a)),c=decodeURIComponent(escape(atob(b)));return c}};!function(){var a={},b={},c=function(){},d={define:function(b,c,d){if(!a[b]){var e={name:b,dependencies:c,factory:d};a[b]=e}return a[b]},use:function(b){var d=a[b];if(!d)return null;if(!d.entity){for(var e=[],f=0;f<d.dependencies.length;f++)a[d.dependencies[f]].entity?e.push(a[d.dependencies[f]].entity):e.push(this.use(d.dependencies[f]));d.entity=d.factory.apply(c,e)}return d.entity},require:function(a,c){function d(){for(var d=!0,e=0;e<a.length;e++)if(!b[a[e]]){d=!1;break}d&&c()}for(var e=0;e<a.length;e++){var f=a[e];if(!b[f]){var g=document.getElementsByTagName("head")[0],h=document.createElement("script");h.type="text/javascript",h.async="true",h.src=f+".js",h.onload=function(){b[f]=!0,g.removeChild(h),d()},g.appendChild(h)}}}};window.ModuleBase=d}(),ModuleBase.define("Error",[],function(){var a=function(a,b){"object"==typeof a&&"undefined"==typeof b?(this.code=a.code,this.message=a.message):(this.code=a,this.message=b)};return a.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},a});var cmdBuilder=dcodeIO.ProtoBuf.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{
rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ANNOTATION_MSG",id:2100}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16}]}]}).build();ModuleBase.define("CmdProtobufCoded",[],function(){var a,b=function(){a=cmdBuilder.room_pdu};return b.prototype.getRoomPduTypeEnum=function(){var b=a.RoomPduType;return b},b.prototype.getRoomStatusEnum=function(){var b=a.RoomStatus;return b},b.prototype.getResourceOptEnum=function(){var b=a.ResourceOpt;return b},b.prototype.getResourceStatusEnum=function(){var b=a.ResourceStatus;return b},b.prototype.getCameraTypeEnum=function(){var b=a.CameraType;return b},b.prototype.getUserStatusEnum=function(){var b=a.UserStatus;return b},b.prototype.getUserRoleEnum=function(){var b=a.UserRole;return b},b.prototype.getMediaTypeEnum=function(){var b=a.MediaType;return b},b.prototype.getSessionTypeEnum=function(){var b=a.SessionType;return b},b.prototype.getRepResultTypeEnum=function(){var b=a.RepResultType;return b},b.prototype.getUserMsgOptEnum=function(){var b=a.UserMsgOpt;return b},b.prototype.getRoomModeEnum=function(){var b=a.RoomMode;return b},b.prototype.getLineArrowEnum=function(){var b=a.LineArrow;return b},b.prototype.getAnnotationTypeEnum=function(){var b=a.AnnotationType;return b},b.prototype.newWebcam=function(){var b=a.Webcam,c=new b;return c},b.prototype.newWebcam=function(b,c,d,e){var f=a.Webcam,g=new f(b,c,d,e);return g},b.prototype.newSpeaker=function(){var b=a.Speaker,c=new b;return c},b.prototype.newSpeaker=function(b,c,d,e){var f=a.Speaker,g=new f(b,c,d,e);return g},b.prototype.newDesktop=function(){var b=a.Desktop,c=new b;return c},b.prototype.newDesktop=function(b,c,d,e){var f=a.Desktop,g=new f(b,c,d,e);return g},b.prototype.newDocFile=function(){var b=a.DocFile,c=new b;return c},b.prototype.newDocFile=function(b,c,d,e,f){var g=a.DocFile,h=new g(b,c,d,e,f);return h},b.prototype.newAddWebcamMsg=function(){var b=a.AddWebcamMsg,c=new b;return c},b.prototype.newAddWebcamMsg=function(b,c){var d=a.AddWebcamMsg,e=new d(b,c);return e},b.prototype.newRemoveWebcamMsg=function(){var b=a.RemoveWebcamMsg,c=new b;return c},b.prototype.newRemoveWebcamMsg=function(b,c){var d=a.RemoveWebcamMsg,e=new d(b,c);return e},b.prototype.newAddSpeakerMsg=function(){var b=a.AddSpeakerMsg,c=new b;return c},b.prototype.newAddSpeakerMsg=function(b,c){var d=a.AddSpeakerMsg,e=new d(b,c);return e},b.prototype.newRemoveSpeakerMsg=function(){var b=a.RemoveSpeakerMsg,c=new b;return c},b.prototype.newRemoveSpeakerMsg=function(b,c){var d=a.RemoveSpeakerMsg,e=new d(b,c);return e},b.prototype.newAddDocFileMsg=function(){var b=a.AddDocFileMsg,c=new b;return c},b.prototype.newAddDocFileMsg=function(b,c){var d=a.AddDocFileMsg,e=new d(b,c);return e},b.prototype.newRemoveDocFileMsg=function(){var b=a.RemoveDocFileMsg,c=new b;return c},b.prototype.newRemoveDocFileMsg=function(b,c){var d=a.RemoveDocFileMsg,e=new d(b,c);return e},b.prototype.newRoomResourceInfo=function(){var b=a.RoomResourceInfo,c=new b;return c},b.prototype.newRoomResourceInfo=function(b,c,d){var e=a.RoomResourceInfo,f=new e(b,c,d);return f},b.prototype.newRoomInfo=function(){var b=a.RoomInfo,c=new b;return c},b.prototype.newRoomInfo=function(b,c){var d=a.RoomInfo,e=new d(b,c);return e},b.prototype.newUserPolicy=function(){var b=a.UserPolicy,c=new b;return c},b.prototype.newUserPolicy=function(b,c,d){var e=a.UserPolicy,f=new e(b,c,d);return f},b.prototype.newJoinInfo=function(){var b=a.JoinInfo,c=new b;return c},b.prototype.newJoinInfo=function(b,c,d,e){var f=a.JoinInfo,g=new f(b,c,d,e);return g},b.prototype.newUserInfo=function(){var b=a.UserInfo,c=new b;return c},b.prototype.newUserInfo=function(b,c,d,e,f,g,h,i,j,k,l,m){var n=a.UserInfo,o=new n(b,c,d,e,f,g,h,i,j,k,l,m);return o},b.prototype.newMediaStream=function(){var b=a.MediaStream,c=new b;return c},b.prototype.newMediaStream=function(b,c,d,e,f,g,h){var i=a.MediaStream,j=new i;return j.stream_name=b,j.type=c,j.sdp=d,"undefined"!=typeof e&&0!=e&&(j.width=e),"undefined"!=typeof f&&0!=f&&(j.height=f),"undefined"!=typeof g&&0!=g&&(j.frame_rate=g),"undefined"!=typeof h&&(j.payload=h),j},b.prototype.newMediaStreamInfo=function(){var b=a.MediaStreamInfo,c=new b;return c},b.prototype.newMediaStreamInfo=function(b,c,d){var e=a.MediaStreamInfo,f=new e(b,c,d);return f},b.prototype.newResourceIndiction=function(){var b=a.ResourceIndiction,c=new b;return c},b.prototype.newResourceIndiction=function(b,c,d,e,f){var g=a.ResourceIndiction,h=new g(b,c,d,e,f);return h},b.prototype.newAddDesktopMsg=function(){var b=a.AddDesktopMsg,c=new b;return c},b.prototype.newAddDesktopMsg=function(b,c){var d=a.AddDesktopMsg,e=new d(b,c);return e},b.prototype.newRemoveDesktopMsg=function(){var b=a.RemoveDesktopMsg,c=new b;return c},b.prototype.newRemoveDesktopMsg=function(b,c){var d=a.RemoveDesktopMsg,e=new d;return e},b.prototype.newUpdateWebcamMsg=function(){var b=a.UpdateWebcamMsg,c=new b;return c},b.prototype.newUpdateWebcamMsg=function(b,c,d){var e=a.UpdateWebcamMsg,f=new e(b,c,d);return f},b.prototype.newUpdateSpeakerMsg=function(){var b=a.UpdateSpeakerMsg,c=new b;return c},b.prototype.newUpdateSpeakerMsg=function(b,c,d){var e=a.UpdateSpeakerMsg,f=new e(b,c,d);return f},b.prototype.newUpdateDesktopMsg=function(){var b=a.UpdateDesktopMsg,c=new b;return c},b.prototype.newUpdateDesktopMsg=function(b,c,d){var e=a.UpdateDesktopMsg,f=new e(b,c,d);return f},b.prototype.newLeaveMsg=function(){var b=a.LeaveMsg,c=new b;return c},b.prototype.newLeaveMsg=function(b,c){var d=a.LeaveMsg,e=new d(b,c);return e},b.prototype.newUpdateRoomStatusMsg=function(){var b=a.UpdateRoomStatusMsg,c=new b;return c},b.prototype.newUpdateRoomStatusMsg=function(b){var c=a.UpdateRoomStatusMsg,d=new c(b);return d},b.prototype.newPubRoomResourceMsg=function(){var b=a.PubRoomResourceMsg,c=new b;return c},b.prototype.newPubRoomResourceMsg=function(b,c){var d=a.PubRoomResourceMsg,e=new d(b,c);return e},b.prototype.newUnpubRoomResourceMsg=function(){var b=a.UnpubRoomResourceMsg,c=new b;return c},b.prototype.newUnpubRoomResourceMsg=function(b){var c=a.UnpubRoomResourceMsg,d=new c(b);return d},b.prototype.newSubRoomResourceMsg=function(){var b=a.SubRoomResourceMsg,c=new b;return c},b.prototype.newSubRoomResourceMsg=function(b,c,d){var e=a.SubRoomResourceMsg,f=new e(b,c,d);return f},b.prototype.newUnsubRoomResourceMsg=function(){var b=a.UnsubRoomResourceMsg,c=new b;return c},b.prototype.newUnsubRoomResourceMsg=function(b,c){var d=a.UnsubRoomResourceMsg,e=new d(b,c);return e},b.prototype.newPubResourceReq=function(){var b=a.PubResourceReq,c=new b;return c},b.prototype.newPubResourceReq=function(b,c){var d=a.PubResourceReq,e=new d(b,c);return e},b.prototype.newPubResourceRep=function(){var b=a.PubResourceRep,c=new b;return c},b.prototype.newPubResourceRep=function(b,c,d){var e=a.PubResourceRep,f=new e(b,c,d);return f},b.prototype.newRoomKV=function(){var b=a.RoomKV,c=new b;return c},b.prototype.newRoomKV=function(b,c){var d=a.RoomKV,e=new d(b,c);return e},b.prototype.newRoomDataInfo=function(){var b=a.RoomDataInfo,c=new b;return c},b.prototype.newRoomDataInfo=function(b,c){var d=a.RoomDataInfo,e=new d(b,c);return e},b.prototype.newTextMsg=function(){var b=a.TextMsg,c=new b;return c},b.prototype.newTextMsg=function(b,c){var d=a.TextMsg,e=new d(b,c);return e},b.prototype.newData=function(){var b=a.DATA,c=new b;return c},b.prototype.newData=function(b){var c=a.DATA,d=new c(b);return d},b.prototype.newUserInfoMsg=function(){var b=a.UserInfoMsg,c=new b;return c},b.prototype.newUserInfoMsg=function(b){var c=a.UserInfoMsg,d=new c(b);return d},b.prototype.newUserMsg=function(){var b=a.UserMsg,c=new b;return c},b.prototype.newUserMsg=function(b,c,d){var e=a.UserMsg,f=new e(b,c,d);return f},b.prototype.newUpdateUserRolePriviledgeMsg=function(){var b=a.UpdateUserRolePriviledgeMsg,c=new b;return c},b.prototype.newUpdateUserRolePriviledgeMsg=function(b,c,d){var e=a.UpdateUserRolePriviledgeMsg,f=new e(b,c,d);return f},b.prototype.newUpdateUserStatusMsg=function(){var b=a.UpdateUserStatusMsg,c=new b;return c},b.prototype.newUpdateUserStatusMsg=function(b,c,d){var e=a.UpdateUserStatusMsg,f=new e(b,c,d);return f},b.prototype.newUpdateUserRoleMsg=function(){var b=a.UpdateUserRoleMsg,c=new b;return c},b.prototype.newUpdateUserRoleMsg=function(b,c,d){var e=a.UpdateUserRoleMsg,f=new e(b,c,d);return f},b.prototype.newUserIndiction=function(){var b=a.UserIndiction,c=new b;return c},b.prototype.newUserIndiction=function(b,c,d){var e=a.UserIndiction,f=new e(b,c,d);return f},b.prototype.newUpdateUserDataMsg=function(){var b=a.UpdateUserDataMsg,c=new b;return c},b.prototype.newUpdateUserDataMsg=function(b,c){var d=a.UpdateUserDataMsg,e=new d(b,c);return e},b.prototype.newOfferReq=function(){var b=a.OfferReq,c=new b;return c},b.prototype.newOfferReq=function(b,c,d){var e=a.OfferReq,f=new e(b,c,d);return f},b.prototype.newOfferRep=function(){var b=a.OfferRep,c=new b;return c},b.prototype.newOfferRep=function(b,c,d,e,f){var g=a.OfferRep,h=new g(b,c,d,e,f);return h},b.prototype.newCandidateMsg=function(){var b=a.CandidateMsg,c=new b;return c},b.prototype.newCandidateMsg=function(b,c,d,e){var f=a.CandidateMsg,g=new f(b,c,d,e);return g},b.prototype.newSubRoomResourceReq=function(){var b=a.SubRoomResourceReq,c=new b;return c},b.prototype.newSubRoomResourceReq=function(b,c,d){var e=a.SubRoomResourceReq,f=new e(b,c,d);return f},b.prototype.newSubRoomResourceRep=function(){var b=a.SubRoomResourceRep,c=new b;return c},b.prototype.newSubRoomResourceRep=function(b,c,d,e){var f=a.SubRoomResourceRep,g=new f(b,c,d,e);return g},b.prototype.newOpenReq=function(){var b=a.OpenReq,c=new b;return c},b.prototype.newOpenReq=function(b,c,d,e){var f=a.OpenReq,g=new f(b,c,d,e);return g},b.prototype.newInviteRoomReq=function(){var b=a.InviteRoomReq,c=new b;return c},b.prototype.newInviteRoomReq=function(b,c,d,e){var f=a.InviteRoomReq,g=new f(b,c,d,e);return g},b.prototype.newInviteRoomReq1=function(){var b=a.InviteRoomReq1,c=new b;return c},b.prototype.newInviteRoomReq1=function(b,c,d,e,f,g,h,i,j){var k=a.InviteRoomReq1,l=new k(b,c,d,e,f,g,h,i,j);return l.is_dtls=!0,l},b.prototype.newCandidateMsg1=function(){var b=a.CandidateMsg1,c=new b;return c},b.prototype.newCandidateMsg1=function(b,c,d,e){var f=a.CandidateMsg1,g=new f(b,c,d,e);return g},b.prototype.newCloseMsg=function(){var b=a.CloseMsg,c=new b;return c},b.prototype.newCloseMsg=function(b){var c=a.CloseMsg,d=new c(b);return d},b.prototype.newPoint=function(){var b=a.Point,c=new b;return c},b.prototype.newPoint=function(b,c){var d=a.Point,e=new d(b,c);return e},b.prototype.newcolor=function(){var b=a.color,c=new b;return c},b.prototype.newcolor=function(b,c,d,e){var f=a.color,g=new f(b,c,d,e);return g},b.prototype.newRect=function(){var b=a.Rect,c=new b;return c},b.prototype.newRect=function(b,c,d,e){var f=a.Rect,g=new f(b,c,d,e);
return g},b.prototype.newAnnotationObject=function(){var b=a.AnnotationObject,c=new b;return c},b.prototype.newAnnotationObject=function(b,c,d,e,f,g,h,i,j,k){var l=a.AnnotationObject,m=new l(b,c,d,e,f,g,h,i,j,k);return m},b.prototype.newAnnotation2Point=function(){var b=a.Annotation2Point,c=new b;return c},b.prototype.newAnnotation2Point=function(b,c,d){var e=a.Annotation2Point,f=new e(b,c,d);return f},b.prototype.newAnnotationMultiPoint=function(){var b=a.AnnotationMultiPoint,c=new b;return c},b.prototype.newAnnotationMultiPoint=function(b,c){var d=a.AnnotationMultiPoint,e=new d(b,c);return e},b.prototype.newAnnotationList=function(){var b=a.AnnotationList,c=new b;return c},b.prototype.newAnnotationList=function(b,c){var d=a.AnnotationList,e=new d(b,c);return e},b.prototype.newAnnotationMsgInternal=function(){var b=a.AnnotationMsgInternal,c=new b;return c},b.prototype.newAnnotationMsgInternal=function(b,c,d,e,f){var g=a.AnnotationMsgInternal,h=new g(b,c,d,e,f);return h},b.prototype.newAnnotationMsg=function(){var b=a.AnnotationMsg,c=new b;return c},b.prototype.newAnnotationMsg=function(b,c){var d=a.AnnotationMsg,e=new d(b,c);return e},b.prototype.serverVersionCompatible=function(a){var b=new ArrayBuffer(10),c=new Int8Array(b);c[0]=88,c[1]="3".charCodeAt(),c[2]="t".charCodeAt(),c[3]="e".charCodeAt(),c[4]="e".charCodeAt(),c[5]="a".charCodeAt(),c[6]="v".charCodeAt(),c[7]="d".charCodeAt(),c[8]=2,c[9]=1;for(var d=new Int8Array(a),e=10+d.length,f=new ArrayBuffer(e),g=new Int8Array(f),h=0;h<10;h++)g[h]=c[h];for(var i=0;i<d.length;i++){var j=i+10;g[j]=d[i]}return f},b.prototype.encodedPacket=function(b,c,d,e,f){var g=a.Packet,h=null;null!=f&&(h=f.toArrayBuffer());var i=new g(b,c,d,e,h),j=i.toArrayBuffer();return b==this.getRoomPduTypeEnum().OPEN_REQ&&(j=this.serverVersionCompatible(j)),j},b.prototype.decodePacket=function(b){var c=a.Packet,d=c.decode(b);return d},b.prototype.decodeUserMsg=function(b){var c=a.UserMsg,d=c.decode(b);return d},b.prototype.decodeBody=function(b){var c=a.RoomPduType,d=a.Packet,e=d.decode(b),f=e.type;if(f==c.OPEN_REP){var g=a.OpenRep,h=g.decode(e.body);return h}if(f==c.INVITE_ROOM_REP1){var i=a.InviteRoomRep1,j=i.decode(e.body);return j}if(f==c.ROOM_RESOURCE_INFOS){var k=a.RoomResourceInfos,l=k.decode(e.body);return l}if(f==c.CANDIDATE_MSG1){var m=a.CandidateMsg1,n=m.decode(e.body);return n}if(f==c.PUB_RESOURCE_REP){var o=a.PubResourceRep,p=o.decode(e.body);return p}if(f==c.PRIVATE_TEXT_MSG){var q=a.TextMsg,r=q.decode(e.body);return r}if(f==c.PUBLIC_TEXT_MSG){var q=a.TextMsg,r=q.decode(e.body);return r}if(f==c.PRIVATE_DATA){var s=a.DATA,b=s.decode(e.body);return b}if(f==c.PUBLIC_DATA){var s=a.DATA,b=s.decode(e.body);return b}if(f==c.ROOM_DATA_INFO){var t=a.RoomDataInfo,u=t.decode(e.body);return u}if(f==c.UPDATE_USER_DATA_MSG){var v=a.UpdateUserDataMsg,w=v.decode(e.body);return w}if(f==c.USER_INFO_MSG){var x=a.UserInfoMsg;if(null!=e.body){var y=x.decode(e.body);return y}return null}if(f==c.USER_MSG){var z=a.UserMsg,A=z.decode(e.body);return A}if(f==c.USER_INDICTION){var B=a.UserIndiction,C=B.decode(e.body);return C}if(f==c.UPDATA_USER_ROLE_PRIVILEDGE_MSG){var D=a.UpdateUserRolePriviledgeMsg,E=D.decode(e.body);return E}if(f==c.ADD_WEBCAM_MSG){var F=a.AddWebcamMsg,G=F.decode(e.body);return G}if(f==c.ADD_SPEAKER_MSG){var H=a.AddSpeakerMsg,I=H.decode(e.body);return I}if(f==c.ADD_DESKTOP_MSG){var J=a.AddDesktopMsg,K=J.decode(e.body);return K}if(f==c.REMOVE_WEBCAM_MSG){var L=a.RemoveWebcamMsg,M=L.decode(e.body);return M}if(f==c.REMOVE_SPEAKER_MSG){var N=a.RemoveSpeakerMsg,O=N.decode(e.body);return O}if(f==c.UPDATE_SPEAKER_MSG){var P=a.UpdateSpeakerMsg,Q=P.decode(e.body);return Q}if(f==c.UPDATE_WEBCAM_MSG){var R=a.UpdateWebcamMsg,S=R.decode(e.body);return S}if(f==c.UPDATE_DESKTOP_MSG){var T=a.UpdateDesktopMsg,U=T.decode(e.body);return U}if(f==c.PUB_ROOM_RESOURCE_MSG){var V=a.PubRoomResourceMsg,W=V.decode(e.body);return W}if(f==c.PUB_ROOM_RESOURCE_MSG_REP){var X=a.PubRoomResourceMsgRep,Y=X.decode(e.body);return Y}if(f==c.UNPUB_ROOM_RESOURCE_MSG){var Z=a.UnpubRoomResourceMsg,$=Z.decode(e.body);return $}if(f==c.PUB_VIDEO_REQ||f==c.PUB_AUDIO_REQ){var _=a.PubResourceReq,aa=_.decode(e.body);return aa}if(f==c.PUB_VIDEO_REP||f==c.PUB_AUDIO_REP){var o=a.PubResourceRep,p=o.decode(e.body);return p}if(f==c.VIDEO_INDICTION){var ba=a.ResourceIndiction,ca=ba.decode(e.body);return ca}if(f==c.AUDIO_INDICTION){var ba=a.ResourceIndiction,ca=ba.decode(e.body);return ca}if(f==c.OFFER_REQ){var da=a.OfferReq,ea=da.decode(e.body);return ea}if(f==c.OFFER_REP){var fa=a.OfferRep,ga=fa.decode(e.body);return ga}if(f==c.CANDIDATE_MSG){var ha=a.CandidateMsg,ia=ha.decode(e.body);return ia}if(f==c.SUB_ROOM_RESOURCE_REQ){var ja=a.SubRoomResourceReq,ka=ja.decode(e.body);return ka}if(f==c.SUB_ROOM_RESOURCE_REP){var la=a.SubRoomResourceRep,ma=la.decode(e.body);return ma}if(f==c.SUB_ROOM_RESOURCE_MSG){var na=a.SubRoomResourceMsg,oa=na.decode(e.body);return oa}if(f==c.UNSUB_ROOM_RESOURCE_MSG){var pa=a.UnsubRoomResourceMsg,qa=pa.decode(e.body);return qa}},b});var RTCBrowserType={RTC_BROWSER_CHROME:"rtc_browser.chrome",RTC_BROWSER_FIREFOX:"rtc_browser.firefox"},keyMap={};keyMap[RTCBrowserType.RTC_BROWSER_FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent"},keyMap[RTCBrowserType.RTC_BROWSER_CHROME]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent",receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel"};var connectionQualityValues={98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"};PeerStats.bandwidth={},PeerStats.bitrate={},PeerStats.packetLoss=null,PeerStats.transport=[],PeerStats.resolutions=[],PeerStats.prototype.setSsrcLoss=function(a,b){this.ssrc2Loss[a]=b},PeerStats.prototype.setSsrcResolution=function(a,b){null===b&&this.ssrc2resolution[a]?delete this.ssrc2resolution[a]:null!==b&&(this.ssrc2resolution[a]=b)},PeerStats.prototype.setSsrcBitrate=function(a,b){this.ssrc2bitrate[a]?(this.ssrc2bitrate[a].download+=b.download,this.ssrc2bitrate[a].upload+=b.upload):this.ssrc2bitrate[a]=b},PeerStats.prototype.setSsrcAudioLevel=function(a,b){this.ssrc2AudioLevel[a]=formatAudioLevel(b)},ConnectionInfoCollector.prototype.start=function(){var a=this;this.statsIntervalId=setInterval(function(){a.peerconnection.getStats(function(b){var c=null;b&&b.result&&"function"==typeof b.result?c=b.result():"firefox"==webrtcDetectedBrowser?c=b:"Internet Explorer"==webrtcDetectedBrowser&&(c=b.result()),a.currentStatsReport=c;try{a.processStatsReport()}catch(a){log.error("Unsupported key:"+a,a)}a.baselineStatsReport=a.currentStatsReport},a.errorCallback)},this.statsInterval)},ConnectionInfoCollector.prototype.processStatsReport=function(){if(this.baselineStatsReport){PeerStats.transport=[],PeerStats.resolutions=[];for(var a in this.currentStatsReport){var b=this.currentStatsReport[a];try{(getStatValue(b,"receiveBandwidth")||getStatValue(b,"sendBandwidth"))&&(PeerStats.bandwidth={download:Math.round(getStatValue(b,"receiveBandwidth")/1e3),upload:Math.round(getStatValue(b,"sendBandwidth")/1e3)})}catch(a){}if("googCandidatePair"!=b.type){if("candidatepair"==b.type){if("succeeded"==b.state)continue;var c=this.currentStatsReport[b.localCandidateId],d=this.currentStatsReport[b.remoteCandidateId];PeerStats.transport.push({localip:c.ipAddress+":"+c.portNumber,ip:d.ipAddress+":"+d.portNumber,type:c.transport})}if("ssrc"==b.type||"outboundrtp"==b.type||"inboundrtp"==b.type){var e=this.baselineStatsReport[a];if(e){var f=getStatValue(b,"ssrc");if(f&&(this.jid||!(Date.now()-b.timestamp<3e3))){var g=this.jid2stats[this.jid];g||(g=new PeerStats,this.jid2stats[this.jid]=g);var h=!0,i="packetsReceived";if(getStatValue(b,i)||(h=!1,i="packetsSent",getStatValue(b,i))){var j=getStatValue(b,i);(!j||j<0)&&(j=0);var k=getStatValue(e,i);(!k||k<0)&&(k=0);var l=j-k;(!l||l<0)&&(l=0);var m=getStatValue(b,"packetsLost");(!m||m<0)&&(m=0);var n=getStatValue(e,"packetsLost");(!n||n<0)&&(n=0);var o=m-n;(!o||o<0)&&(o=0);var p=l+o;g.setSsrcLoss(f,{packetsTotal:p,packetsLost:o,isDownloadStream:h});var q=0,r=0;getStatValue(b,"bytesReceived")&&(q=getStatValue(b,"bytesReceived")-getStatValue(e,"bytesReceived")),getStatValue(b,"bytesSent")&&(r=getStatValue(b,"bytesSent")-getStatValue(e,"bytesSent"));var s=Math.round((b.timestamp-e.timestamp)/1e3);q=q<=0||s<=0?0:Math.round(8*q/s/1e3),r=r<=0||s<=0?0:Math.round(8*r/s/1e3),g.setSsrcBitrate(f,{download:q,upload:r});var t={height:null,width:null};try{getStatValue(b,"googFrameHeightSent")&&getStatValue(b,"googFrameWidthSent")&&(t.height=getStatValue(b,"googFrameHeightSent"),t.width=getStatValue(b,"googFrameWidthSent"))}catch(a){}t.height&&t.width?g.setSsrcResolution(f,t):g.setSsrcResolution(f,null)}}}}}else{var u,v,w,x;try{u=getStatValue(b,"remoteAddress"),v=getStatValue(b,"transportType"),w=getStatValue(b,"localAddress"),x=getStatValue(b,"activeConnection")}catch(a){}if(!u||!v||!w||"true"!=x)continue;for(var y=!1,z=0;z<PeerStats.transport.length;z++)PeerStats.transport[z].ip==u&&PeerStats.transport[z].type==v&&PeerStats.transport[z].localip==w&&(y=!0);if(y)continue;PeerStats.transport.push({localip:w,ip:u,type:v})}}var A=this,B={download:0,upload:0},C={download:0,upload:0},D=0,E=0,F={};Object.keys(this.jid2stats).forEach(function(a){Object.keys(A.jid2stats[a].ssrc2Loss).forEach(function(b){var c="upload";A.jid2stats[a].ssrc2Loss[b].isDownloadStream&&(c="download"),B[c]+=A.jid2stats[a].ssrc2Loss[b].packetsTotal,C[c]+=A.jid2stats[a].ssrc2Loss[b].packetsLost}),Object.keys(A.jid2stats[a].ssrc2bitrate).forEach(function(b){D+=A.jid2stats[a].ssrc2bitrate[b].download,E+=A.jid2stats[a].ssrc2bitrate[b].upload,delete A.jid2stats[a].ssrc2bitrate[b]}),F[a]=A.jid2stats[a].ssrc2resolution}),PeerStats.bitrate={upload:E,download:D},PeerStats.packetLoss={total:calculatePacketLoss(C.download+C.upload,B.download+B.upload),download:calculatePacketLoss(C.download,B.download),upload:calculatePacketLoss(C.upload,B.upload)},PeerStats.resolutions=F,this.generateText()}},ConnectionInfoCollector.prototype.generateText=function(){var a,b,c,d,e,f,g,h,j,k,l,m,n;null===PeerStats.bitrate?(b="N/A",c="N/A"):(b=PeerStats.bitrate.download?PeerStats.bitrate.download+" Kbps":"N/A",c=PeerStats.bitrate.upload?PeerStats.bitrate.upload+" Kbps":"N/A"),null===PeerStats.packetLoss?(d="N/A",e="N/A"):(d=(null!==PeerStats.packetLoss.download?PeerStats.packetLoss.download:"N/A")+"%",e=(null!==PeerStats.packetLoss.upload?PeerStats.packetLoss.upload:"N/A")+"%");var o=null;if(PeerStats.resolutions&&null!=this.jid){Object.keys(PeerStats.resolutions);for(var p in PeerStats.resolutions)o=PeerStats.resolutions[p]}if(f="N/A",o){var q=0,r=0;for(i in o){var s=o[i];s&&s.height&&s.width&&(q+=parseInt(s.width),r+=parseInt(s.height))}0!=q&&0!=r&&(f=q+"x"+r)}if(null===PeerStats.bandwidth?(g="N/A",h="N/A"):(g=PeerStats.bandwidth.download?PeerStats.bandwidth.download+" Kbps":"N/A",h=PeerStats.bandwidth.upload?PeerStats.bandwidth.upload+" Kbps":"N/A"),PeerStats.transport&&0!==PeerStats.transport.length){var t={remoteIP:[],localIP:[],remotePort:[],localPort:[]};for(i=0;i<PeerStats.transport.length;i++){var u=getIP(PeerStats.transport[i].ip),v=getPort(PeerStats.transport[i].ip),w=getIP(PeerStats.transport[i].localip),x=getPort(PeerStats.transport[i].localip);t.remoteIP.indexOf(u)==-1&&t.remoteIP.push(u),t.remotePort.indexOf(v)==-1&&t.remotePort.push(v),t.localIP.indexOf(w)==-1&&t.localIP.push(w),t.localPort.indexOf(x)==-1&&t.localPort.push(x)}l=getStringFromArray(t.localIP),m=getStringFromArray(t.localPort),j=getStringFromArray(t.remoteIP),k=getStringFromArray(t.remotePort)}else;var y=100-PeerStats.packetLoss.total;for(var z in connectionQualityValues)y>=z&&(a=connectionQualityValues[z]);var A={};A.downloadBitrate=b,A.uploadBitrate=c;var B={};B.downloaPacketLoss=d,B.uploadPacketLoss=e;var C={};C.downloadBandwidth=g,C.uploadBandwidth=h,PeerStats.transport[0]&&(n=PeerStats.transport[0].type);var D={};D.connectionQuality=a,D.bitrate=A,D.packetLoss=B,D.resolution=f,D.bandwidth=C,D.localaddress=l,D.localport=m,D.remoteaddress=j,D.remoteport=k,D.transport=n,null!=room?room.eventEmitter.emit(RoomCallback.connection_indicator,D):this.stop()},ConnectionInfoCollector.prototype.errorCallback=function(a){log.error("StatsCollector.errorCallback().Get stats error",a),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},AudioLevel.prototype.start=function(a){var b=when.defer(),c=this;return a&&(c.audioLevelsIntervalMilis=a),this.audioLevelsIntervalId=setInterval(function(){c.peerconnection.getStats(function(a){var d=null;a&&a.result&&"function"==typeof a.result?d=a.result():"firefox"==webrtcDetectedBrowser?d=a:"Internet Explorer"==webrtcDetectedBrowser&&(d=a.result()),c.currentAudioLevelsReport=d,c.processAudioLevelReport(),c.baselineAudioLevelsReport=c.currentAudioLevelsReport,b.resolve()},function(a){log.error("StatsCollector.errorCallback().Get stats error",a),b.reject(a)})},c.audioLevelsIntervalMilis),b.promise},AudioLevel.prototype.stop=function(){var a=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,a.resolve()):a.reject(),a.promise},AudioLevel.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport)for(var a in this.currentAudioLevelsReport){var b=this.currentAudioLevelsReport[a];if("ssrc"==b.type){var c=this.baselineAudioLevelsReport[a],d=getStatValue(b,"ssrc");if(c)if(d){var e=!getStatValue(b,"packetsReceived");try{var f=getStatValue(c,"audioInputLevel"),g=getStatValue(c,"audioOutputLevel"),h=getStatValue(b,"audioInputLevel"),i=getStatValue(b,"audioOutputLevel")}catch(a){return loger.error("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(h&&h>0&&f!=h&&e&&room.selfUser.audio.setAudioLevel(h),i&&i>0&&g!=i){var j=room.audioSsrc2user[d];!e&&j&&j.audio&&j.audio.setAudioLevel(i)}}else Date.now()-b.timestamp<3e3&&log.error("No ssrc: ");else log.debug(d+" not enough data")}}};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8;window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=null;LocalStatsCollector.prototype.start=function(){if(window.AudioContext&&!context&&(context=new AudioContext,context.suspend()),context){context.resume();var a=context.createAnalyser();a.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,a.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE;var b=context.createMediaStreamSource(this.stream);b.connect(a);var c=this;this.intervalId=setInterval(function(){var b=new Uint8Array(a.frequencyBinCount);a.getByteTimeDomainData(b);var d=timeDomainDataToAudioLevel(b);d!=c.audioLevel&&(c.audioLevel=animateLevel(d,c.audioLevel),c.callback(c.audioLevel))},this.intervalMilis)}},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},ModuleBase.define("BrowserInfo",[],function(a){var a=function(){};return a.prototype.getBrowserInfo=function(){function a(a,b){var c=window.external||{};for(var d in c)if(a.test(b?c[d]:d))return!0;return!1}var b,c,d,e=(navigator.appVersion,navigator.userAgent),f=navigator.appName,g=""+parseFloat(navigator.appVersion),h="",i="";(c=e.indexOf("OPR/"))!=-1?(f="Opera",g=e.substring(c+4)):(c=e.indexOf("Opera"))!==-1?(f="Opera",g=e.substring(c+6),(c=e.indexOf("Version"))!==-1&&(g=e.substring(c+8))):(c=e.indexOf("MSIE"))!==-1?(f="IE",g=e.substring(c+5)):(c=e.indexOf("Chrome"))!==-1?(f="Chrome",g=e.substring(c+7)):(c=e.indexOf("Safari"))!==-1?(f="Safari",g=e.substring(c+7),(c=e.indexOf("Version"))!==-1&&(g=e.substring(c+8))):(c=e.indexOf("Firefox"))!==-1?(f="Firefox",g=e.substring(c+8)):(b=e.lastIndexOf(" ")+1)<(c=e.lastIndexOf("/"))&&(f=e.substring(b,c),g=e.substring(c+1),f.toLowerCase()===f.toUpperCase()&&(f=navigator.appName));var j=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),k=/QQBrowser/.test(navigator.userAgent),l=/MetaSr/.test(navigator.userAgent),m=/BIDUBrowser/.test(navigator.userAgent),n=a(/^liebao/i,0);return j&&(f="Edge",g=parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),k&&(h="QQ",i=parseInt(navigator.userAgent.match(/QQBrowser\/(\d+).(\d+)/)[2],10).toString()),l&&(h="Sougou",i=parseInt(navigator.userAgent.match(/MetaSr (\d+).(\d+)/)[2],10).toString()),m&&(h="Baidu",i=parseInt(navigator.userAgent.match(/BIDUBrowser\/(\d+).(\d+)/)[1],10).toString()),n&&(h="Liebao",i=""),(d=g.indexOf(";"))!==-1&&(g=g.substring(0,d)),(d=g.indexOf(" "))!==-1&&(g=g.substring(0,d)),{name:f,fullVersion:g,shellName:h,shellFullVersion:i}},a}),ModuleBase.define("OSInfo",[],function(a){var a=function(){};return a.prototype.getOSInfo=function(){var a="Unknown OS",b={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return b.Android()||b.BlackBerry()||b.iOS()||b.Opera()||b.Windows()},getOsName:function(){var a="Unknown OS";return b.Android()&&(a="Android"),b.BlackBerry()&&(a="BlackBerry"),b.iOS()&&(a="iOS"),b.Opera()&&(a="Opera Mini"),b.Windows()&&(a="Windows"),a}};return b.any()?a=b.getOsName():(navigator.appVersion.indexOf("Win")!==-1&&(a="Windows"),navigator.appVersion.indexOf("Mac")!==-1&&(a="OSX"),navigator.appVersion.indexOf("X11")!==-1&&(a="UNIX"),navigator.appVersion.indexOf("Linux")!==-1&&(a="Linux")),a},a}),ModuleBase.define("CheckGetUserMedia",[],function(a){var a=function(){};return a.prototype.getUserMediaSupport=function(){var a=!1;return"undefined"!=typeof navigator.webkitGetUserMedia||"undefined"!=typeof navigator.mozGetUserMedia?a=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(a=!0),a},a}),ModuleBase.define("CheckRTCPeerConnection",[],function(a){var a=function(){};return a.prototype.RTCPeerConnectionSupport=function(){var a=!1;try{a=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(a){return a in window})}catch(a){}return a},a}),ModuleBase.define("CheckDataChannelSupport",[],function(a){var a=function(){};return a.prototype.dataChannelSupport=function(){var a=!1;try{var b=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(b){var c=new b({iceServers:[{url:"stun:0"}]});a="createDataChannel"in c}}catch(b){a=!1}return a},a}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannelSupport"],function(a,b,c,d,e){var f=function(){this.detect={};var f="https:"===location.protocol,g=new a;this.detect.browser=g.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0;var h=new b;this.detect.osName=h.getOSInfo();var i=this.detect.browser.fullVersion,j=i.split("."),k=j[0],l=new c;this.detect.getUserMediaSupport=l.getUserMediaSupport();var m=new d;this.detect.RTCPeerConnectionSupport=m.RTCPeerConnectionSupport();var n=new e;this.detect.dataChannelSupport=n.dataChannelSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,this.detect.browser.isChrome&&k>=42&&(this.detect.screenSharingSupport=!0),f||(this.detect.screenSharingSupport=!1),this.detect.h264Support=!1,this.detect.browser.isChrome&&k>=52&&(this.detect.h264Support=!0),this.detect.browser.isFirefox&&k>=52&&(this.detect.h264Support=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer};return f.prototype.checkBrowserSupport=function(){var a=!1,b=this.detect.browser.isChrome,c=this.detect.browser.isOpera,d=(this.detect.browser.isIE,this.detect.browser.isFirefox),e=(this.detect.browser.name,this.detect.browser.fullVersion),f=e.split("."),g=f[0],h=1==b&&Number(g)>=42||1==c&&Number(g)>=30;return"Android"==this.detect.osName&&(h=1==b&&Number(g)>=37),1==h&&1==this.detect.getUserMediaSupport&&1==this.detect.RTCPeerConnectionSupport&&1==this.detect.WebSocketSupport?a=!0:1==d&&Number(g)>=52&&(a=!0),a},f.prototype.checkChromeSupportH264=function(){var a=!1,b=this.detect.browser.isChrome,c=(this.detect.browser.name,this.detect.browser.fullVersion),d=c.split("."),e=d[0],f=1==b&&Number(e)>=52;return 1==f&&(a=!0),a},f}),ModuleBase.define("Stream",[],function(){var a=function(a,b){this.id=a,this.name=b,this.status=StreamStatus.init,this.stream=null,this.element=null,this.resourceInfo=null,this.ownerId=null};return a}),ModuleBase.define("Video",["Stream","Error"],function(a,b){var c=function(b,c){a.call(this,b,c),this.level,this.description,this.resolution,this.resolutionSelect,this.frameRate,this.cameraType};return c.prototype=new a,c.prototype.setLevel=function(a){this.level=a},c.prototype.setDescription=function(a){this.description=a},c.prototype.setResolution=function(a){this.resolutionSelect=a,this.resolution=Resolution[a]},c.prototype.setResolutionWH=function(a,b){this.resolutionSelect=a;var c={};c.order=1,c.width=a,c.height=b,this.resolution=c},c.prototype.setFrameRate=function(a){"string"==typeof a&&(a=Number(a)),this.frameRate=a},c.prototype.preview=function(a){var c=when.defer(),d=doFsCheck(FTConstant.video,b);if(null!=d)return c.reject(d),c.promise;var e=parseInt(this.resolutionSelect);if(e>640){var d=doFsCheck(FTConstant.video_hd,b);if(null!=d)return c.reject(d),c.promise}if(null!=this.stream)this.status!=StreamStatus.published&&(this.status=StreamStatus.opened),this.element=a,attachMediaStream(a,this.stream),c.resolve();else{var f=this;obtainUserMedia(null,this,function(b){f.status=StreamStatus.opened,f.stream=b.videoStream,f.element=a,attachMediaStream(a,b.videoStream),c.resolve()},function(a){c.reject(a)})}return c.promise},c.prototype.unpreview=function(){null!=this.element&&(attachMediaStream(this.element,null),this.status=StreamStatus.init,this.element=null)},c.prototype.publish=function(){var a=when.defer();return this.publishHandle().then(function(){a.resolve()}).otherwise(function(b){a.reject(b)}),a.promise},c.prototype.previewAndPublish=function(a){var c=when.defer(),d=doFsCheck(FTConstant.video,b);if(null!=d)return c.reject(d),c.promise;var e=parseInt(this.resolutionSelect);if(e>640){var d=doFsCheck(FTConstant.video_hd,b);if(null!=d)return c.reject(d),c.promise}return this.publishHandle(a).then(function(){c.resolve()}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.publishHandle=function(a){var b=when.defer(),c=getRandomNum(1,3e3),d=this;if(d.status==StreamStatus.init)if(null!=d.stream){var e=room.composePDUDeviceId(room.selfUser.id,d.id);room.masterServer.videoPublishHandle(e,d.stream,c),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==c&&(void 0!=a&&(d.status=StreamStatus.opened,d.element=a,attachMediaStream(a,d.stream)),d.status=StreamStatus.published,room.pubVideos.push(d),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,d.status,d.id,d.name,room.selfUser.id),b.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,d){d==c&&b.reject(a)})}else obtainUserMedia(null,this,function(e){d.status=StreamStatus.opened,d.stream=e.videoStream;var f=room.composePDUDeviceId(room.selfUser.id,d.id);room.masterServer.videoPublishHandle(f,d.stream,c),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==c&&(void 0!=a&&(d.status=StreamStatus.opened,d.element=a,attachMediaStream(a,d.stream)),d.status=StreamStatus.published,room.pubVideos.push(d),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,d.status,d.id,d.name,room.selfUser.id),b.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,d){d==c&&b.reject(a)})},function(a){b.reject(a)});else if(d.status==StreamStatus.opened){var e=room.composePDUDeviceId(room.selfUser.id,d.id);room.masterServer.videoPublishHandle(e,d.stream,c),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(a){a==c&&(d.status=StreamStatus.published,room.pubVideos.push(d),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,d.status,d.id,d.name,room.selfUser.id),b.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,d){d==c&&b.reject(a)})}else if(d.status==StreamStatus.published&&room.reconnectionCount>0){var e=room.composePDUDeviceId(room.selfUser.id,d.id);room.masterServer.videoPublishHandle(e,d.stream,c),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(a){a==c&&(room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,d.status,d.id,d.name,room.selfUser.id),b.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,d){d==c&&b.reject(a)})}return b.promise},c.prototype.unpublish=function(){if(this.status==StreamStatus.published||this.status==StreamStatus.init&&(null!=this.stream||void 0!=this.stream)){arrayUtil.objectSplice(room.pubVideos,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id);var a=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.videoUnpublishHandle(a,this.stream),this.stream&&this.stream.getTracks().forEach(function(a){a.stop()}),this.stream=null}},c.prototype.subscrible=function(){room.selfUser.subVideoStream2ResourceInfo[this.resourceInfo.stream.stream_name]=this.resourceInfo,room.selfUser.subVideoIds.push(this.id),room.masterServer.videoSubscribleHandle(this.resourceInfo)},c.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subVideoIds,this.id),room.masterServer.videoUnsubscribleHandle(this.resourceInfo)},c.prototype.updateCameraData=function(a,b){var c=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=a,this.description=b,room.masterServer.updateWebcamMsg(room.selfUser.nodeId,c,this)},c}),ModuleBase.define("Audio",["Stream","Error"],function(a,b){var c=function(b,c){a.call(this,b,c),this.oldAudioLevel=0,this.audioLevel=0};return c.prototype=new a,c.prototype.openMicrophone=function(a){var c=when.defer(),d=doFsCheck(FTConstant.audio,b);if(null!=d)return c.reject(d),c.promise;var e=getRandomNum(30001,6e3),f=this;if(null!=this.stream){var g=room.composePDUDeviceId(room.selfUser.id,f.id);room.masterServer.audioPublishHandle(g,f.stream,e),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(b){b==e&&(f.state=StreamStatus.opened,"undefined"!=typeof a&&null!=a&&""!=a&&(f.element=a,attachMediaStream(a,f.stream)),f.status=StreamStatus.published,room.pubAudios.push(f),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,f.status,f.id,f.name,room.selfUser.id),c.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,b){b==e&&c.reject(a)})}else obtainUserMedia(this,null,function(b){f.state=StreamStatus.opened,f.stream=b.audioStream;var d=room.composePDUDeviceId(room.selfUser.id,f.id);room.masterServer.audioPublishHandle(d,f.stream,e),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(d){d==e&&("undefined"!=typeof a&&null!=a&&""!=a&&(f.element=a,attachMediaStream(a,b.audioStream)),f.status=StreamStatus.published,room.pubAudios.push(f),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,f.status,f.id,f.name,room.selfUser.id),c.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,b){b==e&&c.reject(a)})},function(a){c.reject(a)});return c.promise},c.prototype.closeMicrophone=function(){if(this.status==StreamStatus.published||this.status==StreamStatus.muted){null!=this.element&&(attachMediaStream(this.element,null),this.element=null),arrayUtil.objectSplice(room.pubAudios,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var a=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.audioUnpublishHandle(a,this.stream),this.setAudioLevel(0),this.stream&&this.stream.getTracks().forEach(function(a){a.stop()}),this.stream=null}},c.prototype.muteMicrophone=function(){if(this.status==StreamStatus.published){this.status=StreamStatus.muted,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var a=this.stream.getAudioTracks();for(i=0;i<a.length;i++)a[i].enabled=!1;var b=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,b,this)}},c.prototype.unmuteMicrophone=function(){if(this.status==StreamStatus.muted){this.status=StreamStatus.published,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id);var a=this.stream.getAudioTracks();for(i=0;i<a.length;i++)a[i].enabled=!0;var b=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,b,this)}},c.prototype.ismuteMicrophone=function(){var a=!1;return this.status==StreamStatus.muted&&(a=!0),a},c.prototype.setAudioLevel=function(a){this.audioLevel=a},c.prototype.getAudioLevel=function(){return this.audioLevel>0&&this.audioLevel==this.oldAudioLevel&&this.setAudioLevel(0),this.oldAudioLevel=this.audioLevel,this.audioLevel},c}),ModuleBase.define("Screen",["Stream","Error"],function(a,b){var c=function(b,c){a.call(this,b,c),this.level,this.description,this.resolution,this.frameRate};return c.prototype=new a,c.prototype.setLevel=function(a){this.level=a},c.prototype.setDescription=function(a){this.description=a},c.prototype.setResolution=function(a){this.resolution=EngineEnum.Resolution[a]},c.prototype.setFrameRate=function(a){this.frameRate=a},c.prototype.preview=function(a){self.element=a,attachMediaStream(a,this.stream)},c.prototype.publish=function(a){var c=when.defer(),d=doFsCheck(FTConstant.screen,b);if(null!=d)return c.reject(d),c.promise;if(this.status==StreamStatus.published)c.resolve();else try{var e=this;chrome.runtime.sendMessage(a,{getStream:!0},function(a){if(void 0==a||null==a||""==a){log.debug("Access to screen denied");var d=new b(ErrorConstant.screen_sharing_plugin_not_accessible);return void c.reject(d)}var f=a.streamId;if(log.debug("pending Request Id:"+f),""==f||null==f){log.debug("Access rejected.");var d=new b(ErrorConstant.screen_sharing_response_is_null);return void c.reject(d)}navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:f,maxWidth:screen.width,maxHeight:screen.height,minFrameRate:1,maxFrameRate:5}}},function(a){log.debug("gotShareStream. stream:"+a),"undefined"!=typeof a.onended?a.onended=function(){log.debug("stream.onended"),log.debug("Share stream ended"),log.debug("OpenMyDesktop(),stream.onended,user.unpubDesktop"),null!=e.stream&&(e.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,e.status,e.id,e.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:a.oninactive=function(){log.debug("stream.oninactive"),log.debug("Share stream ended"),log.debug("OpenMyDesktop(),stream.oninactive,user.unpubDesktop"),null!=e.stream&&(e.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,e.status,e.id,e.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)};var b=getRandomNum(6001,9e3),d=room.composePDUDeviceId(room.selfUser.id,e.id);
room.masterServer.screenPublishHandle(d,a,b),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(d){d==b&&(e.stream=a,e.status=StreamStatus.published,room.pubScreens.push(e),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,e.status,e.id,e.name,room.selfUser.id),c.resolve(f))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,d){d==b&&c.reject(a)})},function(a){log.debug("An error occurred: "+a);var a=new b(ErrorConstant.screen_sharing_plugin_not_accessible);c.reject(a)})})}catch(a){log.debug("Screen sharing plugin is not accessible ");var d=new b(ErrorConstant.screen_sharing_plugin_not_accessible);return void c.reject(d)}return c.promise},c.prototype.unpublish=function(){if(this.status==StreamStatus.published){this.status=StreamStatus.init;var a=room.composePDUDeviceId(room.selfUser.id,this.id);room.masterServer.screenUnpublishHandle(a,this.stream),room.isMcu()||(this.stream=null)}},c.prototype.subscrible=function(){room.selfUser.subScreenStream2ResourceInfo[this.resourceInfo.stream.stream_name]=this.resourceInfo,room.selfUser.subScreenIds.push(this.id),room.masterServer.screenSubscribleHandle(this.resourceInfo)},c.prototype.unsubscrible=function(){arrayUtil.baseSplice(room.selfUser.subScreenIds,this.id),room.masterServer.screenUnsubscribleHandle(this.resourceInfo)},c.prototype.updateScreenData=function(a,b){var c=room.composePDUDeviceId(room.selfUser.id,this.id);this.level=a,this.description=b,room.masterServer.updateScreenIdMsg(room.selfUser.nodeId,c,this)},c});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1},fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0};navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(a){navigator.mediaDevices.enumerateDevices().then(a)});var mcuRestServerUrl,roomServerUrl,iceServers,stunUrl,trunUrl,iceusername,iceCredential,is_cluster=!1,protocolStr=document.location.protocol;"http:"!=protocolStr&&"https:"!=protocolStr&&(protocolStr="http:");var fsCheck={isCheck:!1,content:{}},doFsCheck=function(a,b){var c=null;if(1==fsCheck.isCheck){var d=fsCheck.content[a.value];1!=d&&(c=new b(ErrorConstant.ft_no_authorization.code,a.name+ErrorConstant.ft_no_authorization.message))}return c};ModuleBase.define("RestServer",["Error"],function(Error){var RestServer=function(){};return RestServer.prototype.getServerinfo=function(serverURI,accessToken){var deferred=when.defer();mcuRestServerUrl=serverURI;var tjson={access_tocken:accessToken};tjson=JSON.stringify(tjson);var base64token=encodeURI(tjson),serverinfoUrl=protocolStr+"//"+serverURI+"/sdk/config/serverinfo?uri_encode=yes&client_info="+base64token;return $.ajax({type:"get",url:serverinfoUrl,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(serverinfo){var fuValue=serverinfo.ft_value;fuValue&&(fsCheck.isCheck=!0,"object"==typeof fuValue?fsCheck.content=fuValue:"string"==typeof fuValue&&(fsCheck.content=eval("("+fuValue+")")));var error=doFsCheck(FTConstant.platform_web,Error);return null!=error?(deferred.reject(error),deferred.promise):(roomServerUrl=serverinfo.room_server.uri,iceServers=serverinfo.ice_servers,null!=iceServers&&iceServers.length>0&&(stunUrl=iceServers[0].url,trunUrl=iceServers[1].url,iceusername=iceServers[1].username,iceCredential=iceServers[1].credential),serverinfo.is_cluster&&("true"!=serverinfo.is_cluster&&1!=serverinfo.is_cluster||(is_cluster=!0)),void deferred.resolve())},error:function(a,b,c){log.info("ajax (/sdk/config/serverinfo) serverinfoUrl:"+serverinfoUrl),log.info("ajax (/sdk/config/serverinfo) errorThrown:"+c.stack),log.info("ajax (/sdk/config/serverinfo) XMLHttpRequest.status:"+a.status+",XMLHttpRequest.statusText:"+a.statusText);var d=new Error(a.status,a.statusText);deferred.reject(d)}}),deferred.promise},RestServer.prototype.getMcu=function(a,b){var c=when.defer(),d=protocolStr+"//"+mcuRestServerUrl+"/sdk/get_mcu?room_id="+a+"&token="+b;return avdEngine.mcuClusterRouteParams&&(d=d+"&options="+avdEngine.mcuClusterRouteParams,log.info("ajax (/sdk/getMcu) getMcuUrl(带mcuClusterRouteParams):"+d)),$.ajax({type:"get",url:d,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(a){var b=a.ret;if(0==b)roomServerUrl=a.addr,c.resolve();else{var d=new Error(b,a.msg);c.reject(d)}},error:function(a,b,e){log.info("ajax (/sdk/getMcu) getMcuUrl:"+d),log.info("ajax (/sdk/getMcu) errorThrown:"+e.stack),log.info("ajax (/sdk/getMcu) XMLHttpRequest.status:"+a.status+",XMLHttpRequest.statusText:"+a.statusText);var f=new Error(a.status,a.statusText);c.reject(f)}}),c.promise},RestServer.prototype.getMcuWithOEM=function(a,b){var c=when.defer(),d=protocolStr+"//"+mcuRestServerUrl+"/sdk/get_mcu?room_id="+a+"&access_token="+b;return $.ajax({type:"get",url:d,dataType:"jsonp",jsonpCallback:"test",timeout:5e3,success:function(a){var b=a.ret;if(0==b)roomServerUrl=a.addr,room.avdEngine.accessToken=a.access_token,log.info("ajax (/sdk/getMcuWithOEM)  roomServerUrl:"+a.addr+"；accessToken："+a.access_token),c.resolve();else{var d=new Error(b,a.msg);c.reject(d)}},error:function(a,b,e){log.info("ajax (/sdk/getMcuWithOEM) getMcuUrl:"+d),log.info("ajax (/sdk/getMcuWithOEM) errorThrown:"+e.stack),log.info("ajax (/sdk/getMcuWithOEM) XMLHttpRequest.status:"+a.status+",XMLHttpRequest.statusText:"+a.statusText);var f=new Error(a.status,a.statusText);401==a.status||400==a.status?f=new Error(401,"unauthorized"):404==a.status||602==a.status?f=new Error(404,"room not found"):409==a.status&&(f=new Error(409,"http query server timeout")),c.reject(f)}}),c.promise},RestServer}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection"],function(a,b){function c(a){var b=a.split("(")[1].split(")")[0],c=b.split(",");return c.length>=4?c[3]=parseInt(255*c[3]):c[3]=255,c}function d(){var a="js_v2.5.0.0";return a+="firefox"==webrtcDetectedBrowser?" vp8:120,vp9:121,h264:126":webrtcDetectedVersion<57?" vp8:100,vp9:101,h264:107":" vp8:96,vp9:98,h264:100"}var e=function(c){this.signalingChannel=c,this.cmdProtobufCoded=new a,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.traceablePeerConnection=new b,room.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection(),"firefox"==webrtcDetectedBrowser&&this.traceablePeerConnection.getToMCUPeerConnectionForFirefox()};return e.prototype.openReqSend=function(){var a=d();log.debug("====openReqSend,version:"+a);var b=this.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,"",a),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,b);log.info("====openReqSend,OPEN_REQ====="),this.signalingChannel.send(c)},e.prototype.openReqReconnectionSend=function(){var a=d();log.debug("====openReqReconnectionSend,version:"+a);var b=this.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,room.signalTocken,a),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,b);log.info("====openReqReconnectionSend,OPEN_REQ====="),this.signalingChannel.send(c)},e.prototype.pingIntervalHandle=function(){var a=this;room.pingIntervalId=setInterval(function(){room.pingCountTime+=room.pingInterval,packetArray=a.cmdProtobufCoded.encodedPacket(a.roomPduType.PING,0,0,0,null),a.signalingChannel.send(packetArray)},room.pingInterval)},e.prototype.pingTimeoutHandle=function(){var a=this;room.pingTimeoutId=setInterval(function(){room.pingCountTime>=1e4&&(room.reconnectionState||(log.debug("=========Ping Timeout,开始重连...==========="),a.pingInit(),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.reconnectionHandle()))},1e3)},e.prototype.pingInit=function(){clearInterval(room.pingIntervalId),clearInterval(room.pingTimeoutId),room.pingIntervalId=null,room.pingTimeoutId=null,room.pingCountTime=0},e.prototype.inviteRoomReqSend=function(){var a=null;room.reconnectionCount>0&&(a=room.selfUser.nodeId);var b=[],c=[],d=this.cmdProtobufCoded.newUserPolicy(!0,!0,!0),e=this.cmdProtobufCoded.newJoinInfo(b,c,new String("user_agent"),d),f=this.cmdProtobufCoded.newInviteRoomReq1(20,room.id,"",room.avdEngine.accessToken,room.selfUser.id,room.selfUser.name,e,room.selfUser.password,a);if(f.user_data=room.selfUser.data,"firefox"==webrtcDetectedBrowser){var g=this;this.traceablePeerConnection.getInviteRoomReq1ByFirefox().then(function(){void 0!=room.iceUfragLocal&&(f.ice_ufrag=room.iceUfragLocal),void 0!=room.icePwdLocal&&(f.ice_pwd=room.icePwdLocal),void 0!=room.iceUfragLocal2&&(f.ice_ufrag=f.ice_ufrag+":"+room.iceUfragLocal2),void 0!=room.icePwdLocal2&&(f.ice_pwd=f.ice_pwd+":"+room.icePwdLocal2);var a=g.cmdProtobufCoded.encodedPacket(g.roomPduType.INVITE_ROOM_REQ1,0,0,0,f);g.signalingChannel.send(a)})}else{var h=this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,f);this.signalingChannel.send(h)}},e.prototype.sendOffer=function(){var a=this;this.traceablePeerConnection.doSetLocalDescription().then(function(){a.traceablePeerConnection.doSetRemoteDescription()}),"firefox"==webrtcDetectedBrowser&&this.traceablePeerConnection.doSetLocalDescriptionForFirefox().then(function(){a.traceablePeerConnection.doSetRemoteDescriptionForFirefox()})},e.prototype.setAddIcecandidate=function(a){if(roomServerUrl){var b=roomServerUrl.split("/"),c=b[0];if(c){var d=c.split(":");d.size>0&&(c=d[0])}a.candidate=a.candidate.replace("127.0.0.1",c)}log.info("setAddIcecandidate(),mcu server send candidate:"+a.candidate),this.traceablePeerConnection.doAddIceCandidate(a)},e.prototype.addWebcamMsg=function(a,b){var c=this.cmdProtobufCoded.newWebcam(a,b.name,b.status,this.sessionType.Video);c.ctype=this.cameraType.unknown,c.level=b.level,c.description=b.description;var d=this.cmdProtobufCoded.newAddWebcamMsg(room.selfUser.nodeId,c),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(e)},e.prototype.removeWebcamMsg=function(a){var b=this.cmdProtobufCoded.newRemoveWebcamMsg(room.selfUser.nodeId,a),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,room.selfUser.nodeId,0,b);this.signalingChannel.send(c)},e.prototype.addScreenMsg=function(a,b){var c=this.cmdProtobufCoded.newDesktop(a,b.name,b.status,this.sessionType.ShareScreen);c.level=b.level,c.description=b.description;var d=this.cmdProtobufCoded.newAddDesktopMsg(room.selfUser.nodeId,c),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(e)},e.prototype.addSpeakerMsg=function(a,b){var c=this.cmdProtobufCoded.newSpeaker(a,b.name,b.status,this.sessionType.Audio),d=this.cmdProtobufCoded.newAddSpeakerMsg(room.selfUser.nodeId,c),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(e)},e.prototype.removeSpeakerMsg=function(a){var b=this.cmdProtobufCoded.newRemoveSpeakerMsg(room.selfUser.nodeId,a),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,room.selfUser.nodeId,0,b);this.signalingChannel.send(c)},e.prototype.updateUserDataMsg=function(a){var b=this.cmdProtobufCoded.newUpdateUserDataMsg(room.selfUser.nodeId,a),c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,room.selfUser.nodeId,0,b);this.signalingChannel.send(c)},e.prototype.roomDataInfo=function(a,b){var c=this.cmdProtobufCoded.newRoomKV(a,b),d=[];d.push(c);var e=this.cmdProtobufCoded.newRoomDataInfo(room.id,d),f=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,room.selfUser.nodeId,0,e);this.signalingChannel.send(f)},e.prototype.pubRoomResourceMsg=function(a,b,c,d,e){var f;if("video"==a){var g=100;videoCoding==VideoCodingType.VP8?g=100:videoCoding==VideoCodingType.VP9?g=101:videoCoding==VideoCodingType.H264&&(g=107),f=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.video,c,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,g)}else"audio"==a?f=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.audio,c):"screen"==a&&(f=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.desktop,c));if(null!=f){var h=this.cmdProtobufCoded.newRoomResourceInfo(d,room.selfUser.nodeId,f),i=this.cmdProtobufCoded.newPubRoomResourceMsg(h,e),j=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(j),this.signalingChannel.send("")}},e.prototype.subRoomResourceMsg=function(a,b){var c;if(1==a){var d=this.cmdProtobufCoded.newSubRoomResourceMsg(b,room.selfUser.nodeId);c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,d)}else if(0==a){var e=this.cmdProtobufCoded.newUnsubRoomResourceMsg(b,room.selfUser.nodeId);c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,e)}this.signalingChannel.send(c),this.signalingChannel.send("")},e.prototype.unpubRoomResourceMsg=function(a,b,c){var d,e;"video"==a?(d=room.selfUser.videoSdpSsrc,e=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.video,d)):"audio"==a?(d=room.selfUser.audioSdpSsrc,e=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.audio,d)):"screen"==a&&(d=room.selfUser.screenSdpSsrc,e=this.cmdProtobufCoded.newMediaStream(b,this.mediaType.desktop,d));var f=this.cmdProtobufCoded.newRoomResourceInfo(c,room.selfUser.nodeId,e),g=this.cmdProtobufCoded.newUnpubRoomResourceMsg(f),h=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,g);this.signalingChannel.send(h),this.signalingChannel.send("")},e.prototype.updateSpeakerMsg=function(a,b,c){var d=room.composePDUDeviceId(room.selfUser.id,c.id),e=this.cmdProtobufCoded.newSpeaker(d,c.name,c.status,this.sessionType.Audio),f=this.cmdProtobufCoded.newUpdateSpeakerMsg(a,b,e),g=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,room.selfUser.nodeId,0,f);this.signalingChannel.send(g),this.signalingChannel.send("")},e.prototype.updateWebcamMsg=function(a,b,c){var d=room.composePDUDeviceId(room.selfUser.id,c.id),e=c.status;c.status!=StreamStatus.none&&c.status!=StreamStatus.opened||(e=1);var f=this.cmdProtobufCoded.newWebcam(d,c.name,e,this.sessionType.Video);f.level=c.level,f.description=c.description;var g=this.cmdProtobufCoded.newUpdateWebcamMsg(a,b,f),h=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,room.selfUser.nodeId,0,g);this.signalingChannel.send(h),this.signalingChannel.send("")},e.prototype.updateScreenIdMsg=function(a,b,c){var d=room.composePDUDeviceId(room.selfUser.id,c.id),e=this.cmdProtobufCoded.newDesktop(d,c.name,c.status,this.sessionType.ShareScreen);e.level=c.level,e.description=c.description;var f=this.cmdProtobufCoded.newUpdateDesktopMsg(a,b,e),g=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,room.selfUser.nodeId,0,f);this.signalingChannel.send(g),this.signalingChannel.send("")},e.prototype.videoIndiction=function(a,b,c){var d=this.resourceOpt.pub;a||(d=this.resourceOpt.unpub);var e=this.cmdProtobufCoded.newResourceIndiction(b,d,c,room.selfUser.nodeId,"host_tocken"),f=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,room.selfUser.nodeId,c,e);this.signalingChannel.send(f)},e.prototype.audioIndiction=function(a,b,c){var d=this.resourceOpt.pub;a||(d=this.resourceOpt.unpub);var e=this.cmdProtobufCoded.newResourceIndiction(b,d,c,room.selfUser.nodeId,"host_tocken"),f=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,room.selfUser.nodeId,c,e);this.signalingChannel.send(f)},e.prototype.sendMessage=function(a,b){var c=new Date;c.setMinutes(c.getMinutes()+c.getTimezoneOffset());var d=c.getTime();d=Math.round(d/1e3);var e=this.cmdProtobufCoded.newTextMsg(a,d),f=this.roomPduType.PUBLIC_TEXT_MSG,g=0;if("undefined"!=typeof b&&null!=b&&""!=b){var h=room.getNodeId(b);null!=h&&(g=h,f=this.roomPduType.PRIVATE_TEXT_MSG)}var i=this.cmdProtobufCoded.encodedPacket(f,0,room.selfUser.nodeId,g,e);this.signalingChannel.send(i)},e.prototype.sendData=function(a,b){var c=this.cmdProtobufCoded.newData(a),d=this.roomPduType.PUBLIC_DATA,e=0;if("undefined"!=typeof b&&null!=b&&""!=b){var f=room.getNodeId(b);null!=f&&(e=f,d=this.roomPduType.PRIVATE_DATA)}var g=this.cmdProtobufCoded.encodedPacket(d,0,room.selfUser.nodeId,e,c);this.signalingChannel.send(g)},e.prototype.userIndiction=function(a,b){var c=room.getNodeId(b),d=this.cmdProtobufCoded.newUserMsg(c,this.userMsgOpt.kickoff,a),e=this.cmdProtobufCoded.newUserIndiction(room.selfUser.nodeId,this.roomPduType.USER_MSG,d.toArrayBuffer()),f=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,room.selfUser.nodeId,c,e);this.signalingChannel.send(f)},e.prototype.userMsg=function(a,b){var c=this.userMsgOpt.leave;b&&(c=this.userMsgOpt.kickoff);var d=this.cmdProtobufCoded.newUserMsg(room.selfUser.nodeId,c,a),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(e)},e.prototype.videoPublishHandle=function(a,b,c){room.isMcu()?room.traceablePeerConnection.addSdp("video",a,b,c):this.pubRoomResourceMsg("video",b.id,null,a,c)},e.prototype.videoUnpublishHandle=function(a,b){room.isMcu()?room.traceablePeerConnection.reduceSdp("video",a,b):this.unpublishHandleP2P("video",room.selfUser.subMyVideosP2P,b,a)},e.prototype.videoSubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("video",1,a):this.subscribleHandleP2P(a)},e.prototype.videoUnsubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("video",0,a):this.unsubscribleHandleP2P("video",a)},e.prototype.screenPublishHandle=function(a,b,c){room.isMcu()?room.traceablePeerConnection.addSdp("screen",a,b,c):this.pubRoomResourceMsg("screen",b.id,null,a,c)},e.prototype.screenUnpublishHandle=function(a,b){room.isMcu()?room.traceablePeerConnection.reduceSdp("screen",a,b):this.unpublishHandleP2P("screen",room.selfUser.subMyScreensP2P,b,a)},e.prototype.screenSubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",1,a):this.subscribleHandleP2P(a)},e.prototype.screenUnsubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",0,a):this.unsubscribleHandleP2P("screen",a)},e.prototype.audioPublishHandle=function(a,b,c){room.isMcu()?room.traceablePeerConnection.addSdp("audio",a,b,c):this.pubRoomResourceMsg("audio",b.id,null,a,c)},e.prototype.audioUnpublishHandle=function(a,b){room.isMcu()?room.traceablePeerConnection.reduceSdp("audio",a,b):this.unpublishHandleP2P("audio",room.selfUser.subMyAudiosP2P,b,a)},e.prototype.audioSubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",1,a):this.subscribleHandleP2P(a)},e.prototype.audioUnsubscribleHandle=function(a){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",0,a):this.unsubscribleHandleP2P("audio",a)},e.prototype.sendOfferP2P=function(a,b){log.debug("=========sendOfferP2P()========OFFER_REQ======");var c=this.cmdProtobufCoded.newOfferReq(0,a,room.selfUser.nodeId),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,room.selfUser.nodeId,b,c);this.signalingChannel.send(d)},e.prototype.setRemoteP2P=function(a,b){log.debug("=========setRemoteP2P()========OFFER_REP======");var c=this.cmdProtobufCoded.newOfferRep(0,1,"",a,room.selfUser.nodeId),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,room.selfUser.nodeId,b,c);this.signalingChannel.send(d)},e.prototype.sendCandidateMsgP2P=function(a,b){var c=this.cmdProtobufCoded.newCandidateMsg(a.candidate,a.sdpMLineIndex,a.sdpMid,room.selfUser.nodeId),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,room.selfUser.nodeId,b,c);this.signalingChannel.send(d)},e.prototype.sendSubSdpOfferP2P=function(a,b,c){var d=a.info;d.stream.sdp=b;var e;if("offerSub"==c)log.debug("send P2P SUB_ROOM_RESOURCE_REQ: "+room.selfUser.nodeId+"------>"+d.owner_id),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,d.owner_id,a);else if("answerSub"==c){log.debug("send P2P SUB_ROOM_RESOURCE_REP: "+room.selfUser.nodeId+"------>"+a.sub_node_id);var f=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",d);e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,a.sub_node_id,f)}this.signalingChannel.send(e),this.signalingChannel.send("")},e.prototype.sendSubSdpAnswerP2P=function(a,b,c,d){b.stream.sdp=c;var e;if("offerSub"==a){var f=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",b);e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,d,f)}else if("answerSub"==a){var g=this.cmdProtobufCoded.newSubRoomResourceMsg(b,room.selfUser.nodeId);e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,d,g)}this.signalingChannel.send(e),this.signalingChannel.send("")},e.prototype.subscribleHandleP2P=function(a){if(room.selfUser.nodeId>a.owner_id){a.stream.sdp="";var b=this.cmdProtobufCoded.newSubRoomResourceReq(0,a,room.selfUser.nodeId);log.info("=========subscribleHandleP2P() =======SUB_ROOM_RESOURCE_REQ====");var c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,a.owner_id,b);this.signalingChannel.send(c),this.signalingChannel.send("")}else{var b=this.cmdProtobufCoded.newSubRoomResourceReq(0,a,room.selfUser.nodeId);room.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",b)}},e.prototype.unpublishHandleP2P=function(a,b,c,d){if(null!=b&&b.length>0)for(var e=0;e<b.length;e++){var f=b[e];room.traceableP2PPeerConnection.removeStreamP2P(a,f,c),room.selfUser.nodeId>f?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",a,f,null):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",a,f,null)}var g;"video"==a?(g=this.mediaType.video,log.debug("===unPubWebcam() p2p=== send  video  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------>service")):"audio"==a?(g=this.mediaType.audio,log.debug("===unPubWebcam() p2p=== send  audio  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------>service")):"screen"==a&&(g=this.mediaType.desktop,log.debug("===unPubWebcam() p2p=== send  screen  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------>service"));var h=this.cmdProtobufCoded.newMediaStream(c.id,g,null),i=this.cmdProtobufCoded.newRoomResourceInfo(d,room.selfUser.nodeId,h),j=this.cmdProtobufCoded.newUnpubRoomResourceMsg(i),k=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,j);this.signalingChannel.send(k),this.signalingChannel.send("")},e.prototype.unsubscribleHandleP2P=function(a,b){room.selfUser.nodeId>b.owner_id?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",a,b.owner_id,b):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",a,b.owner_id,b)},e.prototype.sendAnnotationMessage=function(a,b,d,e,f,g,h,i,j){for(var b=b+"",k="1",l=[],m=d[0].x,n=d[0].x,o=d[0].y,p=d[0].y,q=0;q<d.length;q++){var r=this.cmdProtobufCoded.newPoint(d[q].x,d[q].y);l.push(r),d[q].x>m&&(m=d[q].x),d[q].x<n&&(n=d[q].x),d[q].y>o&&(o=d[q].y),d[q].y<o&&(o=d[q].y)}var s=this.lineArrow.none,t=this.annotationType.annotation_tool_mouse;e==canvasTypeEnum.line?t=this.annotationType.annotation_tool_line:e==canvasTypeEnum.rect?t=this.annotationType.annotation_tool_rectangle:e==canvasTypeEnum.polyline?t=this.annotationType.annotation_tool_polyline:e==canvasTypeEnum.ellipse?t=this.annotationType.annotation_tool_ellipse:e==canvasTypeEnum.arrowline?(t=this.annotationType.annotation_tool_line,s=h||this.lineArrow.none):e==canvasTypeEnum.undo?t=this.annotationType.annotation_tool_undo:e==canvasTypeEnum.redo?t=this.annotationType.annotation_tool_redo:e==canvasTypeEnum.eraser?t=this.annotationType.annotation_tool_eraser_line:e==canvasTypeEnum.right?t=this.annotationType.annotation_tool_success:e==canvasTypeEnum.wrong&&(t=this.annotationType.annotation_tool_failure);var u=c(f),v=this.cmdProtobufCoded.newcolor(parseInt(u[3]),parseInt(u[0]),parseInt(u[1]),parseInt(u[2])),w=null;i==fillTypeEnum.none?w=this.cmdProtobufCoded.newcolor(0,255,255,255):i==fillTypeEnum.full&&(w=v);var x=this.cmdProtobufCoded.newRect(p,o,n,m),y=this.cmdProtobufCoded.newAnnotationObject(b,k,room.selfUser.nodeId,room.selfUser.id,t,s,g,v,w,x),z=null;if(2==l.length){var A=l[0],B=l[1];z=this.cmdProtobufCoded.newAnnotation2Point(y,A,B)}else z=l.length>2?this.cmdProtobufCoded.newAnnotationMultiPoint(y,l):this.cmdProtobufCoded.newAnnotationList(y,j);var C=this.cmdProtobufCoded.newAnnotationMsgInternal(t,z.toArrayBuffer(),k,room.selfUser.nodeId,0),D=this.cmdProtobufCoded.newAnnotationMsg(t,C.toArrayBuffer()),E=this.roomPduType.ANNOTATION_MSG,F=this.cmdProtobufCoded.encodedPacket(E,0,room.selfUser.nodeId,0,D);this.signalingChannel.send(F)},e}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(a){function b(a){room.selfUser.nodeId<a&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(a))}var c=function(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new a,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection};return c.prototype.createP2PPeerConnection=function(a){null!=room.selfUser&&null!=room.selfUser.nodeId?b(a):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&b(a)},200)},c});var log=log4javascript.getLogger(),room,rooms=[],browserDetect,videoCoding=VideoCodingType.VP8,setRemoteDescriptionSuccess=!1,setRemoteDescriptionSuccessForFirefox=!1,addIcecandidateList=[];ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","Record","Live"],function(a,b,c,d,e,f){function g(a){for(var b=null,c=0;c<rooms.length;c++){var d=rooms[c];if(d.roomId==a){b=d;break}}return b}function h(a){var b=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss} %-5p - %m{1}%n");a.setLayout(b),log.addAppender(a)}function i(a,b,c,d){var e=[];for(var f in b)e.push(f);var g=arrayUtil.inANotInB(e,a),h=arrayUtil.inANotInB(a,e);if(0==h.length&&0==g.length)return!1;for(var i=0;i<this.rooms.length;i++){var j=c[i];if(null!=j.selfUser){if(g.length>0)for(var k=0;k<g.length;k++){var l=b[g[k]];d[g[k]]=l}if(h.length>0)for(var k=0;k<h.length;k++){var l=d[h[k]];h[k]==self.checkMicrophoneId&&j.selfUser.deleteAudio(h[k]),delete d[h[k]]}}}}function j(a,b,c,d){var e=[];for(var f in b)e.push(f);var g=arrayUtil.inANotInB(e,a),h=arrayUtil.inANotInB(a,e);if(0==h.length&&0==g.length)return!1;for(var i=0;i<c.length;i++){var j=c[i];if(null!=j.selfUser){if(g.length>0)for(var k=0;k<g.length;k++){var l=b[g[k]];d[g[k]]=l,j.selfUser.initVideo(g[k],l)}if(h.length>0)for(var k=0;k<h.length;k++)delete d[h[k]],j.selfUser.deleteVideo(h[k])}}}var k=function(){this.accessToken,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.checkAudioStream=null,this.checkVideoStream=null,this.mcuClusterRouteParams=null;var a=new log4javascript.BrowserConsoleAppender;a.setThreshold(log4javascript.Level.ERROR),h(a)};return k.prototype.getVersion=function(){return"cn.tee3.avd-2.4.0.0"},k.prototype.getBrowserDetect=function(){var a=new d;return a.detect},k.prototype.checkBrowserSupport=function(){var a=new d;return a.checkBrowserSupport()},k.prototype.setLog=function(a,b){var c;a==Appender.alert?c=new log4javascript.AlertAppender:a==Appender.inpage?c=new log4javascript.InPageAppender:a==Appender.popup?c=new log4javascript.PopUpAppender:a==Appender.browserConsole&&(c=new log4javascript.BrowserConsoleAppender),b==LogLevel.all?c.setThreshold(log4javascript.Level.ALL):b==LogLevel.trace?c.setThreshold(log4javascript.Level.TRACE):b==LogLevel.debug?c.setThreshold(log4javascript.Level.DEBUG):b==LogLevel.info?c.setThreshold(log4javascript.Level.INFO):b==LogLevel.warn?c.setThreshold(log4javascript.Level.WARN):b==LogLevel.error?c.setThreshold(log4javascript.Level.ERROR):b==LogLevel.fatal?c.setThreshold(log4javascript.Level.FATAL):b==LogLevel.off&&c.setThreshold(log4javascript.Level.OFF),h(c)},k.prototype.setVideoCoding=function(a){videoCoding=a},k.prototype.getVideoCoding=function(){return videoCoding},k.prototype.getResolutionEnum=function(){var a=when.defer();return a.resolve(Resolution),a.promise},k.prototype.setMcuClusterRouteParams=function(a){this.mcuClusterRouteParams=a},k.prototype.init=function(a,e){var f=when.defer();log.info("AVDEngine init begin"),browserDetect=new d;var g=new b;return this.accessToken=e.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"=="),g.getServerinfo(a,e).then(function(){f.resolve()}).otherwise(function(a){if(a)f.reject(a);else{var b=new c(ErrorConstant.avdEngine_init_failed);f.reject(b)}}),f.promise},k.prototype.initWithOEM=function(a,b){var e=when.defer();if(log.info("AVDEngine OEM  init begin"),"qiniu.com"!=b){var f=new c(ErrorConstant.oemname_notfound);e.reject(f)}else browserDetect=new d,mcuRestServerUrl=a,roomServerUrl=a,is_cluster=!0,e.resolve();return e.promise},k.prototype.obtainRoom=function(b){return room=g(b),null==room&&(room=new a(b),room.avdEngine=this,rooms.push(room)),room},k.prototype.getAllDevices=function(){var a=when.defer();if("undefined"!=typeof navigator.mediaDevices)"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser&&"firefox"!=webrtcDetectedBrowser||navigator.mediaDevices.enumerateDevices().then(function(b){a.resolve(b)});else if("undefined"!=typeof MediaStreamTrack)"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser&&"firefox"!=webrtcDetectedBrowser||MediaStreamTrack.getSources(function(b){a.resolve(b)});else{var b=new c(ErrorConstant.not_support_mediaStreamTrack);a.reject(b)}return a.promise},k.prototype.initDevice=function(){var a=this;log.info("initDevice:Camera and Microphone begin"),this.getAllDevices().then(function(b){for(var c={},d=0,e={},f=0,g={},h=0,i=0;i!=b.length;++i){var j=b[i],k=j.deviceId||j.id;"videoinput"===j.kind||"video"===j.kind?(d+=1,c[k]=j.label||"camera"+d):"audioinput"===j.kind||"audio"===j.kind?(f+=1,e[k]=j.label||"microphone"+f):"audiooutput"===j.kind&&(h+=1,g[k]=j.label||"speaker"+h)}a.cameraMap=c,log.info("initDevice Camera finish!cameraMap:"+c),a.microphoneMap=e;for(var l in e){var m=e[l];a.checkMicrophoneId=l,a.checkMicrophoneName=m;break}log.info("initDevice Microphone finish!microphoneMap:"+e),a.speakerMap=g}).otherwise(function(a){log.info("get device error!error code:"+a.code+"; error message:"+a.message)})},k.prototype.refreshDevice=function(){var a=when.defer(),b=this,c=[];for(key in b.microphoneMap)c.push(key);var d=[];for(key in b.cameraMap)d.push(key);return"chrome"!=webrtcDetectedBrowser&&"Internet Explorer"!=webrtcDetectedBrowser||this.getAllDevices().then(function(a){for(var e={},f=0,g={},h=0,k={},l=0,m=0;m!=a.length;++m){var n=a[m],o=n.deviceId||n.id;"videoinput"===n.kind||"video"===n.kind?(f+=1,e[o]=n.label||"camera"+f):"audioinput"===n.kind||"audio"===n.kind?(h+=1,g[o]=n.label||"microphone"+h):"audiooutput"===n.kind&&(l+=1,k[o]=n.label||"speaker"+l)}j(d,e,this.rooms,b.cameraMap);for(var p in g){var q=g[p];b.checkMicrophoneId=p,b.checkMicrophoneName=q;break}i(c,g,this.rooms,b.microphoneMap),b.speakerMap=k}).otherwise(function(a){log.info("get device error!error code:"+a.code+"; error message:"+a.message)}),"firefox"==webrtcDetectedBrowser&&captureUserMedia({audio:!0,video:!0},function(a){
getAllAudioVideoDevices(function(a){for(var e={},f=0,g=0;g!=a.audioInputDevices.length;++g){var h=a.audioInputDevices[g];f+=1,e[h.id]=h.label||"microphone"+f}i(c,e,this.rooms,b.microphoneMap);for(var k={},l=0,g=0;g!=a.videoInputDevices.length;++g){var m=a.videoInputDevices[g];l+=1,k[m.id]=m.label||"camera"+l}j(d,k,this.rooms,b.cameraMap)},function(a){})},function(a){}),setTimeout(function(){a.resolve()},2e3),a.promise},k.prototype.setRecordingMicrophone=function(a){var b=room.selfUser.audio;if(null==b){var c=this.microphoneMap[a];room.selfUser.initAudio(a,c)}else if(a!=b.id)if(b.status==StreamStatus.init){room.selfUser.deleteAudio(b.id);var c=this.microphoneMap[a];room.selfUser.initAudio(a,c)}else if(b.status==StreamStatus.published){var d=b.element;b.closeMicrophone(),room.selfUser.deleteAudio(b.id);var c=this.microphoneMap[a];room.selfUser.initAudio(a,c),room.selfUser.audio.openMicrophone(d)}},k.prototype.getDeviceObject=function(){var a=when.defer();return log.info("getDeviceObject begin"),this.getAllDevices().then(function(b){for(var c={video:null,audio:null,speaker:null},d={},e=0,f={},g=0,h={},i=0,j=0;j!=b.length;++j){var k=b[j],l=k.deviceId||k.id;"videoinput"===k.kind||"video"===k.kind?(e+=1,d[l]=k.label||"camera"+e):"audioinput"===k.kind||"audio"===k.kind?(g+=1,f[l]=k.label||"microphone"+g):"audiooutput"===k.kind&&(i+=1,h[l]=k.label||"speaker"+i)}c.video=d,c.audio=f,c.speaker=h,a.resolve(c)}).otherwise(function(b){a.reject(b)}),a.promise},k.prototype.checkDevice=function(){var a=when.defer();return this.getAllDevices().then(function(b){for(var c={video:!1,audio:!1,speaker:!1},d=0;d!=b.length;++d){var e=b[d];e.deviceId||e.id;"videoinput"===e.kind||"video"===e.kind?c.video=!0:"audioinput"===e.kind||"audio"===e.kind?c.audio=!0:"audiooutput"===e.kind&&(c.speaker=!0)}a.resolve(c)}).otherwise(function(b){a.reject(b)}),a.promise},k.prototype.checkOpenVideo=function(a,b,c){var d=when.defer(),e=this,f={video:!0,audio:!1};if(f.video={mandatory:{},optional:[]},a&&(f.video.mandatory.sourceId=a),b){var g=Resolution[b];f.video.mandatory.minWidth=g.width,f.video.mandatory.minHeight=g.height,f.video.mandatory.maxWidth=g.width,f.video.mandatory.maxHeight=g.height}c&&("string"==typeof c&&(c=Number(c)),f.video.mandatory.minFrameRate=c,f.video.mandatory.maxFrameRate=c);try{getUserMedia(f,function(a){e.checkVideoStream=a,d.resolve(a)},function(a){var b,c=ModuleBase.use(ModulesEnum.error);b=new c("PermissionDeniedError"==a.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==a.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==a.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),d.reject(b)})}catch(a){var h=ModuleBase.use(ModulesEnum.error),i=new h(ErrorConstant.navigatorUserMediaError_unknown);d.reject(i)}return d.promise},k.prototype.checkOpenAudio=function(a){var b=when.defer(),c=this,d={video:!1,audio:!0};a&&(d.audio={mandatory:{},optional:[]},d.audio.mandatory.sourceId=a);try{getUserMedia(d,function(a){c.checkAudioStream=a,b.resolve(a)},function(a){var c,d=ModuleBase.use(ModulesEnum.error);c=new d("PermissionDeniedError"==a.name?ErrorConstant.navigatorUserMediaError_permissionDenied:"ConstraintNotSatisfiedError"==a.name?ErrorConstant.navigatorUserMediaError_constraintNotSatisfied:"TrackStartError"==a.name?ErrorConstant.navigatorUserMediaError_trackStartError:ErrorConstant.navigatorUserMediaError_unknown),b.reject(c)})}catch(a){var e=ModuleBase.use(ModulesEnum.error),f=new e(ErrorConstant.navigatorUserMediaError_unknown);b.reject(f)}return b.promise},k.prototype.checkCloseVideo=function(){this.checkVideoStream&&this.checkVideoStream.getTracks().forEach(function(a){a.stop()}),this.checkVideoStream=null},k.prototype.checkCloseAudio=function(){this.checkAudioStream&&this.checkAudioStream.getTracks().forEach(function(a){a.stop()}),this.checkAudioStream=null},k.prototype.obtainRecord=function(a){var b=new e(a);return b},k.prototype.obtainLive=function(a){var b=new f(a);return b},k}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(a,b,c,d,e,f){function g(a){log.info("============openReqSend(websocket)===========");var b=when.defer();return room.p2pServer=new d,room.masterServer=new c(a),room.masterServer.openReqSend(),room.addCallback(EngineCallback.room_join_success,function(a){b.resolve(a)}),room.addCallback(EngineCallback.room_join_error,function(a){b.reject(a)}),b.promise}var h=function(a){this.id=a,this.roomTocken=null,this.signalTocken=null,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.webocketStatusIntervalId=null,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.avdEngine=null,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.iceUfragLocal,this.icePwdLocal,this.iceUfragLocal2,this.icePwdLocal2,this.fingerPrint,this.iceUfrag,this.icePwd,this.setup,this.sdp=null,this.iceUfragForFirefox,this.icePwdForFirefox,this.sdpForFirefox=null,this.connectionInfoCollector=null,this.audioLevel=null,this.baselineReconnectionTime,this.reconnectionTime,this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!1,this.toMCUReconnectionPC=null,this.toMCUReconnectionPCForFirefox=null,this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.baselineJoinTime=null,this.joinTimeoutIntervalId=null,this.joinTimeout=1e4,this.joinTimeoutState=!1,this.audioSsrc2user={},this.localFirefoxSDP,this.localFirefoxSecondSDP,this.fakeVideoStreams=[],this.fakeAudioStreams=[],this.localVideoMsids=0,this.localAudioMsids=0,this.localAddFakeVideoStreams=[],this.localAddFakeAudioStreams=[],this.videoSsrc=null,this.audioSsrc=null};return h.prototype.join=function(a,c,d,e){var g=when.defer();if(is_cluster){var h=new b;h.getMcu(room.id,room.avdEngine.accessToken).then(function(){room.doJoin(a,c,d,e,g)}).otherwise(function(a){g.reject(a)})}else room.doJoin(a,c,d,e,g);if(!room.isMcu()){var i=doFsCheck(FTConstant.p2p,f);if(null!=i)return g.reject(i),g.promise}return g.promise},h.prototype.joinWithOEM=function(a,c,d,e,f){var g=when.defer(),h=new b;return h.getMcuWithOEM(room.id,f).then(function(){room.doJoin(a,c,d,e,g)}).otherwise(function(a){g.reject(a)}),g.promise},h.prototype.doJoin=function(b,c,d,h,i){if(null==b||""==b){var j=new f(ErrorConstant.userId_required);i.reject(j)}else{null==room.baselineJoinTime&&(room.baselineJoinTime=new Date),room.joinTimeoutIntervalId=setInterval(function(){var a=new Date,b=a-room.baselineJoinTime;if(b>=room.joinTimeout){room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null),room.joinTimeoutState=!0,log.error("登陆加会超时："+ErrorConstant.join_room_timeout.code);var c=new f(ErrorConstant.join_room_timeout);i.reject(c)}},500),this.selfUser=new e(b,c,d,h);var k=new a,l=k.getDataChannel(SignalType.websocket);l.connect().then(g).then(function(a){log.debug("==========doJoin websokcet(one) success========"),a.joinTimeoutIntervalId&&(clearInterval(a.joinTimeoutIntervalId),a.joinTimeoutIntervalId=null,a.baselineJoinTime=null),i.resolve(a)}).otherwise(function(a){log.debug("==========doJoin websokcet(one) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),i.reject(a)})}room.addCallback(EngineCallback.room_join_websocket_reconnection_success,function(a){g(a).then(function(a){log.debug("==========doJoin websokcet(reconnection) success========"),a.joinTimeoutIntervalId&&(clearInterval(a.joinTimeoutIntervalId),a.joinTimeoutIntervalId=null,a.baselineJoinTime=null),i.resolve(a)}).otherwise(function(a){log.debug("==========doJoin websokcet(reconnection) error========"),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),i.reject(a)})})},h.prototype.reJoin=function(){log.info("reJoin room  Operation！");var b=when.defer();return room.traceablePeerConnection.close(this.toMCUReconnectionPC),this.toMCUReconnectionPC=null,"firefox"==webrtcDetectedBrowser&&(room.traceablePeerConnection.close(this.toMCUReconnectionPCForFirefox),this.toMCUReconnectionPCForFirefox=null),room.webocketStatusIntervalId=setInterval(function(){if(room.masterServer.signalingChannel.readyState==WebSocket.CLOSED){clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null;var c=new a,d=c.getDataChannel(SignalType.websocket);d.connect().then(g).then(function(a){room.pingTimeout=a.pingTimeout,room.pingInterval=a.pingInterval,room.signalTocken=a.signalTocken,room.masterServer=a.masterServer,b.resolve(room)}).otherwise(function(a){b.reject(a)})}},500),b.promise},h.prototype.reconnectionHandle=function(){var b=new Date;if(0==this.reconnectionCount&&(this.baselineReconnectionTime=b),b-this.baselineReconnectionTime>this.pingTimeout)this.reconnectionState=!1,this.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],this.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed);else{this.reconnectionState=!0,this.reconnectionCount+=1,log.info("与服务器第"+this.reconnectionCount+"次重连。");var c=new a,d=c.getDataChannel(SignalType.websocket);d.connect().then(function(a){log.debug("=========reconnectionHandle(),websocket.connect() success======="),null!=room.joinTimeoutIntervalId?(log.debug("=========加会时,websocket重连成功======="),room.reconnectionState=!1,room.reconnectionCount=0,room.eventEmitter.emit(EngineCallback.room_join_websocket_reconnection_success,a)):(log.debug("=========房间网络科动时,websocket重连成功======="),room.masterServer.signalingChannel=a,room.masterServer.openReqReconnectionSend())})}},h.prototype.getRoomId=function(){return room.roomInfo.room_id},h.prototype.getRoomTopic=function(){return room.roomInfo.topic},h.prototype.getOwnerId=function(){return room.roomInfo.owner_id},h.prototype.isMcu=function(){var a=!0;if(null==room.roomInfo)return a;var b=room.roomInfo.room_mode;return 3!=b&&4!=b||(a=!1),a},h.prototype.getMaxAudio=function(){return room.roomInfo.max_audio},h.prototype.getMaxVideo=function(){return room.roomInfo.max_video},h.prototype.getMaxAttendee=function(){return room.roomInfo.attendee_max},h.prototype.getUsableVideo=function(){var a=this.getMaxVideo()-this.pubVideos.length;return a<0&&(a=0),a},h.prototype.getUsableAudio=function(){var a=this.getMaxAudio()-this.pubAudios.length;return a<0&&(a=0),a},h.prototype.updateRoomStatus=function(a){this.status=a},h.prototype.getRoomStatus=function(){return this.status},h.prototype.getHost=function(){for(var a=0;a!=this.participants.length;++a){var b=this.participants[a];if(1==b.role)return b}},h.prototype.getSelfUser=function(){return room.selfUser},h.prototype.getSelfUserId=function(){return room.selfUser.id},h.prototype.getParticipants=function(){return this.participants},h.prototype.getUser=function(a){for(var b,c=0;c<this.participants.length;c++){var d=this.participants[c];if(d.id==a){b=d;break}}return b},h.prototype.hasUser=function(a){for(var b=!1,c=0;c<this.participants.length;c++){var d=this.participants[c];if(d.id==a){b=!0;break}}return b},h.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},h.prototype.getPublishedCamera=function(){return this.pubVideos},h.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},h.prototype.getPublishedScreen=function(){return this.pubScreens},h.prototype.addUser=function(a){this.hasUser(a.id)||this.participants.push(a)},h.prototype.removeUser=function(a){null!=this.participants&&this.participants.length>0&&arrayUtil.objectSplice(this.participants,a)},h.prototype.getUserByNodeId=function(a){for(var b,c=0;c<this.participants.length;c++){var d=this.participants[c];if(d.nodeId==a){b=d;break}}return b},h.prototype.getNodeId=function(a){var b=null,c=this.getUser(a);return null!=c&&(b=c.nodeId),b},h.prototype.getUserId=function(a){var b=null,c=this.getUserByNodeId(a);return null!=c&&(b=c.id),b},h.prototype.sendPublicMessage=function(a){var b=when.defer(),c=doFsCheck(FTConstant.chat,f);return null==c?(this.masterServer.sendMessage(a),b.resolve()):b.reject(c),b.promise},h.prototype.sendPrivateMessage=function(a,b){var c=when.defer(),d=doFsCheck(FTConstant.chat,f);return null==d?(this.masterServer.sendMessage(a,b),c.resolve()):c.reject(d),c.promise},h.prototype.sendPublicData=function(a){var b=when.defer(),c=doFsCheck(FTConstant.datachannel,f);return null==c?(this.masterServer.sendData(a),b.resolve()):b.reject(c),b.promise},h.prototype.sendPrivateData=function(a,b){var c=when.defer(),d=doFsCheck(FTConstant.datachannel,f);return null==d?(this.masterServer.sendData(a,b),c.resolve()):c.reject(d),c.promise},h.prototype.updateAppData=function(a,b){this.appData[a]=b,this.masterServer.roomDataInfo(a,b)},h.prototype.getAppData=function(a){return"undefined"==typeof a||null==a||""==a?this.appData:this.appData[a]},h.prototype.setCameraResolutionOrFrameRate=function(a,b,c){var d=when.defer(),e=parseInt(b);if(e>640){var g=doFsCheck(FTConstant.video_hd,f);if(null!=g)return d.reject(g),d.promise}var h=room.selfUser.getVideo(a);if(null!=h){if("string"==typeof c&&(c=Number(c)),h.resolution!=Resolution[b]||h.frameRate!=c)if(null!=h.stream)if(h.status==StreamStatus.none||h.status==StreamStatus.init)h.stream=null,h.setResolution(b),h.setFrameRate(c),d.resolve();else{var g=new f(ErrorConstant.closeVideo_before_operation_warnings);d.reject(g)}else h.setResolution(b),h.setFrameRate(c),d.resolve()}else{var g=new f(ErrorConstant.cameraId_does_not_exist);d.reject(g)}return d.promise},h.prototype.setCameraResolutionWHOrFrameRate=function(a,b,c,d){var e=when.defer(),g=parseInt(b);if(g>640){var h=doFsCheck(FTConstant.video_hd,f);if(null!=h)return e.reject(h),e.promise}var i=room.selfUser.getVideo(a);if(null!=i){if("string"==typeof d&&(d=Number(d)),"undefined"==typeof i.resolution)i.setResolutionWH(b,c),i.setFrameRate(d),e.resolve();else if(i.resolution.width!=b||i.resolution.height!=c||i.frameRate!=d)if(null!=i.stream)if(i.status==StreamStatus.none||i.status==StreamStatus.init)i.stream=null,i.setResolutionWH(b,c),i.setFrameRate(d),e.resolve();else{var h=new f(ErrorConstant.closeVideo_before_operation_warnings);e.reject(h)}else i.setResolutionWH(b,c),i.setFrameRate(d),e.resolve()}else{var h=new f(ErrorConstant.cameraId_does_not_exist);e.reject(h)}return e.promise},h.prototype.muteSpeaker=function(){this.muteSpeakerFlag=!0,this.participants.forEach(function(a){if(a.id!=room.selfUser.id){var b=a.audio.stream;if(null!=b){var c=b.getAudioTracks();for(i=0;i<c.length;i++)c[i].enabled=!1}}})},h.prototype.unmuteSpeaker=function(){this.muteSpeakerFlag=!1,this.participants.forEach(function(a){if(a.id!=room.selfUser.id){var b=a.audio.stream;if(null!=b){var c=b.getAudioTracks();for(i=0;i<c.length;i++)c[i].enabled=!0}}})},h.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},h.prototype.kickoffUser=function(a,b){this.masterServer.userIndiction(a,b)},h.prototype.leave=function(a,b){var c=when.defer(),d=room.selfUser.videos;if(null!=d&&d.length>0)for(key in d){var e=d[key];e.status==StreamStatus.published&&(e.unpreview(),e.unpublish())}var f=room.selfUser.audio;null!=f&&f.status==StreamStatus.published&&f.closeMicrophone();var g=room.selfUser.screen;null!=g&&g.status==StreamStatus.published&&g.unpublish(),null!=this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null),null!=this.pingTimeoutId&&(clearInterval(this.pingTimeoutId),this.pingTimeoutId=null),null!=this.selfUser&&(null!=this.selfUser.toMCUPC&&this.selfUser.toMCUPC.close(),null!=this.selfUser.toMCUPCForFirefox&&"firefox"==webrtcDetectedBrowser&&this.selfUser.toMCUPCForFirefox.close());var h=this;return setTimeout(function(){h.masterServer.userMsg(a,b),null!=room&&(room=null),c.resolve()},1e3),c.promise},h.prototype.addCallback=function(a,b){this.eventEmitter.addListener(a,b)},h.prototype.composePDUDeviceId=function(a,b){return a+"_"+b},h.prototype.splitPDUDeviceId=function(a){var b=a.split("_");return b[1]},h.prototype.splitUserId=function(a){var b=a.split("_");return b[0]},h.prototype.sendAnnotation=function(a,b,c,d,e,f,g,h,i){log.info("send Annotation ========="),this.masterServer.sendAnnotationMessage(a,b,c,d,e,f,g,h,i)},h.prototype.initFakeVideoStream=function(a){for(var b=0;b<a;b++)getFakeVideoStream(function(a){room.fakeVideoStreams.push(a)})},h.prototype.initFakeAudioStream=function(a){for(var b=0;b<a;b++)getFakeAudioStream(function(a){room.fakeAudioStreams.push(a)})},h});var remoteSDPInit;"firefox"==webrtcDetectedBrowser?remoteSDPInit=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass","m=video 1 UDP/TLS/RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n"):webrtcDetectedVersion<57?(remoteSDPInit="v=0\r\n",remoteSDPInit+="o=- 0 0 IN IP4 127.0.0.1\r\n",remoteSDPInit+="s=-\r\n",remoteSDPInit+="t=0 0\r\n",remoteSDPInit+="a=group:BUNDLE video audio\r\n",remoteSDPInit+="a=msid-semantic: WMS\r\n",remoteSDPInit+="m=audio 1 RTP/SAVPF 103 102 111 0 8 9\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:audio\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:111 opus/48000/2\r\n",remoteSDPInit+="a=rtcp-fb:111 transport-cc\r\n",remoteSDPInit+="a=fmtp:111 minptime=10;useinbandfec=1\r\n",remoteSDPInit+="a=rtpmap:102 ILBC/8000\r\n",remoteSDPInit+="a=rtpmap:103 ISAC/16000\r\n",remoteSDPInit+="a=rtpmap:0 PCMU/8000\r\n",remoteSDPInit+="a=rtpmap:8 PCMA/8000\r\n",remoteSDPInit+="a=rtpmap:9 G722/8000\r\n",remoteSDPInit+="a=rtpmap:126 telephone-event/8000\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="m=video 9 RTP/SAVPF 100 101 107\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:video\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:100 VP8/90000\r\n",remoteSDPInit+="a=rtcp-fb:100 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:100 nack\r\n",remoteSDPInit+="a=rtcp-fb:100 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:100 goog-remb\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="a=rtpmap:101 VP9/90000\r\n",remoteSDPInit+="a=rtcp-fb:101 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:101 nack\r\n",remoteSDPInit+="a=rtcp-fb:101 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:101 goog-remb\r\n",remoteSDPInit+="a=rtpmap:107 H264/90000\r\n",remoteSDPInit+="a=rtcp-fb:107 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:107 nack\r\n",remoteSDPInit+="a=rtcp-fb:107 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:107 goog-remb\r\n",remoteSDPInit+="a=rtcp-fb:107 transport-cc\r\n",remoteSDPInit+="a=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n"):(remoteSDPInit="v=0\r\n",remoteSDPInit+="o=- 0 0 IN IP4 127.0.0.1\r\n",remoteSDPInit+="s=-\r\n",remoteSDPInit+="t=0 0\r\n",remoteSDPInit+="a=group:BUNDLE video audio\r\n",remoteSDPInit+="a=msid-semantic: WMS\r\n",remoteSDPInit+="m=audio 1 RTP/SAVPF 103 102 111 0 8 9\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:audio\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:111 opus/48000/2\r\n",remoteSDPInit+="a=rtcp-fb:111 transport-cc\r\n",remoteSDPInit+="a=fmtp:111 minptime=10;useinbandfec=1\r\n",remoteSDPInit+="a=rtpmap:102 ILBC/8000\r\n",remoteSDPInit+="a=rtpmap:103 ISAC/16000\r\n",remoteSDPInit+="a=rtpmap:0 PCMU/8000\r\n",remoteSDPInit+="a=rtpmap:8 PCMA/8000\r\n",remoteSDPInit+="a=rtpmap:9 G722/8000\r\n",remoteSDPInit+="a=rtpmap:126 telephone-event/8000\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="m=video 9 RTP/SAVPF 96 98 100\r\n",remoteSDPInit+="c=IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=rtcp:7000 IN IP4 127.0.0.1\r\n",remoteSDPInit+="a=ice-ufrag:n1PpqVgFoRQbl8RE\r\n",remoteSDPInit+="a=ice-pwd:y7nufWkbyjzhq2K7hCywlUWV\r\n",remoteSDPInit+="a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A\r\n",remoteSDPInit+="a=setup:passive\r\n",remoteSDPInit+="a=mid:video\r\n",remoteSDPInit+="a=sendrecv\r\n",remoteSDPInit+="a=rtcp-mux\r\n",remoteSDPInit+="a=rtpmap:96 VP8/90000\r\n",remoteSDPInit+="a=rtcp-fb:96 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:96 nack\r\n",remoteSDPInit+="a=rtcp-fb:96 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:96 goog-remb\r\n",remoteSDPInit+="a=maxptime:60\r\n",remoteSDPInit+="a=rtpmap:98 VP9/90000\r\n",remoteSDPInit+="a=rtcp-fb:98 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:98 nack\r\n",remoteSDPInit+="a=rtcp-fb:98 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:98 goog-remb\r\n",remoteSDPInit+="a=rtpmap:100 H264/90000\r\n",remoteSDPInit+="a=rtcp-fb:100 ccm fir\r\n",remoteSDPInit+="a=rtcp-fb:100 nack\r\n",remoteSDPInit+="a=rtcp-fb:100 nack pli\r\n",remoteSDPInit+="a=rtcp-fb:100 goog-remb\r\n",remoteSDPInit+="a=rtcp-fb:100 transport-cc\r\n",remoteSDPInit+="a=fmtp:100 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n"),sdpLines=function(a){return a.split("\r\n").filter(function(a){return a.length>0})},sdpMline=function(a){for(var b=a.substr(2).split(" "),c={media:b[0],port:b[1],proto:b[2],formats:[]},d=3;d<b.length;d++)b[d]&&c.formats.push(b[d]);return c},findLineInFirefox=function(a,b,c){for(var d=a.length,e=0;e<b.length;e++)if(b[e].substr(0,d)===a)return b[e];if(!c)return!1;for(var f=0;f<c.length;f++)if(c[f].substr(0,d)===a)return c[f];return!1},findLinesInFirefox=function(a,b,c){for(var d=[],e=a.length,f=0;f<b.length;f++)b[f].substr(0,e)===a&&d.push(b[f]);if(d.length||!c)return d;for(var g=0;g<c.length;g++)c[g].substr(0,e)===a&&d.push(c[g]);return d},rtpmap=function(a){var b=a.substr(9).split(" "),c={id:b.shift()};return b=b[0].split("/"),c.name=b[0],c.clockrate=b[1],c.channels=3==b.length?b[2]:"1",c},sctpmap=function(a){var b=a.substr(10).split(" "),c={number:b.shift(),protocol:b.shift(),streams:b.shift()};return c},fmtp=function(a){for(var b,c,d,e=a.substr(a.indexOf(" ")+1).split(";"),f=[],g=0;g<e.length;g++)b=e[g].split("="),c=b[0].trim(),d=b[1],c&&d?f.push({key:c,value:d}):c&&f.push({key:"",value:c});return f},crypto=function(a){var b=a.substr(9).split(" "),c={tag:b[0],cipherSuite:b[1],keyParams:b[2],sessionParams:b.slice(3).join(" ")};return c},fingerprint=function(a){var b=a.substr(14).split(" ");return{hash:b[0],value:b[1]}},extmap=function(a){var b=a.substr(9).split(" "),c={},d=b.shift(),e=d.indexOf("/");return e>=0?(c.id=d.substr(0,e),c.senders=d.substr(e+1)):(c.id=d,c.senders="sendrecv"),c.uri=b.shift()||"",c},rtcpfb=function(a){var b=a.substr(10).split(" "),c={};return c.id=b.shift(),c.type=b.shift(),"trr-int"===c.type?c.value=b.shift():c.subtype=b.shift()||"",c.parameters=b,c},sdpCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},d=8;d<b.length;d+=2)"raddr"===b[d]?c.relAddr=b[d+1]:"rport"===b[d]?c.relPort=b[d+1]:"generation"===b[d]?c.generation=b[d+1]:"tcptype"===b[d]&&(c.tcpType=b[d+1]);return c.network="1",c},sourceGroups=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].substr(13).split(" ");b.push({semantics:d.shift(),sources:d})}return b},sources=function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d].substr(7).split(" "),f=e.shift();if(!c[f]){var g={ssrc:f,parameters:[]};b.push(g),c[f]=g}e=e.join(" ").split(":");var h=e.shift(),i=e.join(":")||null;c[f].parameters.push({key:h,value:i})}return b},groups=function(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d].substr(8).split(" "),c.push({semantics:b.shift(),contents:b});return c},msidSemantics=function(a){for(var b,c=[],d=0;d<a.length;d++)b="firefox"==webrtcDetectedBrowser?a[d].substr(16).split(" "):a[d].substr(17).split(" "),c.push({semantics:b.shift(),contents:b});return c},bandwidth=function(a){var b=a.substr(2).split(":"),c={};return c.type=b.shift(),c.bandwidth=b.shift(),c};var remoteSDPFirfox_audio=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendonly","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video=["v=0","o=mozilla...THIS_IS_SDPARTA-43.0.2 856593667722250429 0 IN IP4 0.0.0.0","s=-","t=0 0","a=fingerprint:sha-1 72:9B:4F:23:98:6C:20:45:66:4E:E0:92:C7:82:9C:B5:40:2F:9B:8A","a=group:BUNDLE sdparta_0 sdparta_1","a=ice-options:trickle","a=msid-semantic:WMS *","m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=sendonly","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","a=fmtp:121 profile-level-id=42e01f;level-asymmetry-allowed=1","a=fmtp:120 max-fs=12288;max-fr=60","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_1","a=rtcp-fb:120 nack","a=rtcp-fb:120 ccm fir","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=rtpmap:121 VP9/90000","a=rtpmap:126 H264/90000","a=setup:actpass",""].join("\r\n"),remoteSDPFirefox_video_add=["m=video 1 RTP/SAVPF 120 121 126","c=IN IP4 0.0.0.0","a=rtcp:1 IN IP4 0.0.0.0","a=ice-ufrag:e8cf35cf","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=fingerprint:sha-256 FF:8A:0A:40:A4:EF:3D:4C:B1:6E:12:DB:FE:0B:69:B6:D3:7B:40:50:CE:A9:BA","a=setup:actpass","a=sendrecv","a=mid:sdparta_x","a=rtcp-mux","a=rtpmap:120 VP8/90000","a=fmtp:120 max-fs=12288;max-fr=60","a=rtcp-fb:120 nack","a=rtcp-fb:120 nack pli","a=rtcp-fb:120 ccm fir","a=rtpmap:121 VP9/90000","a=rtcp-fb:121 nack","a=rtcp-fb:121 ccm fir","a=rtpmap:126 H264/90000","a=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1\r\n","a=rtcp-fb:126 nack","a=rtcp-fb:126 nack pli","a=rtcp-fb:126 ccm fir",""].join("\r\n"),remoteSDPFirefox_audio_add=["m=audio 1 UDP/TLS/RTP/SAVPF 111 103 102 109 9 0 8","c=IN IP4 0.0.0.0","a=sendrecv","a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level","a=ice-pwd:576032e0c3ba9904aa2dfb014e98a46f","a=ice-ufrag:e8cf35cf","a=mid:sdparta_0","a=rtcp-mux","a=rtpmap:111 opus/48000/2","a=rtpmap:103 ISAC/16000","a=rtpmap:102 ILBC/8000","a=rtpmap:109 opus/48000/2","a=rtpmap:9 G722/8000/1","a=rtpmap:0 PCMU/8000","a=rtpmap:8 PCMA/8000","a=setup:actpass",""].join("\r\n"),SENDERS={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}},idCounter=Math.random();_setIdCounter=function(a){idCounter=a},toSessionJSON=function(a,b){var c,d=b.creators||[],e=b.role||"initiator",f=b.direction||"outgoing",g=a.split("\r\nm=");for(c=1;c<g.length;c++)g[c]="m="+g[c],c!==g.length-1&&(g[c]+="\r\n");var h=g.shift()+"\r\n",i=sdpLines(h),j={},k=[];for(c=0;c<g.length;c++)k.push(toMediaJSON(g[c],h,{role:e,direction:f,creator:d[c]||"initiator"}));j.contents=k;var l=findLinesInFirefox("a=group:",i);l.length&&(j.groups=groups(l));var m=findLinesInFirefox("a=msid-semantic:",i);return m.length&&(j.msidSemantics=msidSemantics(m)),j},toMediaJSON=function(a,b,c){var d=c.creator||"initiator",e=c.role||"initiator",f=c.direction||"outgoing",g=sdpLines(a),h=sdpLines(b),i=sdpMline(g[0]),j={creator:d,role:e,direction:f,name:i.media,description:{descType:"rtp",media:i.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==i.media&&(j.description={descType:"datachannel"},j.transport.sctp=[]);var k=j.description,l=j.transport,m=findLineInFirefox("a=mid:",g);if(m&&(j.name=m.substr(6)),findLineInFirefox("a=sendrecv",g,h)?j.senders="both":findLineInFirefox("a=sendonly",g,h)?j.senders=SENDERS[e][f].sendonly:findLineInFirefox("a=recvonly",g,h)?j.senders=SENDERS[e][f].recvonly:findLineInFirefox("a=inactive",g,h)&&(j.senders="none"),"rtp"==k.descType){var n=findLineInFirefox("b=",g);n&&(k.bandwidth=n(n));var o=findLineInFirefox("a=msid:",g);if(o.length){var p=o.substr(7).split(" "),q={};q.msid=o,q.streamId=p[0],q.trackId=p[1],k.msid=q}var r=findLineInFirefox("a=ssrc:",g);r&&(k.ssrc=r.substr(7).split(" ")[0]);var s=findLinesInFirefox("a=rtpmap:",g);s.forEach(function(a){var b=rtpmap(a);b.parameters=[],b.feedback=[];var c=findLinesInFirefox("a=fmtp:"+b.id,g);c.forEach(function(a){b.parameters=fmtp(a)});var d=findLinesInFirefox("a=rtcp-fb:"+b.id,g);d.forEach(function(a){b.feedback.push(rtcpfb(a))}),k.payloads.push(b)});var t=findLinesInFirefox("a=crypto:",g,h);t.forEach(function(a){k.encryption.push(crypto(a))}),findLineInFirefox("a=rtcp-mux",g)&&(k.mux=!0);var u=findLinesInFirefox("a=rtcp-fb:*",g);u.forEach(function(a){k.feedback.push(rtcpfb(a))});var v=findLinesInFirefox("a=extmap:",g);v.forEach(function(a){var b=extmap(a);b.senders=SENDERS[e][f][b.senders],
k.headerExtensions.push(b)});var w=findLinesInFirefox("a=ssrc-group:",g);k.sourceGroups=sourceGroups(w||[]);var x=findLinesInFirefox("a=ssrc:",g);k.sources=sources(x||[]),findLineInFirefox("a=x-google-flag:conference",g,h)&&(k.googConferenceFlag=!0)}var y=findLinesInFirefox("a=fingerprint:",g,h),z=findLineInFirefox("a=setup:",g,h);y.forEach(function(a){var b=fingerprint(a);z&&(b.setup=z.substr(8)),l.fingerprints.push(b)});var A=findLineInFirefox("a=ice-ufrag:",g,h),B=findLineInFirefox("a=ice-pwd:",g,h);if(A&&B){l.ufrag=A.substr(12),l.pwd=B.substr(10),l.candidates=[];var C=findLinesInFirefox("a=candidate:",g,h);C.forEach(function(a){l.candidates.push(toCandidateJSON(a))})}if("datachannel"==k.descType){var D=findLinesInFirefox("a=sctpmap:",g);D.forEach(function(a){var b=sctpmap(a);l.sctp.push(b)})}return j},toCandidateJSON=function(a){var b=sdpCandidate(a.split("\r\n")[0]);return b.id=(idCounter++).toString(36).substr(0,12),b},toSessionSDP=function(a,b){var c=(b.role||"initiator",b.direction||"outgoing",b.sid||a.sid||Date.now()),d=b.time||Date.now(),e=["v=0","o=- "+c+" "+d+" IN IP4 0.0.0.0","s=-","t=0 0"],f=a.groups||[];f.forEach(function(a){e.push("a=group:"+a.semantics+" "+a.contents.join(" "))});var g=a.msidSemantics||[];g.forEach(function(a){navigator.mozGetUserMedia?e.push("a=msid-semantic:"+a.semantics+" "+a.contents.join(" ")):e.push("a=msid-semantic: "+a.semantics+" "+a.contents.join(" "))});var h=a.contents||[];return h.forEach(function(a){e.push(toMediaSDP(a,b))}),e.join("\r\n")+"\r\n"},toMediaSDP=function(a,b){var c=[],d=b.role||"initiator",e=b.direction||"outgoing",f=a.description,g=a.transport,h=f.payloads||[],i=g&&g.fingerprints||[],j=[];if("datachannel"==f.descType?(j.push("application"),j.push("1"),j.push("DTLS/SCTP"),g.sctp&&g.sctp.forEach(function(a){j.push(a.number)})):(j.push(f.media),j.push("1"),f.encryption&&f.encryption.length>0||i.length>0?j.push("RTP/SAVPF"):j.push("RTP/AVPF"),h.forEach(function(a){j.push(a.id)})),c.push("m="+j.join(" ")),c.push("c=IN IP4 0.0.0.0"),f.bandwidth&&f.bandwidth.type&&f.bandwidth.bandwidth&&c.push("b="+f.bandwidth.type+":"+f.bandwidth.bandwidth),"rtp"==f.descType&&c.push("a=rtcp:1 IN IP4 0.0.0.0"),g){g.ufrag&&c.push("a=ice-ufrag:"+g.ufrag),g.pwd&&c.push("a=ice-pwd:"+g.pwd);var k=!1;i.forEach(function(a){c.push("a=fingerprint:"+a.hash+" "+a.value),a.setup&&!k&&c.push("a=setup:"+a.setup)}),g.sctp&&g.sctp.forEach(function(a){c.push("a=sctpmap:"+a.number+" "+a.protocol+" "+a.streams)})}"rtp"==f.descType&&c.push("a="+(SENDERS[d][e][a.senders]||"sendrecv")),c.push("a=mid:"+a.name),f.msid&&c.push(f.msid.msid),f.mux&&c.push("a=rtcp-mux");var l=f.encryption||[];l.forEach(function(a){c.push("a=crypto:"+a.tag+" "+a.cipherSuite+" "+a.keyParams+(a.sessionParams?" "+a.sessionParams:""))}),f.googConferenceFlag&&c.push("a=x-google-flag:conference"),h.forEach(function(a){var b="a=rtpmap:"+a.id+" "+a.name+"/"+a.clockrate;if(a.channels&&"1"!=a.channels&&(b+="/"+a.channels),c.push(b),a.parameters&&a.parameters.length){var d=["a=fmtp:"+a.id],e=[];a.parameters.forEach(function(a){e.push((a.key?a.key+"=":"")+a.value)}),d.push(e.join(";")),c.push(d.join(" "))}a.feedback&&a.feedback.forEach(function(b){"trr-int"===b.type?c.push("a=rtcp-fb:"+a.id+" trr-int "+b.value?b.value:"0"):c.push("a=rtcp-fb:"+a.id+" "+b.type+(b.subtype?" "+b.subtype:""))})}),f.feedback&&f.feedback.forEach(function(a){"trr-int"===a.type?c.push("a=rtcp-fb:* trr-int "+a.value?a.value:"0"):c.push("a=rtcp-fb:* "+a.type+(a.subtype?" "+a.subtype:""))});var m=f.headerExtensions||[];m.forEach(function(a){c.push("a=extmap:"+a.id+(a.senders?"/"+SENDERS[d][e][a.senders]:"")+" "+a.uri)});var n=f.sourceGroups||[];n.forEach(function(a){c.push("a=ssrc-group:"+a.semantics+" "+a.sources.join(" "))});var o=f.sources||[];o.forEach(function(a){for(var b=0;b<a.parameters.length;b++){var d=a.parameters[b];c.push("a=ssrc:"+(a.ssrc||f.ssrc)+" "+d.key+(d.value?":"+d.value:""))}});var p=g.candidates||[];return p.forEach(function(a){c.push(toCandidateSDP(a))}),c.join("\r\n")},toCandidateSDP=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"srflx"!==c&&"prflx"!==c&&"relay"!==c||a.relAddr&&a.relPort&&(b.push("raddr"),b.push(a.relAddr),b.push("rport"),b.push(a.relPort)),a.tcpType&&"TCP"==a.protocol.toUpperCase()&&(b.push("tcptype"),b.push(a.tcpType)),b.push("generation"),b.push(a.generation||"0"),"a=candidate:"+b.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(a,b){var c=function(){};return c.prototype.connect=function(){var c=when.defer();try{var d=document.location.protocol,e="ws://";"https:"==d&&(e="wss://");var f=e+roomServerUrl+"/ws";log.debug("=====websocket url==="+f);var g=new WebSocket(f);g.binaryType="arraybuffer",g.readyState==WebSocket.CONNECTING&&log.info("WebSocket连接正在建立..."),g.onopen=function(){g.readyState==WebSocket.OPEN&&log.info("WebSocket连接已打开!"),c.resolve(g)},g.onmessage=function(b){var c=new a;c.OnWebSocketMessage(b.data)},g.onclose=function(a){g.readyState==WebSocket.CLOSED&&(log.info("WebSocket连接已关闭!"),null==room||room.reconnectionOpenRep402||room.reconnectionState||room.selfUser.mulLanding||room.joinTimeoutState||(log.info("=========onclose(), WebSocket开始重连=========="),room.masterServer&&room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.reconnectionHandle()))},g.onerror=function(a){log.info("WebSocket连接发生错误！"),null!=room&&room.reconnectionCount>0&&!room.joinTimeoutState&&(log.info("=========onerror(), WebSocket开始重连=========="),setTimeout(function(){room.reconnectionHandle()},3e3))}}catch(a){log.info("websocket Operation  failed. with exception:"+a);var h=new b(ErrorConstant.websock_catch_exception);c.reject(h)}return c.promise},c}),ModuleBase.define("TraceablePeerConnection",["Error"],function(a){function b(a,b,c,d,e){var f={};return f.operationType=a,f.para1=b,f.para2=c,f.para3=d,f.para4=e,f}function c(a,b,c,d){var e;room.traceablePeerConnection.getToMCUPeerConnection().addStream(c),room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(f){f.sdp=updateSDPIceUfrag(f.sdp,room.iceUfrag),f.sdp=updateSDPIcePwd(f.sdp,room.icePwd),f.sdp=h(f.sdp);var k,n,o,p;if("firefox"==webrtcDetectedBrowser){var q;if("video"==a){for(var r=room.localAddFakeVideoStreams,s=0;s<r.length;s++){r[s]}q=getSdpSsrc(f.sdp,"video",c.id),q=g(q,c.id),log.debug("addSdp(),new add video sdp:"+q),k=room.selfUser.videoSdpSsrc,room.selfUser.videoSdpSsrc=q}else"audio"==a?(q=getSdpSsrc(f.sdp,"audio",c.id),log.debug("addSdp(),new add audio sdp:"+q),n=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=q):"screen"==a&&(q=getSdpSsrc(f.sdp,"video",c.id),q=g(q,c.id),log.debug("addSdp(),new add screen sdp:"+q),o=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=q);p=q}else{var t=new SdpSerializer(f.sdp);"video"==a?(p=t._inner.video.ssrcStr,p=g(p,c.id),log.debug("addSdp(),new add video sdp:"+p),k=room.selfUser.videoSdpSsrc,room.selfUser.videoSdpSsrc=p):"audio"==a?(p=t._inner.audio.ssrcStr,log.debug("addSdp(),new add audio sdp:"+p),n=room.selfUser.audioSdpSsrc,room.selfUser.audioSdpSsrc=p):"screen"==a&&(p=t._inner.video.ssrcStr,p=g(p,c.id),log.debug("addSdp(),new add screen sdp:"+p),o=room.selfUser.screenSdpSsrc,room.selfUser.screenSdpSsrc=p)}room.masterServer.pubRoomResourceMsg(a,c.id,p,b,d),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(b){b==d&&("firefox"==webrtcDetectedBrowser&&(e=getSDPSenders(f.sdp),room.localFirefoxSDP=f.sdp),log.debug("addSdp(),  local sessionDescription:"+f.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(f,l,m),setTimeout(function(){var b={};if("firefox"==webrtcDetectedBrowser?b.sdp=f.sdp:b.sdp=room.sdp,b.type="answer",b.sdp=i(b.sdp),"firefox"==webrtcDetectedBrowser){if("video"==a){var c=checkLocalMsids(f.sdp,"video"),d=checkRemoteMsids(b.sdp,"video"),g=c-d,h=checkSdpContents(f.sdp,"video"),k=checkSdpContents(b.sdp,"video"),l=h-k;if(g>0&&l>0){b.sdp+=remoteSDPFirefox_video_add;var m=k+1;b.sdp=b.sdp.replace("sdparta_x","sdparta_"+m),b.sdp=addGroupContents(b.sdp,g),b.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(b.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}else if("audio"==a){var n=checkLocalMsids(f.sdp,"audio"),o=checkRemoteMsids(b.sdp,"audio"),g=n-o,q=checkSdpContents(f.sdp,"audio"),r=checkSdpContents(b.sdp,"audio"),l=q-r;if(g>0&&l>0){b.sdp+=remoteSDPFirefox_audio_add;var m=r+1;b.sdp=b.sdp.replace("sdparta_x","sdparta_"+m),b.sdp=addGroupContents(b.sdp,g),b.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(b.sdp,room.fingerPrint,room.setup,room.iceUfrag,room.icePwd)}}b.sdp=setSDPSenders(b.sdp,e);var s=100;videoCoding==VideoCodingType.VP8||(videoCoding==VideoCodingType.VP9?s=101:videoCoding==VideoCodingType.H264&&(s=107)),b.sdp=j(b.sdp,s,p)}room.sdp=b.sdp,log.debug("addSdp(), remote sessionDescription:"+b.sdp);var t=new RTCSessionDescription(b);room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(t,function(){},function(a){log.error(a)})},200))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(b,e){e==d&&(room.traceablePeerConnection.getToMCUPeerConnection().removeStream(c),"video"==a?room.selfUser.videoSdpSsrc=k:"audio"==a?room.selfUser.audioSdpSsrc=n:"screen"==a&&(room.selfUser.screenSdpSsrc=o))})},k,this.constraints)}function d(a,b,c){var d=c.stream.stream_name,e=c.stream.sdp;if(null==e||""==e)return!1;e=e.replace(/^\n+|\n+$/g,"");var f,g=new SdpSerializer(room.sdp);if(1==b){for(var j=[],l=e.split("\r\n"),n=0;n<l.length;n++){var o=l[n];j.push(o)}if("video"==a){var n=0;null!=g._inner.video.ssrc&&g._inner.video.ssrc.length>0&&(n=g._inner.video.ssrc.length),g.video.track(n).set(j)}else if("audio"==a){var n=0;null!=g._inner.audio.ssrc&&g._inner.audio.ssrc.length>0&&(n=g._inner.audio.ssrc.length),log.info("add ssrc and user relation, use sdp:"+j[0]);var p=j[0].split(" "),q=p[0].split(":"),r=q[1],s=room.getUserByNodeId(c.owner_id);s&&(room.audioSsrc2user[r]=s),g.audio.track(n).set(j)}else if("screen"==a){var n=0;null!=g._inner.video.ssrc&&g._inner.video.ssrc.length>0&&(n=g._inner.video.ssrc.length),g.video.track(n).set(j)}var t=g.deserialize();f=t,f.indexOf("msid-semantic: WMS "+d)>0||(f=f.replace("WMS","WMS "+d)),room.sdp=f}else if(0==b){if("audio"==a){log.info("remove ssrc and user relation");for(key in room.audioSsrc2user){var s=room.audioSsrc2user[key];if(s&&s.nodeId==c.owner_id){delete room.audioSsrc2userNodeId[key];break}}}for(var t=room.sdp,l=e.split("\r\n"),n=0;n<l.length;n++){var o=l[n]+"\r\n";t=t.replace(o,"")}t.indexOf(d)>0&&(t=t.replace(d,"")),f=t,room.sdp=f}var u={};u.sdp=f,u.type="answer",u.sdp=i(u.sdp);var v=new RTCSessionDescription(u);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(a){a.sdp=updateSDPIceUfrag(a.sdp,room.iceUfrag),a.sdp=updateSDPIcePwd(a.sdp,room.icePwd),a.sdp=h(a.sdp),log.debug("updateSdp(), local sessionDescription:"+a.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(a,function(){log.debug("updateSdp(), remote sessionDescription:"+u.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(v,function(){room.masterServer.subRoomResourceMsg(b,c)},function(a){log.error(a)})},m)},k,this.constraints)}function e(a,b,c){var d;log.debug("pc2 for fireofox, update handle "+c.stream.stream_name);var e=c.stream.stream_name,f=c.stream.sdp;if(null==f||""==f)return!1;f=f.replace(/^\n+|\n+$/g,"");var g;if(1==b)log.debug("pc2 for fireofox, update type 11."),"video"==a?g=addSdpSsrc(room.sdpForFirefox,f,"video"):"audio"==a?g=addSdpSsrc(room.sdpForFirefox,f,"audio"):"screen"==a&&(g=addSdpSsrc(room.sdpForFirefox,f,"video"));else if(0==b){log.debug("pc2 for fireofox, update type 00.");for(var l=room.sdpForFirefox,n=f.split("\r\n"),o=0;o<n.length;o++){var p=n[o]+"\r\n";l=l.replace(p,"")}l.indexOf(e)>0&&(l=l.replace(e,"")),g=l}var q={};if(q.sdp=g,q.type="answer",q.sdp=i(q.sdp),1==b)if("video"==a){room.fakeVideoStreams.length<20&&room.initFakeVideoStream(15);var r=checkRemoteMsids(q.sdp,"video"),s=r-room.localVideoMsids,t=checkSdpContents(room.localFirefoxSecondSDP,"video"),u=checkSdpContents(q.sdp,"video"),v=u-t;if(s>0&&v>0)for(var o=0;o<s;o++){var w=room.fakeVideoStreams.shift();room.localAddFakeVideoStreams.push(w),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(w),room.localVideoMsids+=1}}else if("audio"==a){room.fakeAudioStreams.length<20&&room.initFakeAudioStream(15);var x=checkRemoteMsids(q.sdp,"audio"),s=x-room.localAudioMsids,y=checkSdpContents(room.localFirefoxSecondSDP,"audio"),z=checkSdpContents(q.sdp,"audio"),v=z-y;if(s>0&&v>0)for(var o=0;o<s;o++){var w=room.fakeAudioStreams.shift();room.localAddFakeAudioStreams.push(w),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().addStream(w),room.localAudioMsids+=1}}room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().createOffer(function(a){a.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(a.sdp,null,null,room.iceUfragForFirefox,room.icePwd),a.sdp=h(a.sdp),d=getSDPSenders(a.sdp),room.localFirefoxSecondSDP=a.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, local sessionDescription:"+a.sdp),room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setLocalDescription(a,function(){q.sdp=setSDPSenders(q.sdp,d);var a=c.stream.payload;log.debug("payload == "+a),q.sdp=j(q.sdp,a,f),room.sdpForFirefox=q.sdp,log.debug("updateSdpForFirefox(), pc2 for fireofox, remote sessionDescription:"+q.sdp);var e=new RTCSessionDescription(q);room.traceablePeerConnection.getToMCUPeerConnectionForFirefox().setRemoteDescription(e,function(){room.masterServer.subRoomResourceMsg(b,c)},function(a){log.error(a)})},m)},k,this.constraints)}function f(a,b,c){var d;"firefox"==webrtcDetectedBrowser?firefoxRemoveStream(room.traceablePeerConnection.getToMCUPeerConnection(),c):room.traceablePeerConnection.getToMCUPeerConnection().removeStream(c);room.traceablePeerConnection.getToMCUPeerConnection().createOffer(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),e.sdp=h(e.sdp);var f={};f.sdp=room.sdp,f.type="answer",f.sdp=i(f.sdp),"firefox"==webrtcDetectedBrowser&&(d=getSDPSenders(e.sdp),room.localFirefoxSDP=e.sdp),log.debug("reduceSdp(), local sessionDescription:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e,l,m),"firefox"==webrtcDetectedBrowser&&(f.sdp=setSDPSenders(f.sdp,d)),log.debug("reduceSdp(), remote sessionDescription:"+f.sdp);var g=new RTCSessionDescription(f);room.masterServer.unpubRoomResourceMsg(a,c.id,b),setTimeout(function(){room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(g,function(){},function(a){log.error(a)})},200)},k,this.constraints)}function g(a,b){var c=a,d=c.split("\r\n");if(d.length>9){var e="",f=d[4];if(f.indexOf(b)>0)for(var g=0;g<9;g++)""==e?e=d[g]:e+="\r\n"+d[g];else for(var g=9;g<18;g++)""==e?e=d[g]:e+="\r\n"+d[g];return e}return c}function h(a){if(null==a||""==a)return a;var b=a;return b=b.replace(/a=sendonly/g,"a=recvonly"),b=b.replace(/a=inactive/g,"a=recvonly")}function i(a){if(null==a||""==a)return a;var b=a;return navigator.mozGetUserMedia&&(b=b.replace(/a=sendrecv/g,"a=sendonly")),"firefox"==webrtcDetectedBrowser?(b=b.replace(/a=group:BUNDLE audio video/g,"a=group:BUNDLE sdparta_0 sdparta_1"),b=b.replace(/a=mid:audio/g,"a=mid:sdparta_0"),b=b.replace(/a=mid:video/g,"a=mid:sdparta_1")):videoCoding==VideoCodingType.VP8?(b=b.replace("m=video 9 RTP/SAVPF 101 100 107","m=video 9 RTP/SAVPF 100 101 107"),b=b.replace("m=video 9 RTP/SAVPF 107 100 101","m=video 9 RTP/SAVPF 100 101 107"),b=b.replace("m=video 9 RTP/SAVPF 98 96 100","m=video 9 RTP/SAVPF 96 98 100"),b=b.replace("m=video 9 RTP/SAVPF 100 98 96","m=video 9 RTP/SAVPF 96 98 100")):videoCoding==VideoCodingType.VP9?(b=b.replace("m=video 9 RTP/SAVPF 100 101 107","m=video 9 RTP/SAVPF 101 100 107"),b=b.replace("m=video 9 RTP/SAVPF 96 98 100","m=video 9 RTP/SAVPF 98 96 100")):videoCoding==VideoCodingType.H264&&(b=b.replace("m=video 9 RTP/SAVPF 100 101 107","m=video 9 RTP/SAVPF 107 100 101"),b=b.replace("m=video 9 RTP/SAVPF 96 98 100","m=video 9 RTP/SAVPF 100 98 96")),b}function j(a,b,c){for(var d=a.split("m=video"),e=d[0],f=c.split("\r\n"),g=1;g<d.length;g++){var h="m=video"+d[g];h.indexOf(f[0])>-1&&(107==b?h=h.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 126 121 120"):101==b&&(h=h.replace("m=video 1 RTP/SAVPF 120 121 126","m=video 1 RTP/SAVPF 121 120 126"))),e+=h}return e}function k(a){log.error("onCreateSessionDescriptionError(),Failed to add local description: "+a.toString())}function l(){}function m(a){log.error("onSetSessionDescriptionError(),Failed to add local description: "+a.toString())}var n=function(){iceServers&&iceServers.length>0?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};n.prototype.getToMCUPeerConnection=function(){return room.reconnectionCount>0?(null==room.toMCUReconnectionPC&&(room.toMCUReconnectionPC=this.createMCUPeerConnection()),room.toMCUReconnectionPC):(null==room.selfUser.toMCUPC&&(room.selfUser.toMCUPC=this.createMCUPeerConnection()),room.selfUser.toMCUPC)},n.prototype.createMCUPeerConnection=function(){var a=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(a),a},n.prototype.handleMCUPeerConnection=function(a){var b=when.defer();return a.msgQueue=[],a.forLog=!1,a.onicecandidate=function(a){},a.onopen=function(){},a.onaddstream=function(a){if("default"!==a.stream.id){if(log.debug("onaddstream(), remote stream added:"+a.stream.id),a.stream.getVideoTracks().length>0){var b=room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c=room.selfUser.subScreenStream2ResourceInfo[a.stream.id];if(null!=b){log.debug("onaddstream(),MCU stream type: video");var d=room.selfUser.getUserByVideoStreamLabel(a.stream.id),e=d.getVideo(b.resource_id),f=room.traceablePeerConnection.isContainsReconnectionSub(e.id,room.selfUser.reconnectionSubVideoIds);if(f){var g=e.element;attachMediaStream(g,a.stream),g.play();var h=room.selfUser.reconnectionSubVideoIds.indexOf(e.id);h>-1&&room.selfUser.reconnectionSubVideoIds.splice(h,1)}else d.eventEmitter.emit(UserCallback.subscrible_camera_result,a.stream,d.id,d.name,b.resource_id)}if(null!=c){log.debug("onaddstream(), MCU  stream type: screen");var d=room.selfUser.getUserByScreenStreamLabel(a.stream.id),i=d.getScreen(c.resource_id),f=room.traceablePeerConnection.isContainsReconnectionSub(i.id,room.selfUser.reconnectionSubScreenIds);if(f){var j=i.element;attachMediaStream(j,a.stream),j.play();var k=room.selfUser.reconnectionSubScreenIds.indexOf(i.id);k>-1&&room.selfUser.reconnectionSubScreenIds.splice(k,1)}else d.eventEmitter.emit(UserCallback.subscrible_screen_result,a.stream,d.id,d.name,c.resource_id)}}else if(a.stream.getAudioTracks().length>0){log.debug("onaddstream(),MCU stream type: audio");var b=room.selfUser.subAudioStream2ResourceInfo[a.stream.id],d=room.selfUser.getUserByAudioStreamLabel(a.stream.id),l=d.getAudio(b.resource_id);l.stream=a.stream;var f=room.traceablePeerConnection.isContainsReconnectionSub(l.id,room.selfUser.reconnectionSubAudioIds);if(f){var m=l.element;attachMediaStream(m,a.stream),m.play();var n=room.selfUser.reconnectionSubAudioIds.indexOf(l.id);n>-1&&room.selfUser.reconnectionSubAudioIds.splice(n,1)}else d.eventEmitter.emit(UserCallback.subscrible_microphone_result,a.stream,d.id,d.name)}}else log.info("recvonly remote stream ignored:"+a.stream+" - "+a.stream.id)},a.onremovestream=function(a){log.debug("onremovestream(),MCU stream lable:"+a.stream.id);var b=room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c=room.selfUser.getUserByVideoStreamLabel(a.stream.id);null!=c&&(delete room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c.eventEmitter.emit(UserCallback.unsubscrible_camera_result,c.id,c.name,b.resource_id));var d=room.selfUser.subScreenStream2ResourceInfo[a.stream.id],e=room.selfUser.getUserByScreenStreamLabel(a.stream.id);null!=e&&(delete room.selfUser.subScreenStream2ResourceInfo[a.stream.id],e.eventEmitter.emit(UserCallback.unsubscrible_screen_result,e.id,e.name,d.resource_id));var f=room.selfUser.subAudioStream2ResourceInfo[a.stream.id],g=room.selfUser.getUserByAudioStreamLabel(a.stream.id);if(null!=g){var h=g.getAudio(f.resource_id);h.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[a.stream.id],g.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,g.id,g.name)}},a.ondatachannel=function(a){},a.oniceconnectionstatechange=function(c){var d=c.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),MCU iceConnectionState :"+d),d){case"disconnected":break;case"failed":var e="Create MCU PeerConnection  failed. ";log.error(e),b.reject(e);break;case"completed":room.audioLevel=new AudioLevel(a,500),room.connectionInfoCollector=new ConnectionInfoCollector(a,1e3),room.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed);break;case"connected":break;case"closed":}},a.onsignalingstatechange=function(b){log.debug("onsignalingstatechange(), MCU signalingState :"+b.target.signalingState),"stable"==b.target.signalingState&&0==a.forLog&&(a.forLog=!0,a.intervalSet(a))},a.intervalSet=function(a){window.setInterval(function(){a.processSignalingMessage(a)},400)},a.processSignalingMessage=function(a){if("stable"==a.signalingState&&a.msgQueue.length>0){var b=a.msgQueue.shift();log.debug("MCU 操作对列:"+b.operationType),"add"==b.operationType?c(b.para1,b.para2,b.para3,b.para4):"update"==b.operationType?d(b.para1,b.para2,b.para3):"reduce"==b.operationType&&f(b.para1,b.para2,b.para3)}},b.promise},n.prototype.getToMCUPeerConnectionForFirefox=function(){return room.reconnectionCount>0?(null==room.toMCUReconnectionPCForFirefox&&(room.toMCUReconnectionPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.toMCUReconnectionPCForFirefox):(null==room.selfUser.toMCUPCForFirefox&&(room.selfUser.toMCUPCForFirefox=this.createMCUPeerConnectionForFirefox()),room.selfUser.toMCUPCForFirefox)},n.prototype.createMCUPeerConnectionForFirefox=function(){var a=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnectionForFirefox(a),a},n.prototype.handleMCUPeerConnectionForFirefox=function(a){a.msgQueue=[],a.forLog=!1,a.onaddstream=function(a){if("default"!==a.stream.id){if(log.debug("pc2 for fireofox, remote stream added:"+a.stream.id),a.stream.getVideoTracks().length>0){var b=room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c=room.selfUser.subScreenStream2ResourceInfo[a.stream.id];if(null!=b){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: video");var d=room.selfUser.getUserByVideoStreamLabel(a.stream.id),e=d.getVideo(b.resource_id),f=room.traceablePeerConnection.isContainsReconnectionSub(e.id,room.selfUser.reconnectionSubVideoIds);if(f){var g=e.element;attachMediaStream(g,a.stream),g.play();var h=room.selfUser.reconnectionSubVideoIds.indexOf(e.id);h>-1&&room.selfUser.reconnectionSubVideoIds.splice(h,1)}else d.eventEmitter.emit(UserCallback.subscrible_camera_result,a.stream,d.id,d.name,b.resource_id)}if(null!=c){log.debug("onaddstream(), pc2 for fireofox, MCU  stream type: screen");var d=room.selfUser.getUserByScreenStreamLabel(a.stream.id),i=d.getScreen(c.resource_id),f=room.traceablePeerConnection.isContainsReconnectionSub(i.id,room.selfUser.reconnectionSubScreenIds);if(f){var j=i.element;attachMediaStream(j,a.stream),j.play();var k=room.selfUser.reconnectionSubScreenIds.indexOf(i.id);k>-1&&room.selfUser.reconnectionSubScreenIds.splice(k,1)}else d.eventEmitter.emit(UserCallback.subscrible_screen_result,a.stream,d.id,d.name,c.resource_id)}}else if(a.stream.getAudioTracks().length>0){log.debug("onaddstream(),pc2 for fireofox, MCU stream type: audio");var b=room.selfUser.subAudioStream2ResourceInfo[a.stream.id],d=room.selfUser.getUserByAudioStreamLabel(a.stream.id),l=d.getAudio(b.resource_id);l.stream=a.stream;var f=room.traceablePeerConnection.isContainsReconnectionSub(l.id,room.selfUser.reconnectionSubAudioIds);if(f){var m=l.element;attachMediaStream(m,a.stream),m.play();var n=room.selfUser.reconnectionSubAudioIds.indexOf(l.id);n>-1&&room.selfUser.reconnectionSubAudioIds.splice(n,1)}else d.eventEmitter.emit(UserCallback.subscrible_microphone_result,a.stream,d.id,d.name)}}else log.info("pc2 for fireofox, recvonly remote stream ignored:"+a.stream+" - "+a.stream.id)},a.onremovestream=function(a){log.debug("onremovestream(),pc2 for fireofox, MCU stream label:"+a.stream.id);var b=room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c=room.selfUser.getUserByVideoStreamLabel(a.stream.id);null!=c&&(delete room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c.eventEmitter.emit(UserCallback.unsubscrible_camera_result,c.id,c.name,b.resource_id));var d=room.selfUser.subScreenStream2ResourceInfo[a.stream.id],e=room.selfUser.getUserByScreenStreamLabel(a.stream.id);null!=e&&(delete room.selfUser.subScreenStream2ResourceInfo[a.stream.id],e.eventEmitter.emit(UserCallback.unsubscrible_screen_result,e.id,e.name,d.resource_id));var f=room.selfUser.subAudioStream2ResourceInfo[a.stream.id],g=room.selfUser.getUserByAudioStreamLabel(a.stream.id);if(null!=g){var h=g.getAudio(f.resource_id);h.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[a.stream.id],g.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,g.id,g.name)}},a.oniceconnectionstatechange=function(a){var b=a.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(), pc2 for fireofox, MCU iceConnectionState :"+b),b){case"disconnected":break;case"failed":log.error("Create MCU Second PeerConnection failed For Firefox.");break;case"completed":break;case"connected":break;case"closed":}},a.onsignalingstatechange=function(b){log.debug("onsignalingstatechange(), pc2 for fireofox, MCU signalingState :"+b.target.signalingState),"stable"==b.target.signalingState&&0==a.forLog&&(a.forLog=!0,a.intervalSet(a))},a.intervalSet=function(a){window.setInterval(function(){a.processSignalingMessage(a)},400)},a.processSignalingMessage=function(a){if("stable"==a.signalingState&&a.msgQueue.length>0){var b=a.msgQueue.shift();log.debug("MCU 操作对列, pc2 for firefox:"+b.operationType),e(b.para1,b.para2,b.para3)}}},n.prototype.close=function(a){a&&"closed"!=a.signalingState&&a.close()},n.prototype.getInviteRoomReq1ByFirefox=function(){var a=when.defer(),b=!1,c=!1;this.getToMCUPeerConnection().createOffer(function(a){var c=a.sdp,d=preferLineSdp(c,"a=","ice-ufrag");if(null!=d&&d.length>0)for(var e=0;e<d.length;e++){var f=d[e];log.debug("==========local ice-ufrag======="+f);var g=f.split(":");room.iceUfragLocal=g[1];break}var d=preferLineSdp(c,"a=","ice-pwd");if(null!=d&&d.length>0)for(var e=0;e<d.length;e++){var f=d[e];log.debug("=================local ice-pw============="+f);var g=f.split(":");room.icePwdLocal=g[1];break}b=!0},function(a){},this.constraints),this.getToMCUPeerConnectionForFirefox().createOffer(function(a){var b=a.sdp,d=preferLineSdp(b,"a=","ice-ufrag");if(null!=d&&d.length>0)for(var e=0;e<d.length;e++){var f=d[e];log.debug("==========local ice-ufrag 2======="+f);var g=f.split(":");room.iceUfragLocal2=g[1];break}var d=preferLineSdp(b,"a=","ice-pwd");if(null!=d&&d.length>0)for(var e=0;e<d.length;e++){var f=d[e];log.debug("=================local ice-pw 2============="+f);var g=f.split(":");room.icePwdLocal2=g[1];break}c=!0},function(a){},this.constraints);var d=setInterval(function(){b&&c&&(clearInterval(d),a.resolve())},300);return a.promise},n.prototype.doSetLocalDescription=function(){var a=when.defer(),b=this;return b.getToMCUPeerConnection().createOffer(function(c){c.sdp=updateSDPIceUfrag(c.sdp,room.iceUfrag),c.sdp=updateSDPIcePwd(c.sdp,room.icePwd),c.sdp=h(c.sdp),log.debug("doSetLocalDescription(), local sessionDescription:"+c.sdp),"firefox"==webrtcDetectedBrowser&&(room.localFirefoxSDP=c.sdp),b.getToMCUPeerConnection().setLocalDescription(c,function(){log.info("doSetLocalDescription(), set local sessionDescription success"),a.resolve()},function(a){log.error("doSetLocalDescription(), set local sessionDescription error: "+a.toString())})},function(a){log.error("doSetLocalDescription(), createOffer error:"+a.toString())},this.constraints),a.promise},n.prototype.doSetRemoteDescription=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfrag),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdp=sdp;var a={};a.sdp=room.sdp,a.type="answer",a.sdp=i(a.sdp),log.debug("doSetRemoteDescription ,remote  sessionDescription:"+a.sdp);var b=new RTCSessionDescription(a);room.sdp=a.sdp;this.getToMCUPeerConnection().setRemoteDescription(b,function(){if(log.info("doSetRemoteDescription(), set remote sessionDescription success"),setRemoteDescriptionSuccess=!0,"firefox"!=webrtcDetectedBrowser&&null!=addIcecandidateList&&addIcecandidateList.length>0){for(var a=0;a<addIcecandidateList.length;a++){var b=addIcecandidateList[a];room.masterServer.setAddIcecandidate(b)}addIcecandidateList=[]}if("firefox"==webrtcDetectedBrowser){var c=30;room.initFakeVideoStream(c),room.initFakeAudioStream(c)}},function(a){log.error("doSetRemoteDescription(), setRemoteDescription error:"+a)})},n.prototype.doSetLocalDescriptionForFirefox=function(){var a=when.defer(),b=this;return b.getToMCUPeerConnectionForFirefox().createOffer(function(c){c.sdp=updateSDPFingerPrintAndSetupAndIceUfragAndIcePwd(c.sdp,null,null,room.iceUfragForFirefox,room.icePwd),c.sdp=h(c.sdp),log.debug("doSetLocalDescription(), pc2 for fireofox, local sessionDescription:"+c.sdp),room.localFirefoxSecondSDP=c.sdp,b.getToMCUPeerConnectionForFirefox().setLocalDescription(c,function(){log.info("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription success"),a.resolve()},function(a){log.error("doSetLocalDescription(), pc2 for fireofox, set local sessionDescription error: "+a.toString())})},function(a){log.error("doSetLocalDescription(), pc2 for fireofox, createOffer error:"+a.toString())},this.constraints),a.promise},n.prototype.doSetRemoteDescriptionForFirefox=function(){sdp=updateSDPFingerPrint(remoteSDPInit,room.fingerPrint),sdp=updateSDPIceUfrag(sdp,room.iceUfragForFirefox),sdp=updateSDPIcePwd(sdp,room.icePwd),sdp=updateSDPSetup(sdp,room.setup),room.sdpForFirefox=sdp;var a={};a.sdp=room.sdpForFirefox,a.type="answer",a.sdp=i(a.sdp),log.debug("doSetRemoteDescription , pc2 for fireofox, remote  sessionDescription:"+a.sdp);var b=new RTCSessionDescription(a);room.sdpForFirefox=a.sdp,this.getToMCUPeerConnectionForFirefox().setRemoteDescription(b,function(){if(log.info("doSetRemoteDescription(), pc2 for fireofox, set remote sessionDescription success"),setRemoteDescriptionSuccessForFirefox=!0,null!=addIcecandidateList&&addIcecandidateList.length>0){for(var a=0;a<addIcecandidateList.length;a++){var b=addIcecandidateList[a];room.masterServer.setAddIcecandidate(b)}addIcecandidateList=[]}var c=30;room.initFakeVideoStream(c),room.initFakeAudioStream(c)},function(a){log.error("doSetRemoteDescription(), pc2 for fireofox, setRemoteDescription error:"+a)})},n.prototype.doAddIceCandidate=function(a){var b="";a.candidate.indexOf("=")>-1&&(b=a.candidate.split("=")[1]);var c="audio",d="video";navigator.mozGetUserMedia&&(c="sdparta_0",d="sdparta_1");var e=new RTCIceCandidate({sdpMLineIndex:a.sdp_mline_index,sdpMid:c,candidate:b});this.getToMCUPeerConnection().addIceCandidate(e,o,p);var f=new RTCIceCandidate({sdpMLineIndex:1,sdpMid:d,candidate:b});this.getToMCUPeerConnection().addIceCandidate(f,o,p),"firefox"==webrtcDetectedBrowser&&(this.getToMCUPeerConnectionForFirefox().addIceCandidate(e,o,p),this.getToMCUPeerConnectionForFirefox().addIceCandidate(f,o,p));
},n.prototype.addSdp=function(a,c,d,e){this.getToMCUPeerConnection().msgQueue.unshift(b("add",a,c,d,e))},n.prototype.updateSdp=function(a,c,d){"firefox"==webrtcDetectedBrowser?this.getToMCUPeerConnectionForFirefox().msgQueue.unshift(b("update",a,c,d)):this.getToMCUPeerConnection().msgQueue.unshift(b("update",a,c,d))},n.prototype.reduceSdp=function(a,c,d){this.getToMCUPeerConnection().msgQueue.unshift(b("reduce",a,c,d))},n.prototype.isContainsReconnectionSub=function(a,b){var c=!1;if(null!=b&&b.length>0)for(var d=0;d<b.length;d++){var e=b[d];if(a==e){c=!0;break}}return c};var o=function(){},p=function(a){log.error("onAddIceCandidateError(),Failed to add remote candidate: "+a.toString())};return n}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(a){function b(){}function c(){}function d(a,b){var c=a,d=c.split("\r\n");if(d.length>9){var e="",f=d[4];if(f.indexOf(b)>0)for(var g=0;g<9;g++)""==e?e=d[g]:e+="\r\n"+d[g];else for(var g=9;g<18;g++)""==e?e=d[g]:e+="\r\n"+d[g];return e}return c}function e(a,b,c,d,e){var f={};return f.operationType=a,f.para1=b,f.para2=c,f.para3=d,f.para4=e,f}function f(a){if("default"!=a.id){var b=room.selfUser.subVideoStream2ResourceInfo[a.id],c=room.selfUser.getUserByVideoStreamLabel(a.id);null!=c&&(delete room.selfUser.subVideoStream2ResourceInfo[a.id],c.eventEmitter.emit(UserCallback.unsubscrible_camera_result,c.id,c.name,b.resource_id));var d=room.selfUser.subScreenStream2ResourceInfo[a.id],e=room.selfUser.getUserByScreenStreamLabel(a.id);null!=e&&(delete room.selfUser.subScreenStream2ResourceInfo[a.id],e.eventEmitter.emit(UserCallback.unsubscrible_screen_result,e.id,e.name,d.resource_id));var f=room.selfUser.subAudioStream2ResourceInfo[a.id],g=room.selfUser.getUserByAudioStreamLabel(a.id);if(null!=g){var h=g.getAudio(f.resource_id);h.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[a.id],g.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,g.id,g.name)}}}var g=function(){iceServers&&iceServers.length>0?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};g.prototype.getToP2PPeerConnection=function(a){var b=room.selfUser.toP2PPCs[a];return null==b&&(b=this.createP2PPeerConnection(a),room.selfUser.toP2PPCs[a]=b,room.selfUser.nodeId<a&&this.sendOfferP2P(b,a)),b},g.prototype.createP2PPeerConnection=function(a){var b=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(a,b),b},g.prototype.sendOfferP2P=function(a,d,e){var f=this.constraints;1==e?f.iceRestart=!0:f.iceRestart=!1;var g=this;a.createOffer(function(e){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+e.sdp),a.setLocalDescription(e,b,c),room.masterServer.sendOfferP2P(e.sdp,d),g.constraints.iceRestart=!1},function(a){},f)},g.prototype.setRemoteP2P=function(a){var d={};d.sdp=a.sdp,d.type="offer";var e=new RTCSessionDescription(d);room.sdp=d.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+d.sdp);var f=this.getToP2PPeerConnection(a.node_id);f.setRemoteDescription(e,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),f.createAnswer(function(d){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+d.sdp),f.setLocalDescription(d,b,c),room.masterServer.setRemoteP2P(d.sdp,a.node_id)},function(a){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+a)},this.constraints)},function(a){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+a)})},g.prototype.setAnswerP2P=function(a){var b={};b.sdp=a.sdp,b.type="answer";var c=new RTCSessionDescription(b);log.debug("setAnswerP2P():  P2P  session Description:"+b.sdp);var d=this.getToP2PPeerConnection(a.node_id);d.setRemoteDescription(c,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(a){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+a)})},g.prototype.addIceCandidateP2P=function(a){var b=this.getToP2PPeerConnection(a.node_id);log.debug("addIceCandidateP2P(), P2P candidate:"+a.candidate);var c=new RTCIceCandidate({sdpMLineIndex:a.sdp_mline_index,sdpMid:a.sdp_mid,candidate:a.candidate});b.addIceCandidate(c,i,j)},g.prototype.addStreamP2P=function(a){var b=this.getToP2PPeerConnection(a.sub_node_id),c=a.info.resource_id;if(1==a.info.stream.type){var d=room.splitPDUDeviceId(c),e=room.selfUser.getVideo(d),f=e.stream;null!=f&&(b.addStream(f),room.selfUser.subMyVideosP2P.push(a.sub_node_id))}else if(2==a.info.stream.type){var d=room.splitPDUDeviceId(c),g=room.selfUser.getAudio(d),h=g.stream;null!=h&&(b.addStream(h),room.selfUser.subMyAudiosP2P.push(a.sub_node_id))}else if(3==a.info.stream.type){var d=room.splitPDUDeviceId(c),i=room.selfUser.getScreen(d),j=i.stream;null!=j&&(b.addStream(j),room.selfUser.subMyScreensP2P.push(a.sub_node_id))}},g.prototype.sendSubSdpOfferP2P=function(a,b){var c;"offerSub"==a?c=this.getToP2PPeerConnection(b.info.owner_id):"answerSub"==a&&(c=this.getToP2PPeerConnection(b.sub_node_id)),c.msgQueue.unshift(e("sub",c,a,b,null))},g.prototype.sendSubSdpAnswerP2P=function(a,e,f,g,i,j){var k=i.stream.sdp,l={};l.sdp=k,l.type="offer";var m=new RTCSessionDescription(l),n="sendSubSdpAnswerP2P(), P2P remote sessionDescription:";log.debug(n+l.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+e.signalingState),e.setRemoteDescription(m,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success."),room.selfUser.sdpP2PMap[i.owner_id]=k;var g,l=new SdpSerializer(k);"video"==f?(g=l._inner.video.ssrcStr,g=d(g,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+g),room.selfUser.videoSdpSsrcMapP2PMap[i.owner_id]=g):"audio"==f?(g=l._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+g),room.selfUser.audioSdpSsrcP2PMap[i.owner_id]=g):"desktop"==f&&(g=l._inner.video.ssrcStr,g=d(g,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+g),room.selfUser.screenSdpSsrcP2PMap[i.owner_id]=g),e.createAnswer(function(d){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+d.sdp),e.setLocalDescription(d,b,c),room.masterServer.sendSubSdpAnswerP2P(a,i,d.sdp,j)},h,this.constraints)},function(a){log.error(a)})},g.prototype.getSubSdpAnswerP2P=function(a){var b={};b.sdp=a.info.stream.sdp,b.type="answer";var c=new RTCSessionDescription(b);log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+b.sdp),room.selfUser.sdpP2PMap[a.info.owner_id]=a.info.stream.sdp;var d=this.getToP2PPeerConnection(a.sub_node_id);d.setRemoteDescription(c,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(a){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+a)})},g.prototype.getSubSdpAnswerP2PByRep=function(a){var b={};b.sdp=a.info.stream.sdp,b.type="answer";var c=new RTCSessionDescription(b);log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+b.sdp),room.selfUser.sdpP2PMap[a.info.owner_id]=a.info.stream.sdp;var d=this.getToP2PPeerConnection(a.info.owner_id);d.setRemoteDescription(c,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(a){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+a)})},g.prototype.removeStreamP2P=function(a,b,c){var d=this.getToP2PPeerConnection(b);"video"==a?null!=d&&"closed"!=d.signalingState&&null!=c&&(d.removeStream(c),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==a?null!=d&&"closed"!=d.signalingState&&null!=c&&(d.removeStream(c),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==a&&null!=d&&"closed"!=d.signalingState&&null!=c&&(d.removeStream(c),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},g.prototype.sendUnSubSdpOfferP2P=function(a,b,c,d){var f=this.getToP2PPeerConnection(c);null!=f&&"closed"!=f.signalingState&&f.msgQueue.unshift(e("unsub",f,a,b,d))},g.prototype.sendUnSubSdpAnswerP2P=function(a,b,d,e){var f,g=this.getToP2PPeerConnection(d),i={};if("unsubAnswer"==a){var j,k=e.stream.stream_name;"video"==b?j=room.selfUser.videoSdpSsrcMapP2PMap[e.owner_id]:"audio"==b?j=room.selfUser.audioSdpSsrcP2PMap[e.owner_id]:"screen"==b&&(j=room.selfUser.screenSdpSsrcP2PMap[e.owner_id]);for(var l=room.selfUser.sdpP2PMap[e.owner_id],m=j.split("\r\n"),n=0;n<m.length;n++){var o=m[n]+"\r\n";l=l.replace(o,"")}l.indexOf(k)>0&&(l=l.replace(k,"")),room.selfUser.sdpP2PMap[e.owner_id]=l,i.sdp=l,i.type="offer",f=new RTCSessionDescription(i)}else"unpubAnswer"==a&&(i.sdp=g.remoteDescription.sdp,i.type="offer",f=new RTCSessionDescription(i));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+f.sdp),g.setRemoteDescription(f,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(a){log.error(a)}),g.createAnswer(function(a){room.sdp=a.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),g.setLocalDescription(a,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},c)},h,this.constraints)},g.prototype.handleP2PPeerConnection=function(a,b){var c=when.defer();return b.msgQueue=[],b.forLog=!1,b.nodeId=a,b.onicecandidate=function(b){b.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+b.candidate.candidate),room.masterServer.sendCandidateMsgP2P(b.candidate,a)):log.debug("P2P  End of candidates.")},b.onopen=function(){},b.onaddstream=function(a){if(log.debug("onaddstream(), P2P  stream id:"+a.stream.id),"default"!=a.stream.id)if(a.stream.getVideoTracks().length>0){var b=room.selfUser.subVideoStream2ResourceInfo[a.stream.id],c=room.selfUser.subScreenStream2ResourceInfo[a.stream.id];if(null!=b){log.debug("onaddstream(), P2P  stream type: video");var d=room.selfUser.getUserByVideoStreamLabel(a.stream.id);d.getVideo(b.resource_id);d.eventEmitter.emit(UserCallback.subscrible_camera_result,a.stream,d.id,d.name,b.resource_id)}if(null!=c){log.debug("onaddstream(), P2P  stream type: screen");var d=room.selfUser.getUserByScreenStreamLabel(a.stream.id);d.getScreen(c.resource_id);d.eventEmitter.emit(UserCallback.subscrible_screen_result,a.stream,d.id,d.name,c.resource_id)}}else if(a.stream.getAudioTracks().length>0){log.debug("onaddstream(), P2P  stream type: audio");var b=room.selfUser.subAudioStream2ResourceInfo[a.stream.id],d=room.selfUser.getUserByAudioStreamLabel(a.stream.id),e=d.getAudio(b.resource_id);e.stream=a.stream,d.eventEmitter.emit(UserCallback.subscrible_microphone_result,a.stream,d.id,d.name)}},b.onremovestream=function(a){f(a.stream)},b.ondatachannel=function(a){},b.oniceconnectionstatechange=function(a){var c=a.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+c),c){case"disconnected":room.isMcu()||room.selfUser.nodeId<b.nodeId&&(log.debug("=======PeerConnection reconnection，send off.  self user nodeId:"+room.selfUser.nodeId+" ----> download user nodeId:"+b.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(b,b.nodeId,!0));break;case"failed":break;case"completed":break;case"connected":break;case"closed":}},b.onsignalingstatechange=function(a){log.debug("onsignalingstatechange(), P2P signalingState :"+a.target.signalingState),"stable"==a.target.signalingState&&0==b.forLog&&(b.forLog=!0,b.intervalSet(b))},b.intervalSet=function(a){window.setInterval(function(){a.processSignalingMessage(a)},400)},b.processSignalingMessage=function(a){if("stable"==a.signalingState&&a.msgQueue.length>0){var b=a.msgQueue.shift();log.debug("P2P 操作对列:"+b.operationType),"sub"==b.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(b.para1,b.para2,b.para3,b.para4):"unsub"==b.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(b.para1,b.para2,b.para3,b.para4)}},c.promise},g.prototype.sendSubSdpOfferP2PHandle=function(a,d,e){a.createOffer(function(f){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+f.sdp),room.sdp=f.sdp,a.setLocalDescription(f,b,c),room.masterServer.sendSubSdpOfferP2P(e,f.sdp,d)},h,this.constraints)},g.prototype.sendUnSubSdpOfferP2PHandle=function(a,b,d,e){a.createOffer(function(g){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+g.sdp),a.setLocalDescription(g,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var c,g={};if("unpubOffer"==b){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),g.sdp=a.remoteDescription.sdp,g.type="answer";var c=new RTCSessionDescription(g)}else if("unsubOffer"==b){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");var h,i=a.remoteDescription.sdp,j=new SdpSerializer(i);"video"==d?h=j._inner.video.ssrcStr:"audio"==d?h=j._inner.audio.ssrcStr:"screen"==d&&(h=j._inner.video.ssrcStr);for(var k=h.split("\r\n"),l=0;l<k.length;l++){var m=k[l]+"\r\n";i=i.replace(m,"")}var n=e.stream.stream_name;i.indexOf(n)>0&&(i=i.replace(n,"")),g.sdp=i,g.type="answer",c=new RTCSessionDescription(g)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+g.sdp),a.setRemoteDescription(c,function(){if(log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success."),"unsubOffer"==b){var c=a.getRemoteStreams();if(c.length>0)for(l=0;l<c.length;l++){var d=c[l];"default"!=d.id&&(d.onremovetrack=function(a){f(d)})}}},function(a){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+a)})},c)},h,this.constraints)};var h=function(){},i=function(){},j=function(a){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+a.toString())};return g}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(a){var b=function(){};return b.prototype.getDataChannel=function(b){var c;switch(b){case SignalType.websocket:c=new a}return c},b}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Error"],function(a,b,c){function d(a,b){var c=room.getUserByNodeId(a),d=new Object,e=new Date;return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),d.timestamp=e.getTime(),d.fromId=c.id,d.fromName=c.name,d.message=b,d}var e=function(){};return e.prototype.OnWebSocketMessage=function(e){var f;null==room.cmdProtobufCoded?(f=new a,room.cmdProtobufCoded=f):f=room.cmdProtobufCoded;var g=f.getRoomPduTypeEnum(),h=f.getMediaTypeEnum(),i=f.getResourceStatusEnum(),j=f.getResourceOptEnum(),k=f.decodePacket(e),l=k.type;switch(l){case g.OPEN_REP:var m=f.decodeBody(e);if(0==m.result)log.info("======openRep.result：0=========="),room.reconnectionState?(log.debug("======OPEN_REP：重连成功======="),room.reconnectionState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle()):(log.debug("======OPEN_REP：连接成功======="),room.pingInterval=m.ping_interval,room.pingTimeout=m.ping_timeout,room.signalTocken=m.signal_tocken,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.masterServer.inviteRoomReqSend()),room.reconnectionOpenRep402=!1,room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected);else if(402==m.result)log.info("======openRep.result：402=========="),room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed);else{log.info("OPEN_REP,openRep.result: "+m.result+",openRep.description:"+m.description),room.reconnectionState=!1;var n=new c(m.result,m.description);room.eventEmitter.emit(EngineCallback.room_join_error,n)}break;case g.PONG:room.pingCountTime=0;break;case g.INVITE_ROOM_REP1:var o=f.decodeBody(e);if(0==o.result){if(room.fingerPrint=o.finger_print,room.setup=o.setup,"firefox"==webrtcDetectedBrowser){var p=o.ice_ufrag.split(":"),q=o.ice_pwd.split(":");room.iceUfrag=p[0],room.icePwd=q[0],room.iceUfragForFirefox=p[1],room.icePwdForFirefox=q[1]}else console.log("1=========="+o.ice_ufrag),room.iceUfrag=o.ice_ufrag,room.icePwd=o.ice_pwd;if(room.roomTocken=o.room_tocken,room.roomInfo=o.room_info,room.masterServer.sendOffer(),0==room.reconnectionCount){room.selfUser.nodeId=o.node_id,room.selfUser.role=1,null!=o.role&&(room.selfUser.role=o.role);var r=room.avdEngine.cameraMap;for(var s in r){var t=r[s];room.selfUser.initVideo(s,t)}null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.addUser(room.selfUser),log.info("join room  Success! your nodeId:"+room.selfUser.nodeId+"; roomId:"+room.id)}else{var r=room.avdEngine.cameraMap;for(var s in r){var t=r[s];room.selfUser.initVideo(s,t)}null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.selfUser.reconnectionSubVideoIds=room.selfUser.subVideoIds.slice(0),room.selfUser.reconnectionSubAudioIds=room.selfUser.subAudioIds.slice(0),room.selfUser.reconnectionSubScreenIds=room.selfUser.subScreenIds.slice(0),room.selfUser.reconnectionUsers.push(room.selfUser),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected),log.info("reconnection,join room  Success!"),room.traceablePeerConnection.close(room.selfUser.toMCUPC),room.selfUser.toMCUPC=room.toMCUReconnectionPC,"firefox"==webrtcDetectedBrowser&&(room.traceablePeerConnection.close(room.selfUser.toMCUPCForFirefox),room.selfUser.toMCUPCForFirefox=room.toMCUReconnectionPCForFirefox),setTimeout(function(){for(var a in room.selfUser.videos){var b=room.selfUser.videos[a];if(b.status==StreamStatus.published){var c=b.stream.clone();b.stream=c,b.publish()}}var d=room.selfUser.screen;null!=d&&d.status==StreamStatus.published&&d.publish();var e=room.selfUser.audio;null!=e&&e.status==StreamStatus.published&&e.openMicrophone()},2e3),setTimeout(function(){var a=arrayUtil.chajiObject(room.participants,room.selfUser.reconnectionUsers);if(null!=a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b],d=room.getUserByNodeId(c);null!=d&&(room.removeUser(d.id),room.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,d))}room.reconnectionCount=0,room.selfUser.reconnectionUsers=[]},2e4)}room.eventEmitter.emit(EngineCallback.room_join_success,room);break}log.info("INVITE_ROOM_REP1,inviteRoomRep1.result: "+o.result+",inviteRoomRep1.description:"+o.description);var n=new c(o.result,o.description);room.eventEmitter.emit(EngineCallback.room_join_error,n);break;case g.CANDIDATE_MSG1:var u=f.decodeBody(e);log.info("mcu send  CANDIDATE_MSG1:"+u.candidate),"firefox"==webrtcDetectedBrowser?setRemoteDescriptionSuccess&&setRemoteDescriptionSuccessForFirefox?room.masterServer.setAddIcecandidate(u):addIcecandidateList.push(u):setRemoteDescriptionSuccess?room.masterServer.setAddIcecandidate(u):addIcecandidateList.push(u);break;case g.ROOM_RESOURCE_INFOS:var v=f.decodeBody(e),w=v.resource_infos;for(var s in w){var x=w[s],y=x.stream.type;switch(y){case h.video:log.info("accept video  JOIN_REP(PUB_ROOM_RESOURCE): "+x.owner_id+"------>"+room.selfUser.nodeId);var z=room.traceablePeerConnection.isContainsReconnectionSub(x.resource_id,room.selfUser.subVideoIds);if(z){var A=room.getUserByNodeId(x.owner_id),B=A.getVideo(x.resource_id);B.resourceInfo=x,B.subscrible()}else{var A=room.getUserByNodeId(x.owner_id),B=A.getVideo(x.resource_id);null==B&&(B=A.createVideo(x.resource_id,"")),B.resourceInfo=x,B.ownerId=A.id,room.pubVideos.push(B);var C=[];C.push(B),A.eventEmitter.emit(UserCallback.camera_status_notify,B.status,B.id,B.name,A.id),A.eventEmitter.emit(UserCallback.publish_camera_notify,C)}break;case h.audio:log.info("accept audio  JOIN_REP(PUB_ROOM_RESOURCE): "+x.owner_id+"------>"+room.selfUser.nodeId);var z=room.traceablePeerConnection.isContainsReconnectionSub(x.resource_id,room.selfUser.subAudioIds);if(z)room.masterServer.audioSubscribleHandle(x);else{var A=room.getUserByNodeId(x.owner_id),D=A.getAudio(x.resource_id);null==D&&(D=A.createAudio(x.resource_id,"")),D.resourceInfo=x,room.pubAudios.push(D),room.selfUser.subAudioStream2ResourceInfo[x.stream.stream_name]=x,room.selfUser.subAudioIds.push(D.id),room.masterServer.audioSubscribleHandle(x),A.eventEmitter.emit(UserCallback.microphone_status_notify,D.status,D.id,D.name,A.id)}break;case h.desktop:log.info("accept desktop  JOIN_REP(PUB_ROOM_RESOURCE): "+x.owner_id+"------>"+room.selfUser.nodeId);var z=room.traceablePeerConnection.isContainsReconnectionSub(x.resource_id,room.selfUser.subScreenIds);if(z){var A=room.getUserByNodeId(x.owner_id),E=A.getScreen(x.resource_id);E.resourceInfo=x,E.subscrible()}else{var A=room.getUserByNodeId(x.owner_id),E=A.getScreen(x.resource_id);null==E&&(E=A.createScreen(x.resource_id,"")),E.resourceInfo=x,E.ownerId=A.id,room.pubScreens.push(E);var F=[];F.push(E),A.eventEmitter.emit(UserCallback.screen_status_notify,E.status,E.id,E.name,A.id),A.eventEmitter.emit(UserCallback.publish_screen_notify,F)}}}break;case g.USER_INFO_MSG:log.debug("messageManager: roomPduType.USER_INFO_MSG");var G=f.decodeBody(e);if(null==G)return;var H=[],I=G.user;I.forEach(function(a){var c=new b(a.user_id,a.user_name,null,null);c.nodeId=a.node_id,c.role=a.role,c.data=a.user_data,room.reconnectionCount>0&&room.selfUser.reconnectionUsers.push(c),a.webcams.forEach(function(a){var b=c.createVideo(a.id,a.name);b.status=a.status,b.cameraType=a.ctype,b.level=a.level,b.description=a.description}),a.speakers.forEach(function(a){var b=c.createAudio(a.id,a.name);b.status=a.status}),a.desktops.forEach(function(a){var b=c.createScreen(a.id,a.name);b.status=a.status,b.level=a.level,b.description=a.description}),room.hasUser(c.id)||(room.addUser(c),H.push(c)),room.isMcu()||room.p2pServer.createP2PPeerConnection(c.nodeId)}),room.eventEmitter.emit(RoomCallback.user_join_notify,H);break;case g.ADD_WEBCAM_MSG:log.debug("messageManager: roomPduType.ADD_WEBCAM_MSG");var J=f.decodeBody(e),A=room.getUserByNodeId(J.node_id);if(A){var K=J.webcam,B=A.createVideo(K.id,K.name);B.status=K.status,B.cameraType=K.ctype,B.level=K.level,B.description=K.description,A.eventEmitter.emit(UserCallback.camera_status_notify,K.status,K.id,K.name,A.id)}break;case g.ADD_SPEAKER_MSG:log.debug("messageManager: roomPduType.ADD_SPEAKER_MSG");var L=f.decodeBody(e),A=room.getUserByNodeId(L.node_id);if(A){var M=L.speaker,D=A.createAudio(M.id,M.name);D.status=M.status,A.eventEmitter.emit(UserCallback.microphone_status_notify,M.status,M.id,M.name,A.id)}break;case g.ADD_DESKTOP_MSG:log.debug("messageManager: roomPduType.ADD_DESKTOP_MSG");var N=f.decodeBody(e),A=room.getUserByNodeId(N.node_id);if(A){var O=N.desktop,E=A.createScreen(O.id,O.name);E.status=O.status,E.level=O.level,E.description=O.description,A.eventEmitter.emit(UserCallback.screen_status_notify,O.status,O.id,O.name,A.id)}break;case g.REMOVE_WEBCAM_MSG:var P=f.decodeBody(e),A=room.getUserByNodeId(P.node_id),Q=A.getVideo(P.resource_id);A.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,Q.id,Q.name,A.id),arrayUtil.objectSplice(A.videos,P.resource_id);break;case g.REMOVE_SPEAKER_MSG:var R=f.decodeBody(e),A=room.getUserByNodeId(R.node_id);A.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,A.audio.id,A.audio.name,A.id),A.audio.id==R.resource_id&&(A.audio=null);break;case g.REMOVE_DESKTOP_MSG:var S=f.decodeBody(e),A=room.getUserByNodeId(S.node_id);A.eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,A.screen.id,A.screen.name,A.id),A.screen.id==S.resource_id&&(A.screen=null);break;case g.UPDATE_SPEAKER_MSG:var T=f.decodeBody(e),A=room.getUserByNodeId(T.node_id),D=A.getAudio(T.resource_id);D.status=T.speaker.status,A.eventEmitter.emit(UserCallback.microphone_status_notify,D.status,D.id,D.name,A.id);break;case g.UPDATE_WEBCAM_MSG:var U=f.decodeBody(e),A=room.getUserByNodeId(U.node_id),B=A.getVideo(U.resource_id);B.level=U.webcam.level,B.description=U.webcam.description,A.eventEmitter.emit(UserCallback.camera_data_notify,B.level,B.description,B.id,B.name,A.id);break;case g.UPDATE_DESKTOP_MSG:var V=f.decodeBody(e),A=room.getUserByNodeId(V.node_id),E=A.getScreen(V.resource_id);E.level=V.desktop.level,E.description=V.desktop.description,A.eventEmitter.emit(UserCallback.screen_data_notify,E.level,E.description,E.id,E.name,A.id);break;case g.PUB_ROOM_RESOURCE_MSG:var W=f.decodeBody(e),x=W.info;if(x.stream.type==h.video){log.info("accept video  PUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var z=room.traceablePeerConnection.isContainsReconnectionSub(x.resource_id,room.selfUser.reconnectionSubVideoIds);if(z){var A=room.getUserByNodeId(x.owner_id),B=A.getVideo(x.resource_id);B.resourceInfo=x,B.subscrible()}else{var C=[],A=room.getUserByNodeId(x.owner_id),B=A.getVideo(x.resource_id);null==B&&(B=A.createVideo(x.resource_id,"")),B.resourceInfo=x,B.status=StreamStatus.published,B.ownerId=A.id,C.push(B),room.pubVideos.push(B),A.eventEmitter.emit(UserCallback.camera_status_notify,B.status,B.id,B.name,A.id),A.eventEmitter.emit(UserCallback.publish_camera_notify,C)}}else if(x.stream.type==h.audio){log.info("accept audio  PUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var A=room.getUserByNodeId(x.owner_id),D=A.getAudio(x.resource_id);null==D&&(D=A.createAudio(x.resource_id,"")),D.resourceInfo=x,D.status=StreamStatus.published,room.pubAudios.push(D),A.eventEmitter.emit(UserCallback.microphone_status_notify,D.status,D.id,D.name,A.id),room.selfUser.subAudioStream2ResourceInfo[x.stream.stream_name]=x,room.selfUser.subAudioIds.push(D.id),room.masterServer.audioSubscribleHandle(x)}else if(x.stream.type==h.desktop){log.info("accept screen  PUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var z=room.traceablePeerConnection.isContainsReconnectionSub(x.resource_id,room.selfUser.reconnectionSubScreenIds);if(z){var A=room.getUserByNodeId(x.owner_id),E=A.getScreen(x.resource_id);E.resourceInfo=x,E.subscrible()}else{var F=[],A=room.getUserByNodeId(x.owner_id),E=A.getScreen(x.resource_id);null==E&&(E=A.createScreen(x.resource_id,"")),E.resourceInfo=x,E.status=StreamStatus.published,E.ownerId=A.id,F.push(E),room.pubScreens.push(E),A.eventEmitter.emit(UserCallback.screen_status_notify,E.status,E.id,E.name,A.id),A.eventEmitter.emit(UserCallback.publish_screen_notify,F)}}break;case g.PUB_ROOM_RESOURCE_MSG_REP:var X=f.decodeBody(e),Y=X.id,Z=X.result,$=X.description;if(0==Z)room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,Y);else{log.info("pubRoomResourceMsgRep.result: "+Z+",pubRoomResourceMsgRep.description:"+$);var _=new c(Z,$);room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,_,Y)}break;case g.UNPUB_ROOM_RESOURCE_MSG:var aa=f.decodeBody(e),x=aa.info;if(x.stream.type==h.video){log.info("accept video  UNPUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var A=room.getUserByNodeId(x.owner_id),B=A.getVideo(x.resource_id);B.status=i.init,A.eventEmitter.emit(UserCallback.camera_status_notify,B.status,B.id,B.name,A.id),A.eventEmitter.emit(UserCallback.unpublish_camera_notify,B),arrayUtil.objectSplice(room.pubVideos,x.resource_id)}else if(x.stream.type==h.audio){log.info("accept audio  UNPUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var A=room.getUserByNodeId(x.owner_id),D=A.getAudio(x.resource_id);D.status=i.init,A.eventEmitter.emit(UserCallback.microphone_status_notify,D.status,D.id,D.name,A.id),arrayUtil.baseSplice(room.selfUser.subAudioIds,this.id),room.masterServer.audioUnsubscribleHandle(x),arrayUtil.objectSplice(room.pubAudios,x.resource_id)}else if(x.stream.type==h.desktop){log.info("accept screen  UNPUB_ROOM_RESOURCE_MSG: "+x.owner_id+"------>"+room.selfUser.nodeId);var A=room.getUserByNodeId(x.owner_id),E=A.getScreen(x.resource_id);E.status=i.init,A.eventEmitter.emit(UserCallback.screen_status_notify,E.status,E.id,E.name,A.id),A.eventEmitter.emit(UserCallback.unpublish_screen_notify,E),arrayUtil.objectSplice(room.pubScreens,x.resource_id)}break;case g.VIDEO_INDICTION:var ba=f.decodeBody(e),ca=room.splitPDUDeviceId(ba.resource_id),B=room.selfUser.getVideo(ca);ba.opt==j.pub?B.publish():ba.opt==j.unpub&&B.unpublish();break;case g.AUDIO_INDICTION:var ba=f.decodeBody(e),da=room.splitPDUDeviceId(ba.resource_id),D=room.selfUser.getAudio(da);ba.opt==j.pub?D.openMicrophone():ba.opt==j.unpub&&D.closeMicrophone();break;case g.PUBLIC_TEXT_MSG:var ea=f.decodeBody(e),fa=d(k.src,ea.content);room.eventEmitter.emit(RoomCallback.public_message,fa);break;case g.PRIVATE_TEXT_MSG:var ea=f.decodeBody(e),fa=d(k.src,ea.content);room.eventEmitter.emit(RoomCallback.private_message,fa);break;case g.PUBLIC_DATA:var ga=f.decodeBody(e),A=room.getUserByNodeId(k.src);room.eventEmitter.emit(RoomCallback.public_data,ga.content.toArrayBuffer(),A.id);break;case g.PRIVATE_DATA:var ga=f.decodeBody(e),A=room.getUserByNodeId(k.src);room.eventEmitter.emit(RoomCallback.private_data,ga.content.toArrayBuffer(),A.id);break;case g.UPDATE_USER_DATA_MSG:var ha=f.decodeBody(e),A=room.getUserByNodeId(ha.node_id);A.data=ha.user_data,room.eventEmitter.emit(RoomCallback.user_data_notify,ha.user_data,A.id);break;case g.ROOM_DATA_INFO:var ia=f.decodeBody(e);room.eventEmitter.emit(RoomCallback.app_data_notify,ia.kvs);var ja=ia.kvs;if(null!=ja)for(var ka=0;ka!=ja.length;++ka){var la=ja[ka];room.appData[la.key]=la.value}break;case g.USER_INDICTION:var ma=f.decodeBody(e);if(ma.type==g.USER_MSG){var na=f.decodeUserMsg(ma.body),oa=room.getUserId(ma.operator_id);room.eventEmitter.emit(RoomCallback.leave_indication,na.reason,oa);var pa=!0;room.leave(na.reason,pa)}break;case g.USER_MSG:var na=f.decodeBody(e),A=room.getUserByNodeId(na.node_id);if(null!=A){if(null!=A.videos&&A.videos.length>0)for(var s in A.videos){var B=A.videos[s];null!=room.pubVideos&&room.pubVideos.length>0&&arrayUtil.objectSplice(room.pubVideos,B.id),null!=room.selfUser.subVideoIds&&room.selfUser.subVideoIds.length>0&&arrayUtil.baseSplice(room.selfUser.subVideoIds,B.id)}return null!=A.audio&&(null!=room.pubAudios&&room.pubAudios.length>0&&arrayUtil.objectSplice(room.pubAudios,A.audio.id),null!=room.selfUser.subAudioIds&&room.selfUser.subAudioIds.length>0&&arrayUtil.baseSplice(room.selfUser.subAudioIds,A.audio.id)),null!=A.screen&&(null!=room.pubScreens&&room.pubScreens.length>0&&arrayUtil.objectSplice(room.pubScreens,A.screen.id),null!=room.selfUser.subScreenIds&&room.selfUser.subScreenIds.length>0&&arrayUtil.baseSplice(room.selfUser.subScreenIds,A.screen.id)),room.removeUser(A.id),void room.eventEmitter.emit(RoomCallback.user_leave_notify,na.opt,na.reason,A)}null!=room.selfUser&&na.node_id==room.selfUser.nodeId&&(room.selfUser.mulLanding=!0,room.masterServer.pingInit(),room.eventEmitter.emit(RoomCallback.leave_indication,ErrorConstant.mulLanding_error.message,room.selfUser.id));break;case g.OFFER_REQ:log.debug("P2P acception Offer,send answer");var qa=f.decodeBody(e);room.traceableP2PPeerConnection.setRemoteP2P(qa);break;case g.OFFER_REP:log.debug("P2P acception OFFER_REP");var ra=f.decodeBody(e);room.traceableP2PPeerConnection.setAnswerP2P(ra);break;case g.CANDIDATE_MSG:log.debug("P2P acception candidate,send candidate");var u=f.decodeBody(e);room.traceableP2PPeerConnection.addIceCandidateP2P(u);break;case g.SUB_ROOM_RESOURCE_REQ:log.debug("P2P acception SUB_ROOM_RESOURCE_REQ");var sa=f.decodeBody(e);if(room.selfUser.nodeId>sa.sub_node_id){room.traceableP2PPeerConnection.addStreamP2P(sa);var ta=sa.info,ua=room.traceableP2PPeerConnection.getToP2PPeerConnection(sa.sub_node_id);ta.stream.type==h.video?(log.info("accept video P2P SUB_ROOM_RESOURCE_REQ: "+sa.sub_node_id+"------>"+room.selfUser.nodeId),room.selfUser.subVideoStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",ua,"video",1,ta,sa.sub_node_id)):ta.stream.type==h.audio?(log.info("accept audio P2P SUB_ROOM_RESOURCE_REQ: "+sa.sub_node_id+"------>"+room.selfUser.nodeId),
room.selfUser.subAudioStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",ua,"audio",1,ta,sa.sub_node_id)):ta.stream.type==h.desktop&&(log.info("accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+sa.sub_node_id+"------>"+room.selfUser.nodeId),room.selfUser.subScreenStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",ua,"desktop",1,ta,sa.sub_node_id))}else room.traceableP2PPeerConnection.addStreamP2P(sa),room.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",sa);break;case g.SUB_ROOM_RESOURCE_REP:log.debug("P2P acception SUB_ROOM_RESOURCE_REP, TO sub");var va=f.decodeBody(e);if(room.selfUser.nodeId>va.info.owner_id){var ta=va.info,ua=room.traceableP2PPeerConnection.getToP2PPeerConnection(ta.owner_id);ta.stream.type==h.video?(room.selfUser.subVideoStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",ua,"video",1,ta,ta.owner_id)):ta.stream.type==h.audio?(room.selfUser.subAudioStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",ua,"audio",1,ta,ta.owner_id)):ta.stream.type==h.desktop&&(room.selfUser.subScreenStream2ResourceInfo[ta.stream.stream_name]=ta,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",ua,"desktop",1,ta,ta.owner_id))}else room.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(va);break;case g.SUB_ROOM_RESOURCE_MSG:log.debug("P2P acception SUB_ROOM_RESOURCE_MSG");var wa=f.decodeBody(e);room.traceableP2PPeerConnection.getSubSdpAnswerP2P(wa);break;case g.ANNOTATION_MSG:log.debug("acception ANNOTATION_MSG")}},e}),ModuleBase.define("User",["Video","Audio","Screen","Error"],function(a,b,c,d){var e=function(a,b,c,d){this.id=a,this.name=b,this.data=c,this.password=d,this.nodeId=null,this.role=null,this.videos=[],this.audio,this.screen,this.toMCUPC,this.toMCUPCForFirefox,this.mulLanding=!1,this.eventEmitter=new EventEmitter,this.videoSdpSsrc,this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoStream2ResourceInfo={},this.subAudioStream2ResourceInfo={},this.subScreenStream2ResourceInfo={},this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.reconnectionSubVideoIds=null,this.reconnectionSubAudioIds=null,this.reconnectionSubScreenIds=null,this.reconnectionUsers=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]};return e.prototype.createVideo=function(b,c){var d=new a(b,c);return this.videos.push(d),d},e.prototype.createAudio=function(a,c){var d=new b(a,c);return this.audio=d,d},e.prototype.createScreen=function(a,b){var d=new c(a,b);return this.screen=d,d},e.prototype.initScreen=function(){var a="screen-"+this.id,b=this.name+"-screen",c=this.createScreen(a,b);c.level=0,c.description="",this.eventEmitter.emit(UserCallback.screen_status_notify,c.status,c.id,c.name,this.id);var d=room.composePDUDeviceId(this.id,a);room.masterServer.addScreenMsg(d,c)},e.prototype.initVideo=function(a,b){var c=this.createVideo(a,b);c.cameraType=CameraType.unknown,c.level=0,c.description="",this.eventEmitter.emit(UserCallback.camera_status_notify,c.status,c.id,c.name,this.id);var d=room.composePDUDeviceId(this.id,a);room.masterServer.addWebcamMsg(d,c)},e.prototype.deleteVideo=function(a){var b=this.getVideo(a);if(null!=b){b.status==StreamStatus.opened?b.unpreview():b.status==StreamStatus.published&&b.unpublish(),arrayUtil.objectSplice(this.videos,a),this.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,b.id,b.name,this.id);var c=room.composePDUDeviceId(this.id,a);room.masterServer.removeWebcamMsg(c)}},e.prototype.initAudio=function(a,b){var c=this.createAudio(a,b);room.avdEngine.checkAudioId=a,room.avdEngine.checkAudioName=b,this.eventEmitter.emit(UserCallback.microphone_status_notify,c.status,c.id,c.name,this.id);var d=room.composePDUDeviceId(this.id,a);room.masterServer.addSpeakerMsg(d,c)},e.prototype.deleteAudio=function(a){var b=this.getAudio(a);if(null!=b){b.status==StreamStatus.published&&video.closeMicrophone(),this.audio=null,this.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,b.id,b.name,this.id);var c=room.composePDUDeviceId(this.id,a);room.masterServer.removeSpeakerMsg(c)}},e.prototype.getVideo=function(a){for(var b=null,c=0;c<this.videos.length;c++){var d=this.videos[c];if(d.id==a){b=d;break}}return b},e.prototype.getScreen=function(a){"undefined"==typeof a&&(a="screen-"+this.id);var b=null;return null!=this.screen&&this.screen.id==a&&(b=this.screen),b},e.prototype.getAudio=function(a){var b=null;return null!=this.audio&&this.audio.id==a&&(b=this.audio),b},e.prototype.openCameraAndMicrophone=function(a,b,c,e){var f=when.defer(),g=this;return null!=a&&null==b?a.publish():null==a&&null!=b?b.openMicrophone():null!=a&&null!=b&&obtainUserMedia(b,a,function(d){var h=getRandomNum(1,3e3);a.status=StreamStatus.opened,a.stream=d.videoStream;var i=room.composePDUDeviceId(g.id,a.id);room.masterServer.videoPublishHandle(i,a.stream,h),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(b){b==h&&(a.element=c,attachMediaStream(c,d.videoStream),a.status=StreamStatus.published,room.pubVideos.push(a),g.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,g.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,b){b==h&&f.reject(a)});var j=getRandomNum(30001,6e3);b.state=StreamStatus.opened,b.stream=d.audioStream;var k=room.composePDUDeviceId(g.id,b.id);room.masterServer.audioPublishHandle(k,b.stream,j),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(a){a==j&&(b.element=e,attachMediaStream(e,d.audioStream),b.status=StreamStatus.published,room.pubAudios.push(b),g.eventEmitter.emit(UserCallback.microphone_status_notify,b.status,b.id,b.name,g.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(a,b){b==j&&f.reject(a)})},function(a){var b=new d(ErrorConstant.failed_access_localMedia);f.reject(b)}),f.promise},e.prototype.remotecmdPublishCamera=function(a){var b=room.splitUserId(a.id),c=room.getNodeId(b);room.masterServer.videoIndiction(!0,a.id,c)},e.prototype.remotecmdUnpublishCamera=function(a){var b=room.splitUserId(a),c=room.getNodeId(b);room.masterServer.videoIndiction(!1,a,c)},e.prototype.remotecmdOpenMicrophone=function(a){var b=room.getUser(a),c=room.getNodeId(a);room.masterServer.audioIndiction(!0,b.audio.id,c)},e.prototype.remotecmdCloseMicrophone=function(a){var b=room.getUser(a),c=room.getNodeId(a);room.masterServer.audioIndiction(!1,b.audio.id,c)},e.prototype.updateUserData=function(a){this.data=a,room.masterServer.updateUserDataMsg(a)},e.prototype.getUserData=function(a){if("undefined"==typeof a||null==a||""==a)return this.data;var b=room.getUser(a);return null!=b?b.data:void 0},e.prototype.attachVideoElementMediaStream=function(a,b){if(null!=b){var c=this.subVideoStream2ResourceInfo[b.id],d=this.getUserByVideoStreamLabel(b.id),e=d.getVideo(c.resource_id);e.element=a}attachMediaStream(a,b)},e.prototype.attachScreenElementMediaStream=function(a,b){if(null!=b){var c=this.subScreenStream2ResourceInfo[b.id],d=this.getUserByScreenStreamLabel(b.id),e=d.getScreen(c.resource_id);e.element=a}attachMediaStream(a,b)},e.prototype.attachAudioElementMediaStream=function(a,b){if(null!=b){var c=this.subAudioStream2ResourceInfo[b.id],d=this.getUserByAudioStreamLabel(b.id),e=d.getAudio(c.resource_id);e.element=a}attachMediaStream(a,b)},e.prototype.addCallback=function(a,b){this.eventEmitter.addListener(a,b)},e.prototype.getUserByVideoStreamLabel=function(a){var b=this.subVideoStream2ResourceInfo[a];if(null!=b){var c=b.owner_id;return room.getUserByNodeId(c)}return null},e.prototype.getUserByAudioStreamLabel=function(a){var b=this.subAudioStream2ResourceInfo[a];if(null!=b){var c=b.owner_id;return room.getUserByNodeId(c)}return null},e.prototype.getUserByScreenStreamLabel=function(a){var b=this.subScreenStream2ResourceInfo[a];if(null!=b){var c=b.owner_id;return room.getUserByNodeId(c)}return null},e}),ModuleBase.define("Record",["RecordRestServer","Error"],function(a,b){var c=function(b){this.restServerURI=b,this.recordRestServer=new a,this.recordInfo={name:"",tag:"",roomId:"",userId:"",audioType:RecordEnum.AudioType.singleuser,videoType:RecordEnum.VideoType.mainflow,fileType:RecordEnum.FileType.mp4}};return c.prototype.createUserRecord=function(a,c){var d=when.defer();if(!c){var e=new b(ErrorConstant.params_require);return d.reject(e),d.promise}if(""==c.roomId){var e=new b(ErrorConstant.roomId_required);return d.reject(e),d.promise}if(""==c.userId){var e=new b(ErrorConstant.userId_required);return d.reject(e),d.promise}return this.recordRestServer.createUserRecord(this.restServerURI,a,c).then(function(a){d.resolve(a)}).otherwise(function(a){d.reject(a)}),d.promise},c.prototype.stopRecord=function(a,b){var c=when.defer();return this.recordRestServer.stopRecord(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.getRecord=function(a,b){var c=when.defer();return this.recordRestServer.getRecord(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.deleteRecord=function(a,b){var c=when.defer();return this.recordRestServer.deleteRecord(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.findRecords=function(a,b,c,d){var e=when.defer();return this.recordRestServer.findRecords(this.restServerURI,a,b,c,d).then(function(a){e.resolve(a)}).otherwise(function(a){e.reject(a)}),e.promise},c}),ModuleBase.define("RecordRestServer",["Error"],function(a){var b=function(){};return b.prototype.createUserRecord=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/record/createUserRecord?accessToken="+c+"&callback=?";return console.log(g),$.ajax({type:"post",url:g,dataType:"jsonp",data:d,timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/record/createUserRecord) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.stopRecord=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/record/stop?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/record/stop) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.getRecord=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/record/getRecord?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/record/getRecord) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.deleteRecord=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/record/delete?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/record/delete) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.findRecords=function(b,c,d,e,f){var g=when.defer(),h=document.location.protocol,i=h+"//"+b+"/avd/api/record/findRecords?begin="+d+"&count="+e+"&filter="+f+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)g.resolve(b.data);else{var c=new a(b.result,b.err);g.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/record/findRecords) errorCode:"+b.status+",errorMsg:"+b.statusText);var e=new a(b.status,b.statusText);g.reject(e)}}),g.promise},b}),ModuleBase.define("Live",["LiveRestServer","Error"],function(a,b){var c=function(b){this.restServerURI=b,this.liveRestServer=new a,this.liveInfo={name:"",tag:"",roomId:"",userId:"",audioType:LiveEnum.AudioType.singleuser,videoType:LiveEnum.VideoType.mainflow}};return c.prototype.createUserLive=function(a,c){var d=when.defer();if(!c){var e=new b(ErrorConstant.params_require);return d.reject(e),d.promise}if(""==c.roomId){var e=new b(ErrorConstant.roomId_required);return d.reject(e),d.promise}if(""==c.userId){var e=new b(ErrorConstant.userId_required);return d.reject(e),d.promise}return this.liveRestServer.createUserLive(this.restServerURI,a,c).then(function(a){d.resolve(a)}).otherwise(function(a){d.reject(a)}),d.promise},c.prototype.stopLive=function(a,b){var c=when.defer();return this.liveRestServer.stopLive(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.getLive=function(a,b){var c=when.defer();return this.liveRestServer.getLive(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.deleteLive=function(a,b){var c=when.defer();return this.liveRestServer.deleteLive(this.restServerURI,a,b).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)}),c.promise},c.prototype.findLives=function(a,b,c,d){var e=when.defer();return this.liveRestServer.findLives(this.restServerURI,a,b,c,d).then(function(a){e.resolve(a)}).otherwise(function(a){e.reject(a)}),e.promise},c}),ModuleBase.define("LiveRestServer",["Error"],function(a){var b=function(){};return b.prototype.createUserLive=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/live/createUserLive?accessToken="+c+"&callback=?";return console.log(g),$.ajax({type:"post",url:g,dataType:"jsonp",data:d,timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/live/createUserLive) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.stopLive=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/live/stop?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/live/stop) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.getLive=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/live/getLive?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/live/getLive) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.deleteLive=function(b,c,d){var e=when.defer(),f=document.location.protocol,g=f+"//"+b+"/avd/api/live/delete?id="+d+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:g,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)e.resolve(b.data);else{var c=new a(b.result,b.err);e.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/live/delete) errorCode:"+b.status+",errorMsg:"+b.statusText);var f=new a(b.status,b.statusText);e.reject(f)}}),e.promise},b.prototype.findLives=function(b,c,d,e,f){var g=when.defer(),h=document.location.protocol,i=h+"//"+b+"/avd/api/live/findLives?begin="+d+"&count="+e+"&filter="+f+"&accessToken="+c+"&callback=?";return $.ajax({type:"get",url:i,dataType:"jsonp",timeout:5e3,success:function(b){if(b&&0==b.result)g.resolve(b.data);else{var c=new a(b.result,b.err);g.reject(c)}},error:function(b,c,d){log.info("ajax (/avd/api/live/findLives) errorCode:"+b.status+",errorMsg:"+b.statusText);var e=new a(b.status,b.statusText);g.reject(e)}}),g.promise},b}),ModuleBase.define("Annotation",["Error"],function(a){var b=function(){this.zr=null,this.shapeArray=[],this.currentIndex=-1,this.currentWidth=null,this.click=!1,this.annoDiv=null,this.videoAnnoDiv=null,this.videoObject=null,this.scrollX=0,this.scrollY=0,this.finishAnimate=!0,this.zrender=null,this.ellipse=null,this.line=null,this.rect=null,this.polyline=null,this.arrowline=null,this.shapeType=canvasTypeEnum.line,this.drawOrEraser=annoSelectTypeEnum.draw,this.color="rgba(255,0,0,1)",this.lineWidth=1,this.arrowLength=10,this.arrowtype=arrowTypeEnum.none,this.fillType=fillTypeEnum.none,this.fillColor="none",this.eraserArray={}};return b.prototype.init=function(a,b,c,d){this.annoDiv=a,this.videoAnnoDiv=b,this.videoObject=c,this.shapeArray=[],this.currentIndex=-1;var e=this;require.config({paths:{zrender:d,"zrender/graphic/shape/Arrowline":d,"zrender/graphic/shape/Ellipse":d,"zrender/graphic/shape/Rect":d,"zrender/graphic/shape/Line":d,"zrender/graphic/shape/Polyline":d}}),require(["zrender","zrender/graphic/shape/Ellipse","zrender/graphic/shape/Line","zrender/graphic/shape/Rect","zrender/graphic/shape/Polyline","zrender/graphic/shape/Arrowline"],function(a,b,c,d,f,g){e.zrender=a,e.ellipse=b,e.line=c,e.rect=d,e.polyline=f,e.arrowline=g})},b.prototype.undo=function(){for(;this.shapeArray[this.currentIndex]&&this.shapeArray[this.currentIndex].remove;)this.currentIndex--;return this.currentIndex<0?void(this.currentIndex=-1):(this.shapeArray[this.currentIndex].shape&&this.zr.remove(this.shapeArray[this.currentIndex].shape),room.sendAnnotation(0,this.shapeArray[this.currentIndex].annotationId,[{x:0,y:0},{x:0,y:0}],canvasTypeEnum.undo,this.color,this.lineWidth,this.arrowtype,this.fillType),void this.currentIndex--)},b.prototype.redo=function(){for(;this.shapeArray[this.currentIndex+1]&&this.shapeArray[this.currentIndex+1].remove;)this.currentIndex++;return this.currentIndex>=this.shapeArray.length-1?void(this.currentIndex=this.shapeArray.length-1):(this.currentIndex++,this.shapeArray[this.currentIndex].shape&&this.zr.add(this.shapeArray[this.currentIndex].shape),void room.sendAnnotation(0,this.shapeArray[this.currentIndex].annotationId,[{x:0,y:0},{x:0,y:0}],canvasTypeEnum.redo,this.color,this.lineWidth,this.arrowtype,this.fillType))},b.prototype.clear=function(){this.zr.clear(),this.shapeArray=[],this.currentIndex=-1},b.prototype.setShapeType=function(a){this.shapeType=parseInt(a)},b.prototype.setDrawOrEraser=function(a){this.drawOrEraser=parseInt(a)},b.prototype.setColor=function(a){this.color=a},b.prototype.setLineWidth=function(a){this.lineWidth=parseInt(a)},b.prototype.setArrowLength=function(a){this.arrowLength=parseInt(a)},b.prototype.setArrowType=function(a){this.arrowtype=parseInt(a)},b.prototype.setFillColor=function(a){this.fillType=a,a==fillTypeEnum.none?this.fillColor="none":this.fillColor=this.color},b.prototype.start=function(b){function c(a){if(o.click=!0,o.drawOrEraser==annoSelectTypeEnum.draw){r=a.clientX-l.getBoundingClientRect().left,s=a.clientY-l.getBoundingClientRect().top,o.shapeType==canvasTypeEnum.ellipse?t=new z({position:[r,s],scale:[1,1],shape:{cx:0,cy:0,rx:0,ry:0},style:{lineWidth:o.lineWidth,stroke:o.color,fill:o.fillColor},index:o.currentIndex,onmouseover:f}):o.shapeType==canvasTypeEnum.line?t=new x({shape:{x1:r,y1:s,x2:r,y2:s},style:{lineWidth:o.lineWidth,stroke:o.color},index:o.currentIndex,onmouseover:f}):o.shapeType==canvasTypeEnum.rect?t=new A({shape:{x:r,y:s,width:0,height:0},style:{lineWidth:o.lineWidth,stroke:o.color,fill:o.fillColor},index:o.currentIndex,onmouseover:f}):o.shapeType==canvasTypeEnum.polyline?(u=[],u.push([r,s]),t=new y({shape:{points:[]},style:{lineWidth:o.lineWidth,stroke:o.color,fill:"none"},index:o.currentIndex,onmouseover:f})):o.shapeType==canvasTypeEnum.arrowline?t=new B({shape:{x1:r,y1:s,x2:r,y2:s,arrowlength:o.arrowLength,arrowtype:o.arrowtype},style:{lineWidth:o.lineWidth,stroke:o.color,fill:o.fillColor},index:o.currentIndex,onmouseover:f}):o.shapeType!=canvasTypeEnum.right&&o.shapeType!=canvasTypeEnum.wrong||(t=null),o.shapeArray.length=o.currentIndex+1,o.currentIndex++;var b={};b.annotationId=o.currentIndex,b.index=o.currentIndex,b.remove=!1,b.shape=t,b.shapeType=o.shapeType,o.shapeArray.push(b),o.shapeArray[o.currentIndex].shape&&w.add(o.shapeArray[o.currentIndex].shape)}}function d(a){if(o.click&&o.drawOrEraser==annoSelectTypeEnum.draw){var b=a.clientX-l.getBoundingClientRect().left,c=a.clientY-l.getBoundingClientRect().top;if(o.shapeType==canvasTypeEnum.ellipse){var d=(b-r)/2,e=(c-s)/2;t.animateTo({shape:{cx:d,cy:e,rx:d,ry:e}},30)}else o.shapeType==canvasTypeEnum.line?t.animateTo({shape:{x2:b,y2:c}},30):o.shapeType==canvasTypeEnum.rect?t.animateTo({shape:{width:b-r,height:c-s}},30):o.shapeType==canvasTypeEnum.polyline?(u.push([b,c]),t.animateTo({shape:{points:u}},30)):o.shapeType==canvasTypeEnum.arrowline&&t.animateTo({shape:{x2:b,y2:c}},30)}}function e(a){if(o.click=!1,o.drawOrEraser==annoSelectTypeEnum.draw){var b=a.clientX-l.getBoundingClientRect().left,c=a.clientY-l.getBoundingClientRect().top,d=[];if(null==u)d=[{x:h(r),y:i(s)},{x:h(b),y:i(c)}];else for(var e=0;e<u.length;e++){var f=u[e];d.push({x:h(f[0]),y:i(f[1])})}room.sendAnnotation(0,o.shapeArray[o.currentIndex].annotationId,d,o.shapeType,o.color,o.lineWidth,o.arrowtype,o.fillType,null),u=null,t=null}else if(o.drawOrEraser==annoSelectTypeEnum.eraser){var g=[];for(var j in o.eraserArray){var k=o.shapeArray[j].shape;o.zr.remove(k),o.shapeArray[j].remove=!0,g.push(j+"")}o.currentIndex++,room.sendAnnotation(0,o.currentIndex,[{x:0,y:0}],canvasTypeEnum.eraser,o.color,o.lineWidth,o.arrowtype,o.fillType,g),o.eraserArray={}}}function f(a){if(o.click&&o.drawOrEraser==annoSelectTypeEnum.eraser){var b=a.target.index+1;if(o.drawOrEraser!=annoSelectTypeEnum.eraser||o.eraserArray[b])return;o.eraserArray[b]=!0}}function g(){for(var a=m.scrollLeft,b=m.scrollTop,c=o.scrollX-a,d=o.scrollY-b,e=0;e<o.shapeArray.length;e++){var f=o.shapeArray[e].shape,g=o.shapeArray[e].shapeType;if(g==canvasTypeEnum.ellipse)f.animateTo({position:[f.position[0]+c,f.position[1]+d]},100);else if(g==canvasTypeEnum.line)f.animateTo({shape:{x1:f.shape.x1+c,y1:f.shape.y1+d,x2:f.shape.x2+c,y2:f.shape.y2+d}},100);else if(g==canvasTypeEnum.rect)f.animateTo({shape:{x:f.shape.x+c,y:f.shape.y+d}},100);else if(g==canvasTypeEnum.polyline){for(var h=f.shape.points,i=[],j=0;j<h.length;j++)i.push([h[j][0]+c,h[j][1]+d]);f.animateTo({shape:{points:i}},100)}else g==canvasTypeEnum.arrowline&&f.animateTo({shape:{x1:f.shape.x1+c,y1:f.shape.y1+d,x2:f.shape.x2+c,y2:f.shape.y2+d}},100)}setTimeout(function(){o.scrollX=a,o.scrollY=b,o.finishAnimate=!0},250)}function h(a){a+=m.scrollLeft;var b=n.videoWidth,c=n.clientWidth;return parseInt(a*b/c)}function i(a){a+=m.scrollTop;var b=n.videoHeight,c=n.clientHeight;return parseInt(a*b/c)}var j=when.defer();if(!room||!room.selfUser){var k=new a(ErrorConstant.not_join_room);return j.reject(k),j.promise}if(0==room.pubScreens.length){var k=new a(ErrorConstant.screen_sharing_response_is_null);return j.reject(k),j.promise}var l=this.annoDiv,m=this.videoAnnoDiv,n=this.videoObject,o=this,p=m.style.height.split("px"),q=m.style.width.split("px");for(l.style.height=p[0]-20+"px",l.style.width=q[0]-20+"px",l.style.left="0px",l.style.top="0px",l.style.display="block";m.getBoundingClientRect().left!=l.getBoundingClientRect().left;)l.style.left=m.getBoundingClientRect().left-l.getBoundingClientRect().left+"px";for(;m.getBoundingClientRect().top!=l.getBoundingClientRect().top;)l.style.top=m.getBoundingClientRect().top-l.getBoundingClientRect().top+"px";var r=0,s=0,t=null,u=null,v=null,w=this.zrender.init(l);this.zr=w;var x=this.line,y=this.polyline,z=this.ellipse,A=this.rect,B=this.arrowline;this.currentWidth||(this.currentWidth=b);for(var C=b/this.currentWidth,D=0;D<o.shapeArray.length;D++){var E=o.shapeArray[D].shape;E&&w.add(E);var F=o.shapeArray[D].shapeType;if(F==canvasTypeEnum.ellipse)E.animateTo({position:[E.position[0]*C,E.position[1]*C],shape:{cx:E.shape.cx*C,cy:E.shape.cy*C,rx:E.shape.rx*C,ry:E.shape.ry*C}},30);else if(F==canvasTypeEnum.line)E.animateTo({shape:{x1:E.shape.x1*C,y1:E.shape.y1*C,x2:E.shape.x2*C,y2:E.shape.y2*C}},30);else if(F==canvasTypeEnum.rect)E.animateTo({shape:{x:E.shape.x*C,y:E.shape.y*C,width:E.shape.width*C,height:E.shape.height*C}},30);else if(F==canvasTypeEnum.polyline){for(var G=E.shape.points,H=[],I=0;I<G.length;I++)H.push([G[I][0]*C,G[I][1]*C]);E.animateTo({shape:{points:H}},30)}else F==canvasTypeEnum.arrowline&&E.animateTo({shape:{x1:E.shape.x1*C,y1:E.shape.y1*C,x2:E.shape.x2*C,y2:E.shape.y2*C}},30)}return this.currentWidth=b,l.onmousedown=c,l.onmousemove=d,l.onmouseup=e,m.addEventListener("scroll",function(){o.finishAnimate&&(o.finishAnimate=!1,clearTimeout(v),v=null,g(),v=setTimeout(g,500))}),j.resolve(),j.promise},b});